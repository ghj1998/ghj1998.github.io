<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>ANTLRå®‰è£…å’Œåˆæ¬¡å°è¯•</title>
    <url>/2021/04/26/ANTLR4%E6%8C%87%E5%8D%97/</url>
    <content><![CDATA[<blockquote>
<p>æœ¬æ–‡æ˜¯antlr4æƒå¨æŒ‡å—çš„é˜…è¯»ç¬”è®°ã€‚</p>
<p>ä¹¦ç±é“¾æ¥ï¼šé“¾æ¥: <a href="https://pan.baidu.com/s/1OLBC46BL8V_3qZQm7bgzdw">https://pan.baidu.com/s/1OLBC46BL8V_3qZQm7bgzdw</a> æå–ç : ckdf</p>
</blockquote>
<h1 id="1-åˆè¯†ANTLR"><a href="#1-åˆè¯†ANTLR" class="headerlink" title="1. åˆè¯†ANTLR"></a>1. åˆè¯†ANTLR</h1><h2 id="1-1-å®‰è£…ANTLR"><a href="#1-1-å®‰è£…ANTLR" class="headerlink" title="1.1 å®‰è£…ANTLR"></a>1.1 å®‰è£…ANTLR</h2><p><strong>ç¬¬ä¸€æ­¥ï¼šä¸‹è½½jaråŒ…</strong></p>
<blockquote>
<p>è¯¥ä¹¦ç±ä½¿ç”¨4.0ç‰ˆæœ¬ï¼Œä½†æ˜¯å½“å‰æœ€æ–°ç‰ˆå·²ç»åˆ°äº†4.9.2ç‰ˆæœ¬äº†ï¼Œæœ¬æ–‡ä»ç„¶é‡‡ç”¨4.0ç‰ˆæœ¬ã€‚</p>
</blockquote>
<p>jaråŒ…åŒ…å«äº†ANTLRå·¥å…·ã€è¿è¡Œåº“ã€æ ‘å½¢ç»“æ„ç”Ÿæˆåº“ã€SrtingTemplateã€‚</p>
<ul>
<li><p><strong>ANTLRå·¥å…·</strong>ï¼šå°†è¯­æ³•æ–‡ä»¶è½¬åŒ–æˆå¯ä»¥è¯†åˆ«è¯¥è¯­æ³•æ–‡ä»¶æ‰€æè¿°çš„è¯­è¨€çš„ç¨‹åºã€‚ä¾‹å¦‚ï¼šç»™å®šä¸€ä¸ªè¯†åˆ«JSONçš„è¯­æ³•ï¼ŒANTLRå·¥å…·ä¼šæ ¹æ®è¯¥è¯­æ³•ç”Ÿæˆç¨‹åºã€‚</p>
</li>
<li><p><strong>è¿è¡Œåº“</strong>ï¼šåˆ©ç”¨ANTLRå·¥å…·ç”Ÿæˆçš„ç¨‹åºé€šè¿‡ANTLRè¿è¡Œåº“æ¥è¯†åˆ«è¾“å…¥çš„JSONã€‚</p>
</li>
<li><p><strong>æ ‘å½¢ç»“æ„ç”Ÿæˆåº“</strong>ï¼šç”Ÿæˆæ ‘å½¢ç»“æ„ã€‚</p>
</li>
<li><p><strong>StringTemplate</strong>ï¼šç”¨äºç”Ÿæˆæºä»£ç ã€ç½‘é¡µã€ç”µå­é‚®ä»¶æˆ–å…¶ä»–æ ¼å¼åŒ–çš„è¾“å‡ºæ–‡æœ¬ã€‚</p>
</li>
</ul>
<p><strong>UNIXç³»ç»Ÿ</strong></p>
<ol start="0">
<li><p>å®‰è£…JAVA</p>
</li>
<li><p>ä¸‹è½½</p>
</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /usr/<span class="built_in">local</span>/lib</span><br><span class="line">$ curl -O https://www.antlr.org/download/antlr-4.0-complete.jar</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>æ·»åŠ <code>antlr-4.9-complete.jar</code>åˆ°<code>CLASSPATH</code>ï¼š</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">$ export CLASSPATH=<span class="string">&quot;.:/usr/local/lib/antlr-4.0-complete.jar:$CLASSPATH&quot;</span></span><br></pre></td></tr></table></figure>

<p>å°†å…¶æ”¾å…¥<code>.bash_profile</code>ä¸­ï¼ˆç”¨æˆ·æ ¹ç›®å½•ï¼‰ã€‚</p>
<ol start="3">
<li>ä¸ºANTLRå·¥å…·åˆ›å»ºåˆ«åï¼Œç„¶åä¸º<code>TestRig</code>ã€‚</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ <span class="built_in">alias</span> antlr4=<span class="string">&#x27;java -Xmx500M -cp &quot;/usr/local/lib/antlr-4.0-complete.jar:$CLASSPATH&quot; org.antlr.v4.Tool&#x27;</span></span><br><span class="line">$ <span class="built_in">alias</span> grun=<span class="string">&#x27;java -Xmx500M -cp &quot;/usr/local/lib/antlr-4.0-complete.jar:$CLASSPATH&quot; org.antlr.v4.gui.TestRig&#x27;</span></span><br></pre></td></tr></table></figure>

<p><strong>Windowsç³»ç»Ÿ</strong></p>
<ol start="0">
<li><p>å®‰è£…JAVA</p>
</li>
<li><p>ä»<a href="https://www.antlr.org/download/%E4%B8%8B%E8%BD%BDantlr-4.0-complete.jar%EF%BC%88%E6%88%96%E4%BB%BB%E4%BD%95%E7%89%88%E6%9C%AC%EF%BC%89%EF%BC%8C%E7%84%B6%E5%90%8E">https://www.antlr.org/download/ä¸‹è½½antlr-4.0-complete.jarï¼ˆæˆ–ä»»ä½•ç‰ˆæœ¬ï¼‰ï¼Œç„¶å</a> ä¿å­˜åˆ°ç¬¬ä¸‰æ–¹Javaåº“çš„ç›®å½•ä¸­<code>C:\Javalib</code></p>
</li>
<li><p>æ·»åŠ <code>antlr-4.0-complete.jar</code>åˆ°CLASSPATHï¼Œå¯ä»¥ï¼š</p>
<ul>
<li>æ°¸ä¹…ï¼šé«˜çº§ç³»ç»Ÿè®¾ç½®&gt;ç¯å¢ƒå˜é‡&gt;åˆ›å»ºæˆ–é™„åŠ åˆ°<code>CLASSPATH</code>å˜é‡</li>
</ul>
</li>
<li><p>ä½¿ç”¨æ‰¹å¤„ç†æ–‡ä»¶æˆ–doskeyå‘½ä»¤ä¸ºANTLRå·¥å…·å’ŒTestRigåˆ›å»ºç®€çŸ­çš„ä¾¿æ·å‘½ä»¤ï¼š</p>
<ul>
<li>ä½¿ç”¨doskeyå‘½ä»¤ï¼š</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">doskey antlr4=java org.antlr.v4.Tool $*</span><br><span class="line">doskey grun =java org.antlr.v4.runtime.misc.TestRig  $*</span><br></pre></td></tr></table></figure>

<p>æ¯æ¬¡æ‰“å¼€å‘½ä»¤è¡Œéƒ½éœ€è¦é‡æ–°è¾“å…¥è¿™æ®µå‘½ä»¤ï¼Œå¯ä»¥é€šè¿‡ä¿®æ”¹æ³¨å†Œè¡¨æ¥ä½¿å¾—æ¯æ¬¡æ‰“å¼€è‡ªåŠ¨è¾“å…¥è¿™ä¸¤æ¡å‘½ä»¤ã€‚</p>
<p>å…·ä½“æ“ä½œå‚ç…§ï¼š<a href="https://www.zhihu.com/question/51962577/answer/128317488">https://www.zhihu.com/question/51962577/answer/128317488</a></p>
</li>
</ol>
<h2 id="1-2-æµ‹è¯•-amp-åˆæ¬¡å°è¯•"><a href="#1-2-æµ‹è¯•-amp-åˆæ¬¡å°è¯•" class="headerlink" title="1.2 æµ‹è¯•&amp;åˆæ¬¡å°è¯•"></a>1.2 æµ‹è¯•&amp;åˆæ¬¡å°è¯•</h2><p>å°†ä»¥ä¸‹è¯­æ³•æ”¾å…¥æ–‡ä»¶Hello.g4ä¸­ï¼šHello.g4</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Define a grammar called Hello</span></span><br><span class="line">grammar Hello;</span><br><span class="line">r  : <span class="string">&#x27;hello&#x27;</span> ID ;         <span class="comment">// match keyword hello followed by an identifier</span></span><br><span class="line">ID : [a-z]+ ;             <span class="comment">// match lower-case identifiers</span></span><br><span class="line">WS : [ \t\r\n]+ -&gt; skip ; <span class="comment">// skip spaces, tabs, newlines</span></span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/ghj1998/image_repository/main/image-20210429165441964.png" alt="image-20210429165441964"></p>
<p>åœ¨å…¶ä¸Šè¿è¡ŒANTLRå·¥å…·ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /tmp</span><br><span class="line">$ antlr4 Hello.g4</span><br><span class="line">$ javac Hello*.java</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œ<code>antlr4 Hello.g4</code>åï¼Œä¼šè‡ªåŠ¨ç”Ÿæˆ.javaæ–‡ä»¶ä»¥åŠ.tokensæ–‡ä»¶ã€‚</p>
<p><img src="https://raw.githubusercontent.com/ghj1998/image_repository/main/image-20210429165536160.png" alt="image-20210429165536160"></p>
<p>æ‰§è¡Œ<code>javac Hello*.java</code>ä¼šæŠŠæ‰€æœ‰çš„.javaæ–‡ä»¶ç¼–è¯‘æˆ.classæ–‡ä»¶ã€‚</p>
<p><img src="https://raw.githubusercontent.com/ghj1998/image_repository/main/image-20210429165657920.png" alt="image-20210429165657920"></p>
<p>æµ‹è¯•ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">grun Hello r -tokens</span><br><span class="line">=&gt;hello parrt</span><br><span class="line">=&gt;(Ctrl+Z)</span><br><span class="line"><span class="comment">#è¾“å‡ºï¼š</span></span><br><span class="line">[@0,0:4=<span class="string">&#x27;hello&#x27;</span>,&lt;1&gt;,1:0]</span><br><span class="line">[@1,6:10=<span class="string">&#x27;parrt&#x27;</span>,&lt;2&gt;,1:6]</span><br><span class="line">[@2,13:12=<span class="string">&#x27;&lt;EOF&gt;&#x27;</span>,&lt;-1&gt;,2:0]</span><br></pre></td></tr></table></figure>

<p>æ¯è¡Œä»£è¡¨ä¸€ä¸ªè¯æ³•ç¬¦å·ï¼Œè¡¨æ˜äº†å…¨éƒ¨ä¿¡æ¯ï¼Œä¾‹å¦‚<code>[@1,6:10=&#39;parrt&#39;,&lt;2&gt;,1:6]</code>è¡¨ç¤ºï¼Œè¿™ä¸ªè¯æ³•ç¬¦å·ä½äºç¬¬äºŒä¸ªä½ç½®ï¼Œç”±è¾“å…¥æ–‡æœ¬çš„ç¬¬6-10ä¸ªä½ç½®ä¹‹é—´çš„å­—ç¬¦ç»„æˆã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">grun Hello r -gui</span><br><span class="line">=&gt;hello parrt</span><br><span class="line">=&gt;(Ctrl+Z)</span><br></pre></td></tr></table></figure>

<p>åˆ©ç”¨guiå¯ä»¥å±•ç¤ºè¯­æ³•åˆ†ææ ‘ï¼š</p>
<p><img src="https://raw.githubusercontent.com/ghj1998/image_repository/main/image-20210426173304589.png" alt="image-20210426173304589"></p>
]]></content>
      <tags>
        <tag>JAVA</tag>
        <tag>è¯­æ³•åˆ†æ</tag>
        <tag>ANTLR</tag>
      </tags>
  </entry>
  <entry>
    <title>ANTLR4ç†è§£</title>
    <url>/2021/05/10/ANTLR4%E7%90%86%E8%A7%A3/</url>
    <content><![CDATA[<h1 id="ANTLRèƒŒååœ¨å¹²ä»€ä¹ˆï¼Ÿ"><a href="#ANTLRèƒŒååœ¨å¹²ä»€ä¹ˆï¼Ÿ" class="headerlink" title="ANTLRèƒŒååœ¨å¹²ä»€ä¹ˆï¼Ÿ"></a>ANTLRèƒŒååœ¨å¹²ä»€ä¹ˆï¼Ÿ</h1><h2 id="1-è¯­æ³•åˆ†æçš„è¿‡ç¨‹"><a href="#1-è¯­æ³•åˆ†æçš„è¿‡ç¨‹" class="headerlink" title="1. è¯­æ³•åˆ†æçš„è¿‡ç¨‹"></a>1. è¯­æ³•åˆ†æçš„è¿‡ç¨‹</h2><p><strong>è¯­æ³•åˆ†æ</strong>ç”±ä¸¤ä¸ªé˜¶æ®µï¼š</p>
<ul>
<li><strong>è¯æ³•åˆ†æ(lexical analysis)/è¯æ³•ç¬¦å·åŒ–(tokenizing)<strong>ï¼šå°†å­—ç¬¦èšé›†ä¸ºå•è¯æˆ–è€…ç¬¦å·(<strong>è¯æ³•ç¬¦å·ï¼Œtoken</strong>)çš„è¿‡ç¨‹ï¼Œå°†</strong>è¾“å…¥æ–‡æœ¬</strong>è½¬åŒ–ä¸º<strong>è¯æ³•ç¬¦å·</strong>çš„è¿‡ç¨‹ç§°ä¸º<strong>è¯æ³•åˆ†æå™¨(lexer)<strong>ã€‚</strong>è¯æ³•åˆ†æå™¨</strong>å¯ä»¥å°†è¯æ³•ç¬¦å·åˆ†ç±»ï¼Œä¾‹å¦‚INTï¼ŒFLOATç­‰ç­‰ã€‚è¯æ³•ç¬¦å·åŒ…å«è‡³å°‘ä¸¤éƒ¨åˆ†ä¿¡æ¯ï¼Œè¯æ³•ç¬¦å·çš„ç±»å‹ä»¥åŠè¯¥ç¬¦å·å¯¹åº”çš„æ–‡æœ¬ã€‚</li>
<li><strong>è¯†åˆ«è¯­å¥ç»“æ„</strong>ï¼šæ„é€ è¯­æ³•åˆ†ææ ‘æ¥è®°å½•è¯­æ³•åˆ†æå™¨çš„æ•°æ®ç»“æ„ã€‚</li>
</ul>
<p>æ€»çš„æ¥è¯´ï¼Œå°±æ˜¯å…ˆåˆ’åˆ†æˆè¯ï¼Œå†åˆ†æã€‚</p>
<p>ä¾‹å¦‚ï¼š</p>
<p><img src="https://raw.githubusercontent.com/ghj1998/image_repository/main/image-20210426213615055.png" alt="image-20210426213615055"></p>
<p><strong>è¯­æ³•åˆ†ææ ‘è§£æ</strong>ï¼š</p>
<ul>
<li>å¶å­èŠ‚ç‚¹æ°¸è¿œæ˜¯è¾“å…¥çš„è¯æ³•ç¬¦å·ã€‚</li>
<li>æ ¹èŠ‚ç‚¹æ˜¯æŠ½è±¡çš„åå­—ï¼Œstatæ˜¯statementçš„ç®€å†™ã€‚</li>
<li>æ ‘çš„ç»“æ„åœ¨åç»­å¾ˆå¥½å¤„ç†ï¼Œå¹¶ä¸”èƒ½ä¼ é€’å®Œæ•´çš„ç¬¦å·ä¿¡æ¯ã€‚</li>
<li>å­æ ‘çš„æ ¹èŠ‚ç‚¹æ˜¯å¯¹åº”è¯­æ³•è§„åˆ™çš„åå­—ã€‚</li>
</ul>
<p><img src="https://raw.githubusercontent.com/ghj1998/image_repository/main/image-20210426215414826.png" alt="image-20210426215414826"></p>
<p>è¿™å°±æ˜¯è¯­æ³•è§„åˆ™ã€‚</p>
<h2 id="2-å®ç°ä¸€ä¸ªè¯­æ³•åˆ†æå™¨"><a href="#2-å®ç°ä¸€ä¸ªè¯­æ³•åˆ†æå™¨" class="headerlink" title="2. å®ç°ä¸€ä¸ªè¯­æ³•åˆ†æå™¨"></a>2. å®ç°ä¸€ä¸ªè¯­æ³•åˆ†æå™¨</h2><p>ANTLRå·¥å…·ä¾èµ–äºç±»ä¼¼äºassignçš„è¯­æ³•è§„åˆ™ï¼Œäº§ç”Ÿé€’å½’ä¸‹é™çš„è¯­æ³•åˆ†æå™¨ã€‚</p>
<p><strong>ä»€ä¹ˆæ˜¯é€’å½’ä¸‹é™ï¼Ÿ</strong></p>
<p>ä»æ ¹èŠ‚ç‚¹å¼€å§‹ï¼Œå‘å¶èŠ‚ç‚¹è§£æã€‚</p>
<p>ä¸¾ä¾‹ï¼š</p>
<p>ä¾‹å¦‚å¦‚ä¸‹çš„è¯­æ³•è§„åˆ™</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">assin : ID &#39;&#x3D;&#39; expr &#39;;&#39;;</span><br></pre></td></tr></table></figure>

<p>è¯­æ³•åˆ†æå™¨å®ç°çš„ç»†èŠ‚ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">assign</span><span class="params">()</span></span>&#123;</span><br><span class="line">    match(ID);</span><br><span class="line">    match(<span class="string">&#x27;=&#x27;</span>);</span><br><span class="line">    expr();</span><br><span class="line">    match(<span class="string">&quot;;&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>stat()</code>æ˜¯æ ¹èŠ‚ç‚¹ã€‚</p>
<p><code>assign()</code>å’Œ<code>expr()</code>éƒ½æ˜¯è°ƒç”¨è·¯çº¿ï¼Œ<code>match()</code>å¯¹åº”äº†è¯­æ³•è§„åˆ™çš„å¶å­èŠ‚ç‚¹ã€‚</p>
<p><code>stat</code>è§„åˆ™èƒ½å¯¹åº”å¤šä¸ª<code>assign</code>çº§åˆ«çš„åˆ†æ”¯ã€‚</p>
<p>ä¾‹å¦‚ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">stat: assign   &#x2F;&#x2F;ç¬¬ä¸€å¤‡é€‰åˆ†æ”¯</span><br><span class="line">    | ifstat   &#x2F;&#x2F;ç¬¬äºŒå¤‡é€‰åˆ†æ”¯</span><br><span class="line">    | whilestat</span><br><span class="line">    ...</span><br><span class="line">    ;</span><br></pre></td></tr></table></figure>

<p>è§£æçš„è¯ç±»ä¼¼äº<code>switch</code>è¯­å¥ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">stat</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">switch</span>(&lt;&lt; å½“å‰è¾“å…¥çš„è¯æ³•ç¬¦å· &gt;&gt;)&#123;</span><br><span class="line">            CASE ID ï¼šassign();<span class="keyword">break</span>;</span><br><span class="line">            CASE IF : ifstat();<span class="keyword">break</span>;</span><br><span class="line">            CASE WHILE ï¼šwhilestat();<span class="keyword">break</span>;</span><br><span class="line">            ...</span><br><span class="line">            <span class="keyword">default</span> : &lt;&lt;æŠ›å‡ºæ— å¯é€‰æ–¹æ¡ˆçš„å¼‚å¸¸&gt;&gt;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>stat()</code>é€šè¿‡æ£€æŸ¥ä¸‹ä¸€ä¸ªè¯æ³•ç¬¦å·æ¥åšå‡ºå†³ç­–ã€‚ä¾‹å¦‚ï¼Œå¦‚æœé‡åˆ°äº†WHILEå…³é”®å­—ï¼Œåˆ™é€‰æ‹©ç¬¬ä¸‰ä¸ªåˆ†æ”¯å¤‡é€‰ã€‚åŒæ—¶<code>stat()</code>è°ƒç”¨<code>whilestat()</code>æ–¹æ³•ã€‚</p>
<p>ä¸‹ä¸€ä¸ªè¯æ³•ç¬¦å·åˆç§°ä¸º<strong>å‰ç»è¯æ³•ç¬¦å·ï¼ˆlookahead tokenï¼‰</strong></p>
<p>ä½†æ˜¯ï¼Œé€‰æ‹©åˆ†æ”¯å¾€å¾€å¾ˆå¤šï¼Œå°±å¯¼è‡´è¯­æ³•åˆ†æå™¨å¾€å¾€éœ€è¦å¤šä¸ªå‰ç»è¯æ³•ç¬¦å·æ‰èƒ½æŒ‡å¯¼å»å“ªä¸ªåˆ†æ”¯ã€‚</p>
<p><strong>ANTLRèƒ½å¤Ÿæ ¹æ®æƒ…å†µè°ƒæ•´å‰ç»æ•°é‡ã€‚</strong></p>
<p>æ‰€ä»¥ï¼šæˆ‘ä»¬ä¸ç”¨è€ƒè™‘äº†å“ˆå“ˆå“ˆå“ˆã€‚</p>
<p><strong>åˆæ³•è¯­å¥</strong>ï¼šèƒ½å¤Ÿé¡ºåˆ©ä»å¼€å§‹èµ°åˆ°è¯­å¥ç»“å°¾ï¼Œå°±æ˜¯åˆæ³•è¯­å¥ã€‚<br>ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœåœ¨ä¸­é€”æ²¡åŠæ³•åšå‡ºé€‰æ‹©ï¼Œè¡¨ç¤ºï¼Œè¯­å¥æœ¬èº«å‡ºäº†é—®é¢˜ã€‚</p>
<h2 id="3-é¿å…æ­§ä¹‰æ€§è¯­å¥"><a href="#3-é¿å…æ­§ä¹‰æ€§è¯­å¥" class="headerlink" title="3. é¿å…æ­§ä¹‰æ€§è¯­å¥"></a>3. é¿å…æ­§ä¹‰æ€§è¯­å¥</h2><p>æ­§ä¹‰æ€§ä¸¾ä¾‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">stat: expr &#39;;&#39;</span><br><span class="line">     | ID &#39;(&#39; &#39;)&#39; &#39;;&#39;</span><br><span class="line">     ;</span><br><span class="line">expr: ID &#39;(&#39; &#39;)&#39;</span><br><span class="line">	| INT</span><br><span class="line">	;</span><br></pre></td></tr></table></figure>

<p>ä¸Šè¿°è§„åˆ™å¦‚æœåŒ¹é… â€œ<code>f();</code>â€œ</p>
<p><img src="https://raw.githubusercontent.com/ghj1998/image_repository/main/image-20210508160604632.png" alt="image-20210508160604632"></p>
<p>å°±ä¼šå‡ºç°å¦‚ä¸Šä¸¤ç§æƒ…å†µã€‚å·¦è¾¹æ˜¯åŒ¹é…äº†exprè§„åˆ™ï¼Œå³è¾¹æ˜¯åŒ¹é…äº†statè§„åˆ™çš„ç¬¬äºŒä¸ªå¤‡é€‰åˆ†æ”¯ã€‚</p>
<p>ANTLRä¼šé€‰æ‹©å·¦è¾¹çš„è¯­æ³•åˆ†ææ ‘å¯¹<code>f()</code>è¿›è¡Œè§£é‡Šã€‚</p>
<h2 id="4-åˆ©ç”¨è¯­æ³•åˆ†ææ ‘æ„å»ºè¯­è¨€ç±»åº”ç”¨ç¨‹åº"><a href="#4-åˆ©ç”¨è¯­æ³•åˆ†ææ ‘æ„å»ºè¯­è¨€ç±»åº”ç”¨ç¨‹åº" class="headerlink" title="4. åˆ©ç”¨è¯­æ³•åˆ†ææ ‘æ„å»ºè¯­è¨€ç±»åº”ç”¨ç¨‹åº"></a>4. åˆ©ç”¨è¯­æ³•åˆ†ææ ‘æ„å»ºè¯­è¨€ç±»åº”ç”¨ç¨‹åº</h2><h3 id="4-1-ANTLRä½¿ç”¨çš„æ•°æ®ç»“æ„å’Œç±»å"><a href="#4-1-ANTLRä½¿ç”¨çš„æ•°æ®ç»“æ„å’Œç±»å" class="headerlink" title="4.1 ANTLRä½¿ç”¨çš„æ•°æ®ç»“æ„å’Œç±»å"></a>4.1 ANTLRä½¿ç”¨çš„æ•°æ®ç»“æ„å’Œç±»å</h3><p>ANTLRç±»ï¼š<code>CharStream</code>ï¼Œ<code>Lexer</code>ï¼Œ<code>Token</code>ï¼Œ<code>Parser</code>ï¼Œ<code>ParseTree</code>ã€‚</p>
<p>è¿æ¥è¯æ³•åˆ†æå™¨å’Œè¯­æ³•åˆ†æå™¨çš„ç®¡é“æ˜¯<code>TokenStream</code>ã€‚</p>
<p>æ•´ä½“äº¤äº’å¦‚å›¾æ‰€ç¤ºï¼š</p>
<img src="https://raw.githubusercontent.com/ghj1998/image_repository/main/image-20210508162752717.png" alt="image-20210508162752717" style="zoom:50%;" />

<p><code>TokenStream</code>åªè®°å½•äº†<code>CharStream</code>ä¸­å­—ç¬¦åºåˆ—çš„å¼€å§‹ä½ç½®å’Œç»“æŸä½ç½®ã€‚ç›®çš„æ˜¯ï¼šå…±äº«æ•°æ®ç»“æ„æ¥èŠ‚çº¦å†…å­˜ã€‚</p>
<p><code>ParseTree</code>çš„å­ç±»<code>RuleNode</code>å’Œ<code>TerminalNode</code>ï¼Œåˆ†åˆ«æ˜¯å­æ ‘çš„æ ¹èŠ‚ç‚¹å’Œå¶å­èŠ‚ç‚¹ã€‚<code>RuleNode</code>è§„åˆ™ä¸æ˜¯ä¸€æˆä¸å˜ï¼Œå®é™…ä¸Šæ˜¯<code>StatContext</code>ã€<code>AssignContext</code>ä»¥åŠ<code>ExprContext</code>ã€‚</p>
<img src="https://raw.githubusercontent.com/ghj1998/image_repository/main/image-20210508163241574.png" alt="image-20210508163241574" style="zoom:75%;" />



<h2 id="5-è¯­æ³•åˆ†ææ ‘ç›‘å¬å™¨å’Œè®¿é—®å™¨"><a href="#5-è¯­æ³•åˆ†ææ ‘ç›‘å¬å™¨å’Œè®¿é—®å™¨" class="headerlink" title="5. è¯­æ³•åˆ†ææ ‘ç›‘å¬å™¨å’Œè®¿é—®å™¨"></a>5. è¯­æ³•åˆ†ææ ‘ç›‘å¬å™¨å’Œè®¿é—®å™¨</h2><h3 id="5-1-ç›‘å¬å™¨"><a href="#5-1-ç›‘å¬å™¨" class="headerlink" title="5.1 ç›‘å¬å™¨"></a>5.1 ç›‘å¬å™¨</h3><p>ANTLRä¸ºäº†æŠŠéå†æ ‘è§¦å‘çš„äº‹ä»¶è½¬åŒ–ä¸ºç›‘å¬å™¨çš„è°ƒç”¨ï¼Œæä¾›äº†<code>ParseTree-Walker</code>ç±»ï¼Œæˆ‘ä»¬é€šè¿‡è‡ªè¡Œå®ç°ParseTreeListeneræ¥å£æ¥æ„å»ºæˆ‘ä»¬è‡ªå·±çš„è¯­è¨€ç±»åº”ç”¨ç¨‹åºã€‚</p>
<p>ANTLRä¸ºæ¯ä¸€ä¸ªè¯­æ³•æ–‡ä»¶ç”Ÿæˆä¸€ä¸ª<code>ParseTreeListener</code>çš„å­ç±»ï¼Œç”¨æ¥éå†è¯­æ³•æ ‘ã€‚</p>
<p>éå†é¡ºåºå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><img src="https://raw.githubusercontent.com/ghj1998/image_repository/main/image-20210510110628906.png" alt="image-20210510110628906"></p>
<p>ç›‘å¬å™¨ä¸éœ€è¦æˆ‘ä»¬ç¼–å†™è¯­æ³•åˆ†ææ ‘çš„éå†ä»£ç ï¼Œä¹Ÿä¸éœ€è¦æ˜¾ç¤ºçš„è®¿é—®å­èŠ‚ç‚¹ã€‚</p>
<h3 id="5-2-è®¿é—®å™¨"><a href="#5-2-è®¿é—®å™¨" class="headerlink" title="5.2 è®¿é—®å™¨"></a>5.2 è®¿é—®å™¨</h3><p>æœ‰æ—¶ï¼Œæˆ‘ä»¬æƒ³æ§åˆ¶è¯­æ³•åˆ†ææ ‘çš„è¿‡ç¨‹ï¼Œæ˜¾å¼è®¿é—®å­èŠ‚ç‚¹ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡è®¿é—®å™¨æ¥å®ç°è¿™ä¸€ç‚¹ã€‚</p>
<p>åœ¨å‘½ä»¤è¡Œä¸­åŠ å…¥-visitoré€‰é¡¹å¯ä»¥è®©ANTLRç”Ÿæˆè®¿é—®å™¨æ¥å£ï¼Œæ¯æ¡è§„åˆ™å¯¹åº”æ¥å£ä¸­çš„ä¸€ä¸ªvisitæ–¹æ³•ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥åœ¨ç¨‹åºä¸­å®ç°è®¿é—®å™¨æ¥å£ï¼Œè°ƒç”¨<code>visit()</code>æ–¹æ³•æ¥å¯¹è¯­æ³•åˆ†ææ ‘éå†ã€‚</p>
<p><img src="https://raw.githubusercontent.com/ghj1998/image_repository/main/image-20210510112903697.png" alt="image-20210510112903697"></p>
]]></content>
      <tags>
        <tag>è¯­æ³•åˆ†æ</tag>
        <tag>ANTLR</tag>
      </tags>
  </entry>
  <entry>
    <title>ANTLR4é¡¹ç›®å…¥é—¨</title>
    <url>/2021/05/11/ANTLR4%E9%A1%B9%E7%9B%AE%E5%85%A5%E9%97%A8/</url>
    <content><![CDATA[<h1 id="å…¥é—¨çš„ANTLRé¡¹ç›®"><a href="#å…¥é—¨çš„ANTLRé¡¹ç›®" class="headerlink" title="å…¥é—¨çš„ANTLRé¡¹ç›®"></a>å…¥é—¨çš„ANTLRé¡¹ç›®</h1><h1 id="1-é¡¹ç›®éœ€æ±‚"><a href="#1-é¡¹ç›®éœ€æ±‚" class="headerlink" title="1. é¡¹ç›®éœ€æ±‚"></a>1. é¡¹ç›®éœ€æ±‚</h1><p><strong>éœ€æ±‚ï¼š</strong></p>
<ul>
<li>è¯†åˆ«åŒ…å«åœ¨èŠ±æ‹¬å·å†…æˆ–è€…åµŒå¥—èŠ±æ‹¬å·çš„æ•´æ•°ï¼Œä¾‹å¦‚{1ï¼Œ2ï¼Œ3}æˆ–{1ï¼Œ{2ï¼Œ3}ï¼Œ4}ã€‚è¿™ç§æ‹¬å·å¸¸è§äºåˆå§‹åŒ–è¯­å¥ä¸­ã€‚</li>
<li>å¦‚æœè¯­å¥ä¸­çš„æ‰€æœ‰æ•´æ•°éƒ½å¯ä»¥ç”¨ä¸€ä¸ªå­—èŠ‚è¡¨ç¤ºï¼Œå°†è¯¥æ•´æ•°æ•°ç»„è½¬åŒ–ä¸ºå­—èŠ‚æ•°ç»„ã€‚</li>
<li>å°†shortæ•°ç»„è½¬åŒ–ä¸ºå­—ç¬¦ä¸²ã€‚</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">short</span>[] data = &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125;;</span><br></pre></td></tr></table></figure>

<p>è½¬åŒ–ä¸º</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> String data = <span class="string">&quot;\u000u\u0002\u0003&quot;</span>;</span><br></pre></td></tr></table></figure>

<p><strong>ä¸ºä»€ä¹ˆæå‡ºè¿™ä¸ªéœ€æ±‚ï¼š</strong></p>
<p>Javaçš„.classæ–‡ä»¶åœ¨å¤„ç†æ—¶ï¼Œå°†åˆå§‹åŒ–è¯­å¥ç­‰åŒäº<code>data[0] = 1; data[1] = 2</code>ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼ŒJAVAçš„classæ–‡ä»¶æŠŠå­—ç¬¦ä¸²å­˜å‚¨æˆè¿ç»­çš„shortåºåˆ—ã€‚å°†æ•°ç»„çš„åˆå§‹åŒ–è½¬åŒ–ä¸ºå­—ç¬¦ä¸²è€Œå¯ä»¥å¾—åˆ°æ›´ç´§å‡‘çš„classæ–‡ä»¶ã€‚é¿å…äº†JAVAå¯¹åˆå§‹åŒ–æ–¹æ³•çš„é•¿åº¦é™åˆ¶ã€‚</p>
<h2 id="2-ANTLRå·¥å…·ã€è¿è¡Œåº“ã€è‡ªåŠ¨ç”Ÿæˆçš„ä»£ç ã€‚"><a href="#2-ANTLRå·¥å…·ã€è¿è¡Œåº“ã€è‡ªåŠ¨ç”Ÿæˆçš„ä»£ç ã€‚" class="headerlink" title="2. ANTLRå·¥å…·ã€è¿è¡Œåº“ã€è‡ªåŠ¨ç”Ÿæˆçš„ä»£ç ã€‚"></a>2. ANTLRå·¥å…·ã€è¿è¡Œåº“ã€è‡ªåŠ¨ç”Ÿæˆçš„ä»£ç ã€‚</h2><h3 id="2-1-ANTLRå·¥å…·"><a href="#2-1-ANTLRå·¥å…·" class="headerlink" title="2.1 ANTLRå·¥å…·"></a>2.1 ANTLRå·¥å…·</h3><p>ANTLRå·¥å…·ä¸­çš„ä¸¤ä¸ªå…³é”®éƒ¨åˆ†ï¼š</p>
<ul>
<li>ANTLRå·¥å…·</li>
<li>ANTLRè¿è¡Œåº“</li>
</ul>
<p>å½“æåˆ°å¯¹ä¸€ä¸ªè¯­æ³•è¿è¡ŒANTLRæ—¶ï¼ŒæŒ‡çš„æ˜¯åˆ©ç”¨<code>org.antlr.v4.Tool</code>ç±»ç”Ÿæˆä¸€äº›ä»£ç ï¼ˆè¯­æ³•åˆ†æå™¨å’Œè¯æ³•åˆ†æå™¨ï¼‰ã€‚</p>
<p>è¿è¡Œåº“æ˜¯ç”±è‹¥å¹²ç±»å’Œæ–¹æ³•ç»„æˆçš„åº“ï¼Œè¿™äº›ç±»å’Œæ–¹æ³•æ˜¯è‡ªåŠ¨ç”Ÿæˆçš„ä»£ç ï¼ˆå¦‚Parserï¼ŒLexerå’ŒTokenï¼‰è¿è¡Œæ‰€å¿…éœ€çš„ã€‚</p>
<p>æ•…<strong>ä½¿ç”¨ANTLRçš„æ­¥éª¤ï¼š</strong></p>
<ul>
<li>å¯¹ä¸€ä¸ªè¯­æ³•è¿è¡ŒANTLRï¼Œå°†ç”Ÿæˆçš„ä»£ç å’ŒjaråŒ…ä¸­çš„è¿è¡Œåº“ä¸€èµ·ç¼–è¯‘ã€‚</li>
<li>å°†ç¼–è¯‘å¥½çš„ä»£ç å’Œè¿è¡Œåº“ä¸€èµ·è¿è¡Œã€‚</li>
</ul>
<blockquote>
<p><strong>å…³äºå¦‚ä½•ç¼–å†™è¯­æ³•æ–‡ä»¶ï¼Ÿ</strong></p>
<p>é“¾æ¥ï¼š<strong>æš‚æ—¶ç•™ç™½ï¼</strong></p>
</blockquote>
<h3 id="2-2-å¼€å§‹ç¼–å†™"><a href="#2-2-å¼€å§‹ç¼–å†™" class="headerlink" title="2.2 å¼€å§‹ç¼–å†™"></a>2.2 å¼€å§‹ç¼–å†™</h3><ol>
<li><p>è¯­æ³•æ–‡ä»¶<code>ArrayInit.g4</code>ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">grammar</span> <span class="string">ArrayInit;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">init :</span> <span class="string">&#x27;&#123;&#x27;</span> <span class="string">value</span> <span class="string">(</span> <span class="string">&#x27;,&#x27;</span> <span class="string">value)*</span> <span class="string">&#x27;&#125;&#x27;</span><span class="string">;</span></span><br><span class="line"></span><br><span class="line"><span class="string">value</span> <span class="string">:init</span></span><br><span class="line">    <span class="string">|</span> <span class="string">INT</span> </span><br><span class="line">    <span class="string">;</span></span><br><span class="line"><span class="attr">INT :</span> [<span class="number">0</span><span class="number">-9</span>]<span class="string">+</span> <span class="string">;</span></span><br><span class="line"><span class="attr">WS :</span> [<span class="string">\t\r\n</span>]<span class="string">+</span> <span class="string">-&gt;</span> <span class="string">skip;</span></span><br></pre></td></tr></table></figure></li>
</ol>
<ol start="2">
<li><p>ç”Ÿæˆä»£ç </p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> antlr4 ArrayInit.g4</span></span><br></pre></td></tr></table></figure>

<p><strong>æ³¨æ„</strong>ï¼šç›´æ¥<code>antlr4</code>å‘½ä»¤è¦æå‰è¿è¡Œ<code>antlr4=java org.antlr.v4.Tool $*</code></p>
<blockquote>
<p>å‚è€ƒï¼š<a href="https://ghj1998.github.io/2021/04/26/ANTLR4%E6%8C%87%E5%8D%97/">https://ghj1998.github.io/2021/04/26/ANTLR4%E6%8C%87%E5%8D%97/</a></p>
</blockquote>
<p>ç”Ÿæˆæ–‡ä»¶å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><img src="https://raw.githubusercontent.com/ghj1998/image_repository/main/image-20210510153723801.png" alt="image-20210510153723801"></p>
<p>ç”Ÿæˆæ–‡ä»¶ä»‹ç»</p>
<ul>
<li><p><code>ArrayInitParser.java</code></p>
<p>åŒ…å«ä¸€ä¸ªè¯­æ³•åˆ†æå™¨çš„ç±»çš„å®šä¹‰ï¼Œç”¨æ¥è¯†åˆ«è¯­æ³•<code>ArrayInit</code>ã€‚æ¯æ¡è§„åˆ™éƒ½æœ‰å¯¹åº”çš„æ–¹æ³•ã€‚</p>
</li>
<li><p><code>ArrayInitLexer.java</code></p>
<p>åŒ…å«è¯æ³•åˆ†æå™¨çš„ç±»å®šä¹‰ï¼Œè¯æ³•åˆ†æå™¨çš„ä½œç”¨æ˜¯å°†è¾“å…¥å­—ç¬¦åºåˆ—åˆ†è§£ä¸ºè¯æ±‡ç¬¦å·ã€‚</p>
</li>
<li><p><code>ArrayInit.tokens</code></p>
<p>ANTLRä¼šç»™æ¯ä¸ªè¯æ³•ç¬¦å·æŒ‡å®šä¸€ä¸ªæ•°å­—å½¢å¼çš„ç±»å‹ï¼ŒåŒæ—¶å­˜å‚¨å…³ç³»åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­ã€‚</p>
</li>
<li><p><code>ArrayInitListener.java</code></p>
<p>å®šä¹‰éå†è¯­æ³•åˆ†ææ ‘çš„å›è°ƒæ–¹æ³•ã€‚</p>
</li>
</ul>
</li>
<li><p>ç¼–è¯‘</p>
<p>éœ€è¦æå‰è®¾ç½®å¥½ç¯å¢ƒå˜é‡ï¼š</p>
<blockquote>
<p>å‚è€ƒï¼š<a href="https://ghj1998.github.io/2021/04/26/ANTLR4%E6%8C%87%E5%8D%97/">https://ghj1998.github.io/2021/04/26/ANTLR4%E6%8C%87%E5%8D%97/</a></p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> javac *.java</span></span><br></pre></td></tr></table></figure></li>
<li><p>è¿è¡Œ</p>
<p>åŒæ ·è¦æå‰è®¾ç½®å¥½æ‰èƒ½ä½¿ç”¨<code>grun</code>ï¼Œå‚è€ƒé“¾æ¥åŒä¸Šã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> grun ArrayInit init -tokens</span></span><br><span class="line">&#123;99, 3, 451&#125;</span><br><span class="line">^Z</span><br><span class="line"></span><br><span class="line">// output:</span><br><span class="line">[@0,0:0=&#x27;&#123;&#x27;,&lt;1&gt;,1:0]</span><br><span class="line">[@1,1:2=&#x27;99&#x27;,&lt;4&gt;,1:1]</span><br><span class="line">[@2,3:3=&#x27;,&#x27;,&lt;2&gt;,1:3]</span><br><span class="line">[@3,5:5=&#x27;3&#x27;,&lt;4&gt;,1:5]</span><br><span class="line">[@4,6:6=&#x27;,&#x27;,&lt;2&gt;,1:6]</span><br><span class="line">[@5,8:10=&#x27;451&#x27;,&lt;4&gt;,1:8]</span><br><span class="line">[@6,11:11=&#x27;&#125;&#x27;,&lt;3&gt;,1:11]</span><br><span class="line">[@7,14:13=&#x27;&lt;EOF&gt;&#x27;,&lt;-1&gt;,2:0]</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ grun ArrayInit init -gui</span><br><span class="line">&#123;1,&#123;2,3&#125;,4&#125;</span><br><span class="line">^Z</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>output: </p>
<p><img src="https://raw.githubusercontent.com/ghj1998/image_repository/main/image-20210510162450230.png" alt="image-20210510162450230"></p>
</li>
</ol>
<h3 id="2-3-ä»å…¶ä»–JAVAç¨‹åºä¸­è°ƒç”¨ç”Ÿæˆçš„è¯­æ³•åˆ†æå™¨"><a href="#2-3-ä»å…¶ä»–JAVAç¨‹åºä¸­è°ƒç”¨ç”Ÿæˆçš„è¯­æ³•åˆ†æå™¨" class="headerlink" title="2.3 ä»å…¶ä»–JAVAç¨‹åºä¸­è°ƒç”¨ç”Ÿæˆçš„è¯­æ³•åˆ†æå™¨"></a>2.3 ä»å…¶ä»–JAVAç¨‹åºä¸­è°ƒç”¨ç”Ÿæˆçš„è¯­æ³•åˆ†æå™¨</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.antlr.v4.runtime.*;</span><br><span class="line"><span class="keyword">import</span> org.antlr.v4.runtime.tree.*;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// æ–°å»ºä¸€ä¸ªCharStreamï¼Œä»æ ‡å‡†è¾“å…¥è¯»å–æ•°æ®</span></span><br><span class="line">        ANTLRInputStream input = <span class="keyword">new</span> ANTLRInputStream(System.in);</span><br><span class="line">		</span><br><span class="line">        <span class="comment">// æ–°å»ºä¸€ä¸ªè¯æ³•åˆ†æå™¨ï¼Œå¤„ç†è¾“å…¥çš„CharStream</span></span><br><span class="line">        ArrayInitLexer lexer = <span class="keyword">new</span> ArrayInitLexer(input);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ–°å»ºä¸€ä¸ªè¯æ³•ç¬¦å·çš„ç¼“å†²åŒºï¼Œç”¨äºå­˜å‚¨è¯æ³•åˆ†æå™¨ç”Ÿæˆçš„è¯æ³•ç¬¦å·</span></span><br><span class="line">        CommonTokenStream tokens = <span class="keyword">new</span> CommonTokenStream(lexer);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ–°å»ºä¸€ä¸ªè¯­æ³•åˆ†æå™¨ï¼Œå¤„ç†è¯æ³•ç¬¦å·ç¼“å†²åŒºçš„å†…å®¹</span></span><br><span class="line">        ArrayInitParser parser = <span class="keyword">new</span> ArrayInitParser(tokens);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// é’ˆå¯¹initè§„åˆ™ï¼Œå¼€å§‹è¿›è¡Œè¯­æ³•åˆ†æ</span></span><br><span class="line">        ParseTree tree = parser.init();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ç”¨LISPé£æ ¼æ‰“å°å‡ºç”Ÿæˆçš„æ ‘</span></span><br><span class="line">        System.out.println(tree.toStringTree(parser));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>éªŒè¯ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> java Test</span></span><br><span class="line">&#123;1,&#123;2,3&#125;,4&#125;</span><br><span class="line">^Z</span><br><span class="line"></span><br><span class="line">(init &#123; (value 1) , (value (init &#123; (value 2) , (value 3) &#125;)) , (value 4) &#125;)</span><br></pre></td></tr></table></figure>

<p>åŒæ—¶ï¼ŒANTLRè¿˜èƒ½è‡ªåŠ¨æŠ¥å‘Šè¯­æ³•é”™è¯¯ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> java Test</span></span><br><span class="line">&#123;1,3</span><br><span class="line">^Z</span><br><span class="line"></span><br><span class="line">line 2:0 missing &#x27;&#125;&#x27; at &#x27;&lt;EOF&gt;&#x27;</span><br><span class="line">(init &#123; (value 1) , (value 3) &lt;missing &#x27;&#125;&#x27;&gt;)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ä¸Šé¢æåˆ°çš„ç±»ï¼Œå¯ä»¥å‚è€ƒ: <strong>é“¾æ¥ï¼ˆæ­¤å¤„ç•™ç™½ï¼‰</strong></p>
</blockquote>
<h3 id="2-4-å®Œæˆé¡¹ç›®éœ€æ±‚"><a href="#2-4-å®Œæˆé¡¹ç›®éœ€æ±‚" class="headerlink" title="2.4 å®Œæˆé¡¹ç›®éœ€æ±‚"></a>2.4 å®Œæˆé¡¹ç›®éœ€æ±‚</h3><p>ç¨‹åºè¦ä»è¯­æ³•åˆ†ææ ‘ä¸­æå–æ•°æ®ï¼Œç„¶ååœ¨è§¦å‘çš„å›è°ƒå‡½æ•°ä¸­è¿›è¡Œé€‚å½“æ“ä½œã€‚å¦‚æœè¦é€šè¿‡ç¼–å†™ç¨‹åºæ“çºµè¾“å…¥æ•°æ®ï¼Œéœ€è¦ç»§æ‰¿<code>ArrayInitBaseListener</code>ç±»ï¼Œè¦†ç›–å…¶ä¸­å¿…è¦çš„æ–¹æ³•ã€‚</p>
<p>æˆ‘ä»¬çš„æ€æƒ³æ˜¯ï¼šåœ¨éå†å™¨è¿›è¡Œè¯­æ³•åˆ†ææ ‘çš„éå†æ—¶ï¼Œè®©æ¯ä¸ªç›‘å¬å™¨æ–¹æ³•ç¿»è¯‘è¾“å…¥æ•°æ®çš„ä¸€éƒ¨åˆ†å¹¶å°†ç»“æœæ‰“å°å‡ºæ¥ã€‚</p>
<p><strong>ç›‘å¬å™¨çš„ä¼˜ç‚¹</strong>åœ¨äºï¼šæˆ‘ä»¬ä¸éœ€è¦å†™éå†è¯­æ³•åˆ†ææ ‘çš„ä»£ç ã€‚</p>
<p>å¯¹äºè¿™ä¸ªé¡¹ç›®éœ€æ±‚ï¼Œæˆ‘ä»¬å¯ä»¥æ‰¾å‡ºé€šç”¨çš„ç¿»è¯‘é€»è¾‘ã€‚</p>
<p><img src="https://raw.githubusercontent.com/ghj1998/image_repository/main/image-20210510174143835.png" alt="image-20210510174143835"></p>
<ol>
<li>æŠŠ{ç¿»è¯‘æˆâ€ï¼›</li>
<li>æŠŠ}ç¿»è¯‘æˆâ€ï¼›</li>
<li>æŠŠæ•´æ•°ç¿»è¯‘æˆå››ä½çš„åå…­è¿›åˆ¶å½¢å¼ï¼Œç„¶ååŠ å‰ç¼€\u</li>
</ol>
<p>ç¬¬ä¸€æ­¥ï¼šç¼–å†™æ–¹æ³•ï¼Œç»§æ‰¿<code>BaseListener</code>ç±»ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ShortToUnicodeString</span> <span class="keyword">extends</span> <span class="title">ArrayInitBaseListener</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">enterInit</span><span class="params">(ArrayInitParser.InitContext ctx)</span> </span>&#123;</span><br><span class="line">        System.out.print(<span class="string">&#x27;&quot;&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">exitInit</span><span class="params">(ArrayInitParser.InitContext ctx)</span> </span>&#123;</span><br><span class="line">        System.out.print(<span class="string">&#x27;&quot;&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">enterValue</span><span class="params">(ArrayInitParser.ValueContext ctx)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> value = Integer.valueOf(ctx.INT().getText());</span><br><span class="line">        System.out.printf(<span class="string">&quot;\\u%04x&quot;</span>,value);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç¬¬äºŒéƒ¨ï¼Œæ‰©å±•mainå‡½æ•°ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.antlr.v4.runtime.*;</span><br><span class="line"><span class="keyword">import</span> org.antlr.v4.runtime.tree.*;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// æ–°å»ºä¸€ä¸ªCharStreamï¼Œä»æ ‡å‡†è¾“å…¥è¯»å–æ•°æ®</span></span><br><span class="line">        ANTLRInputStream input = <span class="keyword">new</span> ANTLRInputStream(System.in);</span><br><span class="line">		</span><br><span class="line">        <span class="comment">// æ–°å»ºä¸€ä¸ªè¯æ³•åˆ†æå™¨ï¼Œå¤„ç†è¾“å…¥çš„CharStream</span></span><br><span class="line">        ArrayInitLexer lexer = <span class="keyword">new</span> ArrayInitLexer(input);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ–°å»ºä¸€ä¸ªè¯æ³•ç¬¦å·çš„ç¼“å†²åŒºï¼Œç”¨äºå­˜å‚¨è¯æ³•åˆ†æå™¨ç”Ÿæˆçš„è¯æ³•ç¬¦å·</span></span><br><span class="line">        CommonTokenStream tokens = <span class="keyword">new</span> CommonTokenStream(lexer);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ–°å»ºä¸€ä¸ªè¯­æ³•åˆ†æå™¨ï¼Œå¤„ç†è¯æ³•ç¬¦å·ç¼“å†²åŒºçš„å†…å®¹</span></span><br><span class="line">        ArrayInitParser parser = <span class="keyword">new</span> ArrayInitParser(tokens);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// éå†è¯­æ³•åˆ†æè¿‡ç¨‹ä¸­ç”Ÿæˆçš„è¯­æ³•åˆ†ææ ‘ï¼Œè§¦å‘å›è°ƒ</span></span><br><span class="line">      	ParseTreeWalker walker = <span class="keyword">new</span> ParseTreeWalker();</span><br><span class="line">        walker.walk(<span class="keyword">new</span> ShortToUnicodeString(),tree);</span><br><span class="line">        System.out.println();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœï¼š</p>
<p><img src="https://raw.githubusercontent.com/ghj1998/image_repository/main/image-20210511112729050.png" alt="image-20210511112729050"></p>
]]></content>
      <tags>
        <tag>ANTLR</tag>
        <tag>è¯­æ³•</tag>
      </tags>
  </entry>
  <entry>
    <title>ANTLRæŒ‡å—</title>
    <url>/2021/05/11/ANTLR%E6%8C%87%E5%8D%97/</url>
    <content><![CDATA[<h1 id="å››ä¸ªæ¡ˆä¾‹å±•ç¤ºANTLRçš„ä¸åŒç‰¹æ€§"><a href="#å››ä¸ªæ¡ˆä¾‹å±•ç¤ºANTLRçš„ä¸åŒç‰¹æ€§" class="headerlink" title="å››ä¸ªæ¡ˆä¾‹å±•ç¤ºANTLRçš„ä¸åŒç‰¹æ€§"></a>å››ä¸ªæ¡ˆä¾‹å±•ç¤ºANTLRçš„ä¸åŒç‰¹æ€§</h1><h2 id="1-ç®€ä»‹"><a href="#1-ç®€ä»‹" class="headerlink" title="1. ç®€ä»‹"></a>1. ç®€ä»‹</h2><ol>
<li>åˆ†æä¸€ä¸ªç®€å•çš„ç®—æœ¯è¡¨è¾¾å¼è¯­è¨€çš„è¯­æ³•ï¼Œ<ul>
<li>æ·±å…¥å­¦ä¹ è¯­æ³•åˆ†æå™¨çš„å¯åŠ¨è¿‡ç¨‹ã€‚</li>
<li>å¦‚ä½•ä½¿ç”¨è¯­æ³•å¯¼å…¥å°†è¯­æ³•æ–‡ä»¶åˆ‡åˆ†ä¸ºå®¹æ˜“ç®¡ç†çš„å°å—ã€‚</li>
<li>è¯­æ³•åˆ†æå™¨å¤„ç†éæ³•è¾“å…¥ã€‚</li>
</ul>
</li>
<li>ä½¿ç”¨è®¿é—®è€…æ¨¡å¼æ„å»ºè®¡ç®—å™¨<ul>
<li>éå†ç®—æœ¯è¡¨è¾¾å¼çš„è¯­æ³•åˆ†ææ ‘å¹¶è·å¾—è®¡ç®—ç»“æœ</li>
<li>è‡ªåŠ¨ç”Ÿæˆè®¿é—®å™¨æ¥å£å’Œç©ºçš„å®ç°ç±»ã€‚</li>
</ul>
</li>
<li>æ„å»ºä¸€ä¸ªç¿»è¯‘å™¨<ul>
<li>è¯»å–JAVAç±»å®šä¹‰å°†å…¶ç¿»è¯‘æˆä¸€ä¸ªä»…æœ‰æ–¹æ³•å£°æ˜çš„æ¥å£</li>
<li>ANTLRç”Ÿæˆçš„ç›‘å¬å™¨æœºåˆ¶</li>
</ul>
</li>
<li>å¦‚ä½•å°†ä»£ç åµŒå…¥è¯­æ³•æ–‡ä»¶<ul>
<li>å®ç°æç«¯çš„çµæ´»æ€§</li>
</ul>
</li>
<li>ANTLRå¦‚ä½•å¤„ç†åŒ…å«ä¸æ­¢ä¸€ç§è¯­è¨€çš„è¾“å…¥æ–‡ä»¶<ul>
<li><code>TokenStreamRewriter</code></li>
<li>ä¿®æ”¹è¯æ³•ç¬¦å·æµä¸å½±å“åŸæ¥çš„è¾“å…¥æµ</li>
</ul>
</li>
</ol>
<h2 id="2-ç¯å¢ƒæ­å»º"><a href="#2-ç¯å¢ƒæ­å»º" class="headerlink" title="2. ç¯å¢ƒæ­å»º"></a>2. ç¯å¢ƒæ­å»º</h2><p>ä½¿ç”¨mavenæ­å»ºç¯å¢ƒï¼Œåœ¨é…ç½®æ–‡ä»¶<code>pom.xml</code>ä¸­å¢åŠ ä¾èµ–ï¼š</p>
<blockquote>
<p>mavençš„ä½¿ç”¨å‚è€ƒæˆ‘çš„å¦ä¸€ç¯‡åšå®¢ï¼š<a href="https://ghj1998.github.io/2021/05/07/Maven%E4%BD%BF%E7%94%A8/#more">Maven</a></p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.antlr/antlr4 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.antlr<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>antlr4<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.9.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.antlr/antlr4-runtime --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.antlr<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>antlr4-runtime<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.9.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="3-åŒ¹é…ç®—æœ¯è¡¨è¾¾å¼"><a href="#3-åŒ¹é…ç®—æœ¯è¡¨è¾¾å¼" class="headerlink" title="3. åŒ¹é…ç®—æœ¯è¡¨è¾¾å¼"></a>3. åŒ¹é…ç®—æœ¯è¡¨è¾¾å¼</h2><p>è¦å¤„ç†çš„è¡¨è¾¾å¼å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="number">193</span></span><br><span class="line">a = <span class="number">5</span></span><br><span class="line">b = <span class="number">6</span></span><br><span class="line">a+b*<span class="number">2</span></span><br><span class="line">(<span class="number">1</span>+<span class="number">2</span>)*<span class="number">3</span></span><br></pre></td></tr></table></figure>

<p>è§£æè¯¥è¡¨è¾¾å¼çš„ANTLRè¯­æ³•ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">grammar Expr;</span><br><span class="line"></span><br><span class="line">&#x2F;** The start rule; begin parsing here. *&#x2F;</span><br><span class="line">prog:   stat+ ; </span><br><span class="line"></span><br><span class="line">stat:   expr NEWLINE                </span><br><span class="line">    |   ID &#39;&#x3D;&#39; expr NEWLINE        </span><br><span class="line">    |   NEWLINE                   </span><br><span class="line">    ;</span><br><span class="line"></span><br><span class="line">expr:   expr (&#39;*&#39;|&#39;&#x2F;&#39;) expr   </span><br><span class="line">    |   expr (&#39;+&#39;|&#39;-&#39;) expr   </span><br><span class="line">    |   INT                    </span><br><span class="line">    |   ID                    </span><br><span class="line">    |   &#39;(&#39; expr &#39;)&#39;         </span><br><span class="line">    ;</span><br><span class="line"></span><br><span class="line">ID  :   [a-zA-Z]+ ;      &#x2F;&#x2F; match identifiers &lt;label id&#x3D;&quot;code.tour.expr.3&quot;&#x2F;&gt;</span><br><span class="line">INT :   [0-9]+ ;         &#x2F;&#x2F; match integers</span><br><span class="line">NEWLINE:&#39;\r&#39;? &#39;\n&#39; ;     &#x2F;&#x2F; return newlines to parser (is end-statement signal)</span><br><span class="line">WS  :   [ \t]+ -&gt; skip ; &#x2F;&#x2F; toss out whitespace</span><br></pre></td></tr></table></figure>

<p><code>stat</code> å’Œ<code>expr</code>è¡¨ç¤ºè¯­æ³•ç»“æ„ã€‚<code>ID</code> <code>INT</code>æ˜¯è¯æ³•ç¬¦å·ã€‚</p>
<ul>
<li>è¯­æ³•åˆ†æå™¨çš„è§„åˆ™ä»¥å°å†™å­—æ¯å¼€å¤´</li>
<li>è¯æ³•åˆ†æå™¨çš„è§„åˆ™ä»¥å¤§å†™å­—æ¯å¼€å¤´</li>
<li>ç”¨| åˆ†å‰²åŒä¸€ä¸ªè¯­è¨€è§„åˆ™çš„è‹¥å¹²å¤‡é€‰åˆ†æ”¯ï¼Œç”¨åœ†æ‹¬å·æŠŠä¸€äº›ç¬¦å·ç»„åˆæˆå­è§„åˆ™ã€‚ä¾‹å¦‚ï¼ˆâ€™*â€™|â€™â€™/â€˜ï¼‰åŒ¹é…ä¸€ä¸ªä¹˜æ³•ç¬¦å·æˆ–è€…ä¸€ä¸ªé™¤æ³•ç¬¦å·ã€‚</li>
</ul>
<p>æ›´å¤šçš„å†…å®¹åœ¨<strong>ç•™ç™½</strong> è¿›è¡Œè®¨è®ºã€‚</p>
<p>ä½¿ç”¨è¯¥è¯­æ³•åˆ†æå™¨å¯¹ä¸Šè¿°çš„è¡¨è¾¾å¼è¿›è¡Œåˆ†æã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ antlr4 Expr.g4</span><br><span class="line">$ javac Expr*.java</span><br><span class="line">$ grun Expr prog -gui t.expr</span><br></pre></td></tr></table></figure>

<p>*åœ¨æ‰§è¡Œç¬¬ä¸€éƒ¨çš„æ—¶å€™æŠ›å‡ºäº†<code>IndexOutOfBoundsException</code>*ï¼Œæ˜¯<code>antlr4.0</code>çš„é—®é¢˜ï¼Œå»å®˜ç½‘ä¸‹è½½æœ€æ–°ç‰ˆè§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚</p>
<p>æ³¨æ„ä¿®æ”¹æ—¶è¦åŒæ­¥ä¿®æ”¹<code>pom.xml</code> ä¸­çš„ç‰ˆæœ¬å·ã€‚</p>
<p>è¿è¡Œç»“æœå¦‚ä¸‹ğŸ˜ï¼š</p>
<p><img src="https://raw.githubusercontent.com/ghj1998/image_repository/main/image-20210511204440048.png" alt="image-20210511204440048"></p>
<p>æœ€ç»ˆï¼Œæˆ‘ä»¬éœ€è¦æŠŠANTLRä¸ºæˆ‘ä»¬è‡ªåŠ¨ç”Ÿæˆçš„è¯­æ³•åˆ†æå™¨é›†æˆåˆ°ç¨‹åºä¸­ã€‚</p>
]]></content>
      <tags>
        <tag>JAVA</tag>
        <tag>ANTLR</tag>
      </tags>
  </entry>
  <entry>
    <title>Hmacç®—æ³•</title>
    <url>/2021/05/06/Hmac%E7%AE%97%E6%B3%95/</url>
    <content><![CDATA[<h1 id="Hmacç®—æ³•"><a href="#Hmacç®—æ³•" class="headerlink" title="Hmacç®—æ³•"></a>Hmacç®—æ³•</h1><p>å­˜å‚¨ç”¨æˆ·çš„å“ˆå¸Œå£ä»¤æ—¶ï¼Œè¦åŠ ç›å­˜å‚¨ï¼Œç›®çš„å°±åœ¨äºæŠµå¾¡å½©è™¹è¡¨æ”»å‡»ã€‚</p>
<p>å“ˆå¸Œç®—æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">digest = hash(input)</span><br></pre></td></tr></table></figure>

<p>æ­£æ˜¯å› ä¸ºç›¸åŒçš„è¾“å…¥ä¼šäº§ç”Ÿç›¸åŒçš„è¾“å‡ºï¼Œæˆ‘ä»¬åŠ ç›çš„ç›®çš„å°±åœ¨äºï¼Œä½¿å¾—è¾“å…¥æœ‰æ‰€å˜åŒ–ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">digest = hash(salt + input)</span><br></pre></td></tr></table></figure>

<p>saltå¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ªé¢å¤–çš„â€œè®¤è¯ç â€ï¼ŒåŒæ ·çš„è¾“å…¥ï¼Œä¸åŒçš„è®¤è¯ç ï¼Œä¼šäº§ç”Ÿä¸åŒçš„è¾“å‡ºã€‚å› æ­¤ï¼Œè¦éªŒè¯è¾“å‡ºçš„å“ˆå¸Œï¼Œå¿…é¡»åŒæ—¶æä¾›â€œè®¤è¯ç â€ã€‚</p>
<p>Hmacç®—æ³•å°±æ˜¯ä¸€ç§åŸºäºå¯†é’¥çš„æ¶ˆæ¯è®¤è¯ç ç®—æ³•ï¼Œå®ƒçš„å…¨ç§°æ˜¯Hash-based Message Authentication Codeï¼Œæ˜¯ä¸€ç§æ›´å®‰å…¨çš„æ¶ˆæ¯æ‘˜è¦ç®—æ³•ã€‚</p>
<p>Hmacç®—æ³•æ€»æ˜¯å’ŒæŸç§å“ˆå¸Œç®—æ³•é…åˆèµ·æ¥ç”¨çš„ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">HmacMD5 â‰ˆ md5(secure_random_key, input)</span><br></pre></td></tr></table></figure>

<p>HmacMD5å¯ä»¥çœ‹ä½œå¸¦æœ‰ä¸€ä¸ªå®‰å…¨çš„keyçš„MD5ã€‚ä½¿ç”¨HmacMD5è€Œä¸æ˜¯ç”¨MD5åŠ saltï¼Œæœ‰å¦‚ä¸‹å¥½å¤„ï¼š</p>
<ul>
<li>HmacMD5ä½¿ç”¨çš„keyé•¿åº¦æ˜¯64å­—èŠ‚ï¼Œæ›´å®‰å…¨ï¼›</li>
<li>Hmacæ˜¯æ ‡å‡†ç®—æ³•ï¼ŒåŒæ ·é€‚ç”¨äºSHA-1ç­‰å…¶ä»–å“ˆå¸Œç®—æ³•ï¼›</li>
<li>Hmacè¾“å‡ºå’ŒåŸæœ‰çš„å“ˆå¸Œç®—æ³•é•¿åº¦ä¸€è‡´ã€‚</li>
</ul>
<p>ä¸ºäº†ä¿è¯å®‰å…¨ï¼Œæˆ‘ä»¬ä¸ä¼šè‡ªå·±æŒ‡å®škeyï¼Œè€Œæ˜¯é€šè¿‡Javaæ ‡å‡†åº“çš„KeyGeneratorç”Ÿæˆä¸€ä¸ªå®‰å…¨çš„éšæœºçš„keyã€‚ä¸‹é¢æ˜¯ä½¿ç”¨HmacMD5çš„ä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        KeyGenerator keyGen = KeyGenerator.getInstance(<span class="string">&quot;HmacMD5&quot;</span>);</span><br><span class="line">        SecretKey key = keyGen.generateKey();</span><br><span class="line">        <span class="comment">// æ‰“å°éšæœºç”Ÿæˆçš„key:</span></span><br><span class="line">        <span class="keyword">byte</span>[] skey = key.getEncoded();</span><br><span class="line">        System.out.println(<span class="keyword">new</span> BigInteger(<span class="number">1</span>, skey).toString(<span class="number">16</span>));</span><br><span class="line">        Mac mac = Mac.getInstance(<span class="string">&quot;HmacMD5&quot;</span>);</span><br><span class="line">        mac.init(key);</span><br><span class="line">        mac.update(<span class="string">&quot;HelloWorld&quot;</span>.getBytes(<span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">        <span class="keyword">byte</span>[] result = mac.doFinal();</span><br><span class="line">        System.out.println(<span class="keyword">new</span> BigInteger(<span class="number">1</span>, result).toString(<span class="number">16</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å’ŒMD5ç›¸æ¯”ï¼Œä½¿ç”¨HmacMD5çš„æ­¥éª¤æ˜¯ï¼š</p>
<ol>
<li>é€šè¿‡åç§°<code>HmacMD5</code>è·å–<code>KeyGenerator</code>å®ä¾‹ï¼›</li>
<li>é€šè¿‡<code>KeyGenerator</code>åˆ›å»ºä¸€ä¸ª<code>SecretKey</code>å®ä¾‹ï¼›</li>
<li>é€šè¿‡åç§°<code>HmacMD5</code>è·å–<code>Mac</code>å®ä¾‹ï¼›</li>
<li>ç”¨<code>SecretKey</code>åˆå§‹åŒ–<code>Mac</code>å®ä¾‹ï¼›</li>
<li>å¯¹<code>Mac</code>å®ä¾‹åå¤è°ƒç”¨<code>update(byte[])</code>è¾“å…¥æ•°æ®ï¼›</li>
<li>è°ƒç”¨<code>Mac</code>å®ä¾‹çš„<code>doFinal()</code>è·å–æœ€ç»ˆçš„å“ˆå¸Œå€¼ã€‚</li>
</ol>
<p>æ•°æ®åº“ä¸­çš„å­˜å‚¨è¡¨å˜æˆäº†ï¼š</p>
<table>
<thead>
<tr>
<th align="left">username</th>
<th align="left">secret_key (64 bytes)</th>
<th align="left">password</th>
</tr>
</thead>
<tbody><tr>
<td align="left">bob</td>
<td align="left">a8c06e05f92eâ€¦5e16</td>
<td align="left">7e0387872a57c85ef6dddbaa12f376de</td>
</tr>
<tr>
<td align="left">alice</td>
<td align="left">e6a343693985â€¦f4be</td>
<td align="left">c1f929ac2552642b302e739bc0cdbaac</td>
</tr>
<tr>
<td align="left">tim</td>
<td align="left">f27a973dfdc0â€¦6003</td>
<td align="left">af57651c3a8a73303515804d4af43790</td>
</tr>
</tbody></table>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">byte</span>[] hkey = <span class="keyword">new</span> <span class="keyword">byte</span>[] &#123; <span class="number">106</span>, <span class="number">70</span>, -<span class="number">110</span>, <span class="number">125</span>, <span class="number">39</span>, -<span class="number">20</span>, <span class="number">52</span>, <span class="number">56</span>, <span class="number">85</span>, <span class="number">9</span>, -<span class="number">19</span>, -<span class="number">72</span>, <span class="number">52</span>, -<span class="number">53</span>, <span class="number">52</span>, -<span class="number">45</span>, -<span class="number">6</span>, <span class="number">119</span>, -<span class="number">63</span>,</span><br><span class="line">                <span class="number">30</span>, <span class="number">20</span>, -<span class="number">83</span>, -<span class="number">28</span>, <span class="number">77</span>, <span class="number">98</span>, <span class="number">109</span>, -<span class="number">32</span>, -<span class="number">76</span>, <span class="number">121</span>, -<span class="number">106</span>, <span class="number">0</span>, -<span class="number">74</span>, -<span class="number">107</span>, -<span class="number">114</span>, -<span class="number">45</span>, <span class="number">104</span>, -<span class="number">104</span>, -<span class="number">8</span>, <span class="number">2</span>, <span class="number">121</span>, <span class="number">6</span>,</span><br><span class="line">                <span class="number">97</span>, -<span class="number">18</span>, -<span class="number">13</span>, -<span class="number">63</span>, -<span class="number">30</span>, -<span class="number">125</span>, -<span class="number">103</span>, -<span class="number">80</span>, -<span class="number">46</span>, <span class="number">113</span>, -<span class="number">14</span>, <span class="number">68</span>, <span class="number">32</span>, -<span class="number">46</span>, <span class="number">101</span>, -<span class="number">116</span>, -<span class="number">104</span>, -<span class="number">81</span>, -<span class="number">108</span>, <span class="number">122</span>,</span><br><span class="line">                <span class="number">89</span>, -<span class="number">106</span>, -<span class="number">109</span> &#125;;</span><br><span class="line"></span><br><span class="line">        SecretKey key = <span class="keyword">new</span> SecretKeySpec(hkey, <span class="string">&quot;HmacMD5&quot;</span>);</span><br><span class="line">        Mac mac = Mac.getInstance(<span class="string">&quot;HmacMD5&quot;</span>);</span><br><span class="line">        mac.init(key);</span><br><span class="line">        mac.update(<span class="string">&quot;HelloWorld&quot;</span>.getBytes(<span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">        <span class="keyword">byte</span>[] result = mac.doFinal();</span><br><span class="line">        System.out.println(Arrays.toString(result));</span><br><span class="line">        <span class="comment">// [126, 59, 37, 63, 73, 90, 111, -96, -77, 15, 82, -74, 122, -55, -67, 54]</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

]]></content>
      <tags>
        <tag>Hash</tag>
        <tag>Hmac</tag>
      </tags>
  </entry>
  <entry>
    <title>JAVA - å•å…ƒæµ‹è¯•</title>
    <url>/2021/05/06/JAVA%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95/</url>
    <content><![CDATA[<h1 id="å•å…ƒæµ‹è¯•"><a href="#å•å…ƒæµ‹è¯•" class="headerlink" title="å•å…ƒæµ‹è¯•"></a>å•å…ƒæµ‹è¯•</h1><h2 id="1-JUnitæµ‹è¯•"><a href="#1-JUnitæµ‹è¯•" class="headerlink" title="1. JUnitæµ‹è¯•"></a>1. JUnitæµ‹è¯•</h2><h3 id="1-1-TDD"><a href="#1-1-TDD" class="headerlink" title="1.1 TDD"></a>1.1 TDD</h3><p><img src="https://raw.githubusercontent.com/ghj1998/image_repository/main/image-20210422222709239.png" alt="image-20210422222709239"></p>
<p>è¿™å°±æ˜¯ä¼ è¯´çš„TDDã€‚</p>
<p><img src="https://raw.githubusercontent.com/ghj1998/image_repository/main/image-20210422222726238.png" alt="image-20210422222726238"></p>
<h3 id="1-2-å¦‚ä½•åœ¨ideaä½¿ç”¨Junitï¼Ÿ"><a href="#1-2-å¦‚ä½•åœ¨ideaä½¿ç”¨Junitï¼Ÿ" class="headerlink" title="1.2 å¦‚ä½•åœ¨ideaä½¿ç”¨Junitï¼Ÿ"></a>1.2 <strong>å¦‚ä½•åœ¨ideaä½¿ç”¨Junitï¼Ÿ</strong></h3><ol>
<li>å³é”®ç‚¹å‡»ç±»åï¼Œç‚¹å‡»<code>Generate</code>ï¼Œé€‰æ‹©<code>test</code>ï¼Œç‚¹å‡»<code>OK</code>ã€‚</li>
</ol>
<p><img src="https://raw.githubusercontent.com/ghj1998/image_repository/main/image-20210506093726089.png" alt="image-20210506093726089"></p>
<p><img src="https://raw.githubusercontent.com/ghj1998/image_repository/main/image-20210506094116686.png" alt="image-20210506094116686"></p>
<ol start="2">
<li>é€‰æ‹©è¦æµ‹è¯•çš„æ–¹æ³•ï¼ˆä¸é€‰ä¹Ÿå¯ä»¥ï¼Œé€‰äº†ä¼šè‡ªåŠ¨ç”Ÿæˆæµ‹è¯•å‡½æ•°ï¼‰ã€‚ä»¥åŠæµ‹è¯•ç±»çš„ç±»åï¼Œé€šå¸¸é‡‡ç”¨é»˜è®¤å³å¯ã€‚</li>
</ol>
<p><img src="https://raw.githubusercontent.com/ghj1998/image_repository/main/image-20210506094133977.png" alt="image-20210506094133977"></p>
<ol start="3">
<li>æ³¨æ„åˆ°æç¤º<code>Junit5 library not found in the module</code>ã€‚ç‚¹å‡»Fixè¿›è¡Œä¿®å¤ï¼Œå‹¾é€‰Downlad çš„é€‰é¡¹ã€‚</li>
</ol>
<p><img src="https://raw.githubusercontent.com/ghj1998/image_repository/main/image-20210506094426316.png" alt="image-20210506094426316"></p>
<ol start="4">
<li>ç‚¹å‡»<code>OK</code>ä¼šè‡ªåŠ¨ç”ŸæˆTestç±»ï¼Œè¿›å»ä¹‹åå‘ç°</li>
</ol>
<p><img src="https://raw.githubusercontent.com/ghj1998/image_repository/main/image-20210506095058368.png" alt="image-20210506095058368"></p>
<ol start="5">
<li>ç‚¹å‡»Add Library Junit5 to Classpathã€‚</li>
</ol>
<p><img src="https://raw.githubusercontent.com/ghj1998/image_repository/main/image-20210506095143021.png" alt="image-20210506095143021"></p>
<ol start="6">
<li>åŒæ—¶ï¼Œä¸ºäº†å‡å°‘æ³¨é‡Šçš„å¤æ‚åº¦ã€‚æˆ‘ä»¬å°†<code>org.junit.jupiter.api.Test</code>å¯¼å…¥è¿›æ¥ã€‚æœ€ç»ˆæ˜¾ç¤ºå¦‚ä¸‹ï¼š</li>
</ol>
<p><img src="https://raw.githubusercontent.com/ghj1998/image_repository/main/image-20210506095348637.png" alt="image-20210506095348637"></p>
<p>æ¥ä¸‹æ¥å°±å¯ä»¥ä½¿ç”¨ideaè¿›è¡Œå•å…ƒæµ‹è¯•äº†ã€‚</p>
<p>éªŒè¯å¦‚ä¸‹ï¼š</p>
<p><img src="https://raw.githubusercontent.com/ghj1998/image_repository/main/image-20210506095607159.png" alt="image-20210506095607159"></p>
<p>ç‚¹å‡»å·¦è¾¹çš„ç»¿è‰²ä¸‰è§’å³å¯è¿›è¡Œæµ‹è¯•ã€‚</p>
<p><img src="https://raw.githubusercontent.com/ghj1998/image_repository/main/image-20210506095651944.png" alt="image-20210506095651944"></p>
<p><strong>æ³¨æ„</strong>ï¼šMavenéœ€è¦åœ¨pom.xmlä¸­æ·»åŠ ä¾èµ–ã€‚</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="1-3-å¸¸ç”¨æ–­è¨€"><a href="#1-3-å¸¸ç”¨æ–­è¨€" class="headerlink" title="1.3 å¸¸ç”¨æ–­è¨€"></a>1.3 å¸¸ç”¨æ–­è¨€</h3><p><code>assertEquals(expected, actual)</code>æ˜¯æœ€å¸¸ç”¨çš„æµ‹è¯•æ–¹æ³•ã€‚</p>
<p><code>Assertion</code>è¿˜å®šä¹‰äº†å…¶ä»–æ–­è¨€æ–¹æ³•ï¼Œä¾‹å¦‚ï¼š</p>
<ul>
<li><img src="https://raw.githubusercontent.com/ghj1998/image_repository/main/image-20210506110509206.png" alt="image-20210506110509206"></li>
</ul>
<p><strong>æ³¨æ„</strong>ï¼šä½¿ç”¨æµ®ç‚¹æ•°æ—¶ï¼Œç”±äºæµ®ç‚¹æ•°æ— æ³•ç²¾ç¡®åœ°è¿›è¡Œæ¯”è¾ƒï¼Œå› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦è°ƒç”¨<code>assertEquals(double expected, double actual, double delta)</code>è¿™ä¸ªé‡è½½æ–¹æ³•ï¼ŒæŒ‡å®šä¸€ä¸ªè¯¯å·®å€¼ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">assertEquals(<span class="number">0.1</span>, Math.abs(<span class="number">1</span> - <span class="number">9</span> / <span class="number">10.0</span>), <span class="number">0.0000001</span>);</span><br></pre></td></tr></table></figure>

<h3 id="1-5-å…¶ä»–æ–­è¨€"><a href="#1-5-å…¶ä»–æ–­è¨€" class="headerlink" title="1.5 å…¶ä»–æ–­è¨€"></a>1.5 å…¶ä»–æ–­è¨€</h3><p><code>assertThat</code>ï¼šJunit4ä¸­æœ‰ï¼ŒJunit5ä¸­æ²¡æœ‰ã€‚</p>
<p><code>assertThat</code>è®©å¼€å‘è€…å¯ä»¥æ ¹æ®ä¸»è¯­ï¼ŒåŠ¨è¯ï¼Œå®¾è¯­è¿›è¡Œæ–­è¨€ï¼Œå¢åŠ å¯è¯»æ€§ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">assertThat(x,is(<span class="number">3</span>)); <span class="comment">//æ–­è¨€xæ˜¯3</span></span><br><span class="line">assertThat(x,isnot(<span class="number">4</span>)); <span class="comment">//æ–­è¨€xä¸æ˜¯4</span></span><br><span class="line">assertThat(myList,hasItem(<span class="string">&quot;3&quot;</span>)); <span class="comment">//åˆ¤æ–­ListåŒ…å«â€œ3â€</span></span><br></pre></td></tr></table></figure>

<p>æ­¤å¤–ï¼Œè¿˜æœ‰ï¼š</p>
<ul>
<li>allofï¼šæ‰€æœ‰åŒ¹é…æ¡ä»¶éƒ½åŒ¹é…é€šè¿‡ã€‚</li>
<li>anyOfï¼šä»»ä½•ä¸€ä¸ªåŒ¹é…æ¡ä»¶åŒ¹é…åˆ™é€šè¿‡ã€‚</li>
<li>notï¼šä¸æ¡ä»¶è¿èƒŒåˆ™é€šè¿‡ã€‚</li>
<li>equalToï¼šä½¿ç”¨Object.equals æ–¹æ³•æµ‹è¯•å¯¹è±¡ç›¸ç­‰ã€‚</li>
<li>isï¼šç­‰åŒäºeuqalTo</li>
<li>instanceOfï¼ŒisCompatibleTypeï¼šæµ‹è¯•ç±»å‹</li>
<li>notNullValueï¼ŒnullValueï¼šæµ‹è¯•null</li>
<li>sameInstanceï¼šæ˜¯å¦åŒä¸€å®ä¾‹</li>
<li>hasEntryï¼ŒhasKeyï¼ŒhasValueï¼šæµ‹è¯•ä¸€ä¸ªMapåŒ…å«entry.keyæˆ–è€…valueã€‚</li>
</ul>
<h2 id="2-Fixture"><a href="#2-Fixture" class="headerlink" title="2. Fixture"></a>2. Fixture</h2><p>JUnitæä¾›äº†ç¼–å†™æµ‹è¯•å‰å‡†å¤‡ã€æµ‹è¯•åæ¸…ç†çš„å›ºå®šä»£ç ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºFixtureã€‚</p>
<h3 id="2-1-BeforeEachå’Œ-AfterEach"><a href="#2-1-BeforeEachå’Œ-AfterEach" class="headerlink" title="2.1 @BeforeEachå’Œ   @AfterEach"></a>2.1 <code>@BeforeEach</code>å’Œ   <code>@AfterEach</code></h3><p>æˆ‘ä»¬ä¸å¿…åœ¨æ¯ä¸ªæµ‹è¯•æ–¹æ³•ä¸­éƒ½å†™ä¸Šåˆå§‹åŒ–ä»£ç ï¼Œè€Œæ˜¯é€šè¿‡<code>@BeforeEach</code>æ¥åˆå§‹åŒ–ï¼Œé€šè¿‡<code>@AfterEach</code>æ¥æ¸…ç†èµ„æºï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CalculatorTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    Calculator calculator;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@BeforeEach</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUp</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.calculator = <span class="keyword">new</span> Calculator();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@AfterEach</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">tearDown</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.calculator = <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">testAdd</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        assertEquals(<span class="number">100</span>, <span class="keyword">this</span>.calculator.add(<span class="number">100</span>));</span><br><span class="line">        assertEquals(<span class="number">150</span>, <span class="keyword">this</span>.calculator.add(<span class="number">50</span>));</span><br><span class="line">        assertEquals(<span class="number">130</span>, <span class="keyword">this</span>.calculator.add(-<span class="number">20</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">testSub</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        assertEquals(-<span class="number">100</span>, <span class="keyword">this</span>.calculator.sub(<span class="number">100</span>));</span><br><span class="line">        assertEquals(-<span class="number">150</span>, <span class="keyword">this</span>.calculator.sub(<span class="number">50</span>));</span><br><span class="line">        assertEquals(-<span class="number">130</span>, <span class="keyword">this</span>.calculator.sub(-<span class="number">20</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ ‡è®°ä¸º<code>@BeforeEach</code>å’Œ<code>@AfterEach</code>çš„æ–¹æ³•ï¼Œå®ƒä»¬ä¼šåœ¨è¿è¡Œæ¯ä¸ª<code>@Test</code>æ–¹æ³•å‰åè‡ªåŠ¨è¿è¡Œã€‚</p>
<p>ä½†æ˜¯ï¼Œè¿™æ ·åœ¨æŸäº›æƒ…å†µä¸‹ä¼šæ¯”è¾ƒæµªè´¹ç³»ç»Ÿèµ„æºã€‚</p>
<h3 id="2-2-BeforeAllå’Œ-AfterAll"><a href="#2-2-BeforeAllå’Œ-AfterAll" class="headerlink" title="2.2 @BeforeAllå’Œ@AfterAll"></a>2.2 <code>@BeforeAll</code>å’Œ<code>@AfterAll</code></h3><p>JUnitè¿˜æä¾›äº†<code>@BeforeAll</code>å’Œ<code>@AfterAll</code>ï¼Œå®ƒä»¬åœ¨è¿è¡Œæ‰€æœ‰@Testå‰åè¿è¡Œã€‚</p>
<p>å› ä¸º<code>@BeforeAll</code>å’Œ<code>@AfterAll</code>åœ¨æ‰€æœ‰<code>@Test</code>æ–¹æ³•è¿è¡Œå‰åä»…è¿è¡Œä¸€æ¬¡ï¼Œå› æ­¤ï¼Œå®ƒä»¬åª<strong>èƒ½åˆå§‹åŒ–é™æ€å˜é‡</strong>ï¼ŒåŒæ—¶<strong>åˆå§‹åŒ–æ–¹æ³•ä¹Ÿå¿…é¡»æ˜¯é™æ€æ–¹æ³•</strong>ï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DatabaseTest</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> Database db;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@BeforeAll</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">initDatabase</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        db = createDb(...);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@AfterAll</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">dropDatabase</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol>
<li>å¯¹äºå®ä¾‹å˜é‡ï¼Œåœ¨<code>@BeforeEach</code>ä¸­åˆå§‹åŒ–ï¼Œåœ¨<code>@AfterEach</code>ä¸­æ¸…ç†ï¼Œå®ƒä»¬åœ¨å„ä¸ª<code>@Test</code>æ–¹æ³•ä¸­äº’ä¸å½±å“ï¼Œå› ä¸ºæ˜¯ä¸åŒçš„å®ä¾‹ï¼›</li>
<li>å¯¹äºé™æ€å˜é‡ï¼Œåœ¨<code>@BeforeAll</code>ä¸­åˆå§‹åŒ–ï¼Œåœ¨<code>@AfterAll</code>ä¸­æ¸…ç†ï¼Œå®ƒä»¬åœ¨å„ä¸ª<code>@Test</code>æ–¹æ³•ä¸­å‡æ˜¯å”¯ä¸€å®ä¾‹ï¼Œä¼šå½±å“å„ä¸ª<code>@Test</code>æ–¹æ³•ã€‚</li>
</ol>
<p>å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œä½¿ç”¨<code>@BeforeEach</code>å’Œ<code>@AfterEach</code>å°±è¶³å¤Ÿäº†ã€‚åªæœ‰æŸäº›æµ‹è¯•èµ„æºåˆå§‹åŒ–è€—è´¹æ—¶é—´å¤ªé•¿ï¼Œä»¥è‡³äºæˆ‘ä»¬ä¸å¾—ä¸å°½é‡â€œå¤ç”¨â€æ—¶æ‰ä¼šç”¨åˆ°<code>@BeforeAll</code>å’Œ<code>@AfterAll</code>ã€‚</p>
<h2 id="3-å¼‚å¸¸æµ‹è¯•"><a href="#3-å¼‚å¸¸æµ‹è¯•" class="headerlink" title="3. å¼‚å¸¸æµ‹è¯•"></a>3. å¼‚å¸¸æµ‹è¯•</h2><p>JUnitæä¾›<code>assertThrows()</code>æ¥æœŸæœ›æ•è·ä¸€ä¸ªæŒ‡å®šçš„å¼‚å¸¸ã€‚ç¬¬äºŒä¸ªå‚æ•°<code>Executable</code>å°è£…äº†æˆ‘ä»¬è¦æ‰§è¡Œçš„ä¼šäº§ç”Ÿå¼‚å¸¸çš„ä»£ç ã€‚å½“æˆ‘ä»¬æ‰§è¡Œ<code>Factorial.fact(-1)</code>æ—¶ï¼Œå¿…å®šæŠ›å‡º<code>IllegalArgumentException</code>ã€‚<code>assertThrows()</code>åœ¨æ•è·åˆ°æŒ‡å®šå¼‚å¸¸æ—¶è¡¨ç¤ºé€šè¿‡æµ‹è¯•ï¼Œæœªæ•è·åˆ°å¼‚å¸¸ï¼Œæˆ–è€…æ•è·åˆ°çš„å¼‚å¸¸ç±»å‹ä¸å¯¹ï¼Œå‡è¡¨ç¤ºæµ‹è¯•å¤±è´¥ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">testNegative</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    assertThrows(IllegalArgumentException.class, <span class="keyword">new</span> Executable() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">()</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">            Factorial.fact(-<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é‡‡ç”¨åŒ¿åç±»å¤ªç¹çï¼Œç”¨Lambdaæ›´åˆé€‚ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">testNegative</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    assertThrows(IllegalArgumentException.class, () -&gt; &#123;</span><br><span class="line">        Factorial.fact(-<span class="number">1</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="4-æ¡ä»¶æµ‹è¯•"><a href="#4-æ¡ä»¶æµ‹è¯•" class="headerlink" title="4. æ¡ä»¶æµ‹è¯•"></a>4. æ¡ä»¶æµ‹è¯•</h2><h3 id="4-1-Disabled"><a href="#4-1-Disabled" class="headerlink" title="4.1 @Disabled"></a>4.1 <code>@Disabled</code></h3><p><code>@Disabled</code>çš„ä½œç”¨æ˜¯æš‚æ—¶æ’é™¤æŸäº›æ–¹æ³•ï¼Œä¸è®©ä»–è¿è¡Œã€‚</p>
<p>æµ‹è¯•æ—¶çš„æ˜¾ç¤ºç»“æœå¦‚ä¸‹æ ·ä¾‹ï¼šæ˜¾ç¤ºè·³è¿‡ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Tests run: 68, Failures: 2, Errors: 0, Skipped: 5</span><br></pre></td></tr></table></figure>

<h3 id="4-2-EnableOnOs"><a href="#4-2-EnableOnOs" class="headerlink" title="4.2 @EnableOnOs"></a>4.2 <code>@EnableOnOs</code></h3><p><code>@EnableOnOs</code>å°±æ˜¯ä¸€ä¸ªæ¡ä»¶æµ‹è¯•åˆ¤æ–­ã€‚åˆ¤æ–­æ“ä½œç³»ç»Ÿï¼Œå†é€‰æ‹©æ˜¯å¦è¦æ‰§è¡Œã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="meta">@EnabledOnOs(OS.WINDOWS)</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">testWindows</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    assertEquals(<span class="string">&quot;C:\\test.ini&quot;</span>, config.getConfigFile(<span class="string">&quot;test.ini&quot;</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="meta">@EnabledOnOs(&#123; OS.LINUX, OS.MAC &#125;)</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">testLinuxAndMac</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    assertEquals(<span class="string">&quot;/usr/local/test.cfg&quot;</span>, config.getConfigFile(<span class="string">&quot;test.cfg&quot;</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-3-DisabledOnOs"><a href="#4-3-DisabledOnOs" class="headerlink" title="4.3 @DisabledOnOs"></a>4.3 <code>@DisabledOnOs</code></h3><p><code>@DisabledOnOs(OS.WINDOWS)</code>ï¼šè¡¨ç¤ºä¸å†Windowså¹³å°æ‰§è¡Œã€‚</p>
<h3 id="4-4-DisabledOnJre"><a href="#4-4-DisabledOnJre" class="headerlink" title="4.4 @DisabledOnJre"></a>4.4 <code>@DisabledOnJre</code></h3><p><code>@DisabledOnJre(JRE.JAVA_8)</code>ï¼šåªèƒ½åœ¨Java 9æˆ–æ›´é«˜ç‰ˆæœ¬æ‰§è¡Œçš„æµ‹è¯•</p>
<h3 id="4-5-EnabledIfSystemProperty"><a href="#4-5-EnabledIfSystemProperty" class="headerlink" title="4.5 @EnabledIfSystemProperty"></a>4.5 <code>@EnabledIfSystemProperty</code></h3><p><code>@EnabledIfSystemProperty(named = &quot;os.arch&quot;, matches = &quot;.*64.*&quot;)</code>ï¼šåªèƒ½åœ¨64ä½æ“ä½œç³»ç»Ÿä¸Šæ‰§è¡Œçš„æµ‹è¯•.</p>
<h3 id="4-6-EnabledIfEnvironmentVariable"><a href="#4-6-EnabledIfEnvironmentVariable" class="headerlink" title="4.6 @EnabledIfEnvironmentVariable"></a>4.6 <code>@EnabledIfEnvironmentVariable</code></h3><p><code>@EnabledIfEnvironmentVariable(named = &quot;DEBUG&quot;, matches = &quot;true&quot;)</code>ï¼šéœ€è¦ä¼ å…¥ç¯å¢ƒå˜é‡<code>DEBUG=true</code>æ‰èƒ½æ‰§è¡Œçš„æµ‹è¯•</p>
<h2 id="5-å‚æ•°åŒ–æµ‹è¯•"><a href="#5-å‚æ•°åŒ–æµ‹è¯•" class="headerlink" title="5. å‚æ•°åŒ–æµ‹è¯•"></a>5. å‚æ•°åŒ–æµ‹è¯•</h2><p>å¦‚æœå¾…æµ‹è¯•çš„è¾“å…¥å’Œè¾“å‡ºæ˜¯ä¸€ç»„æ•°æ®ï¼š å¯ä»¥æŠŠæµ‹è¯•æ•°æ®ç»„ç»‡èµ·æ¥ ç”¨ä¸åŒçš„æµ‹è¯•æ•°æ®è°ƒç”¨ç›¸åŒçš„æµ‹è¯•æ–¹æ³•ã€‚</p>
<p>JUnitæä¾›äº†ä¸€ä¸ª<code>@ParameterizedTest</code>æ³¨è§£ï¼Œç”¨æ¥è¿›è¡Œå‚æ•°åŒ–æµ‹è¯•ã€‚</p>
<h3 id="5-1-æ–¹æ³•1ï¼š-MethodSource"><a href="#5-1-æ–¹æ³•1ï¼š-MethodSource" class="headerlink" title="5.1 æ–¹æ³•1ï¼š@MethodSource"></a>5.1 æ–¹æ³•1ï¼š<code>@MethodSource</code></h3><p>é€šè¿‡<code>@MethodSource</code>æ³¨è§£ï¼Œå®ƒå…è®¸æˆ‘ä»¬ç¼–å†™ä¸€ä¸ª<strong>åŒå</strong>çš„é™æ€æ–¹æ³•æ¥æä¾›æµ‹è¯•å‚æ•°ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@ParameterizedTest</span></span><br><span class="line"><span class="meta">@MethodSource</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">testCapitalize</span><span class="params">(String input, String result)</span> </span>&#123;</span><br><span class="line">    assertEquals(result, StringUtils.capitalize(input));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> List&lt;Arguments&gt; <span class="title">testCapitalize</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> List.of( <span class="comment">// arguments:</span></span><br><span class="line">            Arguments.arguments(<span class="string">&quot;abc&quot;</span>, <span class="string">&quot;Abc&quot;</span>), <span class="comment">//</span></span><br><span class="line">            Arguments.arguments(<span class="string">&quot;APPLE&quot;</span>, <span class="string">&quot;Apple&quot;</span>), <span class="comment">//</span></span><br><span class="line">            Arguments.arguments(<span class="string">&quot;gooD&quot;</span>, <span class="string">&quot;Good&quot;</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-2-CsvSourceå’Œ-CsvFileSource"><a href="#5-2-CsvSourceå’Œ-CsvFileSource" class="headerlink" title="5.2 @CsvSourceå’Œ@CsvFileSource"></a>5.2 <code>@CsvSource</code>å’Œ<code>@CsvFileSource</code></h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@ParameterizedTest</span></span><br><span class="line"><span class="meta">@CsvSource(&#123; &quot;abc, Abc&quot;, &quot;APPLE, Apple&quot;, &quot;gooD, Good&quot; &#125;)</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">testCapitalize</span><span class="params">(String input, String result)</span> </span>&#123;</span><br><span class="line">    assertEquals(result, StringUtils.capitalize(input));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å®ƒçš„æ¯ä¸€ä¸ªå­—ç¬¦ä¸²è¡¨ç¤ºä¸€è¡Œï¼Œä¸€è¡ŒåŒ…å«çš„è‹¥å¹²å‚æ•°ç”¨<code>,</code>åˆ†éš”ã€‚</p>
<p>å¦‚æœæœ‰æˆç™¾ä¸Šåƒçš„æµ‹è¯•è¾“å…¥ï¼Œé‚£ä¹ˆï¼Œç›´æ¥å†™<code>@CsvSource</code>å°±å¾ˆä¸æ–¹ä¾¿ã€‚è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠæµ‹è¯•æ•°æ®æåˆ°ä¸€ä¸ªç‹¬ç«‹çš„CSVæ–‡ä»¶ä¸­ï¼Œç„¶åæ ‡æ³¨ä¸Š<code>@CsvFileSource</code>ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@ParameterizedTest</span></span><br><span class="line"><span class="meta">@CsvFileSource(resources = &#123; &quot;/test-capitalize.csv&quot; &#125;)</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">testCapitalizeUsingCsvFile</span><span class="params">(String input, String result)</span> </span>&#123;</span><br><span class="line">    assertEquals(result, StringUtils.capitalize(input));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="6-å‘½åè§„èŒƒå’Œæµ‹è¯•åŸåˆ™"><a href="#6-å‘½åè§„èŒƒå’Œæµ‹è¯•åŸåˆ™" class="headerlink" title="6. å‘½åè§„èŒƒå’Œæµ‹è¯•åŸåˆ™"></a>6. å‘½åè§„èŒƒå’Œæµ‹è¯•åŸåˆ™</h2><h3 id="6-1-å‘½åè§„èŒƒ"><a href="#6-1-å‘½åè§„èŒƒ" class="headerlink" title="6.1 å‘½åè§„èŒƒ"></a>6.1 å‘½åè§„èŒƒ</h3><p>æµ‹è¯•çš„å‡½æ•°å‘½ååº”å½“å°½å¯èƒ½æ˜“è¯»ï¼Œèƒ½å¤Ÿä¸€çœ¼å°±çœ‹æ˜ç™½è¿™ä¸ªæµ‹è¯•çš„ä½œç”¨ã€‚</p>
<p>å°½å¯èƒ½ä½¿ç”¨ï¼šgiven when then çš„ç»“æ„ã€‚</p>
<p>ä¾‹å¦‚ï¼šshould_return_3_when_add_given_input_1_and_2</p>
<p>å†å‡½æ•°ä½“ä¸­ä¹Ÿè¦æ ‡æ³¨å¥½given when thenã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">should_return_3_when_add_given_input_1_and_2</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">//given</span></span><br><span class="line">    Calculate calculate = <span class="keyword">new</span> Calculate();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//when</span></span><br><span class="line">    <span class="keyword">int</span> actual = Calculate.add(<span class="number">1</span>,<span class="number">2</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//then</span></span><br><span class="line">    Assert.assertEquals(actual,<span class="number">3</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="6-2-æµ‹è¯•åŸåˆ™"><a href="#6-2-æµ‹è¯•åŸåˆ™" class="headerlink" title="6.2 æµ‹è¯•åŸåˆ™"></a>6.2 æµ‹è¯•åŸåˆ™</h3><p><strong>FIRST</strong></p>
<ul>
<li>Fï¼šfast</li>
<li>Iï¼šIsolated</li>
<li>Rï¼šrepeatable</li>
<li>Sï¼šSelf-Validatingï¼šæµ‹è¯•ç”¨ä¾‹è‡ªåŠ¨å‘ŠçŸ¥è¿è¡Œç»“æœï¼Œä¸ä¾èµ–äººå·¥åˆ¤æ–­</li>
<li>Tï¼štimelyï¼šæµ‹è¯•å…ˆè¡Œæˆ–è€…å°½å¿«æµ‹è¯•ï¼Œä¸è¦æ‹–å»¶ã€‚</li>
</ul>
<h2 id="7-æµ‹è¯•å¥—ä»¶å’ŒMOCK"><a href="#7-æµ‹è¯•å¥—ä»¶å’ŒMOCK" class="headerlink" title="7. æµ‹è¯•å¥—ä»¶å’ŒMOCK"></a>7. æµ‹è¯•å¥—ä»¶å’ŒMOCK</h2><h3 id="7-1-æµ‹è¯•å¥—ä»¶"><a href="#7-1-æµ‹è¯•å¥—ä»¶" class="headerlink" title="7.1 æµ‹è¯•å¥—ä»¶"></a>7.1 æµ‹è¯•å¥—ä»¶</h3><p>éšç€é¡¹ç›®å¼€å±•ï¼Œå•å…ƒæµ‹è¯•ç±»è¶Šæ¥è¶Šå¤šï¼Œå®è·µä¸­éœ€è¦æˆ‘ä»¬ä¸€æ¬¡æ€§æµ‹è¯•è®¸å¤šç±»ã€‚</p>
<p>JUnitä½¿ç”¨æµ‹è¯•å¥—ä»¶è§£å†³è¯¥é—®é¢˜ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RunWith(Suite.class)</span></span><br><span class="line"><span class="meta">@Suite</span>.SuiteClasses(&#123;CalculateTest.class, CalculateTest1.class&#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FeatureTest</span></span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<h3 id="7-2-MOCK"><a href="#7-2-MOCK" class="headerlink" title="7.2 MOCK"></a>7.2 MOCK</h3><p>MOCKç”¨æ¥æ„é€ ä¸€äº›ä¸å®¹æ˜“æ„é€ å‡ºæ¥çš„å¯¹è±¡å’Œä¸€äº›å¤æ‚çš„å¯¹è±¡ï¼Œæ¯”å¦‚HttpServletRequestå¿…é¡»åœ¨Servletå®¹å™¨æ‰èƒ½æ„é€ å‡ºæ¥ã€‚</p>
<p>Mockè§£å†³çš„é—®é¢˜ï¼š</p>
<ol>
<li>è§£å†³ä¸åŒå•å…ƒè€¦åˆè€Œéš¾ä»¥æµ‹è¯•çš„é—®é¢˜</li>
<li>é€šè¿‡æ¨¡æ‹Ÿä¾èµ–åˆ†è§£å•å…ƒæµ‹è¯•è€¦åˆçš„éƒ¨åˆ†</li>
<li>éªŒè¯æ‰€è°ƒç”¨çš„ä¾èµ–</li>
</ol>
<p><strong>mockæ¡†æ¶</strong></p>
<p><strong>mockæ¡†æ¶ï¼ˆMockito ã€jmock ã€ powermockã€EasyMockï¼‰</strong></p>
<p>mockå…·ä½“å†…å®¹ç”¨åˆ°åœ¨å­¦ã€‚</p>
]]></content>
      <tags>
        <tag>JAVA</tag>
        <tag>æµ‹è¯•</tag>
      </tags>
  </entry>
  <entry>
    <title>JAVA-åå°„</title>
    <url>/2021/04/19/JAVA%E5%8F%8D%E5%B0%84/</url>
    <content><![CDATA[<h1 id="JAVAåå°„"><a href="#JAVAåå°„" class="headerlink" title="JAVAåå°„"></a>JAVAåå°„</h1><h2 id="1-Classç±»"><a href="#1-Classç±»" class="headerlink" title="1. Classç±»"></a>1. Classç±»</h2><p><code>class</code>æ˜¯ç”±JVMåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­åŠ¨æ€åŠ è½½çš„ã€‚JVMåœ¨ç¬¬ä¸€æ¬¡è¯»å–åˆ°ä¸€ç§<code>class</code>ç±»å‹æ—¶ï¼Œå°†å…¶åŠ è½½è¿›å†…å­˜ã€‚</p>
<p>æ¯åŠ è½½ä¸€ç§<code>class</code>ï¼ŒJVMå°±ä¸ºå…¶åˆ›å»ºä¸€ä¸ª<code>Class</code>ç±»å‹çš„å®ä¾‹ï¼Œå¹¶å…³è”èµ·æ¥ã€‚</p>
<p><strong>æ³¨æ„</strong>ï¼š<code>class</code>æ˜¯ç”¨æˆ·åˆ›å»ºçš„ç±»ï¼Œ<code>Class</code>æ˜¯ç”±JVMåˆ›å»ºçš„ç±»ã€‚</p>
<p>JVMä¸ºæ¯ä¸ªåŠ è½½çš„<code>class</code>åˆ›å»ºäº†å¯¹åº”çš„<code>Class</code>å®ä¾‹ï¼Œå¹¶åœ¨å®ä¾‹ä¸­ä¿å­˜äº†è¯¥<code>class</code>çš„æ‰€æœ‰ä¿¡æ¯ï¼ŒåŒ…æ‹¬<strong>ç±»åã€åŒ…åã€çˆ¶ç±»ã€å®ç°çš„æ¥å£ã€æ‰€æœ‰æ–¹æ³•ã€å­—æ®µ</strong>ç­‰ï¼Œå› æ­¤ï¼Œå¦‚æœè·å–äº†æŸä¸ª<code>Class</code>å®ä¾‹ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡è¿™ä¸ª<code>Class</code>å®ä¾‹è·å–åˆ°è¯¥å®ä¾‹å¯¹åº”çš„<code>class</code>çš„æ‰€æœ‰ä¿¡æ¯ã€‚</p>
<p>å¦‚ä½•è·å–ä¸€ä¸ª<code>class</code>çš„<code>Class</code>å®ä¾‹ï¼Ÿ</p>
<p>æ–¹æ³•ä¸€ï¼šç›´æ¥é€šè¿‡ä¸€ä¸ª<code>class</code>çš„é™æ€å˜é‡<code>class</code>è·å–ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Class cls = String.class;</span><br></pre></td></tr></table></figure>

<p>æ–¹æ³•äºŒï¼šå¦‚æœæˆ‘ä»¬æœ‰ä¸€ä¸ªå®ä¾‹å˜é‡ï¼Œå¯ä»¥é€šè¿‡è¯¥å®ä¾‹å˜é‡æä¾›çš„<code>getClass()</code>æ–¹æ³•è·å–ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">String s = <span class="string">&quot;Hello&quot;</span>;</span><br><span class="line">Class cls = s.getClass();</span><br></pre></td></tr></table></figure>

<p>æ–¹æ³•ä¸‰ï¼šå¦‚æœçŸ¥é“ä¸€ä¸ª<code>class</code>çš„å®Œæ•´ç±»åï¼Œå¯ä»¥é€šè¿‡é™æ€æ–¹æ³•<code>Class.forName()</code>è·å–ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Class cls = Class.forName(<span class="string">&quot;java.lang.String&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>å› ä¸ºåå°„çš„ç›®çš„æ˜¯ä¸ºäº†è·å¾—æŸä¸ªå®ä¾‹çš„ä¿¡æ¯ã€‚å› æ­¤ï¼Œå½“æˆ‘ä»¬æ‹¿åˆ°æŸä¸ª<code>Object</code>å®ä¾‹æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åå°„è·å–è¯¥<code>Object</code>çš„<code>class</code>ä¿¡æ¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">printObjectInfo</span><span class="params">(Object obj)</span> </span>&#123;</span><br><span class="line">    Class cls = obj.getClass();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>åå°„çš„ç”¨å¤„</strong>ï¼šä»å‡½æ•°ä¸­è·å¾—äº†ä¸€ä¸ªå¯¹è±¡ï¼Œä½†æ˜¯å¹¶ä¸çŸ¥é“è¿™ä¸ªå¯¹è±¡æ˜¯å“ªä¸ªç±»ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡ <code>Class</code>æ¥å¾—åˆ°è¿™ä¸ªå¯¹è±¡çš„ä¿¡æ¯ã€‚</p>
<p>å¯ä»¥å‚è€ƒè¿™æ®µä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        printClassInfo(<span class="string">&quot;&quot;</span>.getClass());</span><br><span class="line">        printClassInfo(Runnable.class);</span><br><span class="line">        printClassInfo(java.time.Month.class);</span><br><span class="line">        printClassInfo(String[].class);</span><br><span class="line">        printClassInfo(<span class="keyword">int</span>.class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">printClassInfo</span><span class="params">(Class cls)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Class name: &quot;</span> + cls.getName());</span><br><span class="line">        System.out.println(<span class="string">&quot;Simple name: &quot;</span> + cls.getSimpleName());</span><br><span class="line">        <span class="keyword">if</span> (cls.getPackage() != <span class="keyword">null</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Package name: &quot;</span> + cls.getPackage().getName());</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;is interface: &quot;</span> + cls.isInterface());</span><br><span class="line">        System.out.println(<span class="string">&quot;is enum: &quot;</span> + cls.isEnum());</span><br><span class="line">        System.out.println(<span class="string">&quot;is array: &quot;</span> + cls.isArray());</span><br><span class="line">        System.out.println(<span class="string">&quot;is primitive: &quot;</span> + cls.isPrimitive());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><del>æ•°ç»„ï¼ˆä¾‹å¦‚<code>String[]</code>ï¼‰ä¹Ÿæ˜¯ä¸€ç§<code>Class</code>ï¼Œè€Œä¸”ä¸åŒäº<code>String.class</code>ï¼Œå®ƒçš„ç±»åæ˜¯<code>java.lang.String</code>ã€‚æ­¤å¤–ï¼ŒJVMä¸ºæ¯ä¸€ç§åŸºæœ¬ç±»å‹å¦‚intä¹Ÿåˆ›å»ºäº†<code>Class</code>ï¼Œé€šè¿‡<code>int.class</code>è®¿é—®ã€‚</del></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è·å–Stringçš„Classå®ä¾‹:</span></span><br><span class="line">Class cls = String.class;</span><br><span class="line"><span class="comment">// åˆ›å»ºä¸€ä¸ªStringå®ä¾‹:</span></span><br><span class="line">String s = (String) cls.newInstance();</span><br></pre></td></tr></table></figure>

<p><del>è¿™æ®µä»£ç ç›¸å½“äº<code>new String()</code></del></p>
<p>è¯¥æ–¹æ³•å·²ç»è¢«å¼ƒç”¨ï¼Œåº”å½“æ›´æ¢æˆ<code>cls.getDeclaredConstructor().newInstance();</code>ã€‚</p>
<p>å®ƒçš„å±€é™æ˜¯ï¼šåªèƒ½è°ƒç”¨<code>public</code>çš„æ— å‚æ•°æ„é€ æ–¹æ³•ã€‚å¸¦å‚æ•°çš„æ„é€ æ–¹æ³•ï¼Œæˆ–è€…é<code>public</code>çš„æ„é€ æ–¹æ³•éƒ½æ— æ³•é€šè¿‡<code>Class.newInstance()</code>è¢«è°ƒç”¨ã€‚</p>
<p><strong>åŠ¨æ€åŠ è½½</strong></p>
<p>JVMæ€»æ˜¯åŠ¨æ€åŠ è½½<code>class</code>ï¼Œå¯ä»¥åœ¨è¿è¡ŒæœŸæ ¹æ®æ¡ä»¶æ¥æ§åˆ¶åŠ è½½classã€‚</p>
<h2 id="2-è®¿é—®å­—æ®µ"><a href="#2-è®¿é—®å­—æ®µ" class="headerlink" title="2. è®¿é—®å­—æ®µ"></a>2. è®¿é—®å­—æ®µ</h2><p><code>Class</code>ç±»æä¾›äº†ä»¥ä¸‹å‡ ä¸ªæ–¹æ³•ï¼š</p>
<ul>
<li>Field getField(name)ï¼šæ ¹æ®å­—æ®µåè·å–æŸä¸ªpublicçš„fieldï¼ˆåŒ…æ‹¬çˆ¶ç±»ï¼‰</li>
<li>Field getDeclaredField(name)ï¼šæ ¹æ®å­—æ®µåè·å–å½“å‰ç±»çš„æŸä¸ªfieldï¼ˆä¸åŒ…æ‹¬çˆ¶ç±»ï¼‰</li>
<li>Field[] getFields()ï¼šè·å–æ‰€æœ‰publicçš„fieldï¼ˆåŒ…æ‹¬çˆ¶ç±»ï¼‰</li>
<li>Field[] getDeclaredFields()ï¼šè·å–å½“å‰ç±»çš„æ‰€æœ‰fieldï¼ˆä¸åŒ…æ‹¬çˆ¶ç±»ï¼‰</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Class stdClass = Student.class;</span><br><span class="line">        <span class="comment">// è·å–publicå­—æ®µ&quot;score&quot;:</span></span><br><span class="line">        System.out.println(stdClass.getField(<span class="string">&quot;score&quot;</span>));</span><br><span class="line">        <span class="comment">// è·å–ç»§æ‰¿çš„publicå­—æ®µ&quot;name&quot;:</span></span><br><span class="line">        System.out.println(stdClass.getField(<span class="string">&quot;name&quot;</span>));</span><br><span class="line">        <span class="comment">// è·å–privateå­—æ®µ&quot;grade&quot;:</span></span><br><span class="line">        System.out.println(stdClass.getDeclaredField(<span class="string">&quot;grade&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span> <span class="keyword">extends</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> score;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> grade;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> String name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Fieldæ˜¯ä¸€ä¸ªç±»ï¼Œ<code>getField</code>å¾—åˆ°çš„æ˜¯Fieldçš„å®ä¾‹åŒ–å¯¹è±¡ï¼Œå¹¶éå­—æ®µã€‚è¯¥å¯¹è±¡åŒ…å«ä¸‰ä¸ªæ–¹æ³•ï¼š</p>
<ul>
<li><code>getName()</code>ï¼šè¿”å›å­—æ®µåç§°ï¼Œä¾‹å¦‚ï¼Œ<code>&quot;name&quot;</code>ï¼›</li>
<li><code>getType()</code>ï¼šè¿”å›å­—æ®µç±»å‹ï¼Œä¹Ÿæ˜¯ä¸€ä¸ª<code>Class</code>å®ä¾‹ï¼Œä¾‹å¦‚ï¼Œ<code>String.class</code>ï¼›</li>
<li><code>getModifiers()</code>ï¼šè¿”å›å­—æ®µçš„ä¿®é¥°ç¬¦ï¼Œå®ƒæ˜¯ä¸€ä¸ª<code>int</code>ï¼Œä¸åŒçš„bitè¡¨ç¤ºä¸åŒçš„å«ä¹‰ã€‚</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Field f = String.class.getDeclaredField(<span class="string">&quot;value&quot;</span>);</span><br><span class="line">f.getName(); <span class="comment">// &quot;value&quot;</span></span><br><span class="line">f.getType(); <span class="comment">// class [B è¡¨ç¤ºbyte[]ç±»å‹</span></span><br><span class="line"><span class="keyword">int</span> m = f.getModifiers();</span><br><span class="line">Modifier.isFinal(m); <span class="comment">// true</span></span><br><span class="line">Modifier.isPublic(m); <span class="comment">// false</span></span><br><span class="line">Modifier.isProtected(m); <span class="comment">// false</span></span><br><span class="line">Modifier.isPrivate(m); <span class="comment">// true</span></span><br><span class="line">Modifier.isStatic(m); <span class="comment">// false</span></span><br></pre></td></tr></table></figure>

<p><strong>è·å–å­—æ®µå€¼</strong></p>
<p>æ‹¿åˆ°Filedå®ä¾‹åï¼Œæˆ‘ä»¬è°ƒç”¨<code>Field.get(Object)</code>è·å–æŒ‡å®šå®ä¾‹çš„æŒ‡å®šå­—æ®µçš„å€¼ã€‚Objectæ˜¯è¦è·å–å±æ€§çš„å¯¹è±¡ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Object p = <span class="keyword">new</span> Person(<span class="string">&quot;Xiao Ming&quot;</span>);</span><br><span class="line">        Class c = p.getClass();</span><br><span class="line">        Field f = c.getDeclaredField(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">        f.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">        <span class="comment">//name æ˜¯privateç±»å‹çš„ï¼Œå› æ­¤éœ€è¦åŠ ä¸Šf.setAccessible(true);å¦åˆ™ä¼šæŠ¥é”™</span></span><br><span class="line">        Object value = f.get(p);  <span class="comment">//valueå®é™…ä¸Šæ˜¯ä¸€ä¸ªStringå¯¹è±¡</span></span><br><span class="line">        System.out.println(value); <span class="comment">// &quot;Xiao Ming&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Person</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åå°„è¿æ³•äº†ç±»çš„å°è£…æ€§ï¼Œä½†æ˜¯åå°„å¤šç”¨äºå·¥å…·æˆ–åº•å±‚æ¡†æ¶ï¼Œå¹¶ä¸”<code>setAccessible</code>(<code>true</code>)å¯èƒ½ä¼šå¤±è´¥ï¼ŒJVMå­˜åœ¨å®‰å…¨æ€§ç®¡ç†å™¨ã€‚æœ‰å¯èƒ½ä¼šé˜»æ­¢æƒé™è®¿é—®ã€‚</p>
<p><strong>è®¾ç½®å­—æ®µå€¼</strong></p>
<p>è®¾ç½®å­—æ®µå€¼æ˜¯é€šè¿‡<code>Field.set(Object, Object)</code>ã€‚ç¬¬ä¸€ä¸ª<code>Object</code>å‚æ•°æ˜¯æŒ‡å®šçš„å®ä¾‹ï¼Œç¬¬äºŒä¸ª<code>Object</code>å‚æ•°æ˜¯å¾…ä¿®æ”¹çš„å€¼ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Person p = <span class="keyword">new</span> Person(<span class="string">&quot;Xiao Ming&quot;</span>);</span><br><span class="line">        System.out.println(p.getName()); <span class="comment">// &quot;Xiao Ming&quot;</span></span><br><span class="line">        Class c = p.getClass();</span><br><span class="line">        Field f = c.getDeclaredField(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">        f.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">        f.set(p, <span class="string">&quot;Xiao Hong&quot;</span>);</span><br><span class="line">        System.out.println(p.getName()); <span class="comment">// &quot;Xiao Hong&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>æ€»ç»“</strong></p>
<p>Javaçš„åå°„APIæä¾›çš„<code>Field</code>ç±»å°è£…äº†å­—æ®µçš„æ‰€æœ‰ä¿¡æ¯ï¼š</p>
<p>é€šè¿‡<code>Class</code>å®ä¾‹çš„æ–¹æ³•å¯ä»¥è·å–<code>Field</code>å®ä¾‹ï¼š<code>getField()</code>ï¼Œ<code>getFields()</code>ï¼Œ<code>getDeclaredField()</code>ï¼Œ<code>getDeclaredFields()</code>ï¼›</p>
<p>é€šè¿‡Fieldå®ä¾‹å¯ä»¥è·å–å­—æ®µä¿¡æ¯ï¼š<code>getName()</code>ï¼Œ<code>getType()</code>ï¼Œ<code>getModifiers()</code>ï¼›</p>
<p>é€šè¿‡Fieldå®ä¾‹å¯ä»¥è¯»å–æˆ–è®¾ç½®æŸä¸ªå¯¹è±¡çš„å­—æ®µï¼Œå¦‚æœå­˜åœ¨è®¿é—®é™åˆ¶ï¼Œè¦é¦–å…ˆè°ƒç”¨<code>setAccessible(true)</code>æ¥è®¿é—®é<code>public</code>å­—æ®µã€‚</p>
<h2 id="3-è°ƒç”¨æ–¹æ³•"><a href="#3-è°ƒç”¨æ–¹æ³•" class="headerlink" title="3. è°ƒç”¨æ–¹æ³•"></a>3. è°ƒç”¨æ–¹æ³•</h2><p>å¯ä»¥é€šè¿‡<code>Class</code>å®ä¾‹è·å–æ‰€æœ‰<code>Method</code>ä¿¡æ¯ã€‚<code>Class</code>ç±»æä¾›äº†ä»¥ä¸‹å‡ ä¸ªæ–¹æ³•æ¥è·å–<code>Method</code>ï¼š</p>
<ul>
<li><code>Method getMethod(name, Class...)</code>ï¼šè·å–æŸä¸ª<code>public</code>çš„<code>Method</code>ï¼ˆåŒ…æ‹¬çˆ¶ç±»ï¼‰</li>
<li><code>Method getDeclaredMethod(name, Class...)</code>ï¼šè·å–å½“å‰ç±»çš„æŸä¸ª<code>Method</code>ï¼ˆä¸åŒ…æ‹¬çˆ¶ç±»ï¼‰</li>
<li><code>Method[] getMethods()</code>ï¼šè·å–æ‰€æœ‰<code>public</code>çš„<code>Method</code>ï¼ˆåŒ…æ‹¬çˆ¶ç±»ï¼‰</li>
<li><code>Method[] getDeclaredMethods()</code>ï¼šè·å–å½“å‰ç±»çš„æ‰€æœ‰<code>Method</code>ï¼ˆä¸åŒ…æ‹¬çˆ¶ç±»ï¼‰</li>
</ul>
<p>ä¸€ä¸ª<code>Method</code>å¯¹è±¡åŒ…å«ä¸€ä¸ªæ–¹æ³•çš„æ‰€æœ‰ä¿¡æ¯ï¼š</p>
<ul>
<li><code>getName()</code>ï¼šè¿”å›æ–¹æ³•åç§°ï¼Œä¾‹å¦‚ï¼š<code>&quot;getScore&quot;</code>ï¼›</li>
<li><code>getReturnType()</code>ï¼šè¿”å›æ–¹æ³•è¿”å›å€¼ç±»å‹ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªClasså®ä¾‹ï¼Œä¾‹å¦‚ï¼š<code>String.class</code>ï¼›</li>
<li><code>getParameterTypes()</code>ï¼šè¿”å›æ–¹æ³•çš„å‚æ•°ç±»å‹ï¼Œæ˜¯ä¸€ä¸ªClassæ•°ç»„ï¼Œä¾‹å¦‚ï¼š<code>&#123;String.class, int.class&#125;</code>ï¼›</li>
<li><code>getModifiers()</code>ï¼šè¿”å›æ–¹æ³•çš„ä¿®é¥°ç¬¦ï¼Œå®ƒæ˜¯ä¸€ä¸ª<code>int</code>ï¼Œä¸åŒçš„bitè¡¨ç¤ºä¸åŒçš„å«ä¹‰ã€‚</li>
</ul>
<p>è·å–åˆ°ä¸€ä¸ª<code>Method</code>å¯¹è±¡æ—¶ï¼Œå°±å¯ä»¥å¯¹å®ƒè¿›è¡Œè°ƒç”¨ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// Stringå¯¹è±¡:</span></span><br><span class="line">        String s = <span class="string">&quot;Hello world&quot;</span>;</span><br><span class="line">        <span class="comment">// è·å–String substring(int)æ–¹æ³•ï¼Œå‚æ•°ä¸ºint:</span></span><br><span class="line">        Method m = String.class.getMethod(<span class="string">&quot;substring&quot;</span>, <span class="keyword">int</span>.class);</span><br><span class="line">        <span class="comment">// åœ¨så¯¹è±¡ä¸Šè°ƒç”¨è¯¥æ–¹æ³•å¹¶è·å–ç»“æœ:</span></span><br><span class="line">        String r = (String) m.invoke(s, <span class="number">6</span>);</span><br><span class="line">        <span class="comment">// æ‰“å°è°ƒç”¨ç»“æœ:</span></span><br><span class="line">        System.out.println(r);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯¹<code>Method</code>å®ä¾‹è°ƒç”¨<code>invoke</code>å°±ç›¸å½“äºè°ƒç”¨è¯¥æ–¹æ³•.</p>
<p><strong>è°ƒç”¨é™æ€æ–¹æ³•</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// è·å–Integer.parseInt(String)æ–¹æ³•ï¼Œå‚æ•°ä¸ºString:</span></span><br><span class="line">        Method m = Integer.class.getMethod(<span class="string">&quot;parseInt&quot;</span>, String.class);</span><br><span class="line">        <span class="comment">// è°ƒç”¨è¯¥é™æ€æ–¹æ³•å¹¶è·å–ç»“æœ:</span></span><br><span class="line">        Integer n = (Integer) m.invoke(<span class="keyword">null</span>, <span class="string">&quot;12345&quot;</span>);</span><br><span class="line">        <span class="comment">// æ‰“å°è°ƒç”¨ç»“æœ:</span></span><br><span class="line">        System.out.println(n);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>è°ƒç”¨épublicæ–¹æ³•</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Person p = <span class="keyword">new</span> Person();</span><br><span class="line">        Method m = p.getClass().getDeclaredMethod(<span class="string">&quot;setName&quot;</span>, String.class);</span><br><span class="line">        m.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">        <span class="comment">//privateæ–¹æ³•éœ€è¦ä½¿ç”¨setAccessibleæ‰èƒ½è¢«è°ƒç”¨</span></span><br><span class="line">        m.invoke(p, <span class="string">&quot;Bob&quot;</span>);</span><br><span class="line">        System.out.println(p.name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>å¤šæ€</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// è·å–Personçš„helloæ–¹æ³•:</span></span><br><span class="line">        Method h = Person.class.getMethod(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">        <span class="comment">// å¯¹Studentå®ä¾‹è°ƒç”¨helloæ–¹æ³•:</span></span><br><span class="line">        h.invoke(<span class="keyword">new</span> Student());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å®é™…è°ƒç”¨çš„æ˜¯studentå¯¹è±¡çš„æ–¹æ³•ï¼Œè€Œä¸æ˜¯personå¯¹è±¡çš„æ–¹æ³•ã€‚</p>
<p>æ€»ç»“ï¼š</p>
<p>Javaçš„åå°„APIæä¾›çš„Methodå¯¹è±¡å°è£…äº†æ–¹æ³•çš„æ‰€æœ‰ä¿¡æ¯ï¼š</p>
<p>é€šè¿‡<code>Class</code>å®ä¾‹çš„æ–¹æ³•å¯ä»¥è·å–<code>Method</code>å®ä¾‹ï¼š<code>getMethod()</code>ï¼Œ<code>getMethods()</code>ï¼Œ<code>getDeclaredMethod()</code>ï¼Œ<code>getDeclaredMethods()</code>ï¼›</p>
<p>é€šè¿‡<code>Method</code>å®ä¾‹å¯ä»¥è·å–æ–¹æ³•ä¿¡æ¯ï¼š<code>getName()</code>ï¼Œ<code>getReturnType()</code>ï¼Œ<code>getParameterTypes()</code>ï¼Œ<code>getModifiers()</code>ï¼›</p>
<p>é€šè¿‡<code>Method</code>å®ä¾‹å¯ä»¥è°ƒç”¨æŸä¸ªå¯¹è±¡çš„æ–¹æ³•ï¼š<code>Object invoke(Object instance, Object... parameters)</code>ï¼›</p>
<p>é€šè¿‡è®¾ç½®<code>setAccessible(true)</code>æ¥è®¿é—®é<code>public</code>æ–¹æ³•ï¼›</p>
<h2 id="4-è°ƒç”¨æ„é€ æ–¹æ³•"><a href="#4-è°ƒç”¨æ„é€ æ–¹æ³•" class="headerlink" title="4.è°ƒç”¨æ„é€ æ–¹æ³•"></a>4.è°ƒç”¨æ„é€ æ–¹æ³•</h2><p>æˆ‘ä»¬é€šå¸¸ä½¿ç”¨<code>new</code>æ“ä½œç¬¦åˆ›å»ºæ–°çš„å®ä¾‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Person p = <span class="keyword">new</span> Person();</span><br></pre></td></tr></table></figure>

<p><del>å¦‚æœé€šè¿‡åå°„æ¥åˆ›å»ºæ–°çš„å®ä¾‹ï¼Œå¯ä»¥è°ƒç”¨Classæä¾›çš„newInstance()æ–¹æ³•ï¼š</del></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Person p = Person.class.newInstance();è¯¥å®ä¾‹æ–¹æ³•åªèƒ½è°ƒç”¨é»˜è®¤æ„é€ æ–¹æ³•ã€‚</span><br></pre></td></tr></table></figure>
<p>è¯¥æ–¹æ³•å·²ç»å¼ƒç”¨ï¼Œåªèƒ½é‡‡ç”¨å¦‚ä¸‹çš„æ–¹æ³•ï¼š</p>
<p>ä¸ºäº†è°ƒç”¨ä»»æ„æ„é€ æ–¹æ³•ï¼ŒJavaçš„åå°„APIæä¾›äº†Constructorå¯¹è±¡ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// è·å–æ„é€ æ–¹æ³•Integer(int):</span></span><br><span class="line">        Constructor cons1 = Integer.class.getConstructor(<span class="keyword">int</span>.class);</span><br><span class="line">        <span class="comment">// è°ƒç”¨æ„é€ æ–¹æ³•:</span></span><br><span class="line">        Integer n1 = (Integer) cons1.newInstance(<span class="number">123</span>);</span><br><span class="line">        System.out.println(n1);</span><br><span class="line">        <span class="comment">// è·å–æ„é€ æ–¹æ³•Integer(String)</span></span><br><span class="line">        Constructor cons2 = Integer.class.getConstructor(String.class);</span><br><span class="line">        Integer n2 = (Integer) cons2.newInstance(<span class="string">&quot;456&quot;</span>);</span><br><span class="line">        System.out.println(n2);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>getConstructor(Class...)</code>ï¼šè·å–æŸä¸ª<code>public</code>çš„<code>Constructor</code>ï¼›</li>
<li><code>getDeclaredConstructor(Class...)</code>ï¼šè·å–æŸä¸ª<code>Constructor</code>ï¼›</li>
<li><code>getConstructors()</code>ï¼šè·å–æ‰€æœ‰<code>public</code>çš„<code>Constructor</code>ï¼›</li>
<li><code>getDeclaredConstructors()</code>ï¼šè·å–æ‰€æœ‰<code>Constructor</code>ã€‚</li>
</ul>
<h2 id="5-è·å–ç»§æ‰¿å…³ç³»"><a href="#5-è·å–ç»§æ‰¿å…³ç³»" class="headerlink" title="5. è·å–ç»§æ‰¿å…³ç³»"></a>5. è·å–ç»§æ‰¿å…³ç³»</h2><p><strong>è·å–çˆ¶ç±»</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Class i = Integer.class;</span><br><span class="line">        Class n = i.getSuperclass();</span><br><span class="line">        System.out.println(n);</span><br><span class="line">        Class o = n.getSuperclass();</span><br><span class="line">        System.out.println(o);</span><br><span class="line">        System.out.println(o.getSuperclass());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>è·å–æ¥å£</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Class s = Integer.class;</span><br><span class="line">        Class[] is = s.getInterfaces();</span><br><span class="line">        <span class="keyword">for</span> (Class i : is) &#123;</span><br><span class="line">            System.out.println(i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å½“æˆ‘ä»¬åˆ¤æ–­ä¸€ä¸ªå®ä¾‹æ˜¯å¦æ˜¯æŸä¸ªç±»å‹æ—¶ï¼Œæ­£å¸¸æƒ…å†µä¸‹ï¼Œä½¿ç”¨<code>instanceof</code>æ“ä½œç¬¦ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Object n = Integer.valueOf(<span class="number">123</span>);</span><br><span class="line"><span class="keyword">boolean</span> isDouble = n <span class="keyword">instanceof</span> Double; <span class="comment">// false</span></span><br><span class="line"><span class="keyword">boolean</span> isInteger = n <span class="keyword">instanceof</span> Integer; <span class="comment">// true</span></span><br><span class="line"><span class="keyword">boolean</span> isNumber = n <span class="keyword">instanceof</span> Number; <span class="comment">// true</span></span><br><span class="line"><span class="keyword">boolean</span> isSerializable = n <span class="keyword">instanceof</span> java.io.Serializable; <span class="comment">// true</span></span><br></pre></td></tr></table></figure>

<h2 id="6-åŠ¨æ€ä»£ç†"><a href="#6-åŠ¨æ€ä»£ç†" class="headerlink" title="6. åŠ¨æ€ä»£ç†"></a>6. åŠ¨æ€ä»£ç†</h2><p>åŠ¨æ€ä»£ç†ï¼ˆ<code>Dynamic Proxy</code>ï¼‰çš„æœºåˆ¶ï¼šå¯ä»¥åœ¨è¿è¡ŒæœŸåŠ¨æ€åˆ›å»ºæŸä¸ª<code>interface</code>çš„å®ä¾‹ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        InvocationHandler handler = <span class="keyword">new</span> InvocationHandler() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">                System.out.println(method);</span><br><span class="line">                <span class="keyword">if</span> (method.getName().equals(<span class="string">&quot;morning&quot;</span>)) &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;Good morning, &quot;</span> + args[<span class="number">0</span>]);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        Hello hello = (Hello) Proxy.newProxyInstance(</span><br><span class="line">            Hello.class.getClassLoader(), <span class="comment">// ä¼ å…¥ClassLoader</span></span><br><span class="line">            <span class="keyword">new</span> Class[] &#123; Hello.class &#125;, <span class="comment">// ä¼ å…¥è¦å®ç°çš„æ¥å£</span></span><br><span class="line">            handler); <span class="comment">// ä¼ å…¥å¤„ç†è°ƒç”¨æ–¹æ³•çš„InvocationHandler</span></span><br><span class="line">        hello.morning(<span class="string">&quot;Bob&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Hello</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">morning</span><span class="params">(String name)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬ä»ç„¶å…ˆå®šä¹‰äº†æ¥å£<code>Hello</code>ï¼Œä½†æ˜¯æˆ‘ä»¬å¹¶ä¸å»ç¼–å†™å®ç°ç±»ï¼Œè€Œæ˜¯ç›´æ¥é€šè¿‡JDKæä¾›çš„ä¸€ä¸ª<code>Proxy.newProxyInstance()</code>åˆ›å»ºäº†ä¸€ä¸ª<code>Hello</code>æ¥å£å¯¹è±¡ã€‚è¿™ç§æ²¡æœ‰å®ç°ç±»ä½†æ˜¯åœ¨è¿è¡ŒæœŸåŠ¨æ€åˆ›å»ºäº†ä¸€ä¸ªæ¥å£å¯¹è±¡çš„æ–¹å¼ï¼Œæˆ‘ä»¬ç§°ä¸ºåŠ¨æ€ä»£ç ã€‚JDKæä¾›çš„åŠ¨æ€åˆ›å»ºæ¥å£å¯¹è±¡çš„æ–¹å¼ï¼Œå°±å«åŠ¨æ€ä»£ç†ã€‚</p>
]]></content>
      <tags>
        <tag>JAVA</tag>
      </tags>
  </entry>
  <entry>
    <title>JAVAå¤„ç†json</title>
    <url>/2021/05/10/JAVA%E5%A4%84%E7%90%86json/</url>
    <content><![CDATA[<h1 id="Json"><a href="#Json" class="headerlink" title="Json"></a>Json</h1><p>åœ¨Webä¸Šä½¿ç”¨XMLç°åœ¨è¶Šæ¥è¶Šå°‘ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯JSONè¿™ç§æ•°æ®ç»“æ„ã€‚</p>
<p>JSONæ˜¯JavaScript Object Notationçš„ç¼©å†™ï¼Œå®ƒå»é™¤äº†æ‰€æœ‰JavaScriptæ‰§è¡Œä»£ç ï¼Œåªä¿ç•™JavaScriptçš„å¯¹è±¡æ ¼å¼ã€‚ä¸€ä¸ªå…¸å‹çš„JSONå¦‚ä¸‹ï¼š</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;id&quot;</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;Javaæ ¸å¿ƒæŠ€æœ¯&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;author&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;firstName&quot;</span>: <span class="string">&quot;Abc&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;lastName&quot;</span>: <span class="string">&quot;Xyz&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;isbn&quot;</span>: <span class="string">&quot;1234567&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;tags&quot;</span>: [<span class="string">&quot;Java&quot;</span>, <span class="string">&quot;Network&quot;</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>JSONä½œä¸ºæ•°æ®ä¼ è¾“çš„æ ¼å¼ï¼Œæœ‰å‡ ä¸ªæ˜¾è‘—çš„ä¼˜ç‚¹ï¼š</p>
<ul>
<li>JSONåªå…è®¸ä½¿ç”¨UTF-8ç¼–ç ï¼Œä¸å­˜åœ¨ç¼–ç é—®é¢˜ï¼›</li>
<li>JSONåªå…è®¸ä½¿ç”¨åŒå¼•å·ä½œä¸ºkeyï¼Œç‰¹æ®Šå­—ç¬¦ç”¨<code>\</code>è½¬ä¹‰ï¼Œæ ¼å¼ç®€å•ï¼›</li>
<li>æµè§ˆå™¨å†…ç½®JSONæ”¯æŒï¼Œå¦‚æœæŠŠæ•°æ®ç”¨JSONå‘é€ç»™æµè§ˆå™¨ï¼Œå¯ä»¥ç”¨JavaScriptç›´æ¥å¤„ç†ã€‚</li>
</ul>
<p>JSONé€‚åˆè¡¨ç¤ºå±‚æ¬¡ç»“æ„ï¼Œå› ä¸ºå®ƒæ ¼å¼ç®€å•ï¼Œä»…æ”¯æŒä»¥ä¸‹å‡ ç§æ•°æ®ç±»å‹ï¼š</p>
<ul>
<li>é”®å€¼å¯¹ï¼š<code>&#123;&quot;key&quot;: value&#125;</code></li>
<li>æ•°ç»„ï¼š<code>[1, 2, 3]</code></li>
<li>å­—ç¬¦ä¸²ï¼š<code>&quot;abc&quot;</code></li>
<li>æ•°å€¼ï¼ˆæ•´æ•°å’Œæµ®ç‚¹æ•°ï¼‰ï¼š<code>12.34</code></li>
<li>å¸ƒå°”å€¼ï¼š<code>true</code>æˆ–<code>false</code></li>
<li>ç©ºå€¼ï¼š<code>null</code></li>
</ul>
<p>å¸¸ç”¨çš„ç”¨äºè§£æJSONçš„ç¬¬ä¸‰æ–¹åº“æœ‰ï¼š</p>
<ul>
<li>Jackson</li>
<li>Gson</li>
<li>Fastjson</li>
<li>â€¦</li>
</ul>
<p>Jacksonä¹Ÿå¯ä»¥è§£æJSONï¼Œå› æ­¤æˆ‘ä»¬åªéœ€è¦å¼•å…¥ä»¥ä¸‹Mavenä¾èµ–ï¼š</p>
<ul>
<li>com.fasterxml.jackson.core:jackson-databind:2.10.0</li>
</ul>
<p>ä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">InputStream input = Main.class.getResourceAsStream(<span class="string">&quot;/book.json&quot;</span>);</span><br><span class="line">ObjectMapper mapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line"><span class="comment">// ååºåˆ—åŒ–æ—¶å¿½ç•¥ä¸å­˜åœ¨çš„JavaBeanå±æ€§:</span></span><br><span class="line">mapper.configure(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES, <span class="keyword">false</span>);</span><br><span class="line">Book book = mapper.readValue(input, Book.class);</span><br></pre></td></tr></table></figure>

<p>æ ¸å¿ƒä»£ç æ˜¯åˆ›å»ºä¸€ä¸ª<code>ObjectMapper</code>å¯¹è±¡ã€‚å…³é—­<code>DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES</code>åŠŸèƒ½ä½¿å¾—è§£ææ—¶å¦‚æœJavaBeanä¸å­˜åœ¨è¯¥å±æ€§æ—¶è§£æä¸ä¼šæŠ¥é”™ã€‚</p>
<p>æŠŠJSONè§£æä¸ºJavaBeançš„è¿‡ç¨‹ç§°ä¸ºååºåˆ—åŒ–ã€‚å¦‚æœæŠŠJavaBeanå˜ä¸ºJSONï¼Œé‚£å°±æ˜¯åºåˆ—åŒ–ã€‚è¦å®ç°JavaBeanåˆ°JSONçš„åºåˆ—åŒ–ï¼Œåªéœ€è¦ä¸€è¡Œä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">String json = mapper.writeValueAsString(book);</span><br></pre></td></tr></table></figure>

<p>è¦æŠŠJSONçš„æŸäº›å€¼è§£æä¸ºç‰¹å®šçš„Javaå¯¹è±¡ï¼Œä¾‹å¦‚<code>LocalDate</code>ï¼Œä¹Ÿæ˜¯å®Œå…¨å¯ä»¥çš„ã€‚</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;Javaæ ¸å¿ƒæŠ€æœ¯&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;pubDate&quot;</span>: <span class="string">&quot;2016-09-01&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¦è§£æä¸ºï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Book</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> String name;</span><br><span class="line">    <span class="keyword">public</span> LocalDate pubDate;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åªéœ€è¦å¼•å…¥æ ‡å‡†çš„JSR 310å…³äºJavaTimeçš„æ•°æ®æ ¼å¼å®šä¹‰è‡³Mavenï¼š</p>
<ul>
<li>com.fasterxml.jackson.datatype:jackson-datatype-jsr310:2.10.0</li>
</ul>
<p>åœ¨åˆ›å»º<code>ObjectMapper</code>æ—¶ï¼Œæ³¨å†Œä¸€ä¸ªæ–°çš„<code>JavaTimeModule</code>ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">ObjectMapper mapper = <span class="keyword">new</span> ObjectMapper().registerModule(<span class="keyword">new</span> JavaTimeModule());</span><br></pre></td></tr></table></figure>

<p>å†…ç½®çš„è§£æè§„åˆ™å’Œæ‰©å±•çš„è§£æè§„åˆ™å¦‚æœéƒ½ä¸æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ï¼Œè¿˜å¯ä»¥è‡ªå®šä¹‰è§£æã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾<code>Book</code>ç±»çš„<code>isbn</code>æ˜¯ä¸€ä¸ª<code>BigInteger</code>ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Book</span> </span>&#123;</span><br><span class="line">	<span class="keyword">public</span> String name;</span><br><span class="line">	<span class="keyword">public</span> BigInteger isbn;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½†JSONæ•°æ®å¹¶ä¸æ˜¯æ ‡å‡†çš„æ•´å½¢æ ¼å¼ï¼š</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;Javaæ ¸å¿ƒæŠ€æœ¯&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;isbn&quot;</span>: <span class="string">&quot;978-7-111-54742-6&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç›´æ¥è§£æï¼Œè‚¯å®šæŠ¥é”™ã€‚è¿™æ—¶ï¼Œæˆ‘ä»¬éœ€è¦è‡ªå®šä¹‰ä¸€ä¸ª<code>IsbnDeserializer</code>ï¼Œç”¨äºè§£æå«æœ‰éæ•°å­—çš„å­—ç¬¦ä¸²ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IsbnDeserializer</span> <span class="keyword">extends</span> <span class="title">JsonDeserializer</span>&lt;<span class="title">BigInteger</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> BigInteger <span class="title">deserialize</span><span class="params">(JsonParser p, DeserializationContext ctxt)</span> <span class="keyword">throws</span> IOException, JsonProcessingException </span>&#123;</span><br><span class="line">        <span class="comment">// è¯»å–åŸå§‹çš„JSONå­—ç¬¦ä¸²å†…å®¹:</span></span><br><span class="line">        String s = p.getValueAsString();</span><br><span class="line">        <span class="keyword">if</span> (s != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> BigInteger(s.replace(<span class="string">&quot;-&quot;</span>, <span class="string">&quot;&quot;</span>));</span><br><span class="line">            &#125; <span class="keyword">catch</span> (NumberFormatException e) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> JsonParseException(p, s, e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç„¶åï¼Œåœ¨<code>Book</code>ç±»ä¸­ä½¿ç”¨æ³¨è§£æ ‡æ³¨ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Book</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> String name;</span><br><span class="line">    <span class="comment">// è¡¨ç¤ºååºåˆ—åŒ–isbnæ—¶ä½¿ç”¨è‡ªå®šä¹‰çš„IsbnDeserializer:</span></span><br><span class="line">    <span class="meta">@JsonDeserialize(using = IsbnDeserializer.class)</span></span><br><span class="line">    <span class="keyword">public</span> BigInteger isbn;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç±»ä¼¼çš„ï¼Œè‡ªå®šä¹‰åºåˆ—åŒ–æ—¶æˆ‘ä»¬éœ€è¦è‡ªå®šä¹‰ä¸€ä¸ª<code>IsbnSerializer</code>ï¼Œç„¶ååœ¨<code>Book</code>ç±»ä¸­æ ‡æ³¨<code>@JsonSerialize(using = ...)</code>å³å¯ã€‚</p>
]]></content>
      <tags>
        <tag>JAVA</tag>
        <tag>json</tag>
      </tags>
  </entry>
  <entry>
    <title>JAVAå¤„ç†xml</title>
    <url>/2021/05/10/JAVA%E5%A4%84%E7%90%86xml/</url>
    <content><![CDATA[<h1 id="XML"><a href="#XML" class="headerlink" title="XML"></a>XML</h1><h2 id="1-XMLç»“æ„"><a href="#1-XMLç»“æ„" class="headerlink" title="1. XMLç»“æ„"></a>1. XMLç»“æ„</h2><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">note</span> <span class="meta-keyword">SYSTEM</span> <span class="meta-string">&quot;book.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">book</span> <span class="attr">id</span>=<span class="string">&quot;1&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>Javaæ ¸å¿ƒæŠ€æœ¯<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">author</span>&gt;</span>Cay S. Horstmann<span class="tag">&lt;/<span class="name">author</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">isbn</span> <span class="attr">lang</span>=<span class="string">&quot;CN&quot;</span>&gt;</span>1234567<span class="tag">&lt;/<span class="name">isbn</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tags</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tag</span>&gt;</span>Java<span class="tag">&lt;/<span class="name">tag</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tag</span>&gt;</span>Network<span class="tag">&lt;/<span class="name">tag</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tags</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">pubDate</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">book</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>é¦–è¡Œå¿…å®šæ˜¯<code>&lt;?xml version=&quot;1.0&quot;?&gt;</code>ï¼Œå¯ä»¥åŠ ä¸Šå¯é€‰çš„ç¼–ç ã€‚</p>
<p><code>&lt;!DOCTYPE note SYSTEM &quot;book.dtd&quot;&gt;</code>å£°æ˜çš„æ˜¯æ–‡æ¡£å®šä¹‰ç±»å‹ï¼ˆDTDï¼šDocument Type Definitionï¼‰ï¼ŒDTDæ˜¯å¯é€‰çš„ã€‚</p>
<p>ä¸€ä¸ªXMLæ–‡æ¡£æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªæ ¹å…ƒç´ ï¼Œæ ¹å…ƒç´ å¯ä»¥åŒ…å«ä»»æ„ä¸ªå­å…ƒç´ ï¼Œå…ƒç´ å¯ä»¥åŒ…å«å±æ€§ï¼Œä¾‹å¦‚ï¼Œ<code>&lt;isbn lang=&quot;CN&quot;&gt;1234567&lt;/isbn&gt;</code>åŒ…å«ä¸€ä¸ªå±æ€§<code>lang=&quot;CN&quot;</code>ã€‚</p>
<p>ç”±äºä½¿ç”¨äº†<code>&lt;</code>ã€<code>&gt;</code>ä»¥åŠå¼•å·ç­‰æ ‡è¯†ç¬¦ï¼Œå¦‚æœå†…å®¹å‡ºç°äº†ç‰¹æ®Šç¬¦å·ï¼Œéœ€è¦ä½¿ç”¨<code>&amp;???;</code>è¡¨ç¤ºè½¬ä¹‰ã€‚</p>
<table>
<thead>
<tr>
<th align="left">å­—ç¬¦</th>
<th align="left">è¡¨ç¤º</th>
</tr>
</thead>
<tbody><tr>
<td align="left">&lt;</td>
<td align="left"><code>&amp;lt; </code></td>
</tr>
<tr>
<td align="left">&gt;</td>
<td align="left"><code>&amp;gt;</code></td>
</tr>
<tr>
<td align="left">&amp;</td>
<td align="left"><code>&amp;amp; </code></td>
</tr>
<tr>
<td align="left">â€œ</td>
<td align="left"><code>&amp;quot;</code></td>
</tr>
<tr>
<td align="left">â€˜</td>
<td align="left"><code>&amp;apos;</code></td>
</tr>
</tbody></table>
<p>DTDæ–‡æ¡£å¯ä»¥æŒ‡å®šä¸€ç³»åˆ—è§„åˆ™ï¼Œä¾‹å¦‚ï¼š</p>
<ul>
<li>æ ¹å…ƒç´ å¿…é¡»æ˜¯<code>book</code></li>
<li><code>book</code>å…ƒç´ å¿…é¡»åŒ…å«<code>name</code>ï¼Œ<code>author</code>ç­‰æŒ‡å®šå…ƒç´ </li>
<li><code>isbn</code>å…ƒç´ å¿…é¡»åŒ…å«å±æ€§<code>lang</code></li>
<li>â€¦</li>
</ul>
<p>å¦‚ä½•éªŒè¯XMLæ–‡ä»¶çš„æ­£ç¡®æ€§å‘¢ï¼Ÿæœ€ç®€å•çš„æ–¹å¼æ˜¯é€šè¿‡æµè§ˆå™¨éªŒè¯ã€‚å¯ä»¥ç›´æ¥æŠŠXMLæ–‡ä»¶æ‹–æ‹½åˆ°æµè§ˆå™¨çª—å£ï¼Œå¦‚æœæ ¼å¼é”™è¯¯ï¼Œæµè§ˆå™¨ä¼šæŠ¥é”™ã€‚</p>
<h2 id="2-DOM"><a href="#2-DOM" class="headerlink" title="2. DOM"></a>2. DOM</h2><p>å› ä¸ºXMLæ˜¯ä¸€ç§æ ‘å½¢ç»“æ„çš„æ–‡æ¡£ï¼Œå®ƒæœ‰ä¸¤ç§æ ‡å‡†çš„è§£æAPIï¼š</p>
<ul>
<li>DOMï¼šä¸€æ¬¡æ€§è¯»å–XMLï¼Œå¹¶åœ¨å†…å­˜ä¸­è¡¨ç¤ºä¸ºæ ‘å½¢ç»“æ„ï¼›</li>
<li>SAXï¼šä»¥æµçš„å½¢å¼è¯»å–XMLï¼Œä½¿ç”¨äº‹ä»¶å›è°ƒã€‚</li>
</ul>
<p>å¦‚æœè§£æä¸ºDOMç»“æ„ï¼Œå®ƒå¤§æ¦‚é•¿è¿™æ ·ï¼š</p>
<p><img src="https://raw.githubusercontent.com/ghj1998/image_repository/main/image-20210510215159229.png" alt="image-20210510215159229"></p>
<p>Javaæä¾›äº†DOM APIæ¥è§£æXMLï¼Œå®ƒä½¿ç”¨ä¸‹é¢çš„å¯¹è±¡æ¥è¡¨ç¤ºXMLçš„å†…å®¹ï¼š</p>
<ul>
<li>Documentï¼šä»£è¡¨æ•´ä¸ªXMLæ–‡æ¡£ï¼›</li>
<li>Elementï¼šä»£è¡¨ä¸€ä¸ªXMLå…ƒç´ ï¼›</li>
<li>Attributeï¼šä»£è¡¨ä¸€ä¸ªå…ƒç´ çš„æŸä¸ªå±æ€§ã€‚</li>
</ul>
<p>ä½¿ç”¨DOM APIè§£æä¸€ä¸ªXMLæ–‡æ¡£çš„ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">InputStream input = Main.class.getResourceAsStream(<span class="string">&quot;/book.xml&quot;</span>);</span><br><span class="line">DocumentBuilderFactory dbf = DocumentBuilderFactory.newInstance();</span><br><span class="line">DocumentBuilder db = dbf.newDocumentBuilder();</span><br><span class="line">Document doc = db.parse(input);</span><br></pre></td></tr></table></figure>

<p><code>DocumentBuilder.parse()</code>ç”¨äºè§£æä¸€ä¸ªXMLï¼Œå®ƒå¯ä»¥æ¥æ”¶InputStreamï¼ŒFileæˆ–è€…URLï¼Œå¦‚æœè§£ææ— è¯¯ï¼Œæˆ‘ä»¬å°†è·å¾—ä¸€ä¸ªDocumentå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡ä»£è¡¨äº†æ•´ä¸ªXMLæ–‡æ¡£çš„æ ‘å½¢ç»“æ„ï¼Œéœ€è¦éå†ä»¥ä¾¿è¯»å–æŒ‡å®šå…ƒç´ çš„å€¼ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">printNode</span><span class="params">(Node n, <span class="keyword">int</span> indent)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; indent; i++) &#123;</span><br><span class="line">        System.out.print(<span class="string">&#x27; &#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">switch</span> (n.getNodeType()) &#123;</span><br><span class="line">    <span class="keyword">case</span> Node.DOCUMENT_NODE: <span class="comment">// DocumentèŠ‚ç‚¹</span></span><br><span class="line">        System.out.println(<span class="string">&quot;Document: &quot;</span> + n.getNodeName());</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> Node.ELEMENT_NODE: <span class="comment">// å…ƒç´ èŠ‚ç‚¹</span></span><br><span class="line">        System.out.println(<span class="string">&quot;Element: &quot;</span> + n.getNodeName());</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> Node.TEXT_NODE: <span class="comment">// æ–‡æœ¬</span></span><br><span class="line">        System.out.println(<span class="string">&quot;Text: &quot;</span> + n.getNodeName() + <span class="string">&quot; = &quot;</span> + n.getNodeValue());</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> Node.ATTRIBUTE_NODE: <span class="comment">// å±æ€§</span></span><br><span class="line">        System.out.println(<span class="string">&quot;Attr: &quot;</span> + n.getNodeName() + <span class="string">&quot; = &quot;</span> + n.getNodeValue());</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">default</span>: <span class="comment">// å…¶ä»–</span></span><br><span class="line">        System.out.println(<span class="string">&quot;NodeType: &quot;</span> + n.getNodeType() + <span class="string">&quot;, NodeName: &quot;</span> + n.getNodeName());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (Node child = n.getFirstChild(); child != <span class="keyword">null</span>; child = child.getNextSibling()) &#123;</span><br><span class="line">        printNode(child, indent + <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Document: #document</span></span><br><span class="line"><span class="comment"> Element: book</span></span><br><span class="line"><span class="comment">  Text: #text = </span></span><br><span class="line"><span class="comment">    </span></span><br><span class="line"><span class="comment">  Element: name</span></span><br><span class="line"><span class="comment">   Text: #text = Javaæ ¸å¿ƒæŠ€æœ¯</span></span><br><span class="line"><span class="comment">  Text: #text = </span></span><br><span class="line"><span class="comment">    </span></span><br><span class="line"><span class="comment">  Element: author</span></span><br><span class="line"><span class="comment">   Text: #text = Cay S. Horstmann</span></span><br><span class="line"><span class="comment">  Text: #text = </span></span><br><span class="line"><span class="comment">  ...</span></span><br><span class="line"><span class="comment">  */</span></span><br></pre></td></tr></table></figure>

<h2 id="3-SAX"><a href="#3-SAX" class="headerlink" title="3. SAX"></a>3. SAX</h2><p>SAXè§£æä¼šè§¦å‘ä¸€ç³»åˆ—äº‹ä»¶ï¼š</p>
<ul>
<li>startDocumentï¼šå¼€å§‹è¯»å–XMLæ–‡æ¡£ï¼›</li>
<li>startElementï¼šè¯»å–åˆ°äº†ä¸€ä¸ªå…ƒç´ ï¼Œä¾‹å¦‚<code>&lt;book&gt;</code>ï¼›</li>
<li>charactersï¼šè¯»å–åˆ°äº†å­—ç¬¦ï¼›</li>
<li>endElementï¼šè¯»å–åˆ°äº†ä¸€ä¸ªç»“æŸçš„å…ƒç´ ï¼Œä¾‹å¦‚<code>&lt;/book&gt;</code>ï¼›</li>
<li>endDocumentï¼šè¯»å–XMLæ–‡æ¡£ç»“æŸã€‚</li>
</ul>
<p>å¦‚æœæˆ‘ä»¬ç”¨SAX APIè§£æXMLï¼ŒJavaä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">InputStream input = Main.class.getResourceAsStream(<span class="string">&quot;/book.xml&quot;</span>);</span><br><span class="line">SAXParserFactory spf = SAXParserFactory.newInstance();</span><br><span class="line">SAXParser saxParser = spf.newSAXParser();</span><br><span class="line">saxParser.parse(input, <span class="keyword">new</span> MyHandler());</span><br></pre></td></tr></table></figure>

<p>å…³é”®ä»£ç <code>SAXParser.parse()</code>é™¤äº†éœ€è¦ä¼ å…¥ä¸€ä¸ª<code>InputStream</code>å¤–ï¼Œè¿˜éœ€è¦ä¼ å…¥ä¸€ä¸ªå›è°ƒå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡è¦ç»§æ‰¿è‡ª<code>DefaultHandler</code>ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyHandler</span> <span class="keyword">extends</span> <span class="title">DefaultHandler</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">startDocument</span><span class="params">()</span> <span class="keyword">throws</span> SAXException </span>&#123;</span><br><span class="line">        print(<span class="string">&quot;start document&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">endDocument</span><span class="params">()</span> <span class="keyword">throws</span> SAXException </span>&#123;</span><br><span class="line">        print(<span class="string">&quot;end document&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">startElement</span><span class="params">(String uri, String localName, String qName, Attributes attributes)</span> <span class="keyword">throws</span> SAXException </span>&#123;</span><br><span class="line">        print(<span class="string">&quot;start element:&quot;</span>, localName, qName);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">endElement</span><span class="params">(String uri, String localName, String qName)</span> <span class="keyword">throws</span> SAXException </span>&#123;</span><br><span class="line">        print(<span class="string">&quot;end element:&quot;</span>, localName, qName);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">characters</span><span class="params">(<span class="keyword">char</span>[] ch, <span class="keyword">int</span> start, <span class="keyword">int</span> length)</span> <span class="keyword">throws</span> SAXException </span>&#123;</span><br><span class="line">        print(<span class="string">&quot;characters:&quot;</span>, <span class="keyword">new</span> String(ch, start, length));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">error</span><span class="params">(SAXParseException e)</span> <span class="keyword">throws</span> SAXException </span>&#123;</span><br><span class="line">        print(<span class="string">&quot;error:&quot;</span>, e);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">(Object... objs)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (Object obj : objs) &#123;</span><br><span class="line">            System.out.print(obj);</span><br><span class="line">            System.out.print(<span class="string">&quot; &quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿è¡ŒSAXè§£æä»£ç ï¼Œå¯ä»¥æ‰“å°å‡ºä¸‹é¢çš„ç»“æœï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">start document</span><br><span class="line">start element:  book</span><br><span class="line">characters:</span><br><span class="line">     </span><br><span class="line">start element:  name</span><br><span class="line">characters: Javaæ ¸å¿ƒæŠ€æœ¯</span><br><span class="line">end element:  name</span><br><span class="line">characters:</span><br><span class="line">     </span><br><span class="line">start element:  author</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>å¦‚æœè¦è¯»å–<code>&lt;name&gt;</code>èŠ‚ç‚¹çš„æ–‡æœ¬ï¼Œæˆ‘ä»¬å°±å¿…é¡»åœ¨è§£æè¿‡ç¨‹ä¸­æ ¹æ®<code>startElement()</code>å’Œ<code>endElement()</code>å®šä½å½“å‰æ­£åœ¨è¯»å–çš„èŠ‚ç‚¹ï¼Œå¯ä»¥ä½¿ç”¨æ ˆç»“æ„ä¿å­˜ï¼Œæ¯é‡åˆ°ä¸€ä¸ª<code>startElement()</code>å…¥æ ˆï¼Œæ¯é‡åˆ°ä¸€ä¸ª<code>endElement()</code>å‡ºæ ˆï¼Œè¿™æ ·ï¼Œè¯»åˆ°<code>characters()</code>æ—¶æˆ‘ä»¬æ‰çŸ¥é“å½“å‰è¯»å–çš„æ–‡æœ¬æ˜¯å“ªä¸ªèŠ‚ç‚¹çš„ã€‚å¯è§ï¼Œä½¿ç”¨SAX APIä»ç„¶æ¯”è¾ƒéº»çƒ¦ã€‚</p>
<h2 id="4-Jackson"><a href="#4-Jackson" class="headerlink" title="4. Jackson"></a>4. Jackson</h2><p>ä¸€ä¸ªåå«Jacksonçš„å¼€æºçš„ç¬¬ä¸‰æ–¹åº“å¯ä»¥è½»æ¾åšåˆ°XMLåˆ°JavaBeançš„è½¬æ¢ã€‚æˆ‘ä»¬è¦ä½¿ç”¨Jacksonï¼Œå…ˆæ·»åŠ ä¸¤ä¸ªMavençš„ä¾èµ–ï¼š</p>
<ul>
<li>com.fasterxml.jackson.dataformat:jackson-dataformat-xml:2.10.1</li>
<li>org.codehaus.woodstox:woodstox-core-asl:4.4.1</li>
</ul>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">book</span> <span class="attr">id</span>=<span class="string">&quot;1&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>Javaæ ¸å¿ƒæŠ€æœ¯<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">author</span>&gt;</span>Cay S. Horstmann<span class="tag">&lt;/<span class="name">author</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">isbn</span> <span class="attr">lang</span>=<span class="string">&quot;CN&quot;</span>&gt;</span>1234567<span class="tag">&lt;/<span class="name">isbn</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tags</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tag</span>&gt;</span>Java<span class="tag">&lt;/<span class="name">tag</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tag</span>&gt;</span>Network<span class="tag">&lt;/<span class="name">tag</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tags</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">pubDate</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">book</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>å®šä¹‰å¥½JavaBean</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Book</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">long</span> id;</span><br><span class="line">    <span class="keyword">public</span> String name;</span><br><span class="line">    <span class="keyword">public</span> String author;</span><br><span class="line">    <span class="keyword">public</span> String isbn;</span><br><span class="line">    <span class="keyword">public</span> List&lt;String&gt; tags;</span><br><span class="line">    <span class="keyword">public</span> String pubDate;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è§£æï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">InputStream input = Main.class.getResourceAsStream(<span class="string">&quot;/book.xml&quot;</span>);</span><br><span class="line">JacksonXmlModule <span class="keyword">module</span> = <span class="keyword">new</span> JacksonXmlModule();</span><br><span class="line">XmlMapper mapper = <span class="keyword">new</span> XmlMapper(<span class="keyword">module</span>);</span><br><span class="line">Book book = mapper.readValue(input, Book.class);</span><br><span class="line">System.out.println(book.id);</span><br><span class="line">System.out.println(book.name);</span><br><span class="line">System.out.println(book.author);</span><br><span class="line">System.out.println(book.isbn);</span><br><span class="line">System.out.println(book.tags);</span><br><span class="line">System.out.println(book.pubDate);</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„åˆ°<code>XmlMapper</code>å°±æ˜¯æˆ‘ä»¬éœ€è¦åˆ›å»ºçš„æ ¸å¿ƒå¯¹è±¡ï¼Œå¯ä»¥ç”¨<code>readValue(InputStream, Class)</code>ç›´æ¥è¯»å–XMLå¹¶è¿”å›ä¸€ä¸ªJavaBeanã€‚</p>
]]></content>
      <tags>
        <tag>JAVA</tag>
        <tag>xml</tag>
      </tags>
  </entry>
  <entry>
    <title>JAVA - å¼‚å¸¸å¤„ç†</title>
    <url>/2021/04/10/JAVA%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86/</url>
    <content><![CDATA[<h1 id="JAVAå¼‚å¸¸å¤„ç†"><a href="#JAVAå¼‚å¸¸å¤„ç†" class="headerlink" title="JAVAå¼‚å¸¸å¤„ç†"></a>JAVAå¼‚å¸¸å¤„ç†</h1><p>æ„Ÿè°¢å»–é›ªå³°è€å¸ˆçš„æ•™ç¨‹ï¼</p>
<p><a href="https://www.liaoxuefeng.com/wiki/1252599548343744">JAVAæ•™ç¨‹</a></p>
<h2 id="1-JAVAçš„å¼‚å¸¸"><a href="#1-JAVAçš„å¼‚å¸¸" class="headerlink" title="1. JAVAçš„å¼‚å¸¸"></a>1. JAVAçš„å¼‚å¸¸</h2><p>Javaä½¿ç”¨å¼‚å¸¸æ¥è¡¨ç¤ºé”™è¯¯ï¼Œå¹¶é€šè¿‡<code>try ... catch</code>æ•è·å¼‚å¸¸ï¼›</p>
<p>Javaçš„å¼‚å¸¸æ˜¯<code>class</code>ï¼Œå¹¶ä¸”ä»<code>Throwable</code>ç»§æ‰¿ï¼›</p>
<p><code>Error</code>æ˜¯æ— éœ€æ•è·çš„ä¸¥é‡é”™è¯¯ï¼Œ<code>Exception</code>æ˜¯åº”è¯¥æ•è·çš„å¯å¤„ç†çš„é”™è¯¯ï¼›</p>
<p><code>RuntimeException</code>æ— éœ€å¼ºåˆ¶æ•è·ï¼Œé<code>RuntimeException</code>ï¼ˆChecked Exceptionï¼‰éœ€å¼ºåˆ¶æ•è·ï¼Œæˆ–è€…ç”¨<code>throws</code>å£°æ˜ï¼›</p>
<p><strong>ç»“æ„</strong>å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    String s = processFile(â€œC:\\test.txtâ€);</span><br><span class="line">    <span class="comment">// ok:</span></span><br><span class="line">&#125; <span class="keyword">catch</span> (FileNotFoundException e) &#123;</span><br><span class="line">    <span class="comment">// file not found:</span></span><br><span class="line">&#125; <span class="keyword">catch</span> (SecurityException e) &#123;</span><br><span class="line">    <span class="comment">// no read permission:</span></span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">    <span class="comment">// io error:</span></span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">    <span class="comment">// other error:</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¼‚å¸¸çš„ç»§æ‰¿å…³ç³»ï¼š</p>
<p><img src="https://raw.githubusercontent.com/ghj1998/image_repository/main/image-20210325183327585.png" alt="image-20210325183327585"></p>
<p><code>Throwable</code>æ˜¯å¼‚å¸¸ä½“ç³»çš„æ ¹ï¼Œå®ƒç»§æ‰¿è‡ª<code>Object</code>ã€‚</p>
<p><code>Throwable</code>æœ‰ä¸¤ä¸ªä½“ç³»ï¼š<code>Error</code>å’Œ<code>Exception</code>ï¼Œ<code>Error</code>è¡¨ç¤ºä¸¥é‡çš„é”™è¯¯ï¼Œç¨‹åºå¯¹æ­¤ä¸€èˆ¬æ— èƒ½ä¸ºåŠ›ï¼Œä¾‹å¦‚ï¼š</p>
<ul>
<li><code>OutOfMemoryError</code>ï¼šå†…å­˜è€—å°½</li>
<li><code>NoClassDefFoundError</code>ï¼šæ— æ³•åŠ è½½æŸä¸ªClass</li>
<li><code>StackOverflowError</code>ï¼šæ ˆæº¢å‡º</li>
</ul>
<p>è€Œ<code>Exception</code>åˆ™æ˜¯è¿è¡Œæ—¶çš„é”™è¯¯ï¼Œå®ƒå¯ä»¥è¢«æ•è·å¹¶å¤„ç†ã€‚</p>
<p>æŸäº›å¼‚å¸¸æ˜¯åº”ç”¨ç¨‹åºé€»è¾‘å¤„ç†çš„ä¸€éƒ¨åˆ†ï¼Œåº”è¯¥æ•è·å¹¶å¤„ç†ã€‚ä¾‹å¦‚ï¼š</p>
<ul>
<li><code>NumberFormatException</code>ï¼šæ•°å€¼ç±»å‹çš„æ ¼å¼é”™è¯¯</li>
<li><code>FileNotFoundException</code>ï¼šæœªæ‰¾åˆ°æ–‡ä»¶</li>
<li><code>SocketException</code>ï¼šè¯»å–ç½‘ç»œå¤±è´¥</li>
</ul>
<p>è¿˜æœ‰ä¸€äº›å¼‚å¸¸æ˜¯ç¨‹åºé€»è¾‘ç¼–å†™ä¸å¯¹é€ æˆçš„ï¼Œåº”è¯¥ä¿®å¤ç¨‹åºæœ¬èº«ã€‚ä¾‹å¦‚ï¼š</p>
<ul>
<li><code>NullPointerException</code>ï¼šå¯¹æŸä¸ª<code>null</code>çš„å¯¹è±¡è°ƒç”¨æ–¹æ³•æˆ–å­—æ®µ</li>
<li><code>IndexOutOfBoundsException</code>ï¼šæ•°ç»„ç´¢å¼•è¶Šç•Œ</li>
</ul>
<p><code>Exception</code>åˆåˆ†ä¸ºä¸¤å¤§ç±»ï¼š</p>
<ol>
<li><code>RuntimeException</code>ä»¥åŠå®ƒçš„å­ç±»ï¼›</li>
<li>é<code>RuntimeException</code>ï¼ˆåŒ…æ‹¬<code>IOException</code>ã€<code>ReflectiveOperationException</code>ç­‰ç­‰ï¼‰</li>
</ol>
<p><strong>å¼ºåˆ¶æ•è·å¼‚å¸¸</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">byte</span>[] getBytes(String charsetName) <span class="keyword">throws</span> UnsupportedEncodingException &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å®šä¹‰æ–¹æ³•æ—¶ï¼Œä½¿ç”¨<code>throws Xxx</code>è¡¨ç¤ºè¯¥æ–¹æ³•å¯èƒ½æŠ›å‡ºçš„å¼‚å¸¸ç±»å‹ã€‚è°ƒç”¨æ–¹åœ¨è°ƒç”¨çš„æ—¶å€™ï¼Œå¿…é¡»å¼ºåˆ¶æ•è·è¿™äº›å¼‚å¸¸ï¼Œå¦åˆ™ç¼–è¯‘å™¨ä¼šæŠ¥é”™ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">byte</span>[] toGBK(String s) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// ç”¨æŒ‡å®šç¼–ç è½¬æ¢Stringä¸ºbyte[]:</span></span><br><span class="line">        <span class="keyword">return</span> s.getBytes(<span class="string">&quot;GBK&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (UnsupportedEncodingException e) &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœç³»ç»Ÿä¸æ”¯æŒGBKç¼–ç ï¼Œä¼šæ•è·åˆ°UnsupportedEncodingException:</span></span><br><span class="line">        System.out.println(e); <span class="comment">// æ‰“å°å¼‚å¸¸ä¿¡æ¯</span></span><br><span class="line">        <span class="keyword">return</span> s.getBytes(); <span class="comment">// å°è¯•ä½¿ç”¨ç”¨é»˜è®¤ç¼–ç </span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬ä¹Ÿå¯ä»¥ä¸æ•è·å®ƒï¼Œè€Œæ˜¯åœ¨æ–¹æ³•å®šä¹‰å¤„ç”¨throwsè¡¨ç¤º<code>toGBK()</code>æ–¹æ³•å¯èƒ½ä¼šæŠ›å‡º<code>UnsupportedEncodingException</code>ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">byte</span>[] toGBK(String s) <span class="keyword">throws</span> UnsupportedEncodingException &#123;</span><br><span class="line">    <span class="keyword">return</span> s.getBytes(<span class="string">&quot;GBK&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ­¤æ—¶è°ƒç”¨<code>toGBK</code>çš„æ–¹æ³•ï¼Œå¿…é¡»æ•è·<code>UnsupportedEncodingException</code>å¼‚å¸¸ï¼Œå¦åˆ™å°±ä¼šå‡ºé”™ã€‚</p>
<p>å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">byte</span>[] bs = toGBK(<span class="string">&quot;ä¸­æ–‡&quot;</span>);</span><br><span class="line">            System.out.println(Arrays.toString(bs));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (UnsupportedEncodingException e) &#123;</span><br><span class="line">            System.out.println(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">byte</span>[] toGBK(String s) <span class="keyword">throws</span> UnsupportedEncodingException &#123;</span><br><span class="line">        <span class="comment">// ç”¨æŒ‡å®šç¼–ç è½¬æ¢Stringä¸ºbyte[]:</span></span><br><span class="line">        <span class="keyword">return</span> s.getBytes(<span class="string">&quot;GBK&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœæ˜¯æµ‹è¯•ä»£ç ï¼Œä¸Šé¢çš„å†™æ³•å°±ç•¥æ˜¾éº»çƒ¦ã€‚å¦‚æœä¸æƒ³å†™ä»»ä½•<code>try</code>ä»£ç ï¼Œå¯ä»¥ç›´æ¥æŠŠ<code>main()</code>æ–¹æ³•å®šä¹‰ä¸º<code>throws Exception</code>ï¼š</p>
<p><code>public static void main(String[] args) throws Exception</code></p>
<p>æ•è·åˆ°å¼‚å¸¸åå³ä½¿ä»€ä¹ˆéƒ½åšä¸äº†ï¼Œä¹Ÿè¦æŠŠå¼‚å¸¸è®°å½•ä¸‹æ¥ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">byte</span>[] toGBK(String s) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> s.getBytes(<span class="string">&quot;GBK&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (UnsupportedEncodingException e) &#123;</span><br><span class="line">        <span class="comment">// å…ˆè®°ä¸‹æ¥å†è¯´:</span></span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br></pre></td></tr></table></figure>

<p><strong><code>printStackTrace()</code></strong></p>
<p>æ‰€æœ‰å¼‚å¸¸éƒ½å¯ä»¥è°ƒç”¨<code>printStackTrace()</code>æ–¹æ³•æ‰“å°å¼‚å¸¸æ ˆï¼Œè¿™æ˜¯ä¸€ä¸ªç®€å•æœ‰ç”¨çš„å¿«é€Ÿæ‰“å°å¼‚å¸¸çš„æ–¹æ³•ã€‚</p>
<h2 id="2-æ•è·å¼‚å¸¸"><a href="#2-æ•è·å¼‚å¸¸" class="headerlink" title="2. æ•è·å¼‚å¸¸"></a>2. æ•è·å¼‚å¸¸</h2><p>å¤šä¸ª<code>catch</code>åªä¼šå‘½ä¸­ä¸€ä¸ªï¼Œå› æ­¤åº”å½“æŠŠå­ç±»çš„<code>catch</code>å†™åœ¨å‰é¢ã€‚</p>
<p><strong><code>finally</code></strong></p>
<p>Javaçš„<code>try ... catch</code>æœºåˆ¶è¿˜æä¾›äº†<code>finally</code>è¯­å¥ï¼Œ<code>finally</code>è¯­å¥å—ä¿è¯æœ‰æ— é”™è¯¯éƒ½ä¼šæ‰§è¡Œã€‚</p>
<p>æ³¨æ„<code>finally</code>æœ‰å‡ ä¸ªç‰¹ç‚¹ï¼š</p>
<ol>
<li><code>finally</code>è¯­å¥ä¸æ˜¯å¿…é¡»çš„ï¼Œå¯å†™å¯ä¸å†™ï¼›</li>
<li><code>finally</code>æ€»æ˜¯æœ€åæ‰§è¡Œã€‚</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        process1();</span><br><span class="line">        process2();</span><br><span class="line">        process3();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (UnsupportedEncodingException e) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Bad encoding&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;IO error&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;END&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ— è®ºæ˜¯å¦æ•è·åˆ°å¼‚å¸¸éƒ½ä¼šè¾“å‡ºâ€œENDâ€ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">catch</span> (IOException | NumberFormatException e) &#123; <span class="comment">// IOExceptionæˆ–NumberFormatException</span></span><br><span class="line">        System.out.println(<span class="string">&quot;Bad input&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>ä¹Ÿå¯ä»¥æŠŠå¤šä¸ªå¼‚å¸¸åˆå¹¶åˆ°ä¸€ä¸ª<code>catch</code>å†…éƒ¨ã€‚</p>
<p>æ•è·åˆ°å¼‚å¸¸å°½é‡éƒ½ä½¿ç”¨<code>printStackTrace()</code>æŠŠè°ƒç”¨è·¯å¾„è¾“å‡ºå‡ºæ¥ã€‚</p>
<h2 id="3-æŠ›å‡ºå¼‚å¸¸"><a href="#3-æŠ›å‡ºå¼‚å¸¸" class="headerlink" title="3. æŠ›å‡ºå¼‚å¸¸"></a>3. æŠ›å‡ºå¼‚å¸¸</h2><p>æŠ›å‡ºå¼‚å¸¸åˆ†ä¸¤æ­¥ï¼š</p>
<ol>
<li>åˆ›å»ºæŸä¸ª<code>Exception</code>çš„å®ä¾‹ï¼›</li>
<li>ç”¨<code>throw</code>è¯­å¥æŠ›å‡ºã€‚</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">process2</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (s==<span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æœ‰æ—¶å€™åœ¨<code>catch</code>ä¸­ä¼šæŠ›å‡ºæ–°çš„å¼‚å¸¸ï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">process1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   <span class="keyword">try</span> &#123;</span><br><span class="line">       process2();</span><br><span class="line">   &#125; <span class="keyword">catch</span> (NullPointerException e) &#123;</span><br><span class="line">       <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(e);   <span class="comment">// å°†catchæ•è·çš„å¼‚å¸¸ä½œä¸ºæ–°å¼‚å¸¸çš„å‚æ•°ã€‚</span></span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸ºäº†èƒ½è¿½è¸ªåˆ°å®Œæ•´çš„å¼‚å¸¸æ ˆï¼Œåœ¨æ„é€ å¼‚å¸¸çš„æ—¶å€™ï¼ŒæŠŠåŸå§‹çš„<code>Exception</code>å®ä¾‹ä¼ è¿›å»ï¼Œæ–°çš„<code>Exception</code>å°±å¯ä»¥æŒæœ‰åŸå§‹<code>Exception</code>ä¿¡æ¯ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">java.lang.IllegalArgumentException: java.lang.NullPointerException</span><br><span class="line">    at Main.process1(Main.java:<span class="number">15</span>)</span><br><span class="line">    at Main.main(Main.java:<span class="number">5</span>)</span><br><span class="line">Caused by: java.lang.NullPointerException</span><br><span class="line">    at Main.process2(Main.java:<span class="number">20</span>)</span><br><span class="line">    at Main.process1(Main.java:<span class="number">13</span>)</span><br></pre></td></tr></table></figure>

<p>èƒ½åŒæ—¶æ‰“å°å‡ºä¸¤ä¸ªå¼‚å¸¸ç±»å‹ã€‚</p>
<p><strong>finally</strong>ä¸­ä¸è¦æŠ›å‡ºå¼‚å¸¸ã€‚</p>
<h2 id="4-è‡ªå®šä¹‰å¼‚å¸¸"><a href="#4-è‡ªå®šä¹‰å¼‚å¸¸" class="headerlink" title="4. è‡ªå®šä¹‰å¼‚å¸¸"></a>4. è‡ªå®šä¹‰å¼‚å¸¸</h2><p>è‡ªå®šä¹‰ä¸€ä¸ª<code>BaseException</code>ä½œä¸ºâ€œæ ¹å¼‚å¸¸â€ï¼Œç„¶åï¼Œæ´¾ç”Ÿå‡ºå„ç§ä¸šåŠ¡ç±»å‹çš„å¼‚å¸¸ã€‚</p>
<p><code>BaseException</code>ä¸€èˆ¬ä»<code>RuntimeException</code>æ´¾ç”Ÿï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseException</span> <span class="keyword">extends</span> <span class="title">RuntimeException</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BaseException</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BaseException</span><span class="params">(String message, Throwable cause)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(message, cause);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BaseException</span><span class="params">(String message)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(message);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BaseException</span><span class="params">(Throwable cause)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(cause);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å…¶ä»–ä¸šåŠ¡ç±»å‹çš„å¼‚å¸¸å°±å¯ä»¥ä»<code>BaseException</code>æ´¾ç”Ÿï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserNotFoundException</span> <span class="keyword">extends</span> <span class="title">BaseException</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginFailedException</span> <span class="keyword">extends</span> <span class="title">BaseException</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="5-NullPointerException"><a href="#5-NullPointerException" class="headerlink" title="5. NullPointerException"></a>5. NullPointerException</h2><p><code>NullPointerException</code>å³ç©ºæŒ‡é’ˆå¼‚å¸¸ï¼Œä¿—ç§°NPEã€‚å¦‚æœä¸€ä¸ªå¯¹è±¡ä¸º<code>null</code>ï¼Œè°ƒç”¨å…¶æ–¹æ³•æˆ–è®¿é—®å…¶å­—æ®µå°±ä¼šäº§ç”Ÿ<code>NullPointerException</code></p>
<p>å¥½çš„ç¼–ç ä¹ æƒ¯å¯ä»¥æå¤§åœ°é™ä½<code>NullPointerException</code>çš„äº§ç”Ÿï¼Œä¾‹å¦‚ï¼š</p>
<p>æˆå‘˜å˜é‡åœ¨å®šä¹‰æ—¶åˆå§‹åŒ–ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name = <span class="string">&quot;&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä»Java 14å¼€å§‹ï¼Œå¦‚æœäº§ç”Ÿäº†<code>NullPointerException</code>ï¼ŒJVMå¯ä»¥ç»™å‡ºè¯¦ç»†çš„ä¿¡æ¯å‘Šè¯‰æˆ‘ä»¬<code>null</code>å¯¹è±¡åˆ°åº•æ˜¯è°ã€‚</p>
<h2 id="6-æ–­è¨€"><a href="#6-æ–­è¨€" class="headerlink" title="6. æ–­è¨€"></a>6. æ–­è¨€</h2><p>åœ¨Javaä¸­ï¼Œä½¿ç”¨<code>assert</code>å…³é”®å­—æ¥å®ç°æ–­è¨€ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">double</span> x = Math.abs(-<span class="number">123.45</span>);</span><br><span class="line">    <span class="keyword">assert</span> x &gt;= <span class="number">0</span>;</span><br><span class="line">    System.out.println(x);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¯­å¥<code>assert x &gt;= 0;</code>å³ä¸ºæ–­è¨€ï¼Œæ–­è¨€æ¡ä»¶<code>x &gt;= 0</code>é¢„æœŸä¸º<code>true</code>ã€‚å¦‚æœè®¡ç®—ç»“æœä¸º<code>false</code>ï¼Œåˆ™æ–­è¨€å¤±è´¥ï¼ŒæŠ›å‡º<code>AssertionError</code>ã€‚</p>
<p>ä½¿ç”¨<code>assert</code>è¯­å¥æ—¶ï¼Œè¿˜å¯ä»¥æ·»åŠ ä¸€ä¸ªå¯é€‰çš„æ–­è¨€æ¶ˆæ¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">assert</span> x &gt;= <span class="number">0</span> : <span class="string">&quot;x must &gt;= 0&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>è¦æ‰§è¡Œ<code>assert</code>è¯­å¥ï¼Œå¿…é¡»ç»™Javaè™šæ‹Ÿæœºä¼ é€’<code>-enableassertions</code>ï¼ˆå¯ç®€å†™ä¸º<code>-ea</code>ï¼‰å‚æ•°å¯ç”¨æ–­è¨€ã€‚</p>
<p>å®é™…å¼€å‘ä¸­ï¼Œå¾ˆå°‘ä½¿ç”¨æ–­è¨€ã€‚</p>
<h2 id="7-JDK-Logging"><a href="#7-JDK-Logging" class="headerlink" title="7. JDK Logging"></a>7. JDK Logging</h2><p>åœ¨ç¼–å†™ç¨‹åºçš„è¿‡ç¨‹ä¸­ï¼Œå‘ç°ç¨‹åºè¿è¡Œç»“æœä¸é¢„æœŸä¸ç¬¦ï¼Œç»å¸¸ç”¨<code>System.out.println()</code>æ‰“å°å‡ºæ‰§è¡Œè¿‡ç¨‹ä¸­çš„æŸäº›å˜é‡ï¼Œè§‚å¯Ÿæ¯ä¸€æ­¥çš„ç»“æœä¸ä»£ç é€»è¾‘æ˜¯å¦ç¬¦åˆï¼Œç„¶åæœ‰é’ˆå¯¹æ€§åœ°ä¿®æ”¹ä»£ç ã€‚</p>
<p>Javaæ ‡å‡†åº“å†…ç½®äº†æ—¥å¿—åŒ…<code>java.util.logging</code>ï¼Œè¿™ä¸ªåŒ…æ¯”<code>System.out.println()</code>å¥½ç”¨å¾ˆå¤šã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Hello</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Logger logger = Logger.getGlobal();</span><br><span class="line">        logger.info(<span class="string">&quot;start process...&quot;</span>);</span><br><span class="line">        logger.warning(<span class="string">&quot;memory is running out...&quot;</span>);</span><br><span class="line">        logger.fine(<span class="string">&quot;ignored.&quot;</span>);</span><br><span class="line">        logger.severe(<span class="string">&quot;process will be terminated...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¾“å‡ºå¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Mar <span class="number">02</span>, <span class="number">2019</span> <span class="number">6</span>:<span class="number">32</span>:<span class="number">13</span> PM Hello main</span><br><span class="line">INFO: start process...</span><br><span class="line">Mar <span class="number">02</span>, <span class="number">2019</span> <span class="number">6</span>:<span class="number">32</span>:<span class="number">13</span> PM Hello main</span><br><span class="line">WARNING: memory is running out...</span><br><span class="line">Mar <span class="number">02</span>, <span class="number">2019</span> <span class="number">6</span>:<span class="number">32</span>:<span class="number">13</span> PM Hello main</span><br><span class="line">SEVERE: process will be terminated...</span><br></pre></td></tr></table></figure>

<p>å®ƒè‡ªåŠ¨æ‰“å°äº†æ—¶é—´ã€è°ƒç”¨ç±»ã€è°ƒç”¨æ–¹æ³•ç­‰å¾ˆå¤šæœ‰ç”¨çš„ä¿¡æ¯ã€‚</p>
<p>JDKçš„Loggingå®šä¹‰äº†7ä¸ªæ—¥å¿—çº§åˆ«ï¼Œä»ä¸¥é‡åˆ°æ™®é€šï¼š</p>
<ul>
<li>SEVERE</li>
<li>WARNING</li>
<li>INFO</li>
<li>CONFIG</li>
<li>FINE</li>
<li>FINER</li>
<li>FINEST</li>
</ul>
<p>å› ä¸ºé»˜è®¤çº§åˆ«æ˜¯INFOï¼Œå› æ­¤ï¼ŒINFOçº§åˆ«ä»¥ä¸‹çš„æ—¥å¿—ï¼Œä¸ä¼šè¢«æ‰“å°å‡ºæ¥ã€‚ä½¿ç”¨æ—¥å¿—çº§åˆ«çš„å¥½å¤„åœ¨äºï¼Œè°ƒæ•´çº§åˆ«ï¼Œå°±å¯ä»¥å±è”½æ‰å¾ˆå¤šè°ƒè¯•ç›¸å…³çš„æ—¥å¿—è¾“å‡ºã€‚</p>
<h2 id="8-Commons-Logging"><a href="#8-Commons-Logging" class="headerlink" title="8. Commons Logging"></a>8. Commons Logging</h2><p><code>Commons Logging</code>æ˜¯ä¸€ä¸ªç¬¬ä¸‰æ–¹æ—¥å¿—åº“ï¼Œå®ƒæ˜¯ç”±<code>Apache</code>åˆ›å»ºçš„æ—¥å¿—æ¨¡å—ã€‚</p>
<p>ä½¿ç”¨Commons Loggingåªéœ€è¦å’Œä¸¤ä¸ªç±»æ‰“äº¤é“ï¼Œå¹¶ä¸”åªæœ‰ä¸¤æ­¥ï¼š</p>
<p>ç¬¬ä¸€æ­¥ï¼Œé€šè¿‡<code>LogFactory</code>è·å–<code>Log</code>ç±»çš„å®ä¾‹ï¼› </p>
<p>ç¬¬äºŒæ­¥ï¼Œä½¿ç”¨<code>Log</code>å®ä¾‹çš„æ–¹æ³•æ‰“æ—¥å¿—ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.commons.logging.Log;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.logging.LogFactory;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Log log = LogFactory.getLog(Main.class);</span><br><span class="line">        log.info(<span class="string">&quot;start...&quot;</span>);</span><br><span class="line">        log.warn(<span class="string">&quot;end.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æŠ¥é”™ï¼š</p>
<p><code>error: package org.apache.commons.logging does not exist</code>ï¼ˆæ‰¾ä¸åˆ°<code>org.apache.commons.logging</code>è¿™ä¸ªåŒ…ï¼‰ã€‚</p>
<p>å› ä¸ºCommons Loggingæ˜¯ä¸€ä¸ªç¬¬ä¸‰æ–¹æä¾›çš„åº“ï¼Œæ‰€ä»¥ï¼Œå¿…é¡»å…ˆæŠŠå®ƒ<a href="https://commons.apache.org/proper/commons-logging/download_logging.cgi">ä¸‹è½½</a>ä¸‹æ¥ã€‚ä¸‹è½½åï¼Œè§£å‹ï¼Œæ‰¾åˆ°<code>commons-logging-1.2.jar</code>è¿™ä¸ªæ–‡ä»¶ï¼Œå†æŠŠJavaæºç <code>Main.java</code>æ”¾åˆ°ä¸€ä¸ªç›®å½•ä¸‹ã€‚</p>
<p>ç¼–è¯‘ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">javac -cp commons-logging-<span class="number">1.2</span>.jar Main.java</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">java -cp .;commons-logging-<span class="number">1.2</span>.jar Main</span><br></pre></td></tr></table></figure>

<p>ommons Loggingå®šä¹‰äº†6ä¸ªæ—¥å¿—çº§åˆ«ï¼š</p>
<ul>
<li>FATAL</li>
<li>ERROR</li>
<li>WARNING</li>
<li>INFO</li>
<li>DEBUG</li>
<li>TRACE</li>
</ul>
<p>é»˜è®¤çº§åˆ«æ˜¯<code>INFO</code>ã€‚</p>
<p>ä½¿ç”¨Commons Loggingæ—¶ï¼Œå¦‚æœåœ¨é™æ€æ–¹æ³•ä¸­å¼•ç”¨<code>Log</code>ï¼Œé€šå¸¸ç›´æ¥å®šä¹‰ä¸€ä¸ªé™æ€ç±»å‹å˜é‡ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åœ¨é™æ€æ–¹æ³•ä¸­å¼•ç”¨Log:</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> Log log = LogFactory.getLog(Main.class);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">foo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;foo&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨å®ä¾‹æ–¹æ³•ä¸­å¼•ç”¨<code>Log</code>ï¼Œé€šå¸¸å®šä¹‰ä¸€ä¸ªå®ä¾‹å˜é‡ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åœ¨å®ä¾‹æ–¹æ³•ä¸­å¼•ç”¨Log:</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">final</span> Log log = LogFactory.getLog(getClass());</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">foo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;foo&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å®ä¾‹å˜é‡ä¸­ä½¿ç”¨<code>LogFactory.getLog(getClass())</code>ï¼Œå­ç±»è¿˜å¯ä»¥ä½¿ç”¨è¯¥logå®ä¾‹ã€‚</p>
<h2 id="9-Log4j"><a href="#9-Log4j" class="headerlink" title="9. Log4j"></a>9. Log4j</h2><p>Log4jæ˜¯ä¸€ç§éå¸¸æµè¡Œçš„æ—¥å¿—æ¡†æ¶ï¼Œæœ€æ–°ç‰ˆæœ¬æ˜¯2.xã€‚</p>
<p>ä½¿ç”¨æ—¶é€šè¿‡é…ç½®æ–‡ä»¶è¿›è¡Œé…ç½®ã€‚</p>
<p>// ç”¨åˆ°åœ¨å­¦</p>
<h2 id="10-SLF4Jå’ŒLogback"><a href="#10-SLF4Jå’ŒLogback" class="headerlink" title="10. SLF4Jå’ŒLogback"></a>10. SLF4Jå’ŒLogback</h2><p>SLF4Jå’ŒLogbackå¯ä»¥å–ä»£Commons Loggingå’ŒLog4jï¼›</p>
<p>å§‹ç»ˆä½¿ç”¨SLF4Jçš„æ¥å£å†™å…¥æ—¥å¿—ï¼Œä½¿ç”¨Logbackåªéœ€è¦é…ç½®ï¼Œä¸éœ€è¦ä¿®æ”¹ä»£ç ã€‚</p>
<p>// ç”¨åˆ°åœ¨å­¦</p>
]]></content>
      <tags>
        <tag>JAVA</tag>
      </tags>
  </entry>
  <entry>
    <title>JAVA - æ³›å‹</title>
    <url>/2021/04/21/JAVA%E6%B3%9B%E5%9E%8B/</url>
    <content><![CDATA[<h1 id="æ³›å‹"><a href="#æ³›å‹" class="headerlink" title="æ³›å‹"></a>æ³›å‹</h1><h2 id="1-æ³›å‹å®šä¹‰"><a href="#1-æ³›å‹å®šä¹‰" class="headerlink" title="1. æ³›å‹å®šä¹‰"></a>1. æ³›å‹å®šä¹‰</h2><p>æ³›å‹å°±æ˜¯å®šä¹‰ä¸€ç§æ¨¡æ¿ï¼Œä¾‹å¦‚<code>ArrayList&lt;T&gt;</code>ï¼Œç„¶ååœ¨ä»£ç ä¸­ä¸ºç”¨åˆ°çš„ç±»åˆ›å»ºå¯¹åº”çš„<code>ArrayList&lt;ç±»å‹&gt;</code>ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">ArrayList&lt;String&gt; strList = <span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ArrayList</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> T[] array;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> size;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(T e)</span> </span>&#123;...&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;...&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">get</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;...&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨Javaæ ‡å‡†åº“ä¸­çš„<code>ArrayList&lt;T&gt;</code>å®ç°äº†<code>List&lt;T&gt;</code>æ¥å£ï¼Œå®ƒå¯ä»¥å‘ä¸Šè½¬å‹ä¸º<code>List&lt;T&gt;</code>ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ArrayList</span>&lt;<span class="title">T</span>&gt; <span class="keyword">implements</span> <span class="title">List</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">List&lt;String&gt; list = <span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br></pre></td></tr></table></figure>

<h2 id="2-ä½¿ç”¨æ³›å‹"><a href="#2-ä½¿ç”¨æ³›å‹" class="headerlink" title="2. ä½¿ç”¨æ³›å‹"></a>2. ä½¿ç”¨æ³›å‹</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ— ç¼–è¯‘å™¨è­¦å‘Š:</span></span><br><span class="line">List&lt;String&gt; list = <span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line">list.add(<span class="string">&quot;Hello&quot;</span>);</span><br><span class="line">list.add(<span class="string">&quot;World&quot;</span>);</span><br><span class="line"><span class="comment">// æ— å¼ºåˆ¶è½¬å‹:</span></span><br><span class="line">String first = list.get(<span class="number">0</span>);</span><br><span class="line">String second = list.get(<span class="number">1</span>);</span><br></pre></td></tr></table></figure>

<p>ç¼–è¯‘å™¨çœ‹åˆ°æ³›å‹ç±»å‹<code>List&lt;Number&gt;</code>å°±å¯ä»¥è‡ªåŠ¨æ¨æ–­å‡ºåé¢çš„<code>ArrayList&lt;T&gt;</code>çš„æ³›å‹ç±»å‹å¿…é¡»æ˜¯<code>ArrayList&lt;Number&gt;</code>ï¼Œå› æ­¤ï¼Œå¯ä»¥æŠŠä»£ç ç®€å†™ä¸ºï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å¯ä»¥çœç•¥åé¢çš„Numberï¼Œç¼–è¯‘å™¨å¯ä»¥è‡ªåŠ¨æ¨æ–­æ³›å‹ç±»å‹ï¼š</span></span><br><span class="line">List&lt;Number&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br></pre></td></tr></table></figure>

<p><strong>æ³›å‹æ¥å£</strong></p>
<p>é™¤äº†<code>ArrayList&lt;T&gt;</code>ä½¿ç”¨äº†æ³›å‹ï¼Œè¿˜å¯ä»¥åœ¨æ¥å£ä¸­ä½¿ç”¨æ³›å‹ã€‚ä¾‹å¦‚ï¼Œ<code>Arrays.sort(Object[])</code>å¯ä»¥å¯¹ä»»æ„æ•°ç»„è¿›è¡Œæ’åºï¼Œä½†å¾…æ’åºçš„å…ƒç´ å¿…é¡»å®ç°<code>Comparable&lt;T&gt;</code>è¿™ä¸ªæ³›å‹æ¥å£ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Comparable</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¿”å›è´Ÿæ•°: å½“å‰å®ä¾‹æ¯”å‚æ•°oå°</span></span><br><span class="line"><span class="comment">     * è¿”å›0: å½“å‰å®ä¾‹ä¸å‚æ•°oç›¸ç­‰</span></span><br><span class="line"><span class="comment">     * è¿”å›æ­£æ•°: å½“å‰å®ä¾‹æ¯”å‚æ•°oå¤§</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(T o)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Person[] ps = <span class="keyword">new</span> Person[] &#123;</span><br><span class="line">            <span class="keyword">new</span> Person(<span class="string">&quot;Bob&quot;</span>, <span class="number">61</span>),</span><br><span class="line">            <span class="keyword">new</span> Person(<span class="string">&quot;Alice&quot;</span>, <span class="number">88</span>),</span><br><span class="line">            <span class="keyword">new</span> Person(<span class="string">&quot;Lily&quot;</span>, <span class="number">75</span>),</span><br><span class="line">        &#125;;</span><br><span class="line">        Arrays.sort(ps);</span><br><span class="line">        System.out.println(Arrays.toString(ps));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> <span class="keyword">implements</span> <span class="title">Comparable</span>&lt;<span class="title">Person</span>&gt; </span>&#123;</span><br><span class="line">    String name;</span><br><span class="line">    <span class="keyword">int</span> score;</span><br><span class="line">    Person(String name, <span class="keyword">int</span> score) &#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.score = score;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(Person other)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.name.compareTo(other.name);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.name + <span class="string">&quot;,&quot;</span> + <span class="keyword">this</span>.score;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-ç¼–å†™æ³›å‹"><a href="#3-ç¼–å†™æ³›å‹" class="headerlink" title="3. ç¼–å†™æ³›å‹"></a>3. ç¼–å†™æ³›å‹</h2><p>å†™æ³›å‹ç±»çš„æ­¥éª¤ï¼š</p>
<ol>
<li>æŒ‰ç…§æŸç§ç±»å‹ï¼Œä¾‹å¦‚ï¼š<code>String</code>ï¼Œæ¥ç¼–å†™ç±»</li>
<li>æ ‡è®°æ‰€æœ‰çš„ç‰¹å®šç±»å‹</li>
<li>æŠŠç‰¹å®šç±»å‹<code>String</code>æ›¿æ¢ä¸º<code>T</code>ï¼Œå¹¶ç”³æ˜<code>&lt;T&gt;</code></li>
</ol>
<p><strong>æ³¨æ„</strong>ï¼šæ³›å‹ç±»å‹<code>&lt;T&gt;</code>ä¸èƒ½ç”¨äºé™æ€æ–¹æ³•ã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Pair</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> T first;</span><br><span class="line">    <span class="keyword">private</span> T last;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Pair</span><span class="params">(T first, T last)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.first = first;</span><br><span class="line">        <span class="keyword">this</span>.last = last;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">getFirst</span><span class="params">()</span> </span>&#123; ... &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">getLast</span><span class="params">()</span> </span>&#123; ... &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¯¹é™æ€æ–¹æ³•ä½¿ç”¨&lt;T&gt;:</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Pair&lt;T&gt; <span class="title">create</span><span class="params">(T first, T last)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Pair&lt;T&gt;(first, last);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·å†™ä¼šæŠ¥é”™ï¼</p>
<p>åº”å½“è¿™ä¹ˆäº›ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Pair</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> T first;</span><br><span class="line">    <span class="keyword">private</span> T last;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Pair</span><span class="params">(T first, T last)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.first = first;</span><br><span class="line">        <span class="keyword">this</span>.last = last;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">getFirst</span><span class="params">()</span> </span>&#123; ... &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">getLast</span><span class="params">()</span> </span>&#123; ... &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é™æ€æ³›å‹æ–¹æ³•åº”è¯¥ä½¿ç”¨å…¶ä»–ç±»å‹åŒºåˆ†:</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;K&gt; <span class="function">Pair&lt;K&gt; <span class="title">create</span><span class="params">(K first, K last)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Pair&lt;K&gt;(first, last);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å› ä¸ºæ™®é€šçš„æ–¹æ³•æ˜¯é€šè¿‡ç±»çš„å®ä¾‹æ¥è°ƒç”¨çš„ï¼Œåˆ›å»ºå®ä¾‹çš„è¿‡ç¨‹è°ƒç”¨äº†æ„é€ æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯è¯´å¯¹è±¡å·²ç»çŸ¥é“è¿™ä¸ªæ—¶å€™ç±»ä¸Šé¢å®šä¹‰çš„<T>çš„å…·ä½“ç±»å‹äº†ï¼›</p>
<p>è€Œé™æ€æ–¹æ³•ä¸éœ€è¦å¯¹è±¡å®ä¾‹æ¥è°ƒç”¨ï¼Œæ‰€ä»¥ä¹Ÿå°±ä¸çŸ¥é“<T>çš„å…·ä½“ç±»å‹ï¼Œè™šæ‹Ÿæœºä¸å…è®¸è¿™ç§æƒ…å†µå‘ç”Ÿï¼Œæ‰€ä»¥ç¼–è¯‘çš„æ—¶å€™å°±æŠ¥é”™äº†ã€‚</p>
<p><K>æ”¾åœ¨staticåé¢ï¼Œä½ å¯ä»¥ç†è§£ä¸ºæ—¢ç„¶é™æ€æ–¹æ³•ä¸çŸ¥é“Pairé‡Œé¢çš„å…·ä½“ç±»å‹ï¼Œä½ å°±æ‰‹åŠ¨çš„å‘Šè¯‰å®ƒå…·ä½“çš„ç±»å‹ã€‚</p>
<p><strong>å¤šä¸ªæ³›å‹ç±»å‹</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Pair</span>&lt;<span class="title">T</span>, <span class="title">K</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> T first;</span><br><span class="line">    <span class="keyword">private</span> K last;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Pair</span><span class="params">(T first, K last)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.first = first;</span><br><span class="line">        <span class="keyword">this</span>.last = last;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">getFirst</span><span class="params">()</span> </span>&#123; ... &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> K <span class="title">getLast</span><span class="params">()</span> </span>&#123; ... &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨çš„æ—¶å€™ï¼Œéœ€è¦æŒ‡å‡ºä¸¤ç§ç±»å‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Pair&lt;String, Integer&gt; p = <span class="keyword">new</span> Pair&lt;&gt;(<span class="string">&quot;test&quot;</span>, <span class="number">123</span>);</span><br></pre></td></tr></table></figure>

<h2 id="4-æ“¦æ‹­æ³•"><a href="#4-æ“¦æ‹­æ³•" class="headerlink" title="4. æ“¦æ‹­æ³•"></a>4. æ“¦æ‹­æ³•</h2><p>Javaè¯­è¨€çš„æ³›å‹å®ç°æ–¹å¼æ˜¯æ“¦æ‹­æ³•ï¼ˆType Erasureï¼‰ã€‚</p>
<p>ç¼–è¯‘å™¨çœ‹åˆ°çš„ä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Pair</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> T first;</span><br><span class="line">    <span class="keyword">private</span> T last;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Pair</span><span class="params">(T first, T last)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.first = first;</span><br><span class="line">        <span class="keyword">this</span>.last = last;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">getFirst</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> first;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">getLast</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> last;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è™šæ‹Ÿæœºæ‰§è¡Œçš„ä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Pair</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Object first;</span><br><span class="line">    <span class="keyword">private</span> Object last;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Pair</span><span class="params">(Object first, Object last)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.first = first;</span><br><span class="line">        <span class="keyword">this</span>.last = last;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">getFirst</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> first;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">getLast</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> last;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å› æ­¤ï¼ŒJavaä½¿ç”¨æ“¦æ‹­æ³•å®ç°æ³›å‹ï¼Œå¯¼è‡´äº†ï¼š</p>
<ul>
<li>ç¼–è¯‘å™¨æŠŠç±»å‹<code>&lt;T&gt;</code>è§†ä¸º<code>Object</code>ï¼›</li>
<li>ç¼–è¯‘å™¨æ ¹æ®<code>&lt;T&gt;</code>å®ç°å®‰å…¨çš„å¼ºåˆ¶è½¬å‹ã€‚</li>
</ul>
<p>ä½¿ç”¨æ³›å‹çš„æ—¶å€™ï¼Œæˆ‘ä»¬ç¼–å†™çš„ä»£ç ä¹Ÿæ˜¯ç¼–è¯‘å™¨çœ‹åˆ°çš„ä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Pair&lt;String&gt; p = <span class="keyword">new</span> Pair&lt;&gt;(<span class="string">&quot;Hello&quot;</span>, <span class="string">&quot;world&quot;</span>);</span><br><span class="line">String first = p.getFirst();</span><br><span class="line">String last = p.getLast();		</span><br></pre></td></tr></table></figure>

<p>è€Œè™šæ‹Ÿæœºæ‰§è¡Œçš„ä»£ç å¹¶æ²¡æœ‰æ³›å‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Pair p = <span class="keyword">new</span> Pair(<span class="string">&quot;Hello&quot;</span>, <span class="string">&quot;world&quot;</span>);</span><br><span class="line">String first = (String) p.getFirst();</span><br><span class="line">String last = (String) p.getLast();</span><br></pre></td></tr></table></figure>

<p>æ•…ç¼ºé™·ï¼š</p>
<p>æ“¦æ‹­æ³•å†³å®šäº†æ³›å‹<code>&lt;T&gt;</code>ï¼š</p>
<ul>
<li>ä¸èƒ½æ˜¯åŸºæœ¬ç±»å‹ï¼Œä¾‹å¦‚ï¼š<code>int</code>ï¼›</li>
<li>ä¸èƒ½è·å–å¸¦æ³›å‹ç±»å‹çš„<code>Class</code>ï¼Œä¾‹å¦‚ï¼š<code>Pair&lt;String&gt;.class</code>ï¼›<ul>
<li>æ— è®º<code>T</code>çš„ç±»å‹æ˜¯ä»€ä¹ˆï¼Œ<code>getClass()</code>è¿”å›åŒä¸€ä¸ª<code>Class</code>å®ä¾‹</li>
</ul>
</li>
<li>ä¸èƒ½åˆ¤æ–­å¸¦æ³›å‹ç±»å‹çš„ç±»å‹ï¼Œä¾‹å¦‚ï¼š<code>x instanceof Pair&lt;String&gt;</code>ï¼›</li>
<li>ä¸èƒ½å®ä¾‹åŒ–<code>T</code>ç±»å‹ï¼Œä¾‹å¦‚ï¼š<code>new T()</code>ã€‚</li>
<li>æ³›å‹æ–¹æ³•è¦é˜²æ­¢é‡å¤å®šä¹‰æ–¹æ³•ï¼Œä¾‹å¦‚ï¼š<code>public boolean equals(T obj)</code>ï¼›</li>
</ul>
<p><strong>æ³›å‹ç»§æ‰¿</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Pair</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> T first;</span><br><span class="line">    <span class="keyword">private</span> T last;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Pair</span><span class="params">(T first, T last)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.first = first;</span><br><span class="line">        <span class="keyword">this</span>.last = last;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">getFirst</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> first;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">getLast</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> last;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IntPair</span> <span class="keyword">extends</span> <span class="title">Pair</span>&lt;<span class="title">Integer</span>&gt; </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨çš„æ—¶å€™ï¼Œå› ä¸ºå­ç±»<code>IntPair</code>å¹¶æ²¡æœ‰æ³›å‹ç±»å‹ï¼Œæ‰€ä»¥ï¼Œæ­£å¸¸ä½¿ç”¨å³å¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">IntPair ip = <span class="keyword">new</span> IntPair(<span class="number">1</span>, <span class="number">2</span>);</span><br></pre></td></tr></table></figure>

<p>å­ç±»å¯ä»¥è·å–çˆ¶ç±»çš„æ³›å‹ç±»å‹<code>&lt;T&gt;</code>ã€‚å…·ä½“å¾ˆå¤æ‚ï¼Œç”¨åˆ°å†æŸ¥ã€‚</p>
<h2 id="5-extendsé€šé…ç¬¦"><a href="#5-extendsé€šé…ç¬¦" class="headerlink" title="5. extendsé€šé…ç¬¦"></a>5. extendsé€šé…ç¬¦</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Pair&lt;Integer&gt; p = <span class="keyword">new</span> Pair&lt;&gt;(<span class="number">123</span>, <span class="number">456</span>);</span><br><span class="line">        <span class="keyword">int</span> n = add(p);</span><br><span class="line">        System.out.println(n);</span><br><span class="line">    &#125;</span><br><span class="line">		<span class="comment">//Pair&lt;? extends Number&gt; p</span></span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">add</span><span class="params">(Pair&lt;? extends Number&gt; p)</span> </span>&#123;</span><br><span class="line">        Number first = p.getFirst();</span><br><span class="line">        Number last = p.getLast();</span><br><span class="line">        <span class="keyword">return</span> first.intValue() + last.intValue();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Pair</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> T first;</span><br><span class="line">    <span class="keyword">private</span> T last;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Pair</span><span class="params">(T first, T last)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.first = first;</span><br><span class="line">        <span class="keyword">this</span>.last = last;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">getFirst</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> first;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">getLast</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> last;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨<code>Pair&lt;? extends Number&gt;</code>ä½¿å¾—æ–¹æ³•æ¥æ”¶æ‰€æœ‰æ³›å‹ç±»å‹ä¸º<code>Number</code>æˆ–<code>Number</code>å­ç±»çš„<code>Pair</code>ç±»å‹ã€‚</p>
<p><code>&lt;? extends Number&gt;</code>é€šé…ç¬¦çš„ä¸€ä¸ªé‡è¦é™åˆ¶ï¼šæ–¹æ³•å‚æ•°ç­¾å<code>setFirst(? extends Number)</code>æ— æ³•ä¼ é€’ä»»ä½•<code>Number</code>çš„å­ç±»å‹ç»™<code>setFirst(? extends Number)</code>ã€‚</p>
<p>ä½¿ç”¨ç±»ä¼¼<code>&lt;? extends Number&gt;</code>é€šé…ç¬¦ä½œä¸ºæ–¹æ³•å‚æ•°æ—¶è¡¨ç¤ºï¼š</p>
<ul>
<li>æ–¹æ³•å†…éƒ¨å¯ä»¥è°ƒç”¨è·å–<code>Number</code>å¼•ç”¨çš„æ–¹æ³•ï¼Œä¾‹å¦‚ï¼š<code>Number n = obj.getFirst();</code>ï¼›</li>
<li>æ–¹æ³•å†…éƒ¨æ— æ³•è°ƒç”¨ä¼ å…¥<code>Number</code>å¼•ç”¨çš„æ–¹æ³•ï¼ˆ<code>null</code>é™¤å¤–ï¼‰ï¼Œä¾‹å¦‚ï¼š<code>obj.setFirst(Number n);</code>ã€‚</li>
</ul>
<p>å³ä¸€å¥è¯æ€»ç»“ï¼š<strong>ä½¿ç”¨<code>extends</code>é€šé…ç¬¦è¡¨ç¤ºå¯ä»¥è¯»ï¼Œä¸èƒ½å†™</strong>ã€‚</p>
<p><strong>ä½¿ç”¨extendsé™å®šTç±»å‹</strong></p>
<p>åœ¨å®šä¹‰æ³›å‹ç±»å‹<code>Pair&lt;T&gt;</code>çš„æ—¶å€™ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨<code>extends</code>é€šé…ç¬¦æ¥é™å®š<code>T</code>çš„ç±»å‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">public class Pair&lt;T extends Number&gt; &#123; ... &#125;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨ç±»ä¼¼<code>&lt;T extends Number&gt;</code>å®šä¹‰æ³›å‹ç±»æ—¶è¡¨ç¤ºï¼š</p>
<ul>
<li>æ³›å‹ç±»å‹é™å®šä¸º<code>Number</code>ä»¥åŠ<code>Number</code>çš„å­ç±»ã€‚</li>
</ul>
<h2 id="6-superé€šé…ç¬¦"><a href="#6-superé€šé…ç¬¦" class="headerlink" title="6. superé€šé…ç¬¦"></a>6. superé€šé…ç¬¦</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">set</span><span class="params">(Pair&lt;? <span class="keyword">super</span> Integer&gt; p, Integer first, Integer last)</span> </span>&#123;</span><br><span class="line">    p.setFirst(first);</span><br><span class="line">    p.setLast(last);</span><br><span class="line">&#125;	</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„åˆ°<code>Pair&lt;? super Integer&gt;</code>è¡¨ç¤ºï¼Œæ–¹æ³•å‚æ•°æ¥å—æ‰€æœ‰æ³›å‹ç±»å‹ä¸º<code>Integer</code>æˆ–<code>Integer</code>çˆ¶ç±»çš„<code>Pair</code>ç±»å‹ã€‚</p>
<p>ä½¿ç”¨<code>&lt;? super Integer&gt;</code>é€šé…ç¬¦è¡¨ç¤ºï¼š</p>
<ul>
<li>å…è®¸è°ƒç”¨<code>set(? super Integer)</code>æ–¹æ³•ä¼ å…¥<code>Integer</code>çš„å¼•ç”¨ï¼›</li>
<li>ä¸å…è®¸è°ƒç”¨<code>get()</code>æ–¹æ³•è·å¾—<code>Integer</code>çš„å¼•ç”¨ã€‚</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Pair&lt;Number&gt; p1 = <span class="keyword">new</span> Pair&lt;&gt;(<span class="number">12.3</span>, <span class="number">4.56</span>);</span><br><span class="line">        Pair&lt;Integer&gt; p2 = <span class="keyword">new</span> Pair&lt;&gt;(<span class="number">123</span>, <span class="number">456</span>);</span><br><span class="line">        setSame(p1, <span class="number">100</span>);</span><br><span class="line">        setSame(p2, <span class="number">200</span>);</span><br><span class="line">        System.out.println(p1.getFirst() + <span class="string">&quot;, &quot;</span> + p1.getLast());</span><br><span class="line">        System.out.println(p2.getFirst() + <span class="string">&quot;, &quot;</span> + p2.getLast());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">setSame</span><span class="params">(Pair&lt;? <span class="keyword">super</span> Integer&gt; p, Integer n)</span> </span>&#123;</span><br><span class="line">        p.setFirst(n);</span><br><span class="line">        p.setLast(n);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨<code>&lt;? super Integer&gt;</code>é€šé…ç¬¦è¡¨ç¤ºï¼š</p>
<ul>
<li>å…è®¸è°ƒç”¨<code>set(? super Integer)</code>æ–¹æ³•ä¼ å…¥<code>Integer</code>çš„å¼•ç”¨ï¼›</li>
<li>ä¸å…è®¸è°ƒç”¨<code>get()</code>æ–¹æ³•è·å¾—<code>Integer</code>çš„å¼•ç”¨ã€‚<ul>
<li>å”¯ä¸€ä¾‹å¤–æ˜¯å¯ä»¥è·å–<code>Object</code>çš„å¼•ç”¨ï¼š<code>Object o = p.getFirst()</code>ã€‚</li>
</ul>
</li>
</ul>
<p>ä½¿ç”¨<code>&lt;? super Integer&gt;</code>é€šé…ç¬¦ä½œä¸ºæ–¹æ³•å‚æ•°ï¼Œè¡¨ç¤ºæ–¹æ³•å†…éƒ¨ä»£ç å¯¹äºå‚æ•°<strong>åªèƒ½å†™ï¼Œä¸èƒ½è¯»</strong>ã€‚</p>
<h2 id="7-å¯¹æ¯”extendså’Œsuperé€šé…ç¬¦"><a href="#7-å¯¹æ¯”extendså’Œsuperé€šé…ç¬¦" class="headerlink" title="7. å¯¹æ¯”extendså’Œsuperé€šé…ç¬¦"></a>7. å¯¹æ¯”extendså’Œsuperé€šé…ç¬¦</h2><p>ä½œä¸ºæ–¹æ³•å‚æ•°ï¼Œ<code>&lt;? extends T&gt;</code>ç±»å‹å’Œ<code>&lt;? super T&gt;</code>ç±»å‹çš„åŒºåˆ«åœ¨äºï¼š</p>
<ul>
<li><code>&lt;? extends T&gt;</code>å…è®¸è°ƒç”¨è¯»æ–¹æ³•<code>T get()</code>è·å–<code>T</code>çš„å¼•ç”¨ï¼Œä½†ä¸å…è®¸è°ƒç”¨å†™æ–¹æ³•<code>set(T)</code>ä¼ å…¥<code>T</code>çš„å¼•ç”¨ï¼ˆä¼ å…¥<code>null</code>é™¤å¤–ï¼‰ï¼›</li>
<li><code>&lt;? super T&gt;</code>å…è®¸è°ƒç”¨å†™æ–¹æ³•<code>set(T)</code>ä¼ å…¥<code>T</code>çš„å¼•ç”¨ï¼Œä½†ä¸å…è®¸è°ƒç”¨è¯»æ–¹æ³•<code>T get()</code>è·å–<code>T</code>çš„å¼•ç”¨ï¼ˆè·å–<code>Object</code>é™¤å¤–ï¼‰ã€‚</li>
</ul>
<p>ä¸€ä¸ªæ˜¯å…è®¸è¯»ä¸å…è®¸å†™ï¼Œå¦ä¸€ä¸ªæ˜¯å…è®¸å†™ä¸å…è®¸è¯»ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Collections</span> </span>&#123;</span><br><span class="line">    <span class="comment">// æŠŠsrcçš„æ¯ä¸ªå…ƒç´ å¤åˆ¶åˆ°destä¸­:</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function"><span class="keyword">void</span> <span class="title">copy</span><span class="params">(List&lt;? <span class="keyword">super</span> T&gt; dest, List&lt;? extends T&gt; src)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;src.size(); i++) &#123;</span><br><span class="line">            T t = src.get(i);</span><br><span class="line">            dest.add(t);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ª<code>copy()</code>æ–¹æ³•çš„å®šä¹‰å°±å®Œç¾åœ°å±•ç¤ºäº†<code>extends</code>å’Œ<code>super</code>çš„æ„å›¾ï¼š</p>
<ul>
<li><code>copy()</code>æ–¹æ³•å†…éƒ¨ä¸ä¼šè¯»å–<code>dest</code>ï¼Œå› ä¸ºä¸èƒ½è°ƒç”¨<code>dest.get()</code>æ¥è·å–<code>T</code>çš„å¼•ç”¨ï¼›</li>
<li><code>copy()</code>æ–¹æ³•å†…éƒ¨ä¹Ÿä¸ä¼šä¿®æ”¹<code>src</code>ï¼Œå› ä¸ºä¸èƒ½è°ƒç”¨<code>src.add(T)</code>ã€‚</li>
</ul>
<p><strong>PECSåŸåˆ™</strong></p>
<p>Producer Extends Consumer Superã€‚</p>
<p>å³ï¼šå¦‚æœéœ€è¦è¿”å›<code>T</code>ï¼Œå®ƒæ˜¯ç”Ÿäº§è€…ï¼ˆProducerï¼‰ï¼Œè¦ä½¿ç”¨<code>extends</code>é€šé…ç¬¦ï¼›å¦‚æœéœ€è¦å†™å…¥<code>T</code>ï¼Œå®ƒæ˜¯æ¶ˆè´¹è€…ï¼ˆConsumerï¼‰ï¼Œè¦ä½¿ç”¨<code>super</code>é€šé…ç¬¦ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Collections</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function"><span class="keyword">void</span> <span class="title">copy</span><span class="params">(List&lt;? <span class="keyword">super</span> T&gt; dest, List&lt;? extends T&gt; src)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;src.size(); i++) &#123;</span><br><span class="line">            T t = src.get(i); <span class="comment">// srcæ˜¯producer</span></span><br><span class="line">            dest.add(t); <span class="comment">// destæ˜¯consumer</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>éœ€è¦è¿”å›<code>T</code>çš„<code>src</code>æ˜¯ç”Ÿäº§è€…ï¼Œå› æ­¤å£°æ˜ä¸º<code>List&lt;? extends T&gt;</code>ï¼Œéœ€è¦å†™å…¥<code>T</code>çš„<code>dest</code>æ˜¯æ¶ˆè´¹è€…ï¼Œå› æ­¤å£°æ˜ä¸º<code>List&lt;? super T&gt;</code>ã€‚</p>
<p><strong>æ— é™å®šé€šé…ç¬¦</strong></p>
<p>æ— é™å®šé€šé…ç¬¦ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">sample</span><span class="params">(Pair&lt;?&gt; p)</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å› ä¸º<code>&lt;?&gt;</code>é€šé…ç¬¦æ—¢æ²¡æœ‰<code>extends</code>ï¼Œä¹Ÿæ²¡æœ‰<code>super</code>ï¼Œå› æ­¤ï¼š</p>
<ul>
<li>ä¸å…è®¸è°ƒç”¨<code>set(T)</code>æ–¹æ³•å¹¶ä¼ å…¥å¼•ç”¨ï¼ˆ<code>null</code>é™¤å¤–ï¼‰ï¼›</li>
<li>ä¸å…è®¸è°ƒç”¨<code>T get()</code>æ–¹æ³•å¹¶è·å–<code>T</code>å¼•ç”¨ï¼ˆåªèƒ½è·å–<code>Object</code>å¼•ç”¨ï¼‰ã€‚</li>
</ul>
<p><strong>æ—¢ä¸èƒ½è¯»ï¼Œä¹Ÿä¸èƒ½å†™</strong></p>
<p><code>&lt;?&gt;</code>é€šé…ç¬¦æœ‰ä¸€ä¸ªç‹¬ç‰¹çš„ç‰¹ç‚¹ï¼Œå°±æ˜¯ï¼š<code>Pair&lt;?&gt;</code>æ˜¯æ‰€æœ‰<code>Pair&lt;T&gt;</code>çš„è¶…ç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Pair&lt;Integer&gt; p = <span class="keyword">new</span> Pair&lt;&gt;(<span class="number">123</span>, <span class="number">456</span>);</span><br><span class="line">        Pair&lt;?&gt; p2 = p; <span class="comment">// å®‰å…¨åœ°å‘ä¸Šè½¬å‹</span></span><br><span class="line">        System.out.println(p2.getFirst() + <span class="string">&quot;, &quot;</span> + p2.getLast());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯¹äº<code>class A&lt;? extends T&gt;ï¼š</code></p>
<p>å› ä¸ºä¼ å…¥çš„å¿…å®šæ˜¯Pair&lt;Tæˆ–è€…Tçš„å­ç±»&gt;ï¼Œæ‰€ä»¥è°ƒç”¨getæ–¹æ³•å› ä¸ºè¿”å›çš„å¿…å®šæ˜¯Tæˆ–è€…Tçš„å­ç±»ï¼Œè¿™æ ·çš„è¯å°±å¯ä»¥ç”¨Tè¿›è¡Œæ¥æ”¶ï¼Œä¾‹å¦‚ï¼š<code>Number n = p.get()</code>ï¼Œå› ä¸ºè¿”å›çš„å¿…å®šæ˜¯Numberçš„å­ç±»ï¼Œæ‰€ä»¥å¯ä»¥å‘ä¸Šè½¬å‹æˆNumberæ¥æ”¶ã€‚ä½†æ˜¯æ— æ³•è°ƒç”¨setæ–¹æ³•ï¼Œå› ä¸ºæ— æ³•å‘ä¸‹è½¬å‹ä¸”åœ¨è¿è¡Œè¿‡ç¨‹ä¸­æ— æ³•è·å–Tåˆ°åº•æ˜¯ä»€ä¹ˆç±»å‹ï¼Œä½ æƒ³å•Šä½ è¦æ˜¯<strong>set(T)<strong>ï¼Œä½†å®é™…ä¸Š</strong>?</strong>(å®é™…çš„ç±»å‹)åˆæ˜¯<strong>Tçš„å­ç±»</strong>ï¼Œåˆæ— æ³•å‘ä¸‹è½¬å‹ï¼Œé‚£èƒ½æ€ä¹ˆåŠï¼Œåªèƒ½æŠ¥é”™å‘—~æ‰€ä»¥åœ¨ç¼–è¯‘çš„æ—¶å€™å°±ä¸ä¼šé€šè¿‡ã€‚æ‰€ä»¥æ— æ³•è°ƒç”¨<code>set</code></p>
<p>å¯¹äº<code>class A&lt;? super T&gt;:</code></p>
<p>å› ä¸ºä¼ å…¥çš„<code>Pair&lt;Tæˆ–è€…Tçš„çˆ¶ç±»&gt;</code>ï¼Œå½“è°ƒç”¨<code>set</code>æ–¹æ³•æ—¶ï¼Œ<code>set(T)</code>ï¼Œä¸è®ºTåˆ°åº•æ˜¯ä»€ä¹ˆï¼Œæœ€åéƒ½å¯ä»¥å‘ä¸Šè½¬å‹åˆ°ç›¸åº”çš„çˆ¶ç±»ã€‚ä½†æ˜¯å½“è°ƒç”¨<code>get</code>æ–¹æ³•æ—¶ç”±äºä¸çŸ¥é“è¿”å›çš„Tåˆ°åº•æ˜¯ä»€ä¹ˆç±»å‹ï¼Œå…¶æ— æ³•å‘ä¸‹è½¬å‹å°±ä¸èƒ½ç”¨Tæ¥æ”¶ã€‚æ‰€ä»¥æ— æ³•è°ƒç”¨<code>get()</code></p>
<h2 id="8-æ³›å‹å’Œåå°„"><a href="#8-æ³›å‹å’Œåå°„" class="headerlink" title="8. æ³›å‹å’Œåå°„"></a>8. æ³›å‹å’Œåå°„</h2><p><a href="https://www.liaoxuefeng.com/wiki/1252599548343744/1265105940850016%60%60">https://www.liaoxuefeng.com/wiki/1252599548343744/1265105940850016``</a></p>
<p><code>Class&lt;T&gt;</code>ä¹Ÿæ˜¯æ³›å‹ï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// compile warning:</span></span><br><span class="line">Class clazz = String.class;</span><br><span class="line">String str = (String) clazz.newInstance();</span><br><span class="line"></span><br><span class="line"><span class="comment">// no warning:</span></span><br><span class="line">Class&lt;String&gt; clazz = String.class;</span><br><span class="line">String str = clazz.newInstance();</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡æ³›å‹ï¼Œå¯ä»¥é¿å…ç±»å‹è½¬åŒ–ã€‚</p>
<p>è°ƒç”¨<code>Class</code>çš„<code>getSuperclass()</code>æ–¹æ³•è¿”å›çš„<code>Class</code>ç±»å‹æ˜¯<code>Class&lt;? super T&gt;</code>ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Class&lt;? <span class="keyword">super</span> String&gt; sup = String.class.getSuperclass();</span><br></pre></td></tr></table></figure>

<p>æ„é€ æ–¹æ³•ä¹Ÿæ˜¯æ³›å‹ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Class&lt;Integer&gt; clazz = Integer.class;</span><br><span class="line">Constructor&lt;Integer&gt; cons = clazz.getConstructor(<span class="keyword">int</span>.class);</span><br><span class="line">Integer i = cons.newInstance(<span class="number">123</span>);</span><br></pre></td></tr></table></figure>

<p><strong>å®šä¹‰æ³›å‹æ•°ç»„</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Pair&lt;String&gt;[] ps = (Pair&lt;String&gt;[]) <span class="keyword">new</span> Pair[<span class="number">2</span>];</span><br></pre></td></tr></table></figure>

<p><strong>åˆ›å»ºæ•°ç»„T[]</strong></p>
<p>ä¸èƒ½ç›´æ¥åˆ›å»ºæ•°ç»„<code>T[]</code>ï¼Œå› ä¸ºæ“¦æ‹­åä»£ç å˜ä¸º<code>Object[]</code>ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// compile error:</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Abc</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    T[] createArray() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> T[<span class="number">5</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¿…é¡»å€ŸåŠ©<code>Class&lt;T&gt;</code>æ¥åˆ›å»ºæ•°ç»„T[]ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">T[] createArray(Class&lt;T&gt; cls) &#123;</span><br><span class="line">    <span class="keyword">return</span> (T[]) Array.newInstance(cls, <span class="number">5</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

]]></content>
      <tags>
        <tag>JAVA</tag>
      </tags>
  </entry>
  <entry>
    <title>JAVA - æ³¨è§£</title>
    <url>/2021/04/19/JAVA%E6%B3%A8%E8%A7%A3/</url>
    <content><![CDATA[<h1 id="JAVAæ³¨è§£"><a href="#JAVAæ³¨è§£" class="headerlink" title="JAVAæ³¨è§£"></a>JAVAæ³¨è§£</h1><p>æ³¨è§£æ˜¯æ”¾åœ¨Javaæºç çš„ç±»ã€æ–¹æ³•ã€å­—æ®µã€å‚æ•°å‰çš„ä¸€ç§ç‰¹æ®Šâ€œæ³¨é‡Šâ€ã€‚</p>
<h2 id="1-ä½¿ç”¨æ³¨è§£"><a href="#1-ä½¿ç”¨æ³¨è§£" class="headerlink" title="1. ä½¿ç”¨æ³¨è§£"></a>1. ä½¿ç”¨æ³¨è§£</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// this is a component:</span></span><br><span class="line"><span class="meta">@Resource(&quot;hello&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Hello</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Inject</span></span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostConstruct</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">hello</span><span class="params">(<span class="meta">@Param</span> String name)</span> </span>&#123;</span><br><span class="line">        System.out.println(name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Hello&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ³¨é‡Šä¼šè¢«ç¼–è¯‘å™¨ç›´æ¥å¿½ç•¥ï¼Œæ³¨è§£åˆ™å¯ä»¥è¢«ç¼–è¯‘å™¨æ‰“åŒ…è¿›å…¥classæ–‡ä»¶ï¼Œå› æ­¤ï¼Œæ³¨è§£æ˜¯ä¸€ç§ç”¨ä½œæ ‡æ³¨çš„â€œå…ƒæ•°æ®â€ã€‚</p>
<p>Javaçš„æ³¨è§£å¯ä»¥åˆ†ä¸ºä¸‰ç±»ï¼š</p>
<p>ç¬¬ä¸€ç±»æ˜¯ç”±ç¼–è¯‘å™¨ä½¿ç”¨çš„æ³¨è§£ï¼Œä¾‹å¦‚ï¼š</p>
<ul>
<li><code>@Override</code>ï¼šè®©ç¼–è¯‘å™¨æ£€æŸ¥è¯¥æ–¹æ³•æ˜¯å¦æ­£ç¡®åœ°å®ç°äº†è¦†å†™ï¼›</li>
<li><code>@SuppressWarnings</code>ï¼šå‘Šè¯‰ç¼–è¯‘å™¨å¿½ç•¥æ­¤å¤„ä»£ç äº§ç”Ÿçš„è­¦å‘Šã€‚</li>
</ul>
<p>è¿™ç±»æ³¨è§£ä¸ä¼šè¢«ç¼–è¯‘è¿›å…¥<code>.class</code>æ–‡ä»¶ï¼Œå®ƒä»¬åœ¨ç¼–è¯‘åå°±è¢«ç¼–è¯‘å™¨æ‰”æ‰äº†ã€‚</p>
<p>ç¬¬äºŒç±»æ˜¯ç”±å·¥å…·å¤„ç†<code>.class</code>æ–‡ä»¶ä½¿ç”¨çš„æ³¨è§£ï¼Œæ¯”å¦‚æœ‰äº›å·¥å…·ä¼šåœ¨åŠ è½½classçš„æ—¶å€™ï¼Œå¯¹classåšåŠ¨æ€ä¿®æ”¹ï¼Œå®ç°ä¸€äº›ç‰¹æ®Šçš„åŠŸèƒ½ã€‚è¿™ç±»æ³¨è§£ä¼šè¢«ç¼–è¯‘è¿›å…¥<code>.class</code>æ–‡ä»¶ï¼Œä½†åŠ è½½ç»“æŸåå¹¶ä¸ä¼šå­˜åœ¨äºå†…å­˜ä¸­ã€‚è¿™ç±»æ³¨è§£åªè¢«ä¸€äº›åº•å±‚åº“ä½¿ç”¨ï¼Œä¸€èˆ¬æˆ‘ä»¬ä¸å¿…è‡ªå·±å¤„ç†ã€‚</p>
<p>ç¬¬ä¸‰ç±»æ˜¯åœ¨ç¨‹åºè¿è¡ŒæœŸèƒ½å¤Ÿè¯»å–çš„æ³¨è§£ï¼Œå®ƒä»¬åœ¨åŠ è½½åä¸€ç›´å­˜åœ¨äºJVMä¸­ï¼Œè¿™ä¹Ÿæ˜¯æœ€å¸¸ç”¨çš„æ³¨è§£ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªé…ç½®äº†<code>@PostConstruct</code>çš„æ–¹æ³•ä¼šåœ¨è°ƒç”¨æ„é€ æ–¹æ³•åè‡ªåŠ¨è¢«è°ƒç”¨ï¼ˆè¿™æ˜¯Javaä»£ç è¯»å–è¯¥æ³¨è§£å®ç°çš„åŠŸèƒ½ï¼ŒJVMå¹¶ä¸ä¼šè¯†åˆ«è¯¥æ³¨è§£ï¼‰ã€‚</p>
<p>å®šä¹‰ä¸€ä¸ªæ³¨è§£æ—¶ï¼Œè¿˜å¯ä»¥å®šä¹‰é…ç½®å‚æ•°ã€‚é…ç½®å‚æ•°å¯ä»¥åŒ…æ‹¬ï¼š</p>
<ul>
<li>æ‰€æœ‰åŸºæœ¬ç±»å‹ï¼›</li>
<li>Stringï¼›</li>
<li>æšä¸¾ç±»å‹ï¼›</li>
<li>åŸºæœ¬ç±»å‹ã€Stringã€Classä»¥åŠæšä¸¾çš„æ•°ç»„ã€‚</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Hello</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Check(min=0, max=100, value=55)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> n;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Check(value=99)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> p;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Check(99)</span> <span class="comment">// @Check(value=99)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> x;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Check</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> y;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>@Check</code>å°±æ˜¯ä¸€ä¸ªæ³¨è§£ã€‚ç¬¬ä¸€ä¸ª<code>@Check(min=0, max=100, value=55)</code>æ˜ç¡®å®šä¹‰äº†ä¸‰ä¸ªå‚æ•°ï¼Œç¬¬äºŒä¸ª<code>@Check(value=99)</code>åªå®šä¹‰äº†ä¸€ä¸ª<code>value</code>å‚æ•°ï¼Œå®ƒå®é™…ä¸Šå’Œ<code>@Check(99)</code>æ˜¯å®Œå…¨ä¸€æ ·çš„ã€‚æœ€åä¸€ä¸ª<code>@Check</code>è¡¨ç¤ºæ‰€æœ‰å‚æ•°éƒ½ä½¿ç”¨é»˜è®¤å€¼ã€‚</p>
<h2 id="2-å®šä¹‰æ³¨è§£"><a href="#2-å®šä¹‰æ³¨è§£" class="headerlink" title="2. å®šä¹‰æ³¨è§£"></a>2. å®šä¹‰æ³¨è§£</h2><p>ä½¿ç”¨<code>@interface</code>è¯­æ³•æ¥å®šä¹‰æ³¨è§£ï¼ˆ<code>Annotation</code>ï¼‰ï¼Œå®ƒçš„æ ¼å¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Report &#123;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">type</span><span class="params">()</span> <span class="keyword">default</span> 0</span>;</span><br><span class="line">    <span class="function">String <span class="title">level</span><span class="params">()</span> <span class="keyword">default</span> &quot;info&quot;</span>;</span><br><span class="line">    <span class="function">String <span class="title">value</span><span class="params">()</span> <span class="keyword">default</span> &quot;&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ³¨è§£çš„å‚æ•°ç±»ä¼¼æ— å‚æ•°æ–¹æ³•ï¼Œå¯ä»¥ç”¨<code>default</code>è®¾å®šä¸€ä¸ªé»˜è®¤å€¼ï¼ˆå¼ºçƒˆæ¨èï¼‰ã€‚æœ€å¸¸ç”¨çš„å‚æ•°åº”å½“å‘½åä¸º<code>value</code>ã€‚</p>
<p><strong>å…ƒæ³¨è§£</strong></p>
<p>å…ƒæ³¨è§£ï¼šèƒ½ä¿®é¥°å…¶ä»–æ³¨è§£çš„æ³¨è§£ã€‚JAVAæ ‡å‡†åº“æä¾›ã€‚</p>
<h3 id="Target"><a href="#Target" class="headerlink" title="@Target"></a>@Target</h3><p>æœ€å¸¸ç”¨çš„å…ƒæ³¨è§£æ˜¯<code>@Target</code>ã€‚ä½¿ç”¨<code>@Target</code>å¯ä»¥å®šä¹‰<code>Annotation</code>èƒ½å¤Ÿè¢«åº”ç”¨äºæºç çš„å“ªäº›ä½ç½®ï¼š</p>
<ul>
<li>ç±»æˆ–æ¥å£ï¼š<code>ElementType.TYPE</code>ï¼›</li>
<li>å­—æ®µï¼š<code>ElementType.FIELD</code>ï¼›</li>
<li>æ–¹æ³•ï¼š<code>ElementType.METHOD</code>ï¼›</li>
<li>æ„é€ æ–¹æ³•ï¼š<code>ElementType.CONSTRUCTOR</code>ï¼›</li>
<li>æ–¹æ³•å‚æ•°ï¼š<code>ElementType.PARAMETER</code>ã€‚</li>
</ul>
<p>ä¾‹å¦‚ï¼š<code>@Target(ElementType.METHOD)</code>æŒ‡å®šè¯¥æ³¨è§£åªèƒ½ç”¨åœ¨æ–¹æ³•ä¸Šã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Target(ElementType.METHOD)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Report &#123;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">type</span><span class="params">()</span> <span class="keyword">default</span> 0</span>;</span><br><span class="line">    <span class="function">String <span class="title">level</span><span class="params">()</span> <span class="keyword">default</span> &quot;info&quot;</span>;</span><br><span class="line">    <span class="function">String <span class="title">value</span><span class="params">()</span> <span class="keyword">default</span> &quot;&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœè¦å®šä¹‰è¯¥æ³¨è§£åªèƒ½ç”¨åœ¨æ–¹æ³•å’Œå­—æ®µä¸Šï¼Œå¯ä»¥æŠŠ<code>@Target</code>æ³¨è§£å‚æ•°å˜ä¸ºæ•°ç»„<code>&#123; ElementType.METHOD, ElementType.FIELD &#125;</code>ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Target(&#123;</span></span><br><span class="line"><span class="meta">    ElementType.METHOD,</span></span><br><span class="line"><span class="meta">    ElementType.FIELD</span></span><br><span class="line"><span class="meta">&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Report &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Retention"><a href="#Retention" class="headerlink" title="@Retention"></a>@Retention</h3><p>å¦ä¸€ä¸ªé‡è¦çš„å…ƒæ³¨è§£<code>@Retention</code>å®šä¹‰äº†<code>Annotation</code>çš„ç”Ÿå‘½å‘¨æœŸï¼š</p>
<ul>
<li>ä»…ç¼–è¯‘æœŸï¼š<code>RetentionPolicy.SOURCE</code>ï¼›</li>
<li>ä»…classæ–‡ä»¶ï¼š<code>RetentionPolicy.CLASS</code>ï¼›</li>
<li>è¿è¡ŒæœŸï¼š<code>RetentionPolicy.RUNTIME</code>ã€‚</li>
</ul>
<p>é»˜è®¤ä¸ºCLASSï¼Œé€šå¸¸æˆ‘ä»¬ä¼šè¦æ±‚æ˜¯RUNTIMEç±»å‹ï¼Œæ‰€ä»¥è¦åŠ ä¸Š<code>@Retention(RetentionPolicy.RUNTIME)</code> ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Report &#123;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">type</span><span class="params">()</span> <span class="keyword">default</span> 0</span>;</span><br><span class="line">    <span class="function">String <span class="title">level</span><span class="params">()</span> <span class="keyword">default</span> &quot;info&quot;</span>;</span><br><span class="line">    <span class="function">String <span class="title">value</span><span class="params">()</span> <span class="keyword">default</span> &quot;&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Repeatable"><a href="#Repeatable" class="headerlink" title="@Repeatable"></a>@Repeatable</h3><p><code>@Repeatable</code>è¿™ä¸ªå…ƒæ³¨è§£å¯ä»¥å®šä¹‰<code>Annotation</code>æ˜¯å¦å¯é‡å¤ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Repeatable(Reports.class)</span></span><br><span class="line"><span class="meta">@Target(ElementType.TYPE)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Report &#123;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">type</span><span class="params">()</span> <span class="keyword">default</span> 0</span>;</span><br><span class="line">    <span class="function">String <span class="title">level</span><span class="params">()</span> <span class="keyword">default</span> &quot;info&quot;</span>;</span><br><span class="line">    <span class="function">String <span class="title">value</span><span class="params">()</span> <span class="keyword">default</span> &quot;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Target(ElementType.TYPE)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Reports &#123;</span><br><span class="line">    Report[] value();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç»è¿‡<code>@Repeatable</code>ä¿®é¥°åï¼Œåœ¨æŸä¸ªç±»å‹å£°æ˜å¤„ï¼Œå°±å¯ä»¥æ·»åŠ å¤šä¸ª<code>@Report</code>æ³¨è§£ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Report(type=1, level=&quot;debug&quot;)</span></span><br><span class="line"><span class="meta">@Report(type=2, level=&quot;warning&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Hello</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Inherited"><a href="#Inherited" class="headerlink" title="@Inherited"></a>@Inherited</h3><p>ä½¿ç”¨<code>@Inherited</code>å®šä¹‰å­ç±»æ˜¯å¦å¯ç»§æ‰¿çˆ¶ç±»å®šä¹‰çš„<code>Annotation</code>ã€‚<code>@Inherited</code>ä»…é’ˆå¯¹<code>@Target(ElementType.TYPE)</code>ç±»å‹çš„<code>annotation</code>æœ‰æ•ˆï¼Œå¹¶ä¸”ä»…é’ˆå¯¹<code>class</code>çš„ç»§æ‰¿ï¼Œå¯¹<code>interface</code>çš„ç»§æ‰¿æ— æ•ˆã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Inherited</span></span><br><span class="line"><span class="meta">@Target(ElementType.TYPE)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Report &#123;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">type</span><span class="params">()</span> <span class="keyword">default</span> 0</span>;</span><br><span class="line">    <span class="function">String <span class="title">level</span><span class="params">()</span> <span class="keyword">default</span> &quot;info&quot;</span>;</span><br><span class="line">    <span class="function">String <span class="title">value</span><span class="params">()</span> <span class="keyword">default</span> &quot;&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨ä½¿ç”¨çš„æ—¶å€™ï¼Œå¦‚æœä¸€ä¸ªç±»ç”¨åˆ°äº†<code>@Report</code>ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Report(type=1)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åˆ™å®ƒçš„å­ç±»é»˜è®¤ä¹Ÿå®šä¹‰äº†è¯¥æ³¨è§£ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span> <span class="keyword">extends</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="å¦‚ä½•å®šä¹‰æ³¨è§£æ€»ç»“"><a href="#å¦‚ä½•å®šä¹‰æ³¨è§£æ€»ç»“" class="headerlink" title="å¦‚ä½•å®šä¹‰æ³¨è§£æ€»ç»“"></a>å¦‚ä½•å®šä¹‰æ³¨è§£æ€»ç»“</h3><p>ç¬¬ä¸€æ­¥ï¼šç”¨<code>@interface</code>å®šä¹‰æ³¨è§£ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Report &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç¬¬äºŒæ­¥ï¼Œæ·»åŠ å‚æ•°ã€é»˜è®¤å€¼ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">public @interface Report &#123;</span><br><span class="line">    int type() default 0;</span><br><span class="line">    String level() default &quot;info&quot;;</span><br><span class="line">    String value() default &quot;&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æŠŠæœ€å¸¸ç”¨çš„å‚æ•°å®šä¹‰ä¸º<code>value()</code>ï¼Œæ¨èæ‰€æœ‰å‚æ•°éƒ½å°½é‡è®¾ç½®é»˜è®¤å€¼ã€‚</p>
<p>ç¬¬ä¸‰æ­¥ï¼Œç”¨å…ƒæ³¨è§£é…ç½®æ³¨è§£ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">@Target(ElementType.TYPE)</span><br><span class="line">@Retention(RetentionPolicy.RUNTIME)</span><br><span class="line">public @interface Report &#123;</span><br><span class="line">    int type() default 0;</span><br><span class="line">    String level() default &quot;info&quot;;</span><br><span class="line">    String value() default &quot;&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­ï¼Œå¿…é¡»è®¾ç½®<code>@Target</code>å’Œ<code>@Retention</code>ï¼Œ<code>@Retention</code>ä¸€èˆ¬è®¾ç½®ä¸º<code>RUNTIME</code>ï¼Œå› ä¸ºæˆ‘ä»¬è‡ªå®šä¹‰çš„æ³¨è§£é€šå¸¸è¦æ±‚åœ¨è¿è¡ŒæœŸè¯»å–ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸å¿…å†™<code>@Inherited</code>å’Œ<code>@Repeatable</code>ã€‚</p>
<h2 id="3-å¤„ç†æ³¨è§£"><a href="#3-å¤„ç†æ³¨è§£" class="headerlink" title="3. å¤„ç†æ³¨è§£"></a>3. å¤„ç†æ³¨è§£</h2><p><code>SOURCE</code>ç±»å‹çš„æ³¨è§£ä¸»è¦ç”±ç¼–è¯‘å™¨ä½¿ç”¨ï¼Œå› æ­¤æˆ‘ä»¬ä¸€èˆ¬åªä½¿ç”¨ï¼Œä¸ç¼–å†™ã€‚</p>
<p><code>CLASS</code>ç±»å‹çš„æ³¨è§£ä¸»è¦ç”±åº•å±‚å·¥å…·åº“ä½¿ç”¨ï¼Œæ¶‰åŠåˆ°classçš„åŠ è½½ï¼Œä¸€èˆ¬æˆ‘ä»¬å¾ˆå°‘ç”¨åˆ°ã€‚</p>
<p><code>RUNTIME</code>ç±»å‹çš„æ³¨è§£ä¸ä½†è¦ä½¿ç”¨ï¼Œè¿˜ç»å¸¸éœ€è¦ç¼–å†™ã€‚</p>
<p>è¯»å–æ³¨è§£ï¼Œéœ€è¦ä½¿ç”¨åå°„APIã€‚</p>
<p>Javaæä¾›çš„ä½¿ç”¨åå°„APIè¯»å–<code>Annotation</code>çš„æ–¹æ³•åŒ…æ‹¬ï¼š</p>
<p>åˆ¤æ–­æŸä¸ªæ³¨è§£æ˜¯å¦å­˜åœ¨äº<code>Class</code>ã€<code>Field</code>ã€<code>Method</code>æˆ–<code>Constructor</code>ï¼š</p>
<ul>
<li><code>Class.isAnnotationPresent(Class)</code></li>
<li><code>Field.isAnnotationPresent(Class)</code></li>
<li><code>Method.isAnnotationPresent(Class)</code></li>
<li><code>Constructor.isAnnotationPresent(Class)</code></li>
</ul>
<p>ä¾‹å¦‚ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åˆ¤æ–­@Reportæ˜¯å¦å­˜åœ¨äºPersonç±»:</span></span><br><span class="line">Person.class.isAnnotationPresent(Report.class);</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨åå°„APIè¯»å–Annotationï¼š</p>
<ul>
<li><code>Class.getAnnotation(Class)</code></li>
<li><code>Field.getAnnotation(Class)</code></li>
<li><code>Method.getAnnotation(Class)</code></li>
<li><code>Constructor.getAnnotation(Class)</code></li>
</ul>
<p>ä¾‹å¦‚ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è·å–Personå®šä¹‰çš„@Reportæ³¨è§£:</span></span><br><span class="line">Report report = Person.class.getAnnotation(Report.class);</span><br><span class="line"><span class="keyword">int</span> type = report.type();</span><br><span class="line">String level = report.level();</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨åå°„APIè¯»å–<code>Annotation</code>æœ‰ä¸¤ç§æ–¹æ³•ã€‚</p>
<p>æ–¹æ³•ä¸€æ˜¯å…ˆåˆ¤æ–­<code>Annotation</code>æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨ï¼Œå°±ç›´æ¥è¯»å–ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Class cls = Person.class;</span><br><span class="line"><span class="keyword">if</span> (cls.isAnnotationPresent(Report.class)) &#123;</span><br><span class="line">    Report report = cls.getAnnotation(Report.class);</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç¬¬äºŒç§æ–¹æ³•æ˜¯ç›´æ¥è¯»å–<code>Annotation</code>ï¼Œå¦‚æœ<code>Annotation</code>ä¸å­˜åœ¨ï¼Œå°†è¿”å›<code>null</code>ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Class cls = Person.class;</span><br><span class="line">Report report = cls.getAnnotation(Report.class);</span><br><span class="line"><span class="keyword">if</span> (report != <span class="keyword">null</span>) &#123;</span><br><span class="line">   ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¯»å–æ–¹æ³•ã€å­—æ®µå’Œæ„é€ æ–¹æ³•çš„<code>Annotation</code>å’ŒClassç±»ä¼¼ã€‚ä½†è¦è¯»å–æ–¹æ³•å‚æ•°çš„<code>Annotation</code>å¿…é¡»ç”¨ä¸€ä¸ªäºŒç»´æ•°ç»„ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">hello</span><span class="params">(<span class="meta">@NotNull</span> <span class="meta">@Range(max=5)</span> String name, <span class="meta">@NotNull</span> String prefix)</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è·å–Methodå®ä¾‹:</span></span><br><span class="line">Method m = ...</span><br><span class="line"><span class="comment">// è·å–æ‰€æœ‰å‚æ•°çš„Annotation:</span></span><br><span class="line">Annotation[][] annos = m.getParameterAnnotations();</span><br><span class="line"><span class="comment">// ç¬¬ä¸€ä¸ªå‚æ•°ï¼ˆç´¢å¼•ä¸º0ï¼‰çš„æ‰€æœ‰Annotation:</span></span><br><span class="line">Annotation[] annosOfName = annos[<span class="number">0</span>];</span><br><span class="line"><span class="keyword">for</span> (Annotation anno : annosOfName) &#123;</span><br><span class="line">    <span class="keyword">if</span> (anno <span class="keyword">instanceof</span> Range) &#123; <span class="comment">// @Rangeæ³¨è§£</span></span><br><span class="line">        Range r = (Range) anno;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (anno <span class="keyword">instanceof</span> NotNull) &#123; <span class="comment">// @NotNullæ³¨è§£</span></span><br><span class="line">        NotNull n = (NotNull) anno;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>ä½¿ç”¨æ³¨è§£</strong></p>
<p>æ³¨è§£å¦‚ä½•ä½¿ç”¨ï¼Œå®Œå…¨ç”±ç¨‹åºè‡ªå·±å†³å®šã€‚ä¾‹å¦‚ï¼ŒJUnitæ˜¯ä¸€ä¸ªæµ‹è¯•æ¡†æ¶ï¼Œå®ƒä¼šè‡ªåŠ¨è¿è¡Œæ‰€æœ‰æ ‡è®°ä¸º<code>@Test</code>çš„æ–¹æ³•ã€‚</p>
<p><code>@Range</code>æ³¨è§£ï¼Œæˆ‘ä»¬å¸Œæœ›ç”¨å®ƒæ¥å®šä¹‰ä¸€ä¸ª<code>String</code>å­—æ®µçš„è§„åˆ™ï¼šå­—æ®µé•¿åº¦æ»¡è¶³<code>@Range</code>çš„å‚æ•°å®šä¹‰ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Target(ElementType.FIELD)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Range &#123;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">min</span><span class="params">()</span> <span class="keyword">default</span> 0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">max</span><span class="params">()</span> <span class="keyword">default</span> 255</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Range(min=1, max=20)</span></span><br><span class="line">    <span class="keyword">public</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Range(max=10)</span></span><br><span class="line">    <span class="keyword">public</span> String city;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å®šä¹‰äº†æ³¨è§£ï¼Œæœ¬èº«å¯¹ç¨‹åºé€»è¾‘æ²¡æœ‰ä»»ä½•å½±å“ã€‚æˆ‘ä»¬å¿…é¡»è‡ªå·±ç¼–å†™ä»£ç æ¥ä½¿ç”¨æ³¨è§£ã€‚</p>
<p>ä¾‹å¦‚ï¼šç¼–å†™ä¸€ä¸ª<code>Person</code>å®ä¾‹çš„æ£€æŸ¥æ–¹æ³•ï¼Œå®ƒå¯ä»¥æ£€æŸ¥<code>Person</code>å®ä¾‹çš„<code>String</code>å­—æ®µé•¿åº¦æ˜¯å¦æ»¡è¶³<code>@Range</code>çš„å®šä¹‰ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">check</span><span class="params">(Person person)</span> <span class="keyword">throws</span> IllegalArgumentException, ReflectiveOperationException </span>&#123;</span><br><span class="line">    <span class="comment">// éå†æ‰€æœ‰Field:</span></span><br><span class="line">    <span class="keyword">for</span> (Field field : person.getClass().getFields()) &#123;</span><br><span class="line">        <span class="comment">// è·å–Fieldå®šä¹‰çš„@Range:</span></span><br><span class="line">        Range range = field.getAnnotation(Range.class);</span><br><span class="line">        <span class="comment">// å¦‚æœ@Rangeå­˜åœ¨:</span></span><br><span class="line">        <span class="keyword">if</span> (range != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">// è·å–Fieldçš„å€¼:</span></span><br><span class="line">            Object value = field.get(person);</span><br><span class="line">            <span class="comment">// å¦‚æœå€¼æ˜¯String:</span></span><br><span class="line">            <span class="keyword">if</span> (value <span class="keyword">instanceof</span> String) &#123;</span><br><span class="line">                String s = (String) value;</span><br><span class="line">                <span class="comment">// åˆ¤æ–­å€¼æ˜¯å¦æ»¡è¶³@Rangeçš„min/max:</span></span><br><span class="line">                <span class="keyword">if</span> (s.length() &lt; range.min() || s.length() &gt; range.max()) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">&quot;Invalid field: &quot;</span> + field.getName());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <tags>
        <tag>JAVA</tag>
      </tags>
  </entry>
  <entry>
    <title>JDBC</title>
    <url>/2021/05/10/JDBC/</url>
    <content><![CDATA[<h1 id="JDBC"><a href="#JDBC" class="headerlink" title="JDBC"></a>JDBC</h1><p>ä¸æ¶‰åŠSQLå†…å®¹ï¼Œå­¦ä¹ SQLçœ‹ï¼š</p>
<p>SQLæ•™ç¨‹ï¼š<a href="https://www.liaoxuefeng.com/wiki/1177760294764384">https://www.liaoxuefeng.com/wiki/1177760294764384</a></p>
<h2 id="1-JDBCç®€ä»‹"><a href="#1-JDBCç®€ä»‹" class="headerlink" title="1. JDBCç®€ä»‹"></a>1. JDBCç®€ä»‹</h2><p>JDBCï¼ŸJDBCæ˜¯Java DataBase Connectivityçš„ç¼©å†™ï¼Œå®ƒæ˜¯Javaç¨‹åºè®¿é—®æ•°æ®åº“çš„æ ‡å‡†æ¥å£ã€‚</p>
<p><img src="https://raw.githubusercontent.com/ghj1998/image_repository/main/image-20210510201125410.png" alt="image-20210510201125410"></p>
<p>ä½¿ç”¨JDBCçš„å¥½å¤„æ˜¯ï¼š</p>
<ul>
<li>å„æ•°æ®åº“å‚å•†ä½¿ç”¨ç›¸åŒçš„æ¥å£ï¼ŒJavaä»£ç ä¸éœ€è¦é’ˆå¯¹ä¸åŒæ•°æ®åº“åˆ†åˆ«å¼€å‘ï¼›</li>
<li>Javaç¨‹åºç¼–è¯‘æœŸä»…ä¾èµ–java.sqlåŒ…ï¼Œä¸ä¾èµ–å…·ä½“æ•°æ®åº“çš„jaråŒ…ï¼›</li>
<li>å¯éšæ—¶æ›¿æ¢åº•å±‚æ•°æ®åº“ï¼Œè®¿é—®æ•°æ®åº“çš„Javaä»£ç åŸºæœ¬ä¸å˜ã€‚</li>
</ul>
<h2 id="2-JDBCæŸ¥è¯¢"><a href="#2-JDBCæŸ¥è¯¢" class="headerlink" title="2. JDBCæŸ¥è¯¢"></a>2. JDBCæŸ¥è¯¢</h2><p>æ‰€è°“JDBCé©±åŠ¨ï¼Œå…¶å®å°±æ˜¯ä¸€ä¸ªç¬¬ä¸‰æ–¹jaråŒ…ï¼Œæˆ‘ä»¬ç›´æ¥æ·»åŠ ä¸€ä¸ªMavenä¾èµ–å°±å¯ä»¥äº†ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.47<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ä¾èµ–çš„<code>scope</code>æ˜¯<code>runtime</code>ï¼Œå› ä¸ºç¼–è¯‘Javaç¨‹åºå¹¶ä¸éœ€è¦MySQLçš„è¿™ä¸ªjaråŒ…ï¼Œåªæœ‰åœ¨è¿è¡ŒæœŸæ‰éœ€è¦ä½¿ç”¨ã€‚</p>
<h3 id="2-1-JDBCè¿æ¥"><a href="#2-1-JDBCè¿æ¥" class="headerlink" title="2.1 JDBCè¿æ¥"></a>2.1 JDBCè¿æ¥</h3><p><strong>Connection</strong>ä»£è¡¨ä¸€ä¸ªJDBCè¿æ¥ï¼Œå®ƒç›¸å½“äºJavaç¨‹åºåˆ°æ•°æ®åº“çš„è¿æ¥ï¼ˆé€šå¸¸æ˜¯TCPè¿æ¥ï¼‰ã€‚æ‰“å¼€ä¸€ä¸ªConnectionæ—¶ï¼Œéœ€è¦å‡†å¤‡URLã€ç”¨æˆ·åå’Œå£ä»¤ï¼Œæ‰èƒ½æˆåŠŸè¿æ¥åˆ°æ•°æ®åº“ã€‚</p>
<p>URLæ˜¯ç”±æ•°æ®åº“å‚å•†æŒ‡å®šçš„æ ¼å¼ï¼Œä¾‹å¦‚ï¼ŒMySQLçš„URLæ˜¯ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">jdbc:mysql://&lt;hostname&gt;:&lt;port&gt;/&lt;db&gt;?key1=value1&amp;key2=value2</span><br></pre></td></tr></table></figure>

<p>å‡è®¾æ•°æ®åº“è¿è¡Œåœ¨æœ¬æœº<code>localhost</code>ï¼Œç«¯å£ä½¿ç”¨æ ‡å‡†çš„<code>3306</code>ï¼Œæ•°æ®åº“åç§°æ˜¯<code>learnjdbc</code>ï¼Œé‚£ä¹ˆURLå¦‚ä¸‹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">jdbc:mysql://localhost:3306/learnjdbc?useSSL=false&amp;characterEncoding=utf8</span><br></pre></td></tr></table></figure>

<p>åé¢çš„ä¸¤ä¸ªå‚æ•°è¡¨ç¤ºä¸ä½¿ç”¨SSLåŠ å¯†ï¼Œä½¿ç”¨UTF-8ä½œä¸ºå­—ç¬¦ç¼–ç ï¼ˆæ³¨æ„MySQLçš„UTF-8æ˜¯<code>utf8</code>ï¼‰ã€‚</p>
<p>è·å–è¿æ¥ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// JDBCè¿æ¥çš„URL, ä¸åŒæ•°æ®åº“æœ‰ä¸åŒçš„æ ¼å¼:</span></span><br><span class="line">String JDBC_URL = <span class="string">&quot;jdbc:mysql://localhost:3306/test&quot;</span>;</span><br><span class="line">String JDBC_USER = <span class="string">&quot;root&quot;</span>;</span><br><span class="line">String JDBC_PASSWORD = <span class="string">&quot;password&quot;</span>;</span><br><span class="line"><span class="comment">// è·å–è¿æ¥:</span></span><br><span class="line">Connection conn = DriverManager.getConnection(JDBC_URL, JDBC_USER, JDBC_PASSWORD);</span><br><span class="line"><span class="comment">// <span class="doctag">TODO:</span> è®¿é—®æ•°æ®åº“...</span></span><br><span class="line"><span class="comment">// å…³é—­è¿æ¥:</span></span><br><span class="line">conn.close();</span><br></pre></td></tr></table></figure>

<p>æ ¸å¿ƒä»£ç æ˜¯<code>DriverManager</code>æä¾›çš„é™æ€æ–¹æ³•<code>getConnection()</code>ã€‚<code>DriverManager</code>ä¼šè‡ªåŠ¨æ‰«æclasspathï¼Œæ‰¾åˆ°æ‰€æœ‰çš„JDBCé©±åŠ¨ï¼Œç„¶åæ ¹æ®æˆ‘ä»¬ä¼ å…¥çš„URLè‡ªåŠ¨æŒ‘é€‰ä¸€ä¸ªåˆé€‚çš„é©±åŠ¨ã€‚</p>
<p>å› ä¸ºJDBCè¿æ¥æ˜¯ä¸€ç§æ˜‚è´µçš„èµ„æºï¼Œæ‰€ä»¥ä½¿ç”¨åè¦åŠæ—¶é‡Šæ”¾ã€‚ä½¿ç”¨<code>try (resource)</code>æ¥è‡ªåŠ¨é‡Šæ”¾JDBCè¿æ¥æ˜¯ä¸€ä¸ªå¥½æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span> (Connection conn = DriverManager.getConnection(JDBC_URL, JDBC_USER, JDBC_PASSWORD)) &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-2-JDBCæŸ¥è¯¢"><a href="#2-2-JDBCæŸ¥è¯¢" class="headerlink" title="2.2 JDBCæŸ¥è¯¢"></a>2.2 JDBCæŸ¥è¯¢</h3><p>ç¬¬ä¸€æ­¥ï¼Œé€šè¿‡<code>Connection</code>æä¾›çš„<code>createStatement()</code>æ–¹æ³•åˆ›å»ºä¸€ä¸ª<code>Statement</code>å¯¹è±¡ï¼Œç”¨äºæ‰§è¡Œä¸€ä¸ªæŸ¥è¯¢ï¼›</p>
<p>ç¬¬äºŒæ­¥ï¼Œæ‰§è¡Œ<code>Statement</code>å¯¹è±¡æä¾›çš„<code>executeQuery(&quot;SELECT * FROM students&quot;)</code>å¹¶ä¼ å…¥SQLè¯­å¥ï¼Œæ‰§è¡ŒæŸ¥è¯¢å¹¶è·å¾—è¿”å›çš„ç»“æœé›†ï¼Œä½¿ç”¨<code>ResultSet</code>æ¥å¼•ç”¨è¿™ä¸ªç»“æœé›†ï¼›</p>
<p>ç¬¬ä¸‰æ­¥ï¼Œåå¤è°ƒç”¨<code>ResultSet</code>çš„<code>next()</code>æ–¹æ³•å¹¶è¯»å–æ¯ä¸€è¡Œç»“æœã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span> (Connection conn = DriverManager.getConnection(JDBC_URL, JDBC_USER, JDBC_PASSWORD)) &#123;</span><br><span class="line">    <span class="keyword">try</span> (Statement stmt = conn.createStatement()) &#123;</span><br><span class="line">        <span class="keyword">try</span> (ResultSet rs = stmt.executeQuery(<span class="string">&quot;SELECT id, grade, name, gender FROM students WHERE gender=1&quot;</span>)) &#123;</span><br><span class="line">            <span class="keyword">while</span> (rs.next()) &#123;</span><br><span class="line">                <span class="keyword">long</span> id = rs.getLong(<span class="number">1</span>); <span class="comment">// æ³¨æ„ï¼šç´¢å¼•ä»1å¼€å§‹</span></span><br><span class="line">                <span class="keyword">long</span> grade = rs.getLong(<span class="number">2</span>);</span><br><span class="line">                String name = rs.getString(<span class="number">3</span>);</span><br><span class="line">                <span class="keyword">int</span> gender = rs.getInt(<span class="number">4</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>Statment</code>å’Œ<code>ResultSet</code>éƒ½æ˜¯éœ€è¦å…³é—­çš„èµ„æºï¼Œå› æ­¤åµŒå¥—ä½¿ç”¨<code>try (resource)</code>ç¡®ä¿åŠæ—¶å…³é—­ï¼›</p>
<p><code>rs.next()</code>ç”¨äºåˆ¤æ–­æ˜¯å¦æœ‰ä¸‹ä¸€è¡Œè®°å½•ï¼Œå¦‚æœæœ‰ï¼Œå°†è‡ªåŠ¨æŠŠå½“å‰è¡Œç§»åŠ¨åˆ°ä¸‹ä¸€è¡Œï¼ˆä¸€å¼€å§‹è·å¾—<code>ResultSet</code>æ—¶å½“å‰è¡Œä¸æ˜¯ç¬¬ä¸€è¡Œï¼‰ï¼›</p>
<p><code>ResultSet</code>è·å–åˆ—æ—¶ï¼Œç´¢å¼•ä»<code>1</code>å¼€å§‹è€Œä¸æ˜¯<code>0</code>ï¼›</p>
<p>å¿…é¡»æ ¹æ®<code>SELECT</code>çš„åˆ—çš„å¯¹åº”ä½ç½®æ¥è°ƒç”¨<code>getLong(1)</code>ï¼Œ<code>getString(2)</code>è¿™äº›æ–¹æ³•ï¼Œå¦åˆ™å¯¹åº”ä½ç½®çš„æ•°æ®ç±»å‹ä¸å¯¹ï¼Œå°†æŠ¥é”™ã€‚</p>
<h3 id="2-3-SQLæ³¨å…¥"><a href="#2-3-SQLæ³¨å…¥" class="headerlink" title="2.3 SQLæ³¨å…¥"></a>2.3 SQLæ³¨å…¥</h3><p>ä½¿ç”¨<code>Statement</code>æ‹¼å­—ç¬¦ä¸²éå¸¸å®¹æ˜“å¼•å‘SQLæ³¨å…¥çš„é—®é¢˜ã€‚</p>
<p>ä¾‹å¦‚ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function">User <span class="title">login</span><span class="params">(String name, String pass)</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    stmt.executeQuery(<span class="string">&quot;SELECT * FROM user WHERE login=&#x27;&quot;</span> + name + <span class="string">&quot;&#x27; AND pass=&#x27;&quot;</span> + pass + <span class="string">&quot;&#x27;&quot;</span>);</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="keyword">user</span> <span class="keyword">WHERE</span> login<span class="operator">=</span><span class="string">&#x27;bob&#x27;</span> <span class="keyword">AND</span> pass<span class="operator">=</span><span class="string">&#x27;1234&#x27;</span></span><br></pre></td></tr></table></figure>

<p>è¿™æ˜¯ä¸€ä¸ªæ­£ç¡®çš„è¾“å…¥ï¼Œä½†æ˜¯å¦‚æœç”¨æˆ·è¾“å…¥çš„æ˜¯ä¸€ä¸ªæ„é€ çš„å­—ç¬¦ä¸²ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="keyword">user</span> <span class="keyword">WHERE</span> login<span class="operator">=</span><span class="string">&#x27;bob&#x27;</span> <span class="keyword">OR</span> pass<span class="operator">=</span><span class="string">&#x27; AND pass=&#x27;</span> <span class="keyword">OR</span> pass<span class="operator">=</span><span class="string">&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªSQLè¯­å¥æ‰§è¡Œçš„æ—¶å€™ï¼Œæ ¹æœ¬ä¸ç”¨åˆ¤æ–­å£ä»¤æ˜¯å¦æ­£ç¡®ï¼Œè¿™æ ·ä¸€æ¥ï¼Œç™»å½•å°±å½¢åŒè™šè®¾ã€‚</p>
<p>ä½¿ç”¨<code>PreparedStatement</code>å¯ä»¥<em>å®Œå…¨é¿å…SQLæ³¨å…¥</em>çš„é—®é¢˜ï¼Œå› ä¸º<code>PreparedStatement</code>å§‹ç»ˆä½¿ç”¨<code>?</code>ä½œä¸ºå ä½ç¬¦ï¼Œå¹¶ä¸”æŠŠæ•°æ®è¿åŒSQLæœ¬èº«ä¼ ç»™æ•°æ®åº“ï¼Œè¿™æ ·å¯ä»¥ä¿è¯æ¯æ¬¡ä¼ ç»™æ•°æ®åº“çš„SQLè¯­å¥æ˜¯ç›¸åŒçš„ï¼Œåªæ˜¯å ä½ç¬¦çš„æ•°æ®ä¸åŒï¼Œè¿˜èƒ½é«˜æ•ˆåˆ©ç”¨æ•°æ®åº“æœ¬èº«å¯¹æŸ¥è¯¢çš„ç¼“å­˜ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function">User <span class="title">login</span><span class="params">(String name, String pass)</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    String sql = <span class="string">&quot;SELECT * FROM user WHERE login=? AND pass=?&quot;</span>;</span><br><span class="line">    PreparedStatement ps = conn.prepareStatement(sql);</span><br><span class="line">    ps.setObject(<span class="number">1</span>, name);</span><br><span class="line">    ps.setObject(<span class="number">2</span>, pass);</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¿®æ”¹ç¬¬ä¸€æ¬¡å†™çš„ä»£ç </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span> (Connection conn = DriverManager.getConnection(JDBC_URL, JDBC_USER, JDBC_PASSWORD)) &#123;</span><br><span class="line">    <span class="keyword">try</span> (PreparedStatement ps = conn.prepareStatement(<span class="string">&quot;SELECT id, grade, name, gender FROM students WHERE gender=? AND grade=?&quot;</span>)) &#123;</span><br><span class="line">        ps.setObject(<span class="number">1</span>, <span class="string">&quot;M&quot;</span>); <span class="comment">// æ³¨æ„ï¼šç´¢å¼•ä»1å¼€å§‹</span></span><br><span class="line">        ps.setObject(<span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line">        <span class="keyword">try</span> (ResultSet rs = ps.executeQuery()) &#123;</span><br><span class="line">            <span class="keyword">while</span> (rs.next()) &#123;</span><br><span class="line">                <span class="keyword">long</span> id = rs.getLong(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">                <span class="keyword">long</span> grade = rs.getLong(<span class="string">&quot;grade&quot;</span>);</span><br><span class="line">                String name = rs.getString(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">                String gender = rs.getString(<span class="string">&quot;gender&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-4-æ•°æ®ç±»å‹"><a href="#2-4-æ•°æ®ç±»å‹" class="headerlink" title="2.4 æ•°æ®ç±»å‹"></a>2.4 æ•°æ®ç±»å‹</h3><p>JDBCåœ¨<code>java.sql.Types</code>å®šä¹‰äº†ä¸€ç»„å¸¸é‡æ¥è¡¨ç¤ºå¦‚ä½•æ˜ å°„SQLæ•°æ®ç±»å‹ï¼Œä½†æ˜¯å¹³æ—¶æˆ‘ä»¬ä½¿ç”¨çš„ç±»å‹é€šå¸¸ä¹Ÿå°±ä»¥ä¸‹å‡ ç§ï¼š</p>
<table>
<thead>
<tr>
<th align="left">SQLæ•°æ®ç±»å‹</th>
<th align="left">Javaæ•°æ®ç±»å‹</th>
</tr>
</thead>
<tbody><tr>
<td align="left">BIT, BOOL</td>
<td align="left">boolean</td>
</tr>
<tr>
<td align="left">INTEGER</td>
<td align="left">int</td>
</tr>
<tr>
<td align="left">BIGINT</td>
<td align="left">long</td>
</tr>
<tr>
<td align="left">REAL</td>
<td align="left">float</td>
</tr>
<tr>
<td align="left">FLOAT, DOUBLE</td>
<td align="left">double</td>
</tr>
<tr>
<td align="left">CHAR, VARCHAR</td>
<td align="left">String</td>
</tr>
<tr>
<td align="left">DECIMAL</td>
<td align="left">BigDecimal</td>
</tr>
<tr>
<td align="left">DATE</td>
<td align="left">java.sql.Date, LocalDate</td>
</tr>
<tr>
<td align="left">TIME</td>
<td align="left">java.sql.Time, LocalTime</td>
</tr>
</tbody></table>
<p>æ³¨æ„ï¼šåªæœ‰æœ€æ–°çš„JDBCé©±åŠ¨æ‰æ”¯æŒ<code>LocalDate</code>å’Œ<code>LocalTime</code>ã€‚</p>
<h2 id="3-JDBCæ›´æ–°"><a href="#3-JDBCæ›´æ–°" class="headerlink" title="3. JDBCæ›´æ–°"></a>3. JDBCæ›´æ–°</h2><h3 id="3-1-æ’å…¥"><a href="#3-1-æ’å…¥" class="headerlink" title="3.1 æ’å…¥"></a>3.1 æ’å…¥</h3><p>é€šè¿‡JDBCè¿›è¡Œæ’å…¥ï¼Œæœ¬è´¨ä¸Šä¹Ÿæ˜¯ç”¨<code>PreparedStatement</code>æ‰§è¡Œä¸€æ¡SQLè¯­å¥ï¼Œä¸è¿‡æœ€åæ‰§è¡Œçš„ä¸æ˜¯<code>executeQuery()</code>ï¼Œè€Œæ˜¯<code>executeUpdate()</code>ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span> (Connection conn = DriverManager.getConnection(JDBC_URL, JDBC_USER, JDBC_PASSWORD)) &#123;</span><br><span class="line">    <span class="keyword">try</span> (PreparedStatement ps = conn.prepareStatement(</span><br><span class="line">            <span class="string">&quot;INSERT INTO students (id, grade, name, gender) VALUES (?,?,?,?)&quot;</span>)) &#123;</span><br><span class="line">        ps.setObject(<span class="number">1</span>, <span class="number">999</span>); <span class="comment">// æ³¨æ„ï¼šç´¢å¼•ä»1å¼€å§‹</span></span><br><span class="line">        ps.setObject(<span class="number">2</span>, <span class="number">1</span>); <span class="comment">// grade</span></span><br><span class="line">        ps.setObject(<span class="number">3</span>, <span class="string">&quot;Bob&quot;</span>); <span class="comment">// name</span></span><br><span class="line">        ps.setObject(<span class="number">4</span>, <span class="string">&quot;M&quot;</span>); <span class="comment">// gender</span></span><br><span class="line">        <span class="keyword">int</span> n = ps.executeUpdate(); <span class="comment">// 1</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-2-æ’å…¥å¹¶è·å–ä¸»é”®"><a href="#3-2-æ’å…¥å¹¶è·å–ä¸»é”®" class="headerlink" title="3.2 æ’å…¥å¹¶è·å–ä¸»é”®"></a>3.2 æ’å…¥å¹¶è·å–ä¸»é”®</h3><p>å¦‚æœæ•°æ®åº“çš„è¡¨è®¾ç½®äº†è‡ªå¢ä¸»é”®ï¼Œé‚£ä¹ˆåœ¨æ‰§è¡Œ<code>INSERT</code>è¯­å¥æ—¶ï¼Œå¹¶ä¸éœ€è¦æŒ‡å®šä¸»é”®ï¼Œæ•°æ®åº“ä¼šè‡ªåŠ¨åˆ†é…ä¸»é”®ã€‚</p>
<p>è‡ªå¢ä¸»é”®ï¼šæ’å…¥æ—¶å¯ä»¥æŠŠä¸»é”®æŒ‡å®šä¸ºNULLæˆ–è€…defaultï¼Œæ•°æ®åº“ä¼šæ ¹æ®è‡ªåŠ¨è®¾ç½®ä¸»é”®ä¸ºä¸»é”®åˆ—çš„æœ€å¤§å€¼+1ã€‚</p>
<p>è·å–è‡ªå¢ä¸»é”®çš„æ­£ç¡®å†™æ³•æ˜¯åœ¨åˆ›å»º<code>PreparedStatement</code>çš„æ—¶å€™ï¼ŒæŒ‡å®šä¸€ä¸ª<code>RETURN_GENERATED_KEYS</code>æ ‡å¿—ä½ï¼Œè¡¨ç¤ºJDBCé©±åŠ¨å¿…é¡»è¿”å›æ’å…¥çš„è‡ªå¢ä¸»é”®ã€‚ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span> (Connection conn = DriverManager.getConnection(JDBC_URL, JDBC_USER, JDBC_PASSWORD)) &#123;</span><br><span class="line">    <span class="keyword">try</span> (PreparedStatement ps = conn.prepareStatement(</span><br><span class="line">            <span class="string">&quot;INSERT INTO students (grade, name, gender) VALUES (?,?,?)&quot;</span>,</span><br><span class="line">            Statement.RETURN_GENERATED_KEYS)) &#123;</span><br><span class="line">        ps.setObject(<span class="number">1</span>, <span class="number">1</span>); <span class="comment">// grade</span></span><br><span class="line">        ps.setObject(<span class="number">2</span>, <span class="string">&quot;Bob&quot;</span>); <span class="comment">// name</span></span><br><span class="line">        ps.setObject(<span class="number">3</span>, <span class="string">&quot;M&quot;</span>); <span class="comment">// gender</span></span><br><span class="line">        <span class="keyword">int</span> n = ps.executeUpdate(); <span class="comment">// 1</span></span><br><span class="line">        <span class="keyword">try</span> (ResultSet rs = ps.getGeneratedKeys()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (rs.next()) &#123;</span><br><span class="line">                <span class="keyword">long</span> id = rs.getLong(<span class="number">1</span>); <span class="comment">// æ³¨æ„ï¼šç´¢å¼•ä»1å¼€å§‹</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸€æ˜¯è°ƒç”¨<code>prepareStatement()</code>æ—¶ï¼Œç¬¬äºŒä¸ªå‚æ•°å¿…é¡»ä¼ å…¥å¸¸é‡<code>Statement.RETURN_GENERATED_KEYS</code>ï¼Œå¦åˆ™JDBCé©±åŠ¨ä¸ä¼šè¿”å›è‡ªå¢ä¸»é”®ï¼›</p>
<p>äºŒæ˜¯æ‰§è¡Œ<code>executeUpdate()</code>æ–¹æ³•åï¼Œå¿…é¡»è°ƒç”¨<code>getGeneratedKeys()</code>è·å–ä¸€ä¸ª<code>ResultSet</code>å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡åŒ…å«äº†æ•°æ®åº“è‡ªåŠ¨ç”Ÿæˆçš„ä¸»é”®çš„å€¼ï¼Œè¯»å–è¯¥å¯¹è±¡çš„æ¯ä¸€è¡Œæ¥è·å–è‡ªå¢ä¸»é”®çš„å€¼ã€‚</p>
<p>å¦‚æœä¸€æ¬¡æ’å…¥å¤šæ¡è®°å½•ï¼Œé‚£ä¹ˆè¿™ä¸ª<code>ResultSet</code>å¯¹è±¡å°±ä¼šæœ‰å¤šè¡Œè¿”å›å€¼ã€‚å¦‚æœæ’å…¥æ—¶æœ‰å¤šåˆ—è‡ªå¢ï¼Œé‚£ä¹ˆ<code>ResultSet</code>å¯¹è±¡çš„æ¯ä¸€è¡Œéƒ½ä¼šå¯¹åº”å¤šä¸ªè‡ªå¢å€¼ï¼ˆè‡ªå¢åˆ—ä¸ä¸€å®šå¿…é¡»æ˜¯ä¸»é”®ï¼‰ã€‚</p>
<p><u>è‡ªå¢åˆ—å¿…é¡»æ˜¯é”®ï¼Œä½†ä¸ä¸€å®šéæ˜¯ä¸»é”®ã€‚</u></p>
<h3 id="3-3-æ›´æ–°"><a href="#3-3-æ›´æ–°" class="headerlink" title="3.3 æ›´æ–°"></a>3.3 æ›´æ–°</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span> (Connection conn = DriverManager.getConnection(JDBC_URL, JDBC_USER, JDBC_PASSWORD)) &#123;</span><br><span class="line">    <span class="keyword">try</span> (PreparedStatement ps = conn.prepareStatement(<span class="string">&quot;UPDATE students SET name=? WHERE id=?&quot;</span>)) &#123;</span><br><span class="line">        ps.setObject(<span class="number">1</span>, <span class="string">&quot;Bob&quot;</span>); <span class="comment">// æ³¨æ„ï¼šç´¢å¼•ä»1å¼€å§‹</span></span><br><span class="line">        ps.setObject(<span class="number">2</span>, <span class="number">999</span>);</span><br><span class="line">        <span class="keyword">int</span> n = ps.executeUpdate(); <span class="comment">// è¿”å›æ›´æ–°çš„è¡Œæ•°</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-4-åˆ é™¤"><a href="#3-4-åˆ é™¤" class="headerlink" title="3.4 åˆ é™¤"></a>3.4 åˆ é™¤</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span> (Connection conn = DriverManager.getConnection(JDBC_URL, JDBC_USER, JDBC_PASSWORD)) &#123;</span><br><span class="line">    <span class="keyword">try</span> (PreparedStatement ps = conn.prepareStatement(<span class="string">&quot;DELETE FROM students WHERE id=?&quot;</span>)) &#123;</span><br><span class="line">        ps.setObject(<span class="number">1</span>, <span class="number">999</span>); <span class="comment">// æ³¨æ„ï¼šç´¢å¼•ä»1å¼€å§‹</span></span><br><span class="line">        <span class="keyword">int</span> n = ps.executeUpdate(); <span class="comment">// åˆ é™¤çš„è¡Œæ•°</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="4-äº‹åŠ¡"><a href="#4-äº‹åŠ¡" class="headerlink" title="4. äº‹åŠ¡"></a>4. äº‹åŠ¡</h2><p>å…³äºäº‹åŠ¡çš„ACIDç‰¹æ€§ï¼Œä»¥åŠäº‹åŠ¡å¹¶å‘å¸¦æ¥çš„æ•°æ®ä¸ä¸€è‡´é—®é¢˜ï¼Œä»¥åŠåŠ é”ï¼Œè¿™é‡Œä¸è¿‡å¤šé˜è¿°ã€‚</p>
<p>è¦åœ¨JDBCä¸­æ‰§è¡Œäº‹åŠ¡ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯å¦‚ä½•æŠŠå¤šæ¡SQLåŒ…è£¹åœ¨ä¸€ä¸ªæ•°æ®åº“äº‹åŠ¡ä¸­æ‰§è¡Œã€‚æˆ‘ä»¬æ¥çœ‹JDBCçš„äº‹åŠ¡ä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Connection conn = openConnection();</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// å…³é—­è‡ªåŠ¨æäº¤:</span></span><br><span class="line">    conn.setAutoCommit(<span class="keyword">false</span>);</span><br><span class="line">    <span class="comment">// æ‰§è¡Œå¤šæ¡SQLè¯­å¥:</span></span><br><span class="line">    insert(); update(); delete();</span><br><span class="line">    <span class="comment">// æäº¤äº‹åŠ¡:</span></span><br><span class="line">    conn.commit();</span><br><span class="line">&#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">    <span class="comment">// å›æ»šäº‹åŠ¡:</span></span><br><span class="line">    conn.rollback();</span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    conn.setAutoCommit(<span class="keyword">true</span>);</span><br><span class="line">    conn.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¼€å¯äº‹åŠ¡çš„å…³é”®ä»£ç æ˜¯<code>conn.setAutoCommit(false)</code>ï¼Œè¡¨ç¤ºå…³é—­è‡ªåŠ¨æäº¤ã€‚æäº¤äº‹åŠ¡çš„ä»£ç åœ¨æ‰§è¡Œå®ŒæŒ‡å®šçš„è‹¥å¹²æ¡SQLè¯­å¥åï¼Œè°ƒç”¨<code>conn.commit()</code>ã€‚</p>
<p>å¦‚æœäº‹åŠ¡æäº¤å¤±è´¥ï¼Œä¼šæŠ›å‡ºSQLå¼‚å¸¸ï¼Œæ­¤æ—¶æˆ‘ä»¬å¿…é¡»æ•è·å¹¶è°ƒç”¨<code>conn.rollback()</code>å›æ»šäº‹åŠ¡ã€‚</p>
<p>è®¾å®šäº‹åŠ¡çš„éš”ç¦»çº§åˆ«ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹ä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è®¾å®šéš”ç¦»çº§åˆ«ä¸ºREAD COMMITTED:</span></span><br><span class="line">conn.setTransactionIsolation(Connection.TRANSACTION_READ_COMMITTED);</span><br></pre></td></tr></table></figure>

<p>SQLæ ‡å‡†å®šä¹‰äº†4ç§éš”ç¦»çº§åˆ«ï¼Œåˆ†åˆ«å¯¹åº”å¯èƒ½å‡ºç°çš„æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µï¼š</p>
<table>
<thead>
<tr>
<th align="left">Isolation Level</th>
<th align="left">è„è¯»ï¼ˆDirty Readï¼‰</th>
<th align="left">ä¸å¯é‡å¤è¯»ï¼ˆNon Repeatable Readï¼‰</th>
<th align="left">å¹»è¯»ï¼ˆPhantom Readï¼‰</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Read Uncommitted</td>
<td align="left">Yes</td>
<td align="left">Yes</td>
<td align="left">Yes</td>
</tr>
<tr>
<td align="left">Read Committed</td>
<td align="left">-</td>
<td align="left">Yes</td>
<td align="left">Yes</td>
</tr>
<tr>
<td align="left">Repeatable Read</td>
<td align="left">-</td>
<td align="left">-</td>
<td align="left">Yes</td>
</tr>
<tr>
<td align="left">Serializable</td>
<td align="left">-</td>
<td align="left">-</td>
<td align="left">-</td>
</tr>
</tbody></table>
<p><strong>è„è¯»</strong>ï¼šAäº‹åŠ¡è¯»å–Bäº‹åŠ¡å°šæœªæäº¤çš„æ•°æ®ï¼Œæ­¤æ—¶å¦‚æœBäº‹åŠ¡å‘ç”Ÿé”™è¯¯å¹¶æ‰§è¡Œå›æ»šæ“ä½œï¼Œé‚£ä¹ˆAäº‹åŠ¡è¯»å–åˆ°çš„æ•°æ®å°±æ˜¯è„æ•°æ®ã€‚</p>
<p><strong>ä¸å¯é‡å¤è¯»</strong>ï¼šäº‹åŠ¡Aåœ¨æ‰§è¡Œè¯»å–æ“ä½œï¼Œç”±æ•´ä¸ªäº‹åŠ¡Aæ¯”è¾ƒå¤§ï¼Œå‰åè¯»å–åŒä¸€æ¡æ•°æ®éœ€è¦ç»å†å¾ˆé•¿çš„æ—¶é—´ ã€‚è€Œåœ¨äº‹åŠ¡Aç¬¬ä¸€æ¬¡è¯»å–æ•°æ®ä¹‹åï¼Œæ•°æ®è¢«Bäº‹åŠ¡ä¿®æ”¹äº†ï¼ŒAç¬¬äºŒæ¬¡è¯»æ•°æ®å’Œç¬¬ä¸€æ¬¡ä¸ä¸€è‡´ã€‚</p>
<p><strong>å¹»è¯»</strong>ï¼šå‰åå¤šæ¬¡è¯»å–ï¼Œæ•°æ®æ€»é‡ä¸ä¸€è‡´ã€‚äº‹åŠ¡Aåœ¨æ‰§è¡Œè¯»å–æ“ä½œï¼Œéœ€è¦ä¸¤æ¬¡ç»Ÿè®¡æ•°æ®çš„æ€»é‡ï¼Œå‰ä¸€æ¬¡æŸ¥è¯¢æ•°æ®æ€»é‡åï¼Œæ­¤æ—¶äº‹åŠ¡Bæ‰§è¡Œäº†æ–°å¢æ•°æ®çš„æ“ä½œå¹¶æäº¤åï¼Œè¿™ä¸ªæ—¶å€™äº‹åŠ¡Aè¯»å–çš„æ•°æ®æ€»é‡å’Œä¹‹å‰ç»Ÿè®¡çš„ä¸ä¸€æ ·ï¼Œå°±åƒäº§ç”Ÿäº†å¹»è§‰ä¸€æ ·ã€‚</p>
<h2 id="5-JDBC-Batch"><a href="#5-JDBC-Batch" class="headerlink" title="5. JDBC Batch"></a>5. JDBC Batch</h2><p>ä¸€æ¬¡ä¿®æ”¹å¤šä¸ªæ•°æ®çš„ä»£ç </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> params : paramsList) &#123;</span><br><span class="line">    PreparedStatement ps = conn.preparedStatement(<span class="string">&quot;INSERT INTO coupons (user_id, type, expires) VALUES (?,?,?)&quot;</span>);</span><br><span class="line">    ps.setLong(params.get(<span class="number">0</span>));</span><br><span class="line">    ps.setString(params.get(<span class="number">1</span>));</span><br><span class="line">    ps.setString(params.get(<span class="number">2</span>));</span><br><span class="line">    ps.executeUpdate();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>SQLæ•°æ®åº“å¯¹SQLè¯­å¥ç›¸åŒï¼Œä½†åªæœ‰å‚æ•°ä¸åŒçš„è‹¥å¹²è¯­å¥å¯ä»¥ä½œä¸ºbatchæ‰§è¡Œï¼Œå³æ‰¹é‡æ‰§è¡Œï¼Œè¿™ç§æ“ä½œæœ‰ç‰¹åˆ«ä¼˜åŒ–ï¼Œé€Ÿåº¦è¿œè¿œå¿«äºå¾ªç¯æ‰§è¡Œæ¯ä¸ªSQLã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span> (PreparedStatement ps = conn.prepareStatement(<span class="string">&quot;INSERT INTO students (name, gender, grade, score) VALUES (?, ?, ?, ?)&quot;</span>)) &#123;</span><br><span class="line">    <span class="comment">// å¯¹åŒä¸€ä¸ªPreparedStatementåå¤è®¾ç½®å‚æ•°å¹¶è°ƒç”¨addBatch():</span></span><br><span class="line">    <span class="keyword">for</span> (Student s : students) &#123;</span><br><span class="line">        ps.setString(<span class="number">1</span>, s.name);</span><br><span class="line">        ps.setBoolean(<span class="number">2</span>, s.gender);</span><br><span class="line">        ps.setInt(<span class="number">3</span>, s.grade);</span><br><span class="line">        ps.setInt(<span class="number">4</span>, s.score);</span><br><span class="line">        ps.addBatch(); <span class="comment">// æ·»åŠ åˆ°batch</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æ‰§è¡Œbatch:</span></span><br><span class="line">    <span class="keyword">int</span>[] ns = ps.executeBatch();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> n : ns) &#123;</span><br><span class="line">        System.out.println(n + <span class="string">&quot; inserted.&quot;</span>); <span class="comment">// batchä¸­æ¯ä¸ªSQLæ‰§è¡Œçš„ç»“æœæ•°é‡</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>executeBatch()</code>ï¼Œå› ä¸ºæˆ‘ä»¬è®¾ç½®äº†å¤šç»„å‚æ•°ï¼Œç›¸åº”åœ°ï¼Œè¿”å›ç»“æœä¹Ÿæ˜¯å¤šä¸ª<code>int</code>å€¼ï¼Œå› æ­¤è¿”å›ç±»å‹æ˜¯<code>int[]</code>ï¼Œå¾ªç¯<code>int[]</code>æ•°ç»„å³å¯è·å–æ¯ç»„å‚æ•°æ‰§è¡Œåå½±å“çš„ç»“æœæ•°é‡ã€‚</p>
<h2 id="6-JDBCè¿æ¥æ± "><a href="#6-JDBCè¿æ¥æ± " class="headerlink" title="6. JDBCè¿æ¥æ± "></a>6. JDBCè¿æ¥æ± </h2><p>åœ¨æ‰§è¡ŒJDBCçš„å¢åˆ æ”¹æŸ¥çš„æ“ä½œæ—¶ï¼Œå¦‚æœæ¯ä¸€æ¬¡æ“ä½œéƒ½æ¥ä¸€æ¬¡æ‰“å¼€è¿æ¥ï¼Œæ“ä½œï¼Œå…³é—­è¿æ¥ï¼Œé‚£ä¹ˆåˆ›å»ºå’Œé”€æ¯JDBCè¿æ¥çš„å¼€é”€å°±å¤ªå¤§äº†ã€‚ä¸ºäº†é¿å…é¢‘ç¹åœ°åˆ›å»ºå’Œé”€æ¯JDBCè¿æ¥ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¿æ¥æ± ï¼ˆConnection Poolï¼‰å¤ç”¨å·²ç»åˆ›å»ºå¥½çš„è¿æ¥ã€‚</p>
<p>JDBCè¿æ¥æ± æœ‰ä¸€ä¸ªæ ‡å‡†çš„æ¥å£<code>javax.sql.DataSource</code>ï¼Œæ³¨æ„è¿™ä¸ªç±»ä½äºJavaæ ‡å‡†åº“ä¸­ï¼Œä½†ä»…ä»…æ˜¯æ¥å£ã€‚è¦ä½¿ç”¨JDBCè¿æ¥æ± ï¼Œæˆ‘ä»¬å¿…é¡»é€‰æ‹©ä¸€ä¸ªJDBCè¿æ¥æ± çš„å®ç°ã€‚å¸¸ç”¨çš„JDBCè¿æ¥æ± æœ‰ï¼š</p>
<ul>
<li>HikariCP</li>
<li>C3P0</li>
<li>BoneCP</li>
<li>Druid</li>
</ul>
<p>ç›®å‰ä½¿ç”¨æœ€å¹¿æ³›çš„æ˜¯HikariCPã€‚</p>
<p>è¦ä½¿ç”¨JDBCè¿æ¥æ± ï¼Œå…ˆæ·»åŠ HikariCPçš„ä¾èµ–å¦‚ä¸‹ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.zaxxer<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>HikariCP<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.7.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>åˆ›å»ºä¸€ä¸ª<code>DataSource</code>å®ä¾‹ï¼Œè¿™ä¸ªå®ä¾‹å°±æ˜¯è¿æ¥æ± ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">HikariConfig config = <span class="keyword">new</span> HikariConfig();</span><br><span class="line">config.setJdbcUrl(<span class="string">&quot;jdbc:mysql://localhost:3306/test&quot;</span>);</span><br><span class="line">config.setUsername(<span class="string">&quot;root&quot;</span>);</span><br><span class="line">config.setPassword(<span class="string">&quot;password&quot;</span>);</span><br><span class="line">config.addDataSourceProperty(<span class="string">&quot;connectionTimeout&quot;</span>, <span class="string">&quot;1000&quot;</span>); <span class="comment">// è¿æ¥è¶…æ—¶ï¼š1ç§’</span></span><br><span class="line">config.addDataSourceProperty(<span class="string">&quot;idleTimeout&quot;</span>, <span class="string">&quot;60000&quot;</span>); <span class="comment">// ç©ºé—²è¶…æ—¶ï¼š60ç§’</span></span><br><span class="line">config.addDataSourceProperty(<span class="string">&quot;maximumPoolSize&quot;</span>, <span class="string">&quot;10&quot;</span>); <span class="comment">// æœ€å¤§è¿æ¥æ•°ï¼š10</span></span><br><span class="line">DataSource ds = <span class="keyword">new</span> HikariDataSource(config);</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„åˆ›å»º<code>DataSource</code>ä¹Ÿæ˜¯ä¸€ä¸ªéå¸¸æ˜‚è´µçš„æ“ä½œï¼Œæ‰€ä»¥é€šå¸¸<code>DataSource</code>å®ä¾‹æ€»æ˜¯ä½œä¸ºä¸€ä¸ªå…¨å±€å˜é‡å­˜å‚¨ï¼Œå¹¶è´¯ç©¿æ•´ä¸ªåº”ç”¨ç¨‹åºçš„ç”Ÿå‘½å‘¨æœŸã€‚</p>
<p>æœ‰äº†è¿æ¥æ± ä»¥åï¼Œæˆ‘ä»¬å¦‚ä½•ä½¿ç”¨å®ƒå‘¢ï¼Ÿå’Œå‰é¢çš„ä»£ç ç±»ä¼¼ï¼Œåªæ˜¯è·å–<code>Connection</code>æ—¶ï¼ŒæŠŠ<code>DriverManage.getConnection()</code>æ”¹ä¸º<code>ds.getConnection()</code>ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span> (Connection conn = ds.getConnection()) &#123; <span class="comment">// åœ¨æ­¤è·å–è¿æ¥</span></span><br><span class="line">    ...</span><br><span class="line">&#125; <span class="comment">// åœ¨æ­¤â€œå…³é—­â€è¿æ¥</span></span><br></pre></td></tr></table></figure>

<p>ä¸€å¼€å§‹ï¼Œè¿æ¥æ± å†…éƒ¨å¹¶æ²¡æœ‰è¿æ¥ï¼Œæ‰€ä»¥ï¼Œç¬¬ä¸€æ¬¡è°ƒç”¨<code>ds.getConnection()</code>ï¼Œä¼šè¿«ä½¿è¿æ¥æ± å†…éƒ¨å…ˆåˆ›å»ºä¸€ä¸ª<code>Connection</code>ï¼Œå†è¿”å›ç»™å®¢æˆ·ç«¯ä½¿ç”¨ã€‚å½“æˆ‘ä»¬è°ƒç”¨<code>conn.close()</code>æ–¹æ³•æ—¶ï¼ˆ<code>åœ¨try(resource)&#123;...&#125;</code>ç»“æŸå¤„ï¼‰ï¼Œä¸æ˜¯çœŸæ­£â€œå…³é—­â€è¿æ¥ï¼Œè€Œæ˜¯é‡Šæ”¾åˆ°è¿æ¥æ± ä¸­ï¼Œä»¥ä¾¿ä¸‹æ¬¡è·å–è¿æ¥æ—¶èƒ½ç›´æ¥è¿”å›ã€‚</p>
]]></content>
      <tags>
        <tag>JAVA</tag>
        <tag>JDBC</tag>
        <tag>æ•°æ®åº“</tag>
      </tags>
  </entry>
  <entry>
    <title>Lambdaå­¦ä¹ </title>
    <url>/2021/05/03/Lambda%E5%AD%A6%E4%B9%A0/</url>
    <content><![CDATA[<h1 id="LambdaåŸºç¡€"><a href="#LambdaåŸºç¡€" class="headerlink" title="LambdaåŸºç¡€"></a>LambdaåŸºç¡€</h1><h2 id="1-å‡½æ•°å¼ç¼–ç¨‹"><a href="#1-å‡½æ•°å¼ç¼–ç¨‹" class="headerlink" title="1. å‡½æ•°å¼ç¼–ç¨‹"></a>1. å‡½æ•°å¼ç¼–ç¨‹</h2><p>å‡½æ•°å¼ç¼–ç¨‹æŠŠå‡½æ•°ä½œä¸ºåŸºæœ¬è¿ç®—å•å…ƒï¼Œå‡½æ•°å¯ä»¥ä½œä¸ºå˜é‡ï¼Œå¯ä»¥æ¥å—å‡½æ•°ï¼Œå¯ä»¥è¿”å›å‡½æ•°ã€‚<em>å¸¸æŠŠæ”¯æŒå‡½æ•°å¼ç¼–ç¨‹çš„é£æ ¼ç­–åˆ’å½’çº³ä¸ºLambdaè¡¨è¾¾å¼</em></p>
<h2 id="2-Lambdaè¡¨è¾¾å¼"><a href="#2-Lambdaè¡¨è¾¾å¼" class="headerlink" title="2. Lambdaè¡¨è¾¾å¼"></a>2. Lambdaè¡¨è¾¾å¼</h2><p>å•æ–¹æ³•æ¥å£ï¼šä¸€ä¸ªæ¥å£åªå®šä¹‰äº†ä¸€ä¸ªæ–¹æ³•ï¼š</p>
<ul>
<li>Comparator</li>
<li>Runnable</li>
<li>Callable</li>
</ul>
<p>ä¾‹å¦‚ï¼Œè°ƒç”¨<code>Arrays.sort()</code>æ—¶ï¼Œå¯ä»¥ä¼ å…¥ä¸€ä¸ª<code>Comparator</code>å®ä¾‹ï¼Œä»¥å‰çš„å†™æ³•æ˜¯ä½¿ç”¨åŒ¿åç±»ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">String[] array = ...</span><br><span class="line">Arrays.sort(array, <span class="keyword">new</span> Comparator&lt;String&gt;() &#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compare</span><span class="params">(String s1, String s2)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> s1.compareTo(s2);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>è¾ƒä¸ºç¹çï¼ŒJAVA 8 å¼€å§‹å¼•å…¥äº†Lambdaè¡¨è¾¾å¼æ¥æ›¿æ¢<strong>å•æ–¹æ³•æ¥å£</strong>ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String[] array = <span class="keyword">new</span> String[] &#123; <span class="string">&quot;Apple&quot;</span>, <span class="string">&quot;Orange&quot;</span>, <span class="string">&quot;Banana&quot;</span>, <span class="string">&quot;Lemon&quot;</span> &#125;;</span><br><span class="line">        Arrays.sort(array, (s1, s2) -&gt; &#123;</span><br><span class="line">            <span class="keyword">return</span> s1.compareTo(s2);</span><br><span class="line">        &#125;);</span><br><span class="line">        System.out.println(String.join(<span class="string">&quot;, &quot;</span>, array));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">(s1, s2) -&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> s1.compareTo(s2);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‹¬å·å†…æ˜¯å‚æ•°ï¼Œå‚æ•°ç±»å‹å¯ä»¥å¿½ç•¥ã€‚<code>-&gt;&#123;&#125;</code>è¡¨ç¤ºæ–¹æ³•ä½“ã€‚</p>
<p>å¦‚æœåªæœ‰ä¸€è¡Œï¼Œå¯ä»¥çœç•¥å¤§æ‹¬å·ä»¥åŠ<code>return</code>ã€‚</p>
<p>ä¾‹å¦‚ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Arrays.sort(array, (s1, s2) -&gt; s1.compareTo(s2));</span><br></pre></td></tr></table></figure>

<h2 id="3-FunctionalInterface"><a href="#3-FunctionalInterface" class="headerlink" title="3. FunctionalInterface"></a>3. FunctionalInterface</h2><p>åªå®šä¹‰äº†å•æ–¹æ³•çš„æ¥å£ç§°ä¹‹ä¸º<code>FunctionalInterface</code>ï¼Œç”¨æ³¨è§£<code>@FunctionalInterface</code>æ ‡è®°ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Callable</span>&lt;<span class="title">V</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function">V <span class="title">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¥å£ä¸­çš„<code>static</code>æ–¹æ³•å’Œ<code>default</code>æ–¹æ³•ä¸è¢«<code>FunctionalInterface</code>è®¡ç®—åœ¨å†…ã€‚</p>
<p><code>Object</code>å®šä¹‰çš„æ–¹æ³•ä¹Ÿä¸ç®—åœ¨æ¥å£æ–¹æ³•å†…ã€‚</p>
<p>ä¾‹å¦‚<code>Comparator</code>ä¹Ÿæ˜¯<code>FunctionalInterface</code>ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Comparator</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">compare</span><span class="params">(T o1, T o2)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object obj)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">default</span> Comparator&lt;T&gt; <span class="title">reversed</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Collections.reverseOrder(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">default</span> Comparator&lt;T&gt; <span class="title">thenComparing</span><span class="params">(Comparator&lt;? <span class="keyword">super</span> T&gt; other)</span> </span>&#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="4-æ–¹æ³•å¼•ç”¨"><a href="#4-æ–¹æ³•å¼•ç”¨" class="headerlink" title="4. æ–¹æ³•å¼•ç”¨"></a>4. æ–¹æ³•å¼•ç”¨</h2><p>æ–¹æ³•å¼•ç”¨ï¼šå¦‚æœæŸä¸ªæ–¹æ³•ç­¾åå’Œæ¥å£æ°å¥½ä¸€è‡´ï¼Œå°±å¯ä»¥ç›´æ¥ä¼ å…¥æ–¹æ³•å¼•ç”¨ã€‚</p>
<p>æ³¨æ„ï¼šåœ¨è¿™é‡Œï¼Œæ–¹æ³•ç­¾ååªçœ‹<strong>å‚æ•°ç±»å‹å’Œè¿”å›ç±»å‹</strong>ï¼Œ<strong>ä¸çœ‹æ–¹æ³•åç§°ï¼Œä¹Ÿä¸çœ‹ç±»çš„ç»§æ‰¿å…³ç³»ã€‚</strong></p>
<p><strong>å¼•ç”¨é™æ€æ–¹æ³•</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String[] array = <span class="keyword">new</span> String[] &#123; <span class="string">&quot;Apple&quot;</span>, <span class="string">&quot;Orange&quot;</span>, <span class="string">&quot;Banana&quot;</span>, <span class="string">&quot;Lemon&quot;</span> &#125;;</span><br><span class="line">        Arrays.sort(array, Main::cmp);</span><br><span class="line">        System.out.println(String.join(<span class="string">&quot;, &quot;</span>, array));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">cmp</span><span class="params">(String s1, String s2)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> s1.compareTo(s2);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>Arrays.sort()</code>ä¸­ç›´æ¥ä¼ å…¥äº†é™æ€æ–¹æ³•<code>cmp</code>çš„å¼•ç”¨ï¼Œç”¨<code>Main::cmp</code>è¡¨ç¤ºã€‚</p>
<p>å› ä¸º<code>Comparator&lt;String&gt;</code>æ¥å£å®šä¹‰çš„æ–¹æ³•æ˜¯<code>int compare(String, String)</code>ï¼Œå’Œé™æ€æ–¹æ³•<code>int cmp(String, String)</code>ç›¸æ¯”ï¼Œé™¤äº†æ–¹æ³•åå¤–ï¼Œæ–¹æ³•å‚æ•°ä¸€è‡´ï¼Œè¿”å›ç±»å‹ç›¸åŒï¼Œå› æ­¤ï¼Œæˆ‘ä»¬è¯´ä¸¤è€…çš„æ–¹æ³•ç­¾åä¸€è‡´ï¼Œå¯ä»¥ç›´æ¥æŠŠæ–¹æ³•åä½œä¸ºLambdaè¡¨è¾¾å¼ä¼ å…¥ã€‚</p>
<p><strong>å¼•ç”¨å®ä¾‹æ–¹æ³•</strong></p>
<p>å®ä¾‹æ–¹æ³•æœ‰ä¸€ä¸ªéšå«çš„<code>this</code>å‚æ•°ï¼Œ<code>String</code>ç±»çš„<code>compareTo()</code>æ–¹æ³•åœ¨å®é™…è°ƒç”¨çš„æ—¶å€™ï¼Œç¬¬ä¸€ä¸ªéšå«å‚æ•°æ€»æ˜¯ä¼ å…¥<code>this</code>ï¼Œç›¸å½“äºé™æ€æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(<span class="keyword">this</span>, String o)</span></span>;</span><br></pre></td></tr></table></figure>

<p>æ‰€ä»¥å¼•ç”¨å®ä¾‹æ–¹æ³•å¯ä»¥è¿™ä¹ˆå†™ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String[] array = <span class="keyword">new</span> String[] &#123; <span class="string">&quot;Apple&quot;</span>, <span class="string">&quot;Orange&quot;</span>, <span class="string">&quot;Banana&quot;</span>, <span class="string">&quot;Lemon&quot;</span> &#125;;</span><br><span class="line">        Arrays.sort(array, String::compareTo);</span><br><span class="line">        System.out.println(String.join(<span class="string">&quot;, &quot;</span>, array));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>æ„é€ æ–¹æ³•å¼•ç”¨</strong></p>
<p>å¦‚æœè¦æŠŠä¸€ä¸ª<code>List&lt;String&gt;</code>è½¬æ¢ä¸º<code>List&lt;Person&gt;</code>ã€‚</p>
<p>ä¼ ç»Ÿçš„åšæ³•æ˜¯ï¼šå®šä¹‰ä¸€ä¸ª<code>ArrayList&lt;Person&gt;</code>ï¼Œç„¶åç”¨<code>for</code>å¾ªç¯å¡«å……è¿™ä¸ª<code>List</code>ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">List&lt;String&gt; names = List.of(<span class="string">&quot;Bob&quot;</span>, <span class="string">&quot;Alice&quot;</span>, <span class="string">&quot;Tim&quot;</span>);</span><br><span class="line">List&lt;Person&gt; persons = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"><span class="keyword">for</span> (String name : names) &#123;</span><br><span class="line">    persons.add(<span class="keyword">new</span> Person(name));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨æ„é€ æ–¹æ³•çš„è¯ï¼Œå¯ä»¥æ”¹å†™æˆï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        List&lt;String&gt; names = List.of(<span class="string">&quot;Bob&quot;</span>, <span class="string">&quot;Alice&quot;</span>, <span class="string">&quot;Tim&quot;</span>);</span><br><span class="line">        List&lt;Person&gt; persons = names.stream().map(Person::<span class="keyword">new</span>).collect(Collectors.toList());</span><br><span class="line">        System.out.println(persons);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    String name;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Person</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Person:&quot;</span> + <span class="keyword">this</span>.name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>mapç¬”è®°è§ï¼š<a href="https://ghj1998.github.io/2021/05/03/%E4%BD%BF%E7%94%A8Stream">mapå­¦ä¹ </a></p>
</blockquote>
<p><code>map()</code>éœ€è¦ä¼ å…¥çš„FunctionalInterfaceçš„å®šä¹‰æ˜¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Function</span>&lt;<span class="title">T</span>, <span class="title">R</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function">R <span class="title">apply</span><span class="params">(T t)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æŠŠæ³›å‹å¯¹åº”ä¸Šå°±æ˜¯æ–¹æ³•ç­¾å<code>Person apply(String)</code>ï¼Œå³ä¼ å…¥å‚æ•°<code>String</code>ï¼Œè¿”å›ç±»å‹<code>Person</code>ã€‚è€Œ<code>Person</code>ç±»çš„æ„é€ æ–¹æ³•æ°å¥½æ»¡è¶³è¿™ä¸ªæ¡ä»¶ï¼Œå› ä¸ºæ„é€ æ–¹æ³•çš„å‚æ•°æ˜¯<code>String</code>ï¼Œè€Œæ„é€ æ–¹æ³•è™½ç„¶æ²¡æœ‰<code>return</code>è¯­å¥ï¼Œä½†å®ƒä¼šéšå¼åœ°è¿”å›<code>this</code>å®ä¾‹ï¼Œç±»å‹å°±æ˜¯<code>Person</code>ï¼Œå› æ­¤ï¼Œæ­¤å¤„å¯ä»¥å¼•ç”¨æ„é€ æ–¹æ³•ã€‚æ„é€ æ–¹æ³•çš„å¼•ç”¨å†™æ³•æ˜¯<code>ç±»å::new</code>ï¼Œå› æ­¤ï¼Œæ­¤å¤„ä¼ å…¥<code>Person::new</code>ã€‚</p>
]]></content>
      <tags>
        <tag>JAVA</tag>
      </tags>
  </entry>
  <entry>
    <title>Mybatisæ¡†æ¶</title>
    <url>/2021/05/04/Mybatis%E6%A1%86%E6%9E%B6/</url>
    <content><![CDATA[]]></content>
  </entry>
  <entry>
    <title>Springæ¡†æ¶</title>
    <url>/2021/05/04/Spring%E6%A1%86%E6%9E%B6/</url>
    <content><![CDATA[]]></content>
  </entry>
  <entry>
    <title>ä½¿ç”¨Stream</title>
    <url>/2021/05/03/%E4%BD%BF%E7%94%A8Stream/</url>
    <content><![CDATA[<h1 id="Stream"><a href="#Stream" class="headerlink" title="Stream"></a>Stream</h1><h2 id="1-Streamç®€ä»‹"><a href="#1-Streamç®€ä»‹" class="headerlink" title="1. Streamç®€ä»‹"></a>1. Streamç®€ä»‹</h2><p>Streamä»£è¡¨çš„æ˜¯ä»»æ„Javaå¯¹è±¡çš„åºåˆ—ã€‚<code>Stream</code>å®ç°çš„æ˜¯æƒ°æ€§è®¡ç®—.</p>
<table>
<thead>
<tr>
<th align="left"></th>
<th align="left">java.io</th>
<th>java.util.stream</th>
</tr>
</thead>
<tbody><tr>
<td align="left">å­˜å‚¨</td>
<td align="left">é¡ºåºè¯»å†™çš„<code>byte</code>æˆ–<code>char</code></td>
<td>é¡ºåºè¾“å‡ºçš„ä»»æ„Javaå¯¹è±¡å®ä¾‹</td>
</tr>
<tr>
<td align="left">ç”¨é€”</td>
<td align="left">åºåˆ—åŒ–è‡³æ–‡ä»¶æˆ–ç½‘ç»œ</td>
<td>å†…å­˜è®¡ç®—ï¼ä¸šåŠ¡é€»è¾‘</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th align="left"></th>
<th align="left">java.util.List</th>
<th>java.util.stream</th>
</tr>
</thead>
<tbody><tr>
<td align="left">å…ƒç´ </td>
<td align="left">å·²åˆ†é…å¹¶å­˜å‚¨åœ¨å†…å­˜</td>
<td>å¯èƒ½æœªåˆ†é…ï¼Œå®æ—¶è®¡ç®—</td>
</tr>
<tr>
<td align="left">ç”¨é€”</td>
<td align="left">æ“ä½œä¸€ç»„å·²å­˜åœ¨çš„Javaå¯¹è±¡</td>
<td>æƒ°æ€§è®¡ç®—</td>
</tr>
</tbody></table>
<p>lä¾‹å¦‚ï¼šæˆ‘ä»¬æ— æ³•ç”¨Listè¡¨ç¤ºå…¨éƒ¨è‡ªç„¶æ•°ï¼Œä½†æ˜¯ç”¨Streamå¯ä»¥ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Stream&lt;BigInteger&gt; naturals = createNaturalStream(); <span class="comment">// å…¨ä½“è‡ªç„¶æ•°</span></span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¯ä»¥å¯¹æ¯ä¸ªè‡ªç„¶æ•°åšä¸€ä¸ªå¹³æ–¹ï¼Œè¿™æ ·æˆ‘ä»¬å°±æŠŠè¿™ä¸ª<code>Stream</code>è½¬æ¢æˆäº†å¦ä¸€ä¸ª<code>Stream</code>ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Stream&lt;BigInteger&gt; naturals = createNaturalStream(); <span class="comment">// å…¨ä½“è‡ªç„¶æ•°</span></span><br><span class="line">Stream&lt;BigInteger&gt; streamNxN = naturals.map(n -&gt; n.multiply(n)); <span class="comment">// å…¨ä½“è‡ªç„¶æ•°çš„å¹³æ–¹</span></span><br></pre></td></tr></table></figure>

<p>å¯ä»¥ç”¨<code>limit()</code> æˆªå–æ•°æ®ï¼ŒåŒæ—¶å¯ä»¥ä½¿ç”¨<code>forEach()</code>æ¥å¤„ç†æ¯ä¸ªå…ƒç´ ã€‚</p>
<p><code>Stream</code>çš„å¦ä¸€ä¸ªç‰¹ç‚¹æ˜¯ï¼Œä¸€ä¸ª<code>Stream</code>å¯ä»¥è½»æ˜“åœ°è½¬æ¢ä¸ºå¦ä¸€ä¸ª<code>Stream</code>ï¼Œè€Œä¸æ˜¯ä¿®æ”¹åŸ<code>Stream</code>æœ¬èº«ã€‚çœŸæ­£çš„è®¡ç®—é€šå¸¸å‘ç”Ÿåœ¨æœ€åç»“æœçš„è·å–ï¼Œä¹Ÿå°±æ˜¯æƒ°æ€§è®¡ç®—ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Stream&lt;BigInteger&gt; naturals = createNaturalStream(); <span class="comment">// ä¸è®¡ç®—</span></span><br><span class="line">Stream&lt;BigInteger&gt; s2 = naturals.map(BigInteger::multiply); <span class="comment">// ä¸è®¡ç®—</span></span><br><span class="line">Stream&lt;BigInteger&gt; s3 = s2.limit(<span class="number">100</span>); <span class="comment">// ä¸è®¡ç®—</span></span><br><span class="line">s3.forEach(System.out::println); <span class="comment">// è®¡ç®—</span></span><br></pre></td></tr></table></figure>

<p>Stream APIçš„åŸºæœ¬ç”¨æ³•å°±æ˜¯ï¼šåˆ›å»ºä¸€ä¸ª<code>Stream</code>ï¼Œç„¶ååšè‹¥å¹²æ¬¡è½¬æ¢ï¼Œæœ€åè°ƒç”¨ä¸€ä¸ªæ±‚å€¼æ–¹æ³•è·å–çœŸæ­£è®¡ç®—çš„ç»“æœï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">int</span> result = createNaturalStream() <span class="comment">// åˆ›å»ºStream</span></span><br><span class="line">             .filter(n -&gt; n % <span class="number">2</span> == <span class="number">0</span>) <span class="comment">// ä»»æ„ä¸ªè½¬æ¢</span></span><br><span class="line">             .map(n -&gt; n * n) <span class="comment">// ä»»æ„ä¸ªè½¬æ¢</span></span><br><span class="line">             .limit(<span class="number">100</span>) <span class="comment">// ä»»æ„ä¸ªè½¬æ¢</span></span><br><span class="line">             .sum(); <span class="comment">// æœ€ç»ˆè®¡ç®—ç»“æœ</span></span><br></pre></td></tr></table></figure>

<h2 id="2-åˆ›å»ºStream"><a href="#2-åˆ›å»ºStream" class="headerlink" title="2. åˆ›å»ºStream"></a>2. åˆ›å»ºStream</h2><p><strong>Stream.of()</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Stream&lt;String&gt; stream = Stream.of(<span class="string">&quot;A&quot;</span>, <span class="string">&quot;B&quot;</span>, <span class="string">&quot;C&quot;</span>, <span class="string">&quot;D&quot;</span>);</span><br><span class="line">        <span class="comment">// forEach()æ–¹æ³•ç›¸å½“äºå†…éƒ¨å¾ªç¯è°ƒç”¨ï¼Œ</span></span><br><span class="line">        <span class="comment">// å¯ä¼ å…¥ç¬¦åˆConsumeræ¥å£çš„void accept(T t)çš„æ–¹æ³•å¼•ç”¨ï¼š</span></span><br><span class="line">        stream.forEach(System.out::println);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>åŸºäºæ•°ç»„æˆ–è€…Collection</strong></p>
<p>åˆ›å»º<code>Stream</code>çš„æ–¹æ³•æ˜¯åŸºäºä¸€ä¸ªæ•°ç»„æˆ–è€…<code>Collection</code>ï¼Œè¿™æ ·è¯¥<code>Stream</code>è¾“å‡ºçš„å…ƒç´ å°±æ˜¯æ•°ç»„æˆ–è€…<code>Collection</code>æŒæœ‰çš„å…ƒç´ ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Stream&lt;String&gt; stream1 = Arrays.stream(<span class="keyword">new</span> String[] &#123; <span class="string">&quot;A&quot;</span>, <span class="string">&quot;B&quot;</span>, <span class="string">&quot;C&quot;</span> &#125;);</span><br><span class="line">        Stream&lt;String&gt; stream2 = List.of(<span class="string">&quot;X&quot;</span>, <span class="string">&quot;Y&quot;</span>, <span class="string">&quot;Z&quot;</span>).stream();</span><br><span class="line">        stream1.forEach(System.out::println);</span><br><span class="line">        stream2.forEach(System.out::println);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æŠŠæ•°ç»„å˜æˆ<code>Stream</code>ä½¿ç”¨<code>Arrays.stream()</code>æ–¹æ³•ã€‚</p>
<p>å¯¹äº<code>Collection</code>ï¼ˆ<code>List</code>ã€<code>Set</code>ã€<code>Queue</code>ç­‰ï¼‰ï¼Œç›´æ¥è°ƒç”¨<code>stream()</code>æ–¹æ³•å°±å¯ä»¥è·å¾—<code>Stream</code>ã€‚</p>
<p><strong>åŸºäºSupplier</strong></p>
<p>åˆ›å»º<code>Stream</code>è¿˜å¯ä»¥é€šè¿‡<code>Stream.generate()</code>æ–¹æ³•ï¼Œå®ƒéœ€è¦ä¼ å…¥ä¸€ä¸ª<code>Supplier</code>å¯¹è±¡ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Stream&lt;String&gt; s = Stream.generate(Supplier&lt;String&gt; sp);</span><br></pre></td></tr></table></figure>

<p>åŸºäº<code>Supplier</code>åˆ›å»ºçš„<code>Stream</code>ä¼šä¸æ–­è°ƒç”¨<code>Supplier.get()</code>æ–¹æ³•æ¥ä¸æ–­äº§ç”Ÿä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œè¿™ç§<code>Stream</code>ä¿å­˜çš„ä¸æ˜¯å…ƒç´ ï¼Œè€Œæ˜¯ç®—æ³•ï¼Œå®ƒå¯ä»¥ç”¨æ¥è¡¨ç¤ºæ— é™åºåˆ—ã€‚</p>
<p>ä¾‹å¦‚ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Stream&lt;Integer&gt; natual = Stream.generate(<span class="keyword">new</span> NatualSupplier());</span><br><span class="line">        <span class="comment">// æ³¨æ„ï¼šæ— é™åºåˆ—å¿…é¡»å…ˆå˜æˆæœ‰é™åºåˆ—å†æ‰“å°:</span></span><br><span class="line">        natual.limit(<span class="number">20</span>).forEach(System.out::println);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NatualSupplier</span> <span class="keyword">implements</span> <span class="title">Supplier</span>&lt;<span class="title">Integer</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n = <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">get</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        n++;</span><br><span class="line">        <span class="keyword">return</span> n;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>å…¶ä»–æ–¹æ³•</strong></p>
<p>åˆ›å»º<code>Stream</code>çš„ç¬¬ä¸‰ç§æ–¹æ³•æ˜¯é€šè¿‡ä¸€äº›APIæä¾›çš„æ¥å£ï¼Œç›´æ¥è·å¾—<code>Stream</code>ã€‚</p>
<p>ä¾‹å¦‚ï¼Œ<code>Files</code>ç±»çš„<code>lines()</code>æ–¹æ³•å¯ä»¥æŠŠä¸€ä¸ªæ–‡ä»¶å˜æˆä¸€ä¸ª<code>Stream</code>ï¼Œæ¯ä¸ªå…ƒç´ ä»£è¡¨æ–‡ä»¶çš„ä¸€è¡Œå†…å®¹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span> (Stream&lt;String&gt; lines = Files.lines(Paths.get(<span class="string">&quot;/path/to/file.txt&quot;</span>))) &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ­£åˆ™è¡¨è¾¾å¼çš„<code>Pattern</code>å¯¹è±¡æœ‰ä¸€ä¸ª<code>splitAsStream()</code>æ–¹æ³•ï¼Œå¯ä»¥ç›´æ¥æŠŠä¸€ä¸ªé•¿å­—ç¬¦ä¸²åˆ†å‰²æˆ<code>Stream</code>åºåˆ—è€Œä¸æ˜¯æ•°ç»„ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Pattern p = Pattern.compile(<span class="string">&quot;\\s+&quot;</span>);</span><br><span class="line">Stream&lt;String&gt; s = p.splitAsStream(<span class="string">&quot;The quick brown fox jumps over the lazy dog&quot;</span>);</span><br><span class="line">s.forEach(System.out::println);</span><br></pre></td></tr></table></figure>

<p><strong>åŸºæœ¬ç±»å‹</strong></p>
<p>æ³›å‹ä¸æ”¯æŒåŸºæœ¬ç±»å‹ã€‚</p>
<p>Javaæ ‡å‡†åº“æä¾›äº†<code>IntStream</code>ã€<code>LongStream</code>å’Œ<code>DoubleStream</code>è¿™ä¸‰ç§ä½¿ç”¨åŸºæœ¬ç±»å‹çš„<code>Stream</code>ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å°†int[]æ•°ç»„å˜ä¸ºIntStream:</span></span><br><span class="line">IntStream is = Arrays.stream(<span class="keyword">new</span> <span class="keyword">int</span>[] &#123; <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span> &#125;);</span><br><span class="line"><span class="comment">// å°†Stream&lt;String&gt;è½¬æ¢ä¸ºLongStream:</span></span><br><span class="line">LongStream ls = List.of(<span class="string">&quot;1&quot;</span>, <span class="string">&quot;2&quot;</span>, <span class="string">&quot;3&quot;</span>).stream().mapToLong(Long::parseLong);</span><br></pre></td></tr></table></figure>

<h2 id="3-map"><a href="#3-map" class="headerlink" title="3. map"></a>3. map</h2><p><code>Stream.map()</code>æ˜¯<code>Stream</code>æœ€å¸¸ç”¨çš„ä¸€ä¸ªè½¬æ¢æ–¹æ³•ï¼Œå®ƒæŠŠä¸€ä¸ª<code>Stream</code>è½¬æ¢ä¸ºå¦ä¸€ä¸ª<code>Stream</code>ã€‚</p>
<p>æ‰€è°“<code>map</code>æ“ä½œï¼Œå°±æ˜¯æŠŠä¸€ç§æ“ä½œè¿ç®—ï¼Œæ˜ å°„åˆ°ä¸€ä¸ªåºåˆ—çš„æ¯ä¸€ä¸ªå…ƒç´ ä¸Šã€‚</p>
<p>å¯è§ï¼Œ<code>map</code>æ“ä½œï¼ŒæŠŠä¸€ä¸ª<code>Stream</code>çš„æ¯ä¸ªå…ƒç´ ä¸€ä¸€å¯¹åº”åˆ°åº”ç”¨äº†ç›®æ ‡å‡½æ•°çš„ç»“æœä¸Šã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Stream&lt;Integer&gt; s = Stream.of(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>);</span><br><span class="line">Stream&lt;Integer&gt; s2 = s.map(n -&gt; n * n);</span><br></pre></td></tr></table></figure>

<p>mapçš„ä¾‹å­ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        List.of(<span class="string">&quot;  Apple &quot;</span>, <span class="string">&quot; pear &quot;</span>, <span class="string">&quot; ORANGE&quot;</span>, <span class="string">&quot; BaNaNa &quot;</span>)</span><br><span class="line">                .stream()</span><br><span class="line">                .map(String::trim) <span class="comment">// å»ç©ºæ ¼</span></span><br><span class="line">                .map(String::toLowerCase) <span class="comment">// å˜å°å†™</span></span><br><span class="line">                .forEach(System.out::println); <span class="comment">// æ‰“å°</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="4-filter"><a href="#4-filter" class="headerlink" title="4. filter"></a>4. filter</h2><p><code>Stream.filter()</code>æ˜¯<code>Stream</code>çš„å¦ä¸€ä¸ªå¸¸ç”¨è½¬æ¢æ–¹æ³•ã€‚</p>
<p>æ‰€è°“<code>filter()</code>æ“ä½œï¼Œå°±æ˜¯å¯¹ä¸€ä¸ª<code>Stream</code>çš„æ‰€æœ‰å…ƒç´ ä¸€ä¸€è¿›è¡Œæµ‹è¯•ï¼Œä¸æ»¡è¶³æ¡ä»¶çš„å°±è¢«â€œæ»¤æ‰â€äº†ï¼Œå‰©ä¸‹çš„æ»¡è¶³æ¡ä»¶çš„å…ƒç´ å°±æ„æˆäº†ä¸€ä¸ªæ–°çš„<code>Stream</code>ã€‚</p>
<p>ä¾‹å¦‚ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        IntStream.of(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>)</span><br><span class="line">                .filter(n -&gt; n % <span class="number">2</span> != <span class="number">0</span>)</span><br><span class="line">                .forEach(System.out::println);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>filter()</code>æ–¹æ³•æ¥æ”¶çš„å¯¹è±¡æ˜¯<code>Predicate</code>æ¥å£å¯¹è±¡ï¼Œå®ƒå®šä¹‰äº†ä¸€ä¸ª<code>test()</code>æ–¹æ³•ï¼Œè´Ÿè´£åˆ¤æ–­å…ƒç´ æ˜¯å¦ç¬¦åˆæ¡ä»¶ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Predicate</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="comment">// åˆ¤æ–­å…ƒç´ tæ˜¯å¦ç¬¦åˆæ¡ä»¶:</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">test</span><span class="params">(T t)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿‡æ»¤å‘¨å…­å‘¨æ—¥ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Stream.generate(<span class="keyword">new</span> LocalDateSupplier())</span><br><span class="line">                .limit(<span class="number">31</span>)</span><br><span class="line">                .filter(ldt -&gt; ldt.getDayOfWeek() == DayOfWeek.SATURDAY || ldt.getDayOfWeek() == DayOfWeek.SUNDAY)</span><br><span class="line">                .forEach(System.out::println);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LocalDateSupplier</span> <span class="keyword">implements</span> <span class="title">Supplier</span>&lt;<span class="title">LocalDate</span>&gt; </span>&#123;</span><br><span class="line">    LocalDate start = LocalDate.of(<span class="number">2020</span>, <span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">int</span> n = -<span class="number">1</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> LocalDate <span class="title">get</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        n++;</span><br><span class="line">        <span class="keyword">return</span> start.plusDays(n);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="5-reduce"><a href="#5-reduce" class="headerlink" title="5. reduce"></a>5. reduce</h2><p><code>Stream.reduce()</code>åˆ™æ˜¯<code>Stream</code>çš„ä¸€ä¸ªèšåˆæ–¹æ³•ï¼Œå®ƒå¯ä»¥æŠŠä¸€ä¸ª<code>Stream</code>çš„æ‰€æœ‰å…ƒç´ æŒ‰ç…§èšåˆå‡½æ•°èšåˆæˆä¸€ä¸ªç»“æœã€‚</p>
<p><code>reduce</code>çš„ç¬¬ä¸€å‚æ•°æ˜¯åˆå§‹å€¼ï¼Œ<code>(acc, n) -&gt; acc + n</code>accæ˜¯ä¸Šæ¬¡è®¡ç®—çš„ç»“æœã€‚</p>
<p>é€’å½’æ±‚å’Œï¼ˆ<code>reduce</code>å‚æ•°æ˜¯0ï¼‰ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> sum = Stream.of(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>).reduce(<span class="number">0</span>, (acc, n) -&gt; acc + n);</span><br><span class="line">        System.out.println(sum); <span class="comment">// 45</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é€’å½’æ±‚ç§¯ï¼ˆ<code>reduce</code>ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯1ï¼‰</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> s = Stream.of(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>).reduce(<span class="number">1</span>, (acc, n) -&gt; acc * n);</span><br><span class="line">        System.out.println(s); <span class="comment">// 362880</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¤æ‚ç‚¹çš„ï¼šï¼ˆå°†é…ç½®æ–‡ä»¶èšåˆæˆMapï¼‰</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// æŒ‰è¡Œè¯»å–é…ç½®æ–‡ä»¶:</span></span><br><span class="line">        List&lt;String&gt; props = List.of(<span class="string">&quot;profile=native&quot;</span>, <span class="string">&quot;debug=true&quot;</span>, <span class="string">&quot;logging=warn&quot;</span>, <span class="string">&quot;interval=500&quot;</span>);</span><br><span class="line">        Map&lt;String, String&gt; map = props.stream()</span><br><span class="line">                <span class="comment">// æŠŠk=vè½¬æ¢ä¸ºMap[k]=v:</span></span><br><span class="line">                .map(kv -&gt; &#123;</span><br><span class="line">                    String[] ss = kv.split(<span class="string">&quot;\\=&quot;</span>, <span class="number">2</span>);</span><br><span class="line">                    <span class="keyword">return</span> Map.of(ss[<span class="number">0</span>], ss[<span class="number">1</span>]);</span><br><span class="line">                &#125;)</span><br><span class="line">                <span class="comment">// æŠŠæ‰€æœ‰Mapèšåˆåˆ°ä¸€ä¸ªMap:</span></span><br><span class="line">                .reduce(<span class="keyword">new</span> HashMap&lt;String, String&gt;(), (m, kv) -&gt; &#123;</span><br><span class="line">                    m.putAll(kv);</span><br><span class="line">                    <span class="keyword">return</span> m;</span><br><span class="line">                &#125;);</span><br><span class="line">        <span class="comment">// æ‰“å°ç»“æœ:</span></span><br><span class="line">        map.forEach((k, v) -&gt; &#123;</span><br><span class="line">            System.out.println(k + <span class="string">&quot; = &quot;</span> + v);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="6-è¾“å‡º"><a href="#6-è¾“å‡º" class="headerlink" title="6. è¾“å‡º"></a>6. è¾“å‡º</h2><p><strong>è¾“å‡ºåˆ°List</strong></p>
<p>å¦‚ä½•å°†ä¸€ç»„<code>String</code>å…ˆè¿‡æ»¤æ‰ç©ºå­—ç¬¦ä¸²ï¼Œç„¶åæŠŠéç©ºå­—ç¬¦ä¸²ä¿å­˜åˆ°<code>List</code>ä¸­ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Stream&lt;String&gt; stream = Stream.of(<span class="string">&quot;Apple&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="keyword">null</span>, <span class="string">&quot;Pear&quot;</span>, <span class="string">&quot;  &quot;</span>, <span class="string">&quot;Orange&quot;</span>);</span><br><span class="line">        List&lt;String&gt; list = stream.filter(s -&gt; s != <span class="keyword">null</span> &amp;&amp; !s.isBlank()).collect(Collectors.toList());</span><br><span class="line">        System.out.println(list);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æŠŠ<code>Stream</code>çš„æ¯ä¸ªå…ƒç´ æ”¶é›†åˆ°<code>List</code>çš„æ–¹æ³•æ˜¯è°ƒç”¨<code>collect()</code>å¹¶ä¼ å…¥<code>Collectors.toList()</code>å¯¹è±¡ï¼Œå®ƒå®é™…ä¸Šæ˜¯ä¸€ä¸ª<code>Collector</code>å®ä¾‹ï¼Œé€šè¿‡ç±»ä¼¼<code>reduce()</code>çš„æ“ä½œï¼ŒæŠŠæ¯ä¸ªå…ƒç´ æ·»åŠ åˆ°ä¸€ä¸ªæ”¶é›†å™¨ä¸­ï¼ˆå®é™…ä¸Šæ˜¯<code>ArrayList</code>ï¼‰ã€‚</p>
<p>ç±»ä¼¼çš„ï¼Œ<code>collect(Collectors.toSet())</code>å¯ä»¥æŠŠ<code>Stream</code>çš„æ¯ä¸ªå…ƒç´ æ”¶é›†åˆ°<code>Set</code>ä¸­ã€‚</p>
<p><strong>è¾“å‡ºåˆ°æ•°ç»„</strong></p>
<p>æŠŠStreamçš„å…ƒç´ è¾“å‡ºä¸ºæ•°ç»„å’Œè¾“å‡ºä¸ºListç±»ä¼¼ï¼Œæˆ‘ä»¬åªéœ€è¦è°ƒç”¨<code>toArray()</code>æ–¹æ³•ï¼Œå¹¶ä¼ å…¥æ•°ç»„çš„â€œæ„é€ æ–¹æ³•â€ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">List&lt;String&gt; list = List.of(<span class="string">&quot;Apple&quot;</span>, <span class="string">&quot;Banana&quot;</span>, <span class="string">&quot;Orange&quot;</span>);</span><br><span class="line">String[] array = list.stream().toArray(String[]::<span class="keyword">new</span>);</span><br></pre></td></tr></table></figure>

<p><code>String[]::new</code> ç­‰ä»·äºnew String[list.size()]</p>
<p><strong>è¾“å‡ºåˆ°Map</strong></p>
<p>æŒ‡å®šä¸¤ä¸ªæ˜ å°„å‡½æ•°ï¼Œåˆ†åˆ«æŠŠå…ƒç´ æ˜ å°„ä¸ºkeyå’Œvalueï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Stream&lt;String&gt; stream = Stream.of(<span class="string">&quot;APPL:Apple&quot;</span>, <span class="string">&quot;MSFT:Microsoft&quot;</span>);</span><br><span class="line">        Map&lt;String, String&gt; map = stream</span><br><span class="line">                .collect(Collectors.toMap(</span><br><span class="line">                        <span class="comment">// æŠŠå…ƒç´ sæ˜ å°„ä¸ºkey:</span></span><br><span class="line">                        s -&gt; s.substring(<span class="number">0</span>, s.indexOf(<span class="string">&#x27;:&#x27;</span>)),</span><br><span class="line">                        <span class="comment">// æŠŠå…ƒç´ sæ˜ å°„ä¸ºvalue:</span></span><br><span class="line">                        s -&gt; s.substring(s.indexOf(<span class="string">&#x27;:&#x27;</span>) + <span class="number">1</span>)));</span><br><span class="line">        System.out.println(map);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>åˆ†ç»„è¾“å‡º</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        List&lt;String&gt; list = List.of(<span class="string">&quot;Apple&quot;</span>, <span class="string">&quot;Banana&quot;</span>, <span class="string">&quot;Blackberry&quot;</span>, <span class="string">&quot;Coconut&quot;</span>, <span class="string">&quot;Avocado&quot;</span>, <span class="string">&quot;Cherry&quot;</span>, <span class="string">&quot;Apricots&quot;</span>);</span><br><span class="line">        Map&lt;String, List&lt;String&gt;&gt; groups = list.stream()</span><br><span class="line">                .collect(Collectors.groupingBy(s -&gt; s.substring(<span class="number">0</span>, <span class="number">1</span>), Collectors.toList()));</span><br><span class="line">        System.out.println(groups);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">    A=[Apple, Avocado, Apricots],</span></span><br><span class="line"><span class="comment">    B=[Banana, Blackberry],</span></span><br><span class="line"><span class="comment">    C=[Coconut, Cherry]</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨<code>Collectors.groupingBy()</code>ï¼Œå®ƒéœ€è¦æä¾›ä¸¤ä¸ªå‡½æ•°ï¼šä¸€ä¸ªæ˜¯åˆ†ç»„çš„keyï¼Œè¿™é‡Œä½¿ç”¨<code>s -&gt; s.substring(0, 1)</code>ï¼Œè¡¨ç¤ºåªè¦é¦–å­—æ¯ç›¸åŒçš„<code>String</code>åˆ†åˆ°ä¸€ç»„ï¼Œç¬¬äºŒä¸ªæ˜¯åˆ†ç»„çš„valueï¼Œè¿™é‡Œç›´æ¥ä½¿ç”¨<code>Collectors.toList()</code>ï¼Œè¡¨ç¤ºè¾“å‡ºä¸º<code>List</code>ã€‚</p>
<h2 id="7-å…¶ä»–æ“ä½œï¼ˆæ’åºï¼Œå»é‡ï¼Œæˆªå–ï¼Œåˆå¹¶ï¼ŒflatMapï¼Œå¹¶è¡Œï¼Œèšåˆï¼‰"><a href="#7-å…¶ä»–æ“ä½œï¼ˆæ’åºï¼Œå»é‡ï¼Œæˆªå–ï¼Œåˆå¹¶ï¼ŒflatMapï¼Œå¹¶è¡Œï¼Œèšåˆï¼‰" class="headerlink" title="7. å…¶ä»–æ“ä½œï¼ˆæ’åºï¼Œå»é‡ï¼Œæˆªå–ï¼Œåˆå¹¶ï¼ŒflatMapï¼Œå¹¶è¡Œï¼Œèšåˆï¼‰"></a>7. å…¶ä»–æ“ä½œï¼ˆæ’åºï¼Œå»é‡ï¼Œæˆªå–ï¼Œåˆå¹¶ï¼ŒflatMapï¼Œå¹¶è¡Œï¼Œèšåˆï¼‰</h2><p><strong>æ’åº</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        List&lt;String&gt; list = List.of(<span class="string">&quot;Orange&quot;</span>, <span class="string">&quot;apple&quot;</span>, <span class="string">&quot;Banana&quot;</span>)</span><br><span class="line">            .stream()</span><br><span class="line">            .sorted()</span><br><span class="line">            .collect(Collectors.toList());</span><br><span class="line">        System.out.println(list);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¦æ±‚æ¯ä¸ªå…ƒç´ å¿…é¡»å®ç°<code>Comparable</code>æ¥å£ã€‚</p>
<p><strong>å»é‡</strong></p>
<p>å¯¹ä¸€ä¸ª<code>Stream</code>çš„å…ƒç´ è¿›è¡Œå»é‡ï¼Œæ²¡å¿…è¦å…ˆè½¬æ¢ä¸º<code>Set</code>ï¼Œå¯ä»¥ç›´æ¥ç”¨<code>distinct()</code>ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">List.of(<span class="string">&quot;A&quot;</span>, <span class="string">&quot;B&quot;</span>, <span class="string">&quot;A&quot;</span>, <span class="string">&quot;C&quot;</span>, <span class="string">&quot;B&quot;</span>, <span class="string">&quot;D&quot;</span>)</span><br><span class="line">    .stream()</span><br><span class="line">    .distinct()</span><br><span class="line">    .collect(Collectors.toList()); <span class="comment">// [A, B, C, D]</span></span><br></pre></td></tr></table></figure>

<p><strong>æˆªå–</strong></p>
<p>æˆªå–æ“ä½œå¸¸ç”¨äºæŠŠä¸€ä¸ªæ— é™çš„<code>Stream</code>è½¬æ¢æˆæœ‰é™çš„<code>Stream</code>ï¼Œ<code>skip()</code>ç”¨äºè·³è¿‡å½“å‰<code>Stream</code>çš„å‰Nä¸ªå…ƒç´ ï¼Œ<code>limit()</code>ç”¨äºæˆªå–å½“å‰<code>Stream</code>æœ€å¤šå‰Nä¸ªå…ƒç´ ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">List.of(<span class="string">&quot;A&quot;</span>, <span class="string">&quot;B&quot;</span>, <span class="string">&quot;C&quot;</span>, <span class="string">&quot;D&quot;</span>, <span class="string">&quot;E&quot;</span>, <span class="string">&quot;F&quot;</span>)</span><br><span class="line">    .stream()</span><br><span class="line">    .skip(<span class="number">2</span>) <span class="comment">// è·³è¿‡A, B</span></span><br><span class="line">    .limit(<span class="number">3</span>) <span class="comment">// æˆªå–C, D, E</span></span><br><span class="line">    .collect(Collectors.toList()); <span class="comment">// [C, D, E]</span></span><br></pre></td></tr></table></figure>

<p><strong>åˆå¹¶</strong></p>
<p>å°†ä¸¤ä¸ª<code>Stream</code>åˆå¹¶ä¸ºä¸€ä¸ª<code>Stream</code>å¯ä»¥ä½¿ç”¨<code>Stream</code>çš„é™æ€æ–¹æ³•<code>concat()</code>ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Stream&lt;String&gt; s1 = List.of(<span class="string">&quot;A&quot;</span>, <span class="string">&quot;B&quot;</span>, <span class="string">&quot;C&quot;</span>).stream();</span><br><span class="line">Stream&lt;String&gt; s2 = List.of(<span class="string">&quot;D&quot;</span>, <span class="string">&quot;E&quot;</span>).stream();</span><br><span class="line"><span class="comment">// åˆå¹¶:</span></span><br><span class="line">Stream&lt;String&gt; s = Stream.concat(s1, s2);</span><br><span class="line">System.out.println(s.collect(Collectors.toList())); <span class="comment">// [A, B, C, D, E]</span></span><br></pre></td></tr></table></figure>

<p><strong>flatMap</strong></p>
<p>å¦‚æœ<code>Stream</code>çš„å…ƒç´ æ˜¯é›†åˆï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Stream&lt;List&lt;Integer&gt;&gt; s = Stream.of(</span><br><span class="line">        Arrays.asList(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>),</span><br><span class="line">        Arrays.asList(<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>),</span><br><span class="line">        Arrays.asList(<span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>));</span><br></pre></td></tr></table></figure>

<p>å¸Œæœ›æŠŠä¸Šè¿°<code>Stream</code>è½¬æ¢ä¸º<code>Stream&lt;Integer&gt;</code>ï¼Œå°±å¯ä»¥ä½¿ç”¨<code>flatMap()</code>ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Stream&lt;Integer&gt; i = s.flatMap(list -&gt; list.stream());</span><br></pre></td></tr></table></figure>

<p><code>flatMap()</code>ï¼Œæ˜¯æŒ‡æŠŠ<code>Stream</code>çš„æ¯ä¸ªå…ƒç´ ï¼ˆè¿™é‡Œæ˜¯<code>List</code>ï¼‰æ˜ å°„ä¸º<code>Stream</code>ï¼Œç„¶ååˆå¹¶æˆä¸€ä¸ªæ–°çš„<code>Stream</code>ï¼š</p>
<p><img src="https://raw.githubusercontent.com/ghj1998/image_repository/main/image-20210503220426922.png" alt="image-20210503220426922"></p>
<p><strong>å¹¶è¡Œ</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Stream&lt;String&gt; s = ...</span><br><span class="line">String[] result = s.parallel() <span class="comment">// å˜æˆä¸€ä¸ªå¯ä»¥å¹¶è¡Œå¤„ç†çš„Stream</span></span><br><span class="line">                   .sorted() <span class="comment">// å¯ä»¥è¿›è¡Œå¹¶è¡Œæ’åº</span></span><br><span class="line">                   .toArray(String[]::<span class="keyword">new</span>);</span><br></pre></td></tr></table></figure>

<p>é™¤äº†<code>reduce()</code>å’Œ<code>collect()</code>å¤–ï¼Œ<code>Stream</code>è¿˜æœ‰ä¸€äº›å¸¸ç”¨çš„èšåˆæ–¹æ³•ï¼š</p>
<ul>
<li><code>count()</code>ï¼šç”¨äºè¿”å›å…ƒç´ ä¸ªæ•°ï¼›</li>
<li><code>max(Comparator&lt;? super T&gt; cp)</code>ï¼šæ‰¾å‡ºæœ€å¤§å…ƒç´ ï¼›</li>
<li><code>min(Comparator&lt;? super T&gt; cp)</code>ï¼šæ‰¾å‡ºæœ€å°å…ƒç´ ã€‚</li>
</ul>
<p>é’ˆå¯¹<code>IntStream</code>ã€<code>LongStream</code>å’Œ<code>DoubleStream</code>ï¼Œè¿˜é¢å¤–æä¾›äº†ä»¥ä¸‹èšåˆæ–¹æ³•ï¼š</p>
<ul>
<li><code>sum()</code>ï¼šå¯¹æ‰€æœ‰å…ƒç´ æ±‚å’Œï¼›</li>
<li><code>average()</code>ï¼šå¯¹æ‰€æœ‰å…ƒç´ æ±‚å¹³å‡æ•°ã€‚</li>
</ul>
<p>è¿˜æœ‰ä¸€äº›æ–¹æ³•ï¼Œç”¨æ¥æµ‹è¯•<code>Stream</code>çš„å…ƒç´ æ˜¯å¦æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š</p>
<ul>
<li><code>boolean allMatch(Predicate&lt;? super T&gt;)</code>ï¼šæµ‹è¯•æ˜¯å¦æ‰€æœ‰å…ƒç´ å‡æ»¡è¶³æµ‹è¯•æ¡ä»¶ï¼›</li>
<li><code>boolean anyMatch(Predicate&lt;? super T&gt;)</code>ï¼šæµ‹è¯•æ˜¯å¦è‡³å°‘æœ‰ä¸€ä¸ªå…ƒç´ æ»¡è¶³æµ‹è¯•æ¡ä»¶ã€‚</li>
</ul>
<p>æœ€åä¸€ä¸ªå¸¸ç”¨çš„æ–¹æ³•æ˜¯<code>forEach()</code>ï¼Œå®ƒå¯ä»¥å¾ªç¯å¤„ç†<code>Stream</code>çš„æ¯ä¸ªå…ƒç´ ï¼Œæˆ‘ä»¬ç»å¸¸ä¼ å…¥<code>System.out::println</code>æ¥æ‰“å°<code>Stream</code>çš„å…ƒç´ ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Stream&lt;String&gt; s = ...</span><br><span class="line">s.forEach(str -&gt; &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;Hello, &quot;</span> + str);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

]]></content>
      <tags>
        <tag>JAVA</tag>
        <tag>Stream</tag>
      </tags>
  </entry>
  <entry>
    <title>å“ˆå¸Œç®—æ³•</title>
    <url>/2021/05/06/%E5%93%88%E5%B8%8C%E7%AE%97%E6%B3%95/</url>
    <content><![CDATA[<h1 id="å“ˆå¸Œç®—æ³•"><a href="#å“ˆå¸Œç®—æ³•" class="headerlink" title="å“ˆå¸Œç®—æ³•"></a>å“ˆå¸Œç®—æ³•</h1><h2 id="1-Hashç®—æ³•ç‰¹ç‚¹"><a href="#1-Hashç®—æ³•ç‰¹ç‚¹" class="headerlink" title="1. Hashç®—æ³•ç‰¹ç‚¹"></a>1. Hashç®—æ³•ç‰¹ç‚¹</h2><p>å“ˆå¸Œç®—æ³•æœ€é‡è¦çš„ç‰¹ç‚¹å°±æ˜¯ï¼š</p>
<ul>
<li>ç›¸åŒçš„è¾“å…¥ä¸€å®šå¾—åˆ°ç›¸åŒçš„è¾“å‡ºï¼›</li>
<li>ä¸åŒçš„è¾“å…¥å¤§æ¦‚ç‡å¾—åˆ°ä¸åŒçš„è¾“å‡ºã€‚</li>
</ul>
<h2 id="2-Hashç¢°æ’"><a href="#2-Hashç¢°æ’" class="headerlink" title="2. Hashç¢°æ’"></a>2. Hashç¢°æ’</h2><p>å“ˆå¸Œç¢°æ’æ˜¯æŒ‡ï¼Œä¸¤ä¸ªä¸åŒçš„è¾“å…¥å¾—åˆ°äº†ç›¸åŒçš„è¾“å‡ºï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;AaAaAa&quot;</span>.hashCode(); <span class="comment">// 0x7460e8c0</span></span><br><span class="line"><span class="string">&quot;BBAaBB&quot;</span>.hashCode(); <span class="comment">// 0x7460e8c0</span></span><br></pre></td></tr></table></figure>

<p>ä¸€ä¸ªå®‰å…¨çš„å“ˆå¸Œç®—æ³•å¿…é¡»æ»¡è¶³ï¼š</p>
<ul>
<li>ç¢°æ’æ¦‚ç‡ä½ï¼›</li>
<li>ä¸èƒ½çŒœæµ‹è¾“å‡ºï¼šä¸èƒ½æ ¹æ®hashCodeçš„è¾“å‡ºåæ¨å›è¾“å…¥ã€‚</li>
</ul>
<h2 id="3-å¸¸è§hashç®—æ³•"><a href="#3-å¸¸è§hashç®—æ³•" class="headerlink" title="3. å¸¸è§hashç®—æ³•"></a>3. å¸¸è§hashç®—æ³•</h2><p>å¸¸ç”¨çš„å“ˆå¸Œç®—æ³•æœ‰ï¼š</p>
<table>
<thead>
<tr>
<th align="left">ç®—æ³•</th>
<th align="left">è¾“å‡ºé•¿åº¦ï¼ˆä½ï¼‰</th>
<th align="left">è¾“å‡ºé•¿åº¦ï¼ˆå­—èŠ‚ï¼‰</th>
</tr>
</thead>
<tbody><tr>
<td align="left">MD5</td>
<td align="left">128 bits</td>
<td align="left">16 bytes</td>
</tr>
<tr>
<td align="left">SHA-1</td>
<td align="left">160 bits</td>
<td align="left">20 bytes</td>
</tr>
<tr>
<td align="left">RipeMD-160</td>
<td align="left">160 bits</td>
<td align="left">20 bytes</td>
</tr>
<tr>
<td align="left">SHA-256</td>
<td align="left">256 bits</td>
<td align="left">32 bytes</td>
</tr>
<tr>
<td align="left">SHA-512</td>
<td align="left">512 bits</td>
<td align="left">64 bytes</td>
</tr>
</tbody></table>
<p>æ ¹æ®ç¢°æ’æ¦‚ç‡ï¼Œå“ˆå¸Œç®—æ³•çš„è¾“å‡ºé•¿åº¦è¶Šé•¿ï¼Œå°±è¶Šéš¾äº§ç”Ÿç¢°æ’ï¼Œä¹Ÿå°±è¶Šå®‰å…¨ã€‚</p>
<p>Javaæ ‡å‡†åº“æä¾›äº†å¸¸ç”¨çš„å“ˆå¸Œç®—æ³•ï¼Œå¹¶ä¸”æœ‰ä¸€å¥—ç»Ÿä¸€çš„æ¥å£ã€‚MessageDigestæ˜¯ä¸“é—¨ç”¨æ¥ç”Ÿæˆæ•£åˆ—ç çš„ç±»ï¼Œåªèƒ½é€šè¿‡getInstanceè¿›è¡Œå®ä¾‹åŒ–ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// åˆ›å»ºä¸€ä¸ªMessageDigestå®ä¾‹:</span></span><br><span class="line">        MessageDigest md = MessageDigest.getInstance(<span class="string">&quot;MD5&quot;</span>);</span><br><span class="line">        <span class="comment">// åå¤è°ƒç”¨updateè¾“å…¥æ•°æ®:</span></span><br><span class="line">        md.update(<span class="string">&quot;Hello&quot;</span>.getBytes(<span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">        md.update(<span class="string">&quot;World&quot;</span>.getBytes(<span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">        <span class="keyword">byte</span>[] result = md.digest(); <span class="comment">// 16 bytes: 68e109f0f40ca72a15e05cc22786f8e6</span></span><br><span class="line">        System.out.println(<span class="keyword">new</span> BigInteger(<span class="number">1</span>, result).toString(<span class="number">16</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨<code>MessageDigest</code>æ—¶ï¼Œæˆ‘ä»¬é¦–å…ˆæ ¹æ®å“ˆå¸Œç®—æ³•è·å–ä¸€ä¸ª<code>MessageDigest</code>å®ä¾‹ï¼Œç„¶åï¼Œåå¤è°ƒç”¨<code>update(byte[])</code>è¾“å…¥æ•°æ®ã€‚å½“è¾“å…¥ç»“æŸåï¼Œè°ƒç”¨<code>digest()</code>æ–¹æ³•è·å¾—byte[]æ•°ç»„è¡¨ç¤ºçš„æ‘˜è¦ï¼Œæœ€åï¼ŒæŠŠå®ƒè½¬æ¢ä¸ºåå…­è¿›åˆ¶çš„å­—ç¬¦ä¸²ã€‚</p>
<p>è¿è¡Œä¸Šè¿°ä»£ç ï¼Œå¯ä»¥å¾—åˆ°è¾“å…¥<code>HelloWorld</code>çš„MD5æ˜¯<code>68e109f0f40ca72a15e05cc22786f8e6</code>ã€‚</p>
<h2 id="4-hashç®—æ³•ç”¨é€”"><a href="#4-hashç®—æ³•ç”¨é€”" class="headerlink" title="4. hashç®—æ³•ç”¨é€”"></a>4. hashç®—æ³•ç”¨é€”</h2><ul>
<li><p>ä¸‹è½½æ–‡ä»¶</p>
<p><img src="https://www.liaoxuefeng.com/files/attachments/1305351978745921/l" alt="file-md5"></p>
<p>ä¸‹è½½å®Œæ–‡ä»¶å¯ä»¥è®¡ç®—æœ¬åœ°æ–‡ä»¶çš„MD5å“ˆå¸Œå€¼ï¼Œå°±å¯ä»¥çŸ¥é“æ–‡ä»¶æœ‰æ²¡æœ‰è¢«ä¿®æ”¹ã€‚</p>
</li>
<li><p>å­˜å‚¨ç”¨æˆ·å£ä»¤</p>
<p>ä¸å­˜å‚¨ç”¨æˆ·çš„åŸå§‹å£ä»¤ï¼Œæ–¹æ³•æ˜¯å­˜å‚¨ç”¨æˆ·å£ä»¤çš„å“ˆå¸Œï¼Œä¾‹å¦‚ï¼ŒMD5ã€‚</p>
<p>åœ¨ç”¨æˆ·è¾“å…¥åŸå§‹å£ä»¤åï¼Œç³»ç»Ÿè®¡ç®—ç”¨æˆ·è¾“å…¥çš„åŸå§‹å£ä»¤çš„MD5å¹¶ä¸æ•°æ®åº“å­˜å‚¨çš„MD5å¯¹æ¯”ï¼Œå¦‚æœä¸€è‡´ï¼Œè¯´æ˜å£ä»¤æ­£ç¡®ï¼Œå¦åˆ™ï¼Œå£ä»¤é”™è¯¯ã€‚</p>
<p>æ•°æ®åº“çš„å­˜å‚¨åº”å½“å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<table>
<thead>
<tr>
<th align="left">username</th>
<th align="left">password</th>
</tr>
</thead>
<tbody><tr>
<td align="left">bob</td>
<td align="left">f30aa7a662c728b7407c54ae6bfd27d1</td>
</tr>
<tr>
<td align="left">alice</td>
<td align="left">25d55ad283aa400af464c76d713c07ad</td>
</tr>
<tr>
<td align="left">tim</td>
<td align="left">bed128365216c019988915ed3add75fb</td>
</tr>
</tbody></table>
<p>ä½¿ç”¨å“ˆå¸Œå£ä»¤æ—¶ï¼Œè¿˜è¦æ³¨æ„é˜²æ­¢å½©è™¹è¡¨æ”»å‡»ã€‚</p>
<p>å½©è™¹è¡¨æ˜¯ä¸€ä¸ªé¢„å…ˆè®¡ç®—å¥½çš„å¸¸ç”¨å£ä»¤å’Œå®ƒä»¬çš„MD5çš„å¯¹ç…§è¡¨ã€‚</p>
<p>ä¾‹å¦‚ï¼š</p>
<table>
<thead>
<tr>
<th align="left">å¸¸ç”¨å£ä»¤</th>
<th align="left">MD5</th>
</tr>
</thead>
<tbody><tr>
<td align="left">hello123</td>
<td align="left">f30aa7a662c728b7407c54ae6bfd27d1</td>
</tr>
<tr>
<td align="left">12345678</td>
<td align="left">25d55ad283aa400af464c76d713c07ad</td>
</tr>
<tr>
<td align="left">passw0rd</td>
<td align="left">bed128365216c019988915ed3add75fb</td>
</tr>
<tr>
<td align="left">19700101</td>
<td align="left">570da6d5277a646f6552b8832012f5dc</td>
</tr>
<tr>
<td align="left">â€¦</td>
<td align="left">â€¦</td>
</tr>
<tr>
<td align="left">20201231</td>
<td align="left">6879c0ae9117b50074ce0a0d4c843060</td>
</tr>
</tbody></table>
<p>æ‰€ä»¥è¯´ï¼Œå°½é‡ä¸è¦ä½¿ç”¨è¿‡äºç®€å•çš„å¯†ç ã€‚</p>
</li>
</ul>
<h2 id="5-ä½¿ç”¨ä¸åœ¨Javaæ ‡å‡†åº“ä¸­çš„å“ˆå¸Œç®—æ³•"><a href="#5-ä½¿ç”¨ä¸åœ¨Javaæ ‡å‡†åº“ä¸­çš„å“ˆå¸Œç®—æ³•" class="headerlink" title="5. ä½¿ç”¨ä¸åœ¨Javaæ ‡å‡†åº“ä¸­çš„å“ˆå¸Œç®—æ³•"></a>5. ä½¿ç”¨ä¸åœ¨Javaæ ‡å‡†åº“ä¸­çš„å“ˆå¸Œç®—æ³•</h2><p><a href="https://www.bouncycastle.org/">BouncyCastle</a>å°±æ˜¯ä¸€ä¸ªæä¾›äº†å¾ˆå¤šå“ˆå¸Œç®—æ³•å’ŒåŠ å¯†ç®—æ³•çš„ç¬¬ä¸‰æ–¹åº“ã€‚å®ƒæä¾›äº†Javaæ ‡å‡†åº“æ²¡æœ‰çš„ä¸€äº›ç®—æ³•ï¼Œä¾‹å¦‚ï¼ŒRipeMD160å“ˆå¸Œç®—æ³•ã€‚</p>
<p>å¦‚ä½•ä½¿ç”¨BouncyCastleè¿™ä¸ªç¬¬ä¸‰æ–¹æä¾›çš„ç®—æ³•ï¼Ÿ</p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬å¿…é¡»æŠŠBouncyCastleæä¾›çš„jaråŒ…æ”¾åˆ°classpathä¸­ã€‚è¿™ä¸ªjaråŒ…å°±æ˜¯<code>bcprov-jdk15on-xxx.jar</code>ï¼Œå¯ä»¥ä»<a href="https://www.bouncycastle.org/latest_releases.html">å®˜æ–¹ç½‘ç«™</a>ä¸‹è½½ã€‚</p>
<p>Javaæ ‡å‡†åº“çš„<code>java.security</code>åŒ…æä¾›äº†ä¸€ç§æ ‡å‡†æœºåˆ¶ï¼Œå…è®¸ç¬¬ä¸‰æ–¹æä¾›å•†æ— ç¼æ¥å…¥ã€‚æˆ‘ä»¬è¦ä½¿ç”¨BouncyCastleæä¾›çš„RipeMD160ç®—æ³•ï¼Œéœ€è¦å…ˆæŠŠBouncyCastleæ³¨å†Œä¸€ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// æ³¨å†ŒBouncyCastle:</span></span><br><span class="line">        Security.addProvider(<span class="keyword">new</span> BouncyCastleProvider());</span><br><span class="line">        <span class="comment">// æŒ‰åç§°æ­£å¸¸è°ƒç”¨:</span></span><br><span class="line">        MessageDigest md = MessageDigest.getInstance(<span class="string">&quot;RipeMD160&quot;</span>);</span><br><span class="line">        md.update(<span class="string">&quot;HelloWorld&quot;</span>.getBytes(<span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">        <span class="keyword">byte</span>[] result = md.digest();</span><br><span class="line">        System.out.println(<span class="keyword">new</span> BigInteger(<span class="number">1</span>, result).toString(<span class="number">16</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­ï¼Œæ³¨å†ŒBouncyCastleæ˜¯é€šè¿‡ä¸‹é¢çš„è¯­å¥å®ç°çš„ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Security.addProvider(<span class="keyword">new</span> BouncyCastleProvider());</span><br></pre></td></tr></table></figure>

<p>æ³¨å†Œåªéœ€è¦åœ¨å¯åŠ¨æ—¶è¿›è¡Œä¸€æ¬¡ï¼Œåç»­å°±å¯ä»¥ä½¿ç”¨BouncyCastleæä¾›çš„æ‰€æœ‰å“ˆå¸Œç®—æ³•å’ŒåŠ å¯†ç®—æ³•ã€‚</p>
]]></content>
      <tags>
        <tag>JAVA</tag>
        <tag>Hash</tag>
        <tag>åŠ å¯†</tag>
      </tags>
  </entry>
  <entry>
    <title>gitå®‰è£…å’Œé…ç½®</title>
    <url>/2021/03/29/git%E5%AE%89%E8%A3%85%E5%92%8C%E9%85%8D%E7%BD%AE/</url>
    <content><![CDATA[<h1 id="gitå®‰è£…å’Œé…ç½®"><a href="#gitå®‰è£…å’Œé…ç½®" class="headerlink" title="gitå®‰è£…å’Œé…ç½®"></a>gitå®‰è£…å’Œé…ç½®</h1><h2 id="1-ç‰ˆæœ¬æ§åˆ¶å·¥å…·"><a href="#1-ç‰ˆæœ¬æ§åˆ¶å·¥å…·" class="headerlink" title="1. ç‰ˆæœ¬æ§åˆ¶å·¥å…·"></a>1. ç‰ˆæœ¬æ§åˆ¶å·¥å…·</h2><p><strong>SVN</strong>ï¼šé›†ä¸­å¼ç‰ˆæœ¬æ§åˆ¶å·¥å…·</p>
<p>é›†ä¸­å¼ç‰ˆæœ¬æ§åˆ¶å·¥å…·ï¼Œå‡ ä¹æ‰€æœ‰çš„åŠ¨ä½œ<strong>éƒ½éœ€è¦æœåŠ¡å™¨å‚ä¸</strong>ï¼Œå¹¶ä¸”<strong>æ•°æ®å®‰å…¨æ€§ä¸æœåŠ¡å™¨å…³ç³»å¾ˆå¤§</strong>ã€‚</p>
<p><strong>git</strong>ï¼šåˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶å·¥å…·</p>
<p><strong>Git æ˜¯åˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶å·¥å…·</strong>ï¼Œé™¤äº†ä¸æœåŠ¡å™¨ä¹‹å‰è¿›è¡ŒæŒ‰éœ€åŒæ­¥ä¹‹å¤–ï¼Œ<strong>æ‰€æœ‰çš„æäº¤æ“ä½œéƒ½ä¸éœ€è¦æœåŠ¡å™¨</strong>ã€‚</p>
<p><strong>SVN</strong>ä¸é€‚ç”¨çš„é¢†åŸŸï¼š</p>
<ul>
<li>è·¨åœ°åŸŸååŒå¼€å‘</li>
<li>è¿½ä¿®é«˜è´¨é‡ä»£ç ä»¥åŠä»£ç é—¨ç¦</li>
</ul>
<p><strong>git</strong>ä¸é€‚åˆçš„é¢†åŸŸï¼š</p>
<ul>
<li>ä¸é€‚åˆWordç­‰äºŒè¿›åˆ¶æ–‡æ¡£çš„ç‰ˆæœ¬æ§åˆ¶</li>
<li>gitæ²¡æœ‰é”å®š/è§£é”æ¨¡å¼ï¼Œä¸èƒ½æ´¾ä»–å¼ä¿®æ”¹</li>
<li>æƒé™ä¸èƒ½ç»†åˆ†ï¼ˆä¾‹å¦‚å°†ä¸åŒçš„æ–‡ä»¶åˆ†é…ä¸åŒçš„è®¿é—®æƒé™ï¼‰</li>
</ul>
<h2 id="2-gitå®‰è£…å’Œé…ç½®"><a href="#2-gitå®‰è£…å’Œé…ç½®" class="headerlink" title="2. gitå®‰è£…å’Œé…ç½®"></a>2. gitå®‰è£…å’Œé…ç½®</h2><h3 id="2-1-Linuxä¸‹å®‰è£…-git"><a href="#2-1-Linuxä¸‹å®‰è£…-git" class="headerlink" title="2.1 Linuxä¸‹å®‰è£… git"></a>2.1 Linuxä¸‹å®‰è£… git</h3><p><strong>åŒ…ç®¡ç†å™¨æ–¹å¼å®‰è£…</strong></p>
<p>Ubuntu 10.10(maverick)æˆ–æ›´æ–°ç‰ˆæœ¬ï¼ŒDebian(squeeze)æˆ–æ›´æ–°ç‰ˆæœ¬:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo aptitude install git</span><br><span class="line">$ sudo aptitude install git-doc git-svn git-email gitk</span><br></pre></td></tr></table></figure>

<p>Linux ç³»ç»Ÿ:  RHELã€Fedoraã€CentOS ç­‰ç‰ˆæœ¬:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ yum install git</span><br><span class="line">$ yum install git-svn git-email gitk</span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­<code>git</code>è½¯ä»¶åŒ…åŒ…å«äº†å¤§éƒ¨åˆ†Gitå‘½ä»¤ï¼Œæ˜¯å¿…è£…çš„è½¯ä»¶åŒ…ã€‚</p>
<p>è½¯ä»¶åŒ…<code>git-svn</code>ã€<code>git-email</code>ã€<code>gitk</code>æœ¬æ¥ä¹Ÿæ˜¯Gitè½¯ä»¶åŒ…çš„ä¸€éƒ¨åˆ†ï¼Œä½†æ˜¯å› ä¸ºæœ‰ç€ä¸ä¸€æ ·çš„è½¯ä»¶åŒ…ä¾èµ–ï¼ˆå¦‚æ›´å¤š<code>perl</code>æ¨¡ç»„ï¼Œ<code>tk</code>ç­‰ï¼‰ï¼Œæ‰€ä»¥å•ç‹¬ä½œä¸ºè½¯ä»¶åŒ…å‘å¸ƒã€‚</p>
<p><strong>æºç å®‰è£…</strong></p>
<p>è®¿é—®<a href="http://git-scm.com/%EF%BC%8C%E4%B8%8B%E8%BD%BDGit%E6%BA%90%E7%A0%81%E5%8C%85%EF%BC%8C%E4%BE%8B%E5%A6%82%EF%BC%9Agit-2.19.0.tar.gz%E3%80%82">http://git-scm.com/ï¼Œä¸‹è½½Gitæºç åŒ…ï¼Œä¾‹å¦‚ï¼šgit-2.19.0.tar.gzã€‚</a></p>
<p>ç¬¬ä¸€æ­¥ï¼šå±•å¼€æºç åŒ…ï¼Œå¹¶è¿›å…¥åˆ°ç›¸åº”çš„ç›®å½•ä¸­ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ tar -jxvf git-2.19.0.tar.bz2</span><br><span class="line">$ <span class="built_in">cd</span> git-2.19.0</span><br></pre></td></tr></table></figure>

<p>ç¬¬äºŒæ­¥ï¼šå®‰è£…ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ make prefix=/usr/<span class="built_in">local</span> all</span><br><span class="line">$ sudo make prefix=/usr/<span class="built_in">local</span> install</span><br></pre></td></tr></table></figure>

<p>ç¬¬ä¸‰æ­¥ï¼šå®‰è£…gitæ–‡æ¡£ï¼ˆå¯é€‰ï¼‰</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ make prefix=/usr/<span class="built_in">local</span> doc info</span><br><span class="line">$ sudo make prefix=/usr/<span class="built_in">local</span> install-doc install-html install-info</span><br></pre></td></tr></table></figure>

<h3 id="2-2-Windows-ä¸‹å®‰è£…-git"><a href="#2-2-Windows-ä¸‹å®‰è£…-git" class="headerlink" title="2.2 Windows ä¸‹å®‰è£… git"></a>2.2 <strong>Windows</strong> <strong>ä¸‹å®‰è£…</strong> git</h3><p><strong>ä¸‹è½½å®‰è£…åŒ…</strong></p>
<p><a href="https://git-scm.com/download/win">https://git-scm.com/download/win </a>ä¸‹è½½ Windows å®‰è£…åŒ…</p>
<p><strong>å®‰è£…å®‰è£…åŒ…</strong></p>
<p><img src="https://raw.githubusercontent.com/ghj1998/image_repository/main/image-20210329144403430.png" alt="image-20210329144403430"></p>
<p>åœ¨è¿™ä¸€æ­¥å»æ‰git LFSé€‰é¡¹ã€‚</p>
<p><img src="https://raw.githubusercontent.com/ghj1998/image_repository/main/image-20210329144502858.png" alt="image-20210329144502858"></p>
<p>åœ¨è¿™ä¸€æ­¥å¯ä»¥é€‰æ‹©ç¼–è¾‘å™¨ï¼Œé»˜è®¤å°±å¯ä»¥ã€‚</p>
<p><img src="https://raw.githubusercontent.com/ghj1998/image_repository/main/image-20210329144551825.png" alt="image-20210329144551825"></p>
<p>è¿™ä¸€æ­¥é€‰æ‹©git bashä½œä¸ºå‘½ä»¤è¡Œã€‚</p>
<p><strong>TortoiseGit</strong></p>
<p><strong>TortoiseGit</strong>æ˜¯ä¸€ä¸ªgitçš„å¯è§†åŒ–å›¾å½¢ç•Œé¢ã€‚ä¸ªäººè®¤ä¸ºç”¨å¤„ä¸å¤§ã€‚</p>
<h3 id="2-3-gitå®‰è£…å®Œæˆåçš„é…ç½®"><a href="#2-3-gitå®‰è£…å®Œæˆåçš„é…ç½®" class="headerlink" title="2.3 gitå®‰è£…å®Œæˆåçš„é…ç½®"></a>2.3 gitå®‰è£…å®Œæˆåçš„é…ç½®</h3><p>gitçš„é…ç½®åˆ†ä¸ºä¸‰ç±»ï¼Œç³»ç»Ÿé…ç½®ï¼ˆé€‚ç”¨æ‰€æœ‰ç”¨æˆ·ï¼‰ï¼Œç”¨æˆ·é…ç½®ï¼ˆé€‚ç”¨äºè¯¥ç”¨æˆ·ï¼‰ï¼Œä»“åº“é…ç½®ï¼ˆåªå¯¹å½“å‰é¡¹ç›®æœ‰æ•ˆï¼‰ã€‚</p>
<p><strong>ç³»ç»Ÿé…ç½®</strong>ï¼ˆå¯¹æ‰€æœ‰ç”¨æˆ·éƒ½é€‚ç”¨ï¼‰</p>
<p>å­˜æ”¾åœ¨gitçš„å®‰è£…ç›®å½•ä¸‹ï¼š<code>%Git%/etc/gitconfig</code>ï¼›è‹¥ä½¿ç”¨ <code>git config</code> æ—¶ç”¨<code> --system</code> é€‰é¡¹ï¼Œè¯»å†™çš„å°±æ˜¯è¿™ä¸ªæ–‡ä»¶ï¼š</p>
<p><code>git config --system core.autocrlf</code></p>
<p><strong>ç”¨æˆ·é…ç½®</strong>ï¼ˆåªé€‚ç”¨äºè¯¥ç”¨æˆ·ï¼‰</p>
<p>å­˜æ”¾åœ¨ç”¨æˆ·ç›®å½•ä¸‹ã€‚ä¾‹å¦‚linuxå­˜æ”¾åœ¨ï¼š<code>~/.gitconfig</code>ï¼›è‹¥ä½¿ç”¨ <code>git config</code> æ—¶ç”¨<code> --global</code> é€‰é¡¹ï¼Œè¯»å†™çš„å°±æ˜¯è¿™ä¸ªæ–‡ä»¶ï¼š</p>
<p><code>git config --global user.name</code></p>
<p><strong>ä»“åº“é…ç½®</strong>ï¼ˆåªå¯¹å½“å‰é¡¹ç›®æœ‰æ•ˆï¼‰</p>
<p>å½“å‰ä»“åº“çš„é…ç½®æ–‡ä»¶ï¼ˆä¹Ÿå°±æ˜¯å·¥ä½œç›®å½•ä¸­çš„ <code>.git/config</code> æ–‡ä»¶ï¼‰ï¼›è‹¥ä½¿ç”¨<code>git config</code> æ—¶ç”¨ <code>--local</code> é€‰é¡¹ï¼Œè¯»å†™çš„å°±æ˜¯è¿™ä¸ªæ–‡ä»¶ï¼š</p>
<p><code>git config --local remote.origin.url</code></p>
<p><strong>é…ç½®ç¬¬ä¸€æ­¥ï¼šé…ç½®ç”¨æˆ·ä¿¡æ¯</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git config --global user.name â€œXXXXXâ€</span><br><span class="line">git config --global user.email XXXXXXXXXX@huawei.com</span><br></pre></td></tr></table></figure>

<p>ç¬¬ä¸€è¡Œè®¾ç½®è‡ªå·±gitæäº¤æ—¶çš„å§“åï¼Œç¬¬äºŒè¡Œè®¾ç½®æäº¤æ—¶çš„é‚®ç®±ã€‚</p>
<p><strong>é…ç½®ç¬¬äºŒæ­¥ï¼šé…ç½®æ–‡æœ¬æ¢è¡Œç¬¦</strong></p>
<p>åŸå› ï¼šWindowsæ—¶ç”¨å›è½¦å’Œæ¢è¡Œä¸¤ä¸ªå­—ç¬¦æ¥æ¢è¡Œï¼ŒLinuxåªä½¿ç”¨æ¢è¡Œã€‚å¦‚æœæ¶‰åŠåˆ°å¤šå¹³å°å¼€å‘ï¼Œå°±å¯èƒ½é€ æˆé—®é¢˜ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ git config --global core.autocrlf <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<p>åœ¨Windowsä¸‹ä½¿ç”¨è¿™ä¸ªå‘½ä»¤å°±å¯ä»¥è®©gitåœ¨æäº¤æ—¶è‡ªåŠ¨å¸®å¿™è½¬åŒ–ã€‚</p>
<p><strong>é…ç½®ç¬¬ä¸‰æ­¥ï¼šæ–‡æœ¬ç¼–ç é…ç½®</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">\<span class="comment"># ä¸­æ–‡ç¼–ç æ”¯æŒ</span></span><br><span class="line">git config --global gui.encoding utf-8</span><br><span class="line">git config --global i18n.commitencoding utf-8</span><br><span class="line">git config --global i18n.logoutputencoding utf-8</span><br><span class="line"></span><br><span class="line">\<span class="comment"># æ˜¾ç¤ºè·¯å¾„ä¸­çš„ä¸­æ–‡ï¼š</span></span><br><span class="line">git config --global core.quotepath <span class="literal">false</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p><strong>i18n.commitEncoding</strong> <strong>é€‰é¡¹ï¼š</strong>ç”¨æ¥è®©git commit logå­˜å‚¨æ—¶ï¼Œé‡‡ç”¨çš„ç¼–ç ï¼Œé»˜è®¤UTF-8.</p>
</li>
<li><p><strong>i18n.logOutputEncoding</strong> <strong>é€‰é¡¹ï¼š</strong>æŸ¥çœ‹git logæ—¶ï¼Œæ˜¾ç¤ºé‡‡ç”¨çš„ç¼–ç ï¼Œå»ºè®®è®¾ç½®ä¸ºUTF-8.</p>
</li>
</ul>
<p><strong>é…ç½®ç¬¬å››æ­¥ï¼šç”Ÿæˆsshè®¤è¯æ–‡ä»¶</strong></p>
<blockquote>
<p>è®¤è¯ï¼šåœ¨ä¸è¿œç¨‹çš„gitæœåŠ¡å™¨ï¼Œä¾‹å¦‚GitHubï¼ŒGitLabè¿›è¡Œé€šè®¯æ—¶ï¼Œå»ºç«‹èµ·æ¥çš„è®¤è¯ï¼Œè¯æ˜è‡ªå·±å¯ä»¥åœ¨å½“å‰è¿™ä¸ªæœºå™¨ä¸Šå¯¹è¿œç¨‹ä»“åº“çš„å†…å®¹è¿›è¡Œä¿®æ”¹ã€‚</p>
</blockquote>
<p>ä¸¤ç§è®¤è¯æ–¹æ³•ï¼š</p>
<ol>
<li>http/httpsåè®®è®¤è¯ï¼ˆä¸æ¨èä½¿ç”¨ï¼Œå› æ­¤ä¸å†™äº†ï¼‰</li>
<li>sshåè®®è®¤è¯</li>
</ol>
<p>sshåè®®è®¤è¯</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ ssh-keygen -t rsa â€“C zhangsan1123@huawei.com</span><br></pre></td></tr></table></figure>

<p>åœ¨git bashä¸­è¾“å…¥è¿™æ®µå‘½ä»¤ï¼Œæ•²å‡»å‡ æ¬¡å›è½¦ï¼Œä¼šåœ¨è®¡ç®—æœºä¸­ç”Ÿæˆsshè®¤è¯æ–‡ä»¶ã€‚</p>
<p>sshè®¤è¯æ–‡ä»¶å­˜æ”¾åœ°å€ï¼š</p>
<p>Windows ï¼šC:\Users\Administrator\.ssh    <em>Administratorä¸ºä½ å½“å‰ç™»é™†çš„ç”¨æˆ·å</em></p>
<p>Linuxï¼š <del>/.ssh           *</del>ä¸ºå½“å‰ç”¨æˆ·çš„å®¶ç›®å½•*</p>
<p>æ‰“å¼€æ–‡ä»¶å¤¹ï¼Œæ‰¾åˆ°<code>id_rsa.pub</code>æ–‡ä»¶ï¼Œæ‰“å¼€å¤åˆ¶å†…éƒ¨çš„å†…å®¹ã€‚</p>
<p>æ·»åŠ å…¬é’¥åˆ°ä»£ç å¹³å°ï¼š</p>
<ol>
<li><p>ç™»å½•ä»£ç å¹³å°</p>
</li>
<li><p>è¿›å…¥â€œProfile Settingsâ€</p>
</li>
<li><p>ç‚¹å‡»å·¦ä¾§æ çš„â€œSSH Keysâ€</p>
</li>
<li><p>ç‚¹å‡»â€œAdd SSH Keyâ€,å°†åˆšç”Ÿæˆçš„å…¬é’¥æ–‡ä»¶çš„å†…å®¹ï¼Œå¤åˆ¶åˆ°â€œPublic Keyâ€æ ï¼Œä¿å­˜å³å¯ã€‚</p>
</li>
</ol>
]]></content>
      <tags>
        <tag>git</tag>
      </tags>
  </entry>
  <entry>
    <title>åœ¨JAVAä¸­ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼</title>
    <url>/2021/05/06/%E5%9C%A8JAVA%E4%B8%AD%E4%BD%BF%E7%94%A8%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/</url>
    <content><![CDATA[<h1 id="åœ¨JAVAä¸­ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼"><a href="#åœ¨JAVAä¸­ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼" class="headerlink" title="åœ¨JAVAä¸­ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼"></a>åœ¨JAVAä¸­ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼</h1><h2 id="1-ç®€ä»‹"><a href="#1-ç®€ä»‹" class="headerlink" title="1. ç®€ä»‹"></a>1. ç®€ä»‹</h2><p>æ­£åˆ™è¡¨è¾¾å¼å¯ä»¥ç”¨å­—ç¬¦ä¸²æ¥æè¿°è§„åˆ™ï¼Œå¹¶ç”¨æ¥åŒ¹é…å­—ç¬¦ä¸²ã€‚ä¾‹å¦‚ï¼Œåˆ¤æ–­æ‰‹æœºå·ï¼Œæˆ‘ä»¬ç”¨æ­£åˆ™è¡¨è¾¾å¼<code>\d&#123;11&#125;</code>ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">isValidMobileNumber</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> s.matches(<span class="string">&quot;\\d&#123;11&#125;&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¾‹å­ï¼š</p>
<p>åˆ¤æ–­å¹´ä»½æ˜¯å¦æ˜¯20##å¹´ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String regex = <span class="string">&quot;20\\d\\d&quot;</span>;</span><br><span class="line">        System.out.println(<span class="string">&quot;2019&quot;</span>.matches(regex)); <span class="comment">// true</span></span><br><span class="line">        System.out.println(<span class="string">&quot;2100&quot;</span>.matches(regex)); <span class="comment">// false</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Javaæ ‡å‡†åº“<code>java.util.regex</code>å†…å»ºäº†æ­£åˆ™è¡¨è¾¾å¼å¼•æ“ã€‚</p>
<h2 id="2-åŒ¹é…è§„åˆ™"><a href="#2-åŒ¹é…è§„åˆ™" class="headerlink" title="2. åŒ¹é…è§„åˆ™"></a>2. åŒ¹é…è§„åˆ™</h2><table>
<thead>
<tr>
<th align="left">æ­£åˆ™è¡¨è¾¾å¼</th>
<th align="left">è§„åˆ™</th>
<th align="left">å¯ä»¥åŒ¹é…</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>A</code></td>
<td align="left">æŒ‡å®šå­—ç¬¦</td>
<td align="left"><code>A</code></td>
</tr>
<tr>
<td align="left"><code>\u548c</code></td>
<td align="left">æŒ‡å®šUnicodeå­—ç¬¦</td>
<td align="left"><code>å’Œ</code></td>
</tr>
<tr>
<td align="left"><code>.</code></td>
<td align="left">ä»»æ„å­—ç¬¦</td>
<td align="left"><code>a</code>ï¼Œ<code>b</code>ï¼Œ<code>&amp;</code>ï¼Œ<code>0</code></td>
</tr>
<tr>
<td align="left"><code>\d</code></td>
<td align="left">æ•°å­—0~9</td>
<td align="left"><code>0</code>~`9`</td>
</tr>
<tr>
<td align="left"><code>\w</code></td>
<td align="left">å¤§å°å†™å­—æ¯ï¼Œæ•°å­—å’Œä¸‹åˆ’çº¿</td>
<td align="left"><code>a</code><del><code>z</code>ï¼Œ<code>A</code></del><code>Z</code>ï¼Œ<code>0</code>~`9<code>ï¼Œ</code>_`</td>
</tr>
<tr>
<td align="left"><code>\s</code></td>
<td align="left">ç©ºæ ¼ã€Tabé”®</td>
<td align="left">ç©ºæ ¼ï¼ŒTab</td>
</tr>
<tr>
<td align="left"><code>\D</code></td>
<td align="left">éæ•°å­—</td>
<td align="left"><code>a</code>ï¼Œ<code>A</code>ï¼Œ<code>&amp;</code>ï¼Œ<code>_</code>ï¼Œâ€¦â€¦</td>
</tr>
<tr>
<td align="left"><code>\W</code></td>
<td align="left">é\w</td>
<td align="left"><code>&amp;</code>ï¼Œ<code>@</code>ï¼Œ<code>ä¸­</code>ï¼Œâ€¦â€¦</td>
</tr>
<tr>
<td align="left"><code>\S</code></td>
<td align="left">é\s</td>
<td align="left"><code>a</code>ï¼Œ<code>A</code>ï¼Œ<code>&amp;</code>ï¼Œ<code>_</code>ï¼Œâ€¦â€¦</td>
</tr>
</tbody></table>
<p>å¤šä¸ªå­—ç¬¦çš„åŒ¹é…è§„åˆ™å¦‚ä¸‹ï¼š</p>
<table>
<thead>
<tr>
<th align="left">æ­£åˆ™è¡¨è¾¾å¼</th>
<th align="left">è§„åˆ™</th>
<th align="left">å¯ä»¥åŒ¹é…</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>A*</code></td>
<td align="left">ä»»æ„ä¸ªæ•°å­—ç¬¦</td>
<td align="left">ç©ºï¼Œ<code>A</code>ï¼Œ<code>AA</code>ï¼Œ<code>AAA</code>ï¼Œâ€¦â€¦</td>
</tr>
<tr>
<td align="left"><code>A+</code></td>
<td align="left">è‡³å°‘1ä¸ªå­—ç¬¦</td>
<td align="left"><code>A</code>ï¼Œ<code>AA</code>ï¼Œ<code>AAA</code>ï¼Œâ€¦â€¦</td>
</tr>
<tr>
<td align="left"><code>A?</code></td>
<td align="left">0ä¸ªæˆ–1ä¸ªå­—ç¬¦</td>
<td align="left">ç©ºï¼Œ<code>A</code></td>
</tr>
<tr>
<td align="left"><code>A&#123;3&#125;</code></td>
<td align="left">æŒ‡å®šä¸ªæ•°å­—ç¬¦</td>
<td align="left"><code>AAA</code></td>
</tr>
<tr>
<td align="left"><code>A&#123;2,3&#125;</code></td>
<td align="left">æŒ‡å®šèŒƒå›´ä¸ªæ•°å­—ç¬¦</td>
<td align="left"><code>AA</code>ï¼Œ<code>AAA</code></td>
</tr>
<tr>
<td align="left"><code>A&#123;2,&#125;</code></td>
<td align="left">è‡³å°‘nä¸ªå­—ç¬¦</td>
<td align="left"><code>AA</code>ï¼Œ<code>AAA</code>ï¼Œ<code>AAAA</code>ï¼Œâ€¦â€¦</td>
</tr>
<tr>
<td align="left"><code>A&#123;0,3&#125;</code></td>
<td align="left">æœ€å¤šnä¸ªå­—ç¬¦</td>
<td align="left">ç©ºï¼Œ<code>A</code>ï¼Œ<code>AA</code>ï¼Œ<code>AAA</code></td>
</tr>
</tbody></table>
<p>æ³¨æ„ï¼šåœ¨JAVAä¸­<code>\</code>ä¹Ÿæ˜¯Javaå­—ç¬¦ä¸²çš„è½¬ä¹‰å­—ç¬¦ï¼Œä¸¤ä¸ª<code>\\</code>å®é™…ä¸Šè¡¨ç¤ºçš„æ˜¯ä¸€ä¸ª<code>\</code>ï¼š</p>
<p>ä¾‹å¦‚ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;\\d&#123;3,4&#125;-\\d&#123;7,8&#125;&quot;</span></span><br><span class="line"><span class="comment">// åŒ¹é…å›½å†…çš„ç”µè¯å·ç è§„åˆ™ï¼š3~4ä½åŒºå·åŠ 7~8ä½ç”µè¯ï¼Œä¸­é—´ç”¨-è¿æ¥</span></span><br></pre></td></tr></table></figure>

<h2 id="3-å¤æ‚åŒ¹é…è§„åˆ™"><a href="#3-å¤æ‚åŒ¹é…è§„åˆ™" class="headerlink" title="3. å¤æ‚åŒ¹é…è§„åˆ™"></a>3. å¤æ‚åŒ¹é…è§„åˆ™</h2><table>
<thead>
<tr>
<th align="left">æ­£åˆ™è¡¨è¾¾å¼</th>
<th align="left">è§„åˆ™</th>
<th align="left">å¯ä»¥åŒ¹é…</th>
</tr>
</thead>
<tbody><tr>
<td align="left">^</td>
<td align="left">å¼€å¤´</td>
<td align="left">å­—ç¬¦ä¸²å¼€å¤´</td>
</tr>
<tr>
<td align="left">$</td>
<td align="left">ç»“å°¾</td>
<td align="left">å­—ç¬¦ä¸²ç»“æŸ</td>
</tr>
<tr>
<td align="left">[ABC]</td>
<td align="left">[â€¦]å†…ä»»æ„å­—ç¬¦</td>
<td align="left">Aï¼ŒBï¼ŒC</td>
</tr>
<tr>
<td align="left">[A-F0-9xy]</td>
<td align="left">æŒ‡å®šèŒƒå›´çš„å­—ç¬¦</td>
<td align="left"><code>A</code>ï¼Œâ€¦â€¦ï¼Œ<code>F</code>ï¼Œ<code>0</code>ï¼Œâ€¦â€¦ï¼Œ<code>9</code>ï¼Œ<code>x</code>ï¼Œ<code>y</code></td>
</tr>
<tr>
<td align="left">[^A-F]</td>
<td align="left">æŒ‡å®šèŒƒå›´å¤–çš„ä»»æ„å­—ç¬¦</td>
<td align="left">é<code>A</code>~`F`</td>
</tr>
<tr>
<td align="left">AB|CD|EF</td>
<td align="left">ABæˆ–CDæˆ–EF</td>
<td align="left"><code>AB</code>ï¼Œ<code>CD</code>ï¼Œ<code>EF</code></td>
</tr>
</tbody></table>
<p>å¯ä»¥ä½¿ç”¨å°æ‹¬å·æ¥è¿›è¡ŒåŒ¹é…é¡ºåºçš„æ”¹å˜ã€‚</p>
<p>ä¾‹å¦‚ï¼š</p>
<p>åŒ¹é…å­—ç¬¦ä¸²<code>learn java</code>ã€<code>learn php</code>å’Œ<code>learn go</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String re = <span class="string">&quot;learn\\s(java|php|go)&quot;</span>;</span><br><span class="line">        System.out.println(<span class="string">&quot;learn java&quot;</span>.matches(re));</span><br><span class="line">        System.out.println(<span class="string">&quot;learn Java&quot;</span>.matches(re));</span><br><span class="line">        System.out.println(<span class="string">&quot;learn php&quot;</span>.matches(re));</span><br><span class="line">        System.out.println(<span class="string">&quot;learn Go&quot;</span>.matches(re));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="4-åˆ†ç»„åŒ¹é…"><a href="#4-åˆ†ç»„åŒ¹é…" class="headerlink" title="4. åˆ†ç»„åŒ¹é…"></a>4. åˆ†ç»„åŒ¹é…</h2><p>å¦‚æœè¦åˆ†ç»„åŒ¹é…ï¼Œç¬¬ä¸€æ­¥ä¿®æ”¹æ­£åˆ™è¡¨è¾¾å¼ï¼Œå°†è¦åˆ†ç»„çš„å­—ä¸²ç”¨æ‹¬å·æ‹¬èµ·æ¥ã€‚</p>
<p>åŒ¹é…åï¼Œå¦‚ä½•æŒ‰æ‹¬å·æå–å­ä¸²ï¼Ÿ</p>
<p>æˆ‘ä»¬å¯ä»¥å¯¼å…¥<code>java.util.regex</code>åŒ…ï¼Œç”¨<code>Pattern</code>å¯¹è±¡åŒ¹é…ï¼ŒåŒ¹é…åè·å¾—ä¸€ä¸ª<code>Matcher</code>å¯¹è±¡ï¼Œå¦‚æœåŒ¹é…æˆåŠŸï¼Œå°±å¯ä»¥ç›´æ¥ä»<code>Matcher.group(index)</code>è¿”å›å­ä¸²ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Pattern p = Pattern.compile(<span class="string">&quot;(\\d&#123;3,4&#125;)\\-(\\d&#123;7,8&#125;)&quot;</span>);</span><br><span class="line">        Matcher m = p.matcher(<span class="string">&quot;010-12345678&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (m.matches()) &#123;</span><br><span class="line">            String g1 = m.group(<span class="number">1</span>);</span><br><span class="line">            String g2 = m.group(<span class="number">2</span>);</span><br><span class="line">            System.out.println(g1);</span><br><span class="line">            System.out.println(g2);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;åŒ¹é…å¤±è´¥!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ­£åˆ™è¡¨è¾¾å¼ç”¨<code>(...)</code>åˆ†ç»„å¯ä»¥é€šè¿‡<code>Matcher</code>å¯¹è±¡å¿«é€Ÿæå–å­ä¸²ï¼š</p>
<ul>
<li><code>group(0)</code>è¡¨ç¤ºåŒ¹é…çš„æ•´ä¸ªå­—ç¬¦ä¸²ï¼›</li>
<li><code>group(1)</code>è¡¨ç¤ºç¬¬1ä¸ªå­ä¸²ï¼Œ<code>group(2)</code>è¡¨ç¤ºç¬¬2ä¸ªå­ä¸²ï¼Œä»¥æ­¤ç±»æ¨ã€‚</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Pattern p = Pattern.compile(<span class="string">&quot;(\\d&#123;3,4&#125;)\\-(\\d&#123;7,8&#125;)&quot;</span>);</span><br><span class="line">        Matcher m = p.matcher(<span class="string">&quot;010-12345678&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (m.matches()) &#123;</span><br><span class="line">            String g1 = m.group(<span class="number">1</span>);</span><br><span class="line">            String g2 = m.group(<span class="number">2</span>);</span><br><span class="line">            System.out.println(g1);</span><br><span class="line">            System.out.println(g2);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;åŒ¹é…å¤±è´¥!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>String.matches()</code>æ–¹æ³•å†…éƒ¨è°ƒç”¨çš„å°±æ˜¯<code>Pattern</code>å’Œ<code>Matcher</code>ç±»çš„æ–¹æ³•ã€‚</p>
<p>ä½†æ˜¯ï¼Œåœ¨æ¯ä¸€æ­¤åŒ¹é…æ—¶éƒ½ä¼šé‡æ–°ç”Ÿæˆ<code>Pattern</code>å¯¹è±¡ï¼Œæ•ˆç‡ä½ã€‚å¦‚æœæ¶‰åŠåˆ°å¤šæ¬¡åŒ¹é…ï¼Œå¯ä»¥ä½¿ç”¨<code>Pattern</code>å¯¹è±¡ã€‚</p>
<p>ä¾‹å¦‚ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Pattern pattern = Pattern.compile(<span class="string">&quot;(\\d&#123;3,4&#125;)\\-(\\d&#123;7,8&#125;)&quot;</span>);</span><br><span class="line">        pattern.matcher(<span class="string">&quot;010-12345678&quot;</span>).matches(); <span class="comment">// true</span></span><br><span class="line">        pattern.matcher(<span class="string">&quot;021-123456&quot;</span>).matches(); <span class="comment">// true</span></span><br><span class="line">        pattern.matcher(<span class="string">&quot;022#1234567&quot;</span>).matches(); <span class="comment">// false</span></span><br><span class="line">        <span class="comment">// è·å¾—Matcherå¯¹è±¡:</span></span><br><span class="line">        Matcher matcher = pattern.matcher(<span class="string">&quot;010-12345678&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (matcher.matches()) &#123;</span><br><span class="line">            String whole = matcher.group(<span class="number">0</span>); <span class="comment">// &quot;010-12345678&quot;, 0è¡¨ç¤ºåŒ¹é…çš„æ•´ä¸ªå­—ç¬¦ä¸²</span></span><br><span class="line">            String area = matcher.group(<span class="number">1</span>); <span class="comment">// &quot;010&quot;, 1è¡¨ç¤ºåŒ¹é…çš„ç¬¬1ä¸ªå­ä¸²</span></span><br><span class="line">            String tel = matcher.group(<span class="number">2</span>); <span class="comment">// &quot;12345678&quot;, 2è¡¨ç¤ºåŒ¹é…çš„ç¬¬2ä¸ªå­ä¸²</span></span><br><span class="line">            System.out.println(area);</span><br><span class="line">            System.out.println(tel);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="5-éè´ªå©ªåŒ¹é…"><a href="#5-éè´ªå©ªåŒ¹é…" class="headerlink" title="5. éè´ªå©ªåŒ¹é…"></a>5. éè´ªå©ªåŒ¹é…</h2><p>æ­£åˆ™è¡¨è¾¾å¼é»˜è®¤ä½¿ç”¨è´ªå©ªåŒ¹é…ï¼šä»»ä½•ä¸€ä¸ªè§„åˆ™ï¼Œå®ƒæ€»æ˜¯å°½å¯èƒ½å¤šåœ°å‘ååŒ¹é…ã€‚</p>
<p>ä¾‹å¦‚ï¼š<code>(\d+)(0*)</code>æˆ‘ä»¬æƒ³æŠŠæ•°å­—å’Œåé¢çš„0åŒºåˆ†å¼€ï¼Œåˆ©ç”¨matcherå¯¹è±¡æå–å‡ºå‰å‡ ä½çš„é0æ•°å­—ä»¥åŠåé¢çš„0ã€‚</p>
<p>ä½†æ˜¯ç”±äºæ­£åˆ™è¡¨è¾¾å¼çš„è´ªå©ªæ€§è´¨ï¼Œæ‰€ä»¥æ²¡åŠæ³•æå–å‡ºåé¢çš„0ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Pattern pattern = Pattern.compile(<span class="string">&quot;(\\d+)(0*)&quot;</span>);</span><br><span class="line">        Matcher matcher = pattern.matcher(<span class="string">&quot;1230000&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (matcher.matches()) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;group1=&quot;</span> + matcher.group(<span class="number">1</span>)); <span class="comment">// &quot;1230000&quot;</span></span><br><span class="line">            System.out.println(<span class="string">&quot;group2=&quot;</span> + matcher.group(<span class="number">2</span>)); <span class="comment">// &quot;&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¦è®©<code>\d+</code>å°½é‡å°‘åŒ¹é…ï¼Œè®©<code>0*</code>å°½é‡å¤šåŒ¹é…ï¼Œæˆ‘ä»¬å°±å¿…é¡»è®©<code>\d+</code>ä½¿ç”¨éè´ªå©ªåŒ¹é…ã€‚</p>
<p>ç»™å®šä¸€ä¸ªåŒ¹é…è§„åˆ™ï¼ŒåŠ ä¸Š<code>?</code>åå°±å˜æˆäº†éè´ªå©ªåŒ¹é…ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Pattern pattern = Pattern.compile(<span class="string">&quot;(\\d+?)(0*)&quot;</span>);</span><br><span class="line">        Matcher matcher = pattern.matcher(<span class="string">&quot;1230000&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (matcher.matches()) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;group1=&quot;</span> + matcher.group(<span class="number">1</span>)); <span class="comment">// &quot;123&quot;</span></span><br><span class="line">            System.out.println(<span class="string">&quot;group2=&quot;</span> + matcher.group(<span class="number">2</span>)); <span class="comment">// &quot;0000&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">group1=123</span></span><br><span class="line"><span class="comment">group2=0000</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<h2 id="6-æœç´¢å’Œæ›¿æ¢"><a href="#6-æœç´¢å’Œæ›¿æ¢" class="headerlink" title="6. æœç´¢å’Œæ›¿æ¢"></a>6. æœç´¢å’Œæ›¿æ¢</h2><h3 id="6-1-åˆ†å‰²å­—ç¬¦ä¸²"><a href="#6-1-åˆ†å‰²å­—ç¬¦ä¸²" class="headerlink" title="6.1 åˆ†å‰²å­—ç¬¦ä¸²"></a>6.1 åˆ†å‰²å­—ç¬¦ä¸²</h3><p>ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼åˆ†å‰²å­—ç¬¦ä¸²å¯ä»¥å®ç°æ›´åŠ çµæ´»çš„åŠŸèƒ½ã€‚<code>String.split()</code>æ–¹æ³•ä¼ å…¥çš„æ­£æ˜¯æ­£åˆ™è¡¨è¾¾å¼ã€‚æˆ‘ä»¬æ¥çœ‹ä¸‹é¢çš„ä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;a b c&quot;</span>.split(<span class="string">&quot;\\s&quot;</span>); <span class="comment">// &#123; &quot;a&quot;, &quot;b&quot;, &quot;c&quot; &#125;</span></span><br><span class="line"><span class="string">&quot;a b  c&quot;</span>.split(<span class="string">&quot;\\s&quot;</span>); <span class="comment">// &#123; &quot;a&quot;, &quot;b&quot;, &quot;&quot;, &quot;c&quot; &#125;</span></span><br><span class="line"><span class="string">&quot;a, b ;; c&quot;</span>.split(<span class="string">&quot;[\\,\\;\\s]+&quot;</span>); <span class="comment">// &#123; &quot;a&quot;, &quot;b&quot;, &quot;c&quot; &#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="6-2-æœç´¢å­—ç¬¦ä¸²"><a href="#6-2-æœç´¢å­—ç¬¦ä¸²" class="headerlink" title="6.2 æœç´¢å­—ç¬¦ä¸²"></a>6.2 æœç´¢å­—ç¬¦ä¸²</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String s = <span class="string">&quot;the quick brown fox jumps over the lazy dog.&quot;</span>;</span><br><span class="line">        Pattern p = Pattern.compile(<span class="string">&quot;\\wo\\w&quot;</span>);</span><br><span class="line">        Matcher m = p.matcher(s);</span><br><span class="line">        <span class="keyword">while</span> (m.find()) &#123;</span><br><span class="line">            String sub = s.substring(m.start(), m.end());</span><br><span class="line">            System.out.println(sub);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">row</span></span><br><span class="line"><span class="comment">fox</span></span><br><span class="line"><span class="comment">dog</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p>è·å–åˆ°<code>Matcher</code>å¯¹è±¡åï¼Œåå¤è°ƒç”¨<code>find()</code>æ–¹æ³•ï¼Œåœ¨æ•´ä¸ªä¸²ä¸­æœç´¢èƒ½åŒ¹é…ä¸Š<code>\\wo\\w</code>è§„åˆ™çš„å­ä¸²ï¼Œå¹¶æ‰“å°å‡ºæ¥ã€‚</p>
<h3 id="6-3-æ›¿æ¢å­—ç¬¦ä¸²"><a href="#6-3-æ›¿æ¢å­—ç¬¦ä¸²" class="headerlink" title="6.3 æ›¿æ¢å­—ç¬¦ä¸²"></a>6.3 æ›¿æ¢å­—ç¬¦ä¸²</h3><p>ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æ›¿æ¢å­—ç¬¦ä¸²å¯ä»¥ç›´æ¥è°ƒç”¨<code>String.replaceAll()</code>ï¼Œå®ƒçš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æ­£åˆ™è¡¨è¾¾å¼ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯å¾…æ›¿æ¢çš„å­—ç¬¦ä¸²ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String s = <span class="string">&quot;The     quick\t\t brown   fox  jumps   over the  lazy dog.&quot;</span>;</span><br><span class="line">        String r = s.replaceAll(<span class="string">&quot;\\s+&quot;</span>, <span class="string">&quot; &quot;</span>);</span><br><span class="line">        System.out.println(r); <span class="comment">// &quot;The quick brown fox jumps over the lazy dog.&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="6-4-åå‘å¼•ç”¨"><a href="#6-4-åå‘å¼•ç”¨" class="headerlink" title="6.4 åå‘å¼•ç”¨"></a>6.4 åå‘å¼•ç”¨</h3><p>å¦‚æœæˆ‘ä»¬è¦æŠŠæœç´¢åˆ°çš„æŒ‡å®šå­—ç¬¦ä¸²æŒ‰è§„åˆ™æ›¿æ¢ï¼Œæ¯”å¦‚å‰åå„åŠ ä¸€ä¸ª<code>&lt;b&gt;xxxx&lt;/b&gt;</code>ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œä½¿ç”¨<code>replaceAll()</code>çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¼ å…¥çš„ç¬¬äºŒä¸ªå‚æ•°å¯ä»¥ä½¿ç”¨<code>$1</code>ã€<code>$2</code>æ¥åå‘å¼•ç”¨åŒ¹é…åˆ°çš„å­ä¸²ã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String s = <span class="string">&quot;the quick brown fox jumps over the lazy dog.&quot;</span>;</span><br><span class="line">        String r = s.replaceAll(<span class="string">&quot;\\s([a-z]&#123;4&#125;)\\s&quot;</span>, <span class="string">&quot; &lt;b&gt;$1&lt;/b&gt; &quot;</span>);</span><br><span class="line">        System.out.println(r);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">the quick brown fox jumps &lt;b&gt;over&lt;/b&gt; the &lt;b&gt;lazy&lt;/b&gt; dog.</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p>å®ƒç”¨åŒ¹é…çš„åˆ†ç»„å­ä¸²<code>([a-z]&#123;4&#125;)</code>æ›¿æ¢äº†<code>$1</code>ã€‚</p>
]]></content>
      <tags>
        <tag>JAVA</tag>
        <tag>æ­£åˆ™</tag>
      </tags>
  </entry>
  <entry>
    <title>ç»™hexoæ­å»ºçš„github-pageç»‘å®šåŸŸå</title>
    <url>/2021/05/11/%E7%BB%99githubpage%E7%BB%91%E5%AE%9A%E5%9F%9F%E5%90%8D/</url>
    <content><![CDATA[<h1 id="github-pageç»‘å®šåŸŸå"><a href="#github-pageç»‘å®šåŸŸå" class="headerlink" title="github-pageç»‘å®šåŸŸå"></a>github-pageç»‘å®šåŸŸå</h1><p>å¿ƒè¡€æ¥æ½®ï¼Œåˆ«äººå®¶çš„åšå®¢éƒ½æœ‰åŸŸåï¼Œæˆ‘ä¹Ÿè¦ï¼</p>
<img src="https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fdingyue.nosdn.127.net%2FzHz6HuOqltLyAdSJvjhSrQIcU5irErphu%3Dk3pPpXDOvK41516856240100compressflag.jpg&refer=http%3A%2F%2Fdingyue.nosdn.127.net&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=jpeg?sec=1623332105&t=8140b449423b67261bfb0f4be4f7153f" alt="img" style="zoom:50%;" />

<h2 id="1-æ³¨å†ŒåŸŸå"><a href="#1-æ³¨å†ŒåŸŸå" class="headerlink" title="1. æ³¨å†ŒåŸŸå"></a>1. æ³¨å†ŒåŸŸå</h2><p>æ³¨å†ŒåŸŸåæˆ‘é€‰æ‹©çš„æ˜¯é˜¿é‡Œäº‘çš„<a href="https://wanwang.aliyun.com/">ä¸‡ç½‘</a>ï¼Œç”±äºæ˜¯æ–°äººï¼Œé€‰æ‹©äº†ä¸€å…ƒè´­åŸŸåä¸“åŒºã€‚</p>
<p><img src="https://raw.githubusercontent.com/ghj1998/image_repository/main/image-20210511214823347.png" alt="image-20210511214823347"></p>
<p>ä¸€å…ƒè´­ï¼Œå†²å†²å†²ï¼ï¼</p>
<p><img src="https://raw.githubusercontent.com/ghj1998/image_repository/main/image-20210511215212606.png" alt="image-20210511215212606"></p>
<p>æ”¯ä»˜æ—¶éœ€è¦åˆ›å»ºä¿¡æ¯æ¨¡æ¿æ‰å¯ä»¥æ”¯ä»˜ï¼Œç‚¹å‡»åˆ›å»ºæ–°çš„ä¿¡æ¯æ¨¡æ¿åˆ›å»ºå°±OKå•¦ã€‚</p>
<p>åˆ›å»ºä¿¡æ¯æ¨¡æ¿åéœ€è¦è¿›è¡Œé‚®ç®±è®¤è¯å’Œå®åè®¤è¯ã€‚</p>
<p>åŸŸåæ³¨å†Œå®Œæ¯•ï¼</p>
<h2 id="2-ç»™github-pageæ·»åŠ CNAMEè§£æã€‚"><a href="#2-ç»™github-pageæ·»åŠ CNAMEè§£æã€‚" class="headerlink" title="2. ç»™github-pageæ·»åŠ CNAMEè§£æã€‚"></a>2. ç»™github-pageæ·»åŠ CNAMEè§£æã€‚</h2><p>æˆ‘ç”¨çš„æ˜¯hexoæ­å»ºçš„ä¸ªäººåšå®¢ï¼Œæ‰€ä»¥ä»¥ä¸‹é’ˆå¯¹hexoã€‚</p>
<p>åœ¨åšå®¢æ ¹ç›®å½•ä¸‹çš„<code>source</code>ç›®å½•ä¸‹æ–°å»ºä¸ªæ–‡ä»¶CNAMEï¼Œæ–‡ä»¶å†…å®¹å¡«å†™è‡ªå·±æ³¨å†Œçš„åŸŸåã€‚</p>
<p><strong>æ³¨æ„</strong>ï¼šä¸å†™www</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ &#x2F;blog&#x2F;CNAME</span><br><span class="line"></span><br><span class="line">ghj1998.top</span><br></pre></td></tr></table></figure>

<p>å°†ä¿®æ”¹æ¨é€åˆ°githubã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo clean</span><br><span class="line">$ hexo d</span><br></pre></td></tr></table></figure>

<h2 id="3-æ·»åŠ åŸŸåè§£æ"><a href="#3-æ·»åŠ åŸŸåè§£æ" class="headerlink" title="3. æ·»åŠ åŸŸåè§£æ"></a>3. æ·»åŠ åŸŸåè§£æ</h2><p><img src="https://raw.githubusercontent.com/ghj1998/image_repository/main/image-20210511220015320.png" alt="image-20210511220015320"></p>
<p>åœ¨åŸŸåç®¡ç†é¡µé¢ç‚¹å‡»è§£æ</p>
<p><img src="https://raw.githubusercontent.com/ghj1998/image_repository/main/image-20210511220117898.png" alt="image-20210511220117898"></p>
<p>æ·»åŠ ä¸¤æ¡è®°å½•ï¼Œä¸»æœºè®°å½•ä¸€ä¸ªå¡«å†™@ï¼Œä¸€ä¸ªå¡«å†™wwwã€‚</p>
<p>è¿™æ ·æ— è®ºæœ‰æ²¡æœ‰wwwï¼Œéƒ½å¯ä»¥è®¿é—®åˆ°ä½ çš„åŸŸåã€‚</p>
<p>è®°å½•ç±»å‹é€‰æ‹©CNAMEã€‚</p>
<p>è®°å½•å€¼è¾“å…¥github-pageçš„åœ°å€ï¼Œå³ <code>ç”¨æˆ·å.github.io</code></p>
<p>OKï¼ŒåŸŸåè§£æå®Œæ¯•ã€‚</p>
<p><strong>ç­‰å¾…å‡ åˆ†é’Ÿï¼Œå°±å¯ä»¥ç”¨åŸŸåè®¿é—®ä½ çš„github-pageäº†ã€‚</strong></p>
<p>æ¬¢è¿è®¿é—®æˆ‘çš„åŸŸå ï¼š<a href="http://www.ghj1998.top/">www.ghj1998.top</a></p>
<hr>
<p><strong>è‡ªå·±é‡åˆ°çš„é—®é¢˜</strong></p>
<p>è§£æå®ŒåŸŸåï¼Œå‘ç°DNSä»ç„¶æœ‰é—®é¢˜ï¼Œç„¶åå‘ç°æ˜¯è‡ªå·±æ²¡æœ‰å®åè®¤è¯ğŸ¤£, é˜¿é‡Œäº‘ä¸ç»™æˆ‘è§£æDNSã€‚</p>
]]></content>
      <tags>
        <tag>hexo</tag>
        <tag>github</tag>
      </tags>
  </entry>
  <entry>
    <title>ç¼–ç </title>
    <url>/2021/05/06/%E7%BC%96%E7%A0%81%E6%80%BB%E7%BB%93/</url>
    <content><![CDATA[<h1 id="ç¼–ç "><a href="#ç¼–ç " class="headerlink" title="ç¼–ç "></a>ç¼–ç </h1><h2 id="1-ASCIIç "><a href="#1-ASCIIç " class="headerlink" title="1. ASCIIç "></a>1. ASCIIç </h2><p>ASCIIç å°±æ˜¯ä¸€ç§ç¼–ç ï¼Œå­—æ¯<code>A</code>çš„ç¼–ç æ˜¯åå…­è¿›åˆ¶çš„<code>0x41</code>ï¼Œå­—æ¯<code>B</code>æ˜¯<code>0x42</code>ï¼Œä»¥æ­¤ç±»æ¨ï¼š</p>
<table>
<thead>
<tr>
<th align="left">å­—æ¯</th>
<th align="left">ASCIIç¼–ç </th>
</tr>
</thead>
<tbody><tr>
<td align="left">A</td>
<td align="left">0x41</td>
</tr>
<tr>
<td align="left">B</td>
<td align="left">0x42</td>
</tr>
<tr>
<td align="left">C</td>
<td align="left">0x43</td>
</tr>
<tr>
<td align="left">D</td>
<td align="left">0x44</td>
</tr>
</tbody></table>
<p>ASCIIç ä¸æ”¯æŒä¸­æ–‡ç¼–ç ã€‚</p>
<h2 id="2-Unicodeç¼–ç "><a href="#2-Unicodeç¼–ç " class="headerlink" title="2. Unicodeç¼–ç "></a>2. Unicodeç¼–ç </h2><p>Unicodeå®ç°äº†å¯¹æ›´å¤šæ–‡å­—è¿›è¡Œç¼–ç ã€‚</p>
<h2 id="3-UTF-8ç¼–ç "><a href="#3-UTF-8ç¼–ç " class="headerlink" title="3. UTF-8ç¼–ç "></a>3. UTF-8ç¼–ç </h2><p>UTF-8ç¼–ç ï¼Œå®ƒæ˜¯ä¸€ç§ä¸å®šé•¿ç¼–ç ã€‚å¯ä»¥ä»Unicodeæ¨å¯¼å‡ºæ¥ã€‚</p>
<table>
<thead>
<tr>
<th align="left">æ±‰å­—</th>
<th align="left">Unicodeç¼–ç </th>
<th align="left">UTF-8ç¼–ç </th>
</tr>
</thead>
<tbody><tr>
<td align="left">ä¸­</td>
<td align="left">0x4e2d</td>
<td align="left">0xe4b8ad</td>
</tr>
<tr>
<td align="left">æ–‡</td>
<td align="left">0x6587</td>
<td align="left">0xe69687</td>
</tr>
<tr>
<td align="left">ç¼–</td>
<td align="left">0x7f16</td>
<td align="left">0xe7bc96</td>
</tr>
<tr>
<td align="left">ç </td>
<td align="left">0x7801</td>
<td align="left">0xe7a081</td>
</tr>
<tr>
<td align="left">â€¦</td>
<td align="left">â€¦</td>
<td align="left">â€¦</td>
</tr>
</tbody></table>
<h2 id="4-URLç¼–ç "><a href="#4-URLç¼–ç " class="headerlink" title="4. URLç¼–ç "></a>4. URLç¼–ç </h2><p>URLç¼–ç æ˜¯æµè§ˆå™¨å‘é€æ•°æ®ç»™æœåŠ¡å™¨æ—¶ä½¿ç”¨çš„ç¼–ç ï¼Œå®ƒé€šå¸¸é™„åŠ åœ¨URLçš„å‚æ•°éƒ¨åˆ†ï¼Œä¾‹å¦‚ï¼š</p>
<p><a href="https://www.baidu.com/s?wd=%E4%B8%AD%E6%96%87">https://www.baidu.com/s?wd=%E4%B8%AD%E6%96%87</a></p>
<p><code>%E4%B8%AD%E6%96%87</code>è¡¨ç¤ºçš„æ˜¯ä¸­æ–‡äºŒå­—ã€‚</p>
<p>ä¹‹æ‰€ä»¥éœ€è¦URLç¼–ç ï¼Œæ˜¯å› ä¸ºå‡ºäºå…¼å®¹æ€§è€ƒè™‘ï¼Œå¾ˆå¤šæœåŠ¡å™¨åªè¯†åˆ«ASCIIå­—ç¬¦ã€‚</p>
<p>URLç¼–ç æœ‰ä¸€å¥—è§„åˆ™ï¼š</p>
<ul>
<li>å¦‚æœå­—ç¬¦æ˜¯<code>A</code><del><code>Z</code>ï¼Œ<code>a</code></del><code>z</code>ï¼Œ<code>0</code>~`9<code>ä»¥åŠ</code>-<code>ã€</code>_<code>ã€</code>.<code>ã€</code>*`ï¼Œåˆ™ä¿æŒä¸å˜ï¼›</li>
<li>å¦‚æœæ˜¯å…¶ä»–å­—ç¬¦ï¼Œå…ˆè½¬æ¢ä¸ºUTF-8ç¼–ç ï¼Œç„¶åå¯¹æ¯ä¸ªå­—èŠ‚ä»¥<code>%XX</code>è¡¨ç¤ºã€‚</li>
</ul>
<p>ä¾‹å¦‚ï¼šå­—ç¬¦<code>ä¸­</code>çš„UTF-8ç¼–ç æ˜¯<code>0xe4b8ad</code>ï¼Œå› æ­¤ï¼Œå®ƒçš„URLç¼–ç æ˜¯<code>%E4%B8%AD</code>ã€‚URLç¼–ç æ€»æ˜¯å¤§å†™ã€‚</p>
<p>Javaæ ‡å‡†åº“æä¾›äº†ä¸€ä¸ª<code>URLEncoder</code>ç±»æ¥å¯¹ä»»æ„å­—ç¬¦ä¸²è¿›è¡ŒURLç¼–ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String encoded = URLEncoder.encode(<span class="string">&quot;ä¸­æ–‡!&quot;</span>, StandardCharsets.UTF_8);</span><br><span class="line">        System.out.println(encoded);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">%E4%B8%AD%E6%96%87%21</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p>å’Œæ ‡å‡†çš„URLç¼–ç ç¨æœ‰ä¸åŒï¼ŒURLEncoderæŠŠç©ºæ ¼å­—ç¬¦ç¼–ç æˆ<code>+</code>ï¼Œè€Œç°åœ¨çš„URLç¼–ç æ ‡å‡†è¦æ±‚ç©ºæ ¼è¢«ç¼–ç ä¸º<code>%20</code>ï¼Œä¸è¿‡ï¼ŒæœåŠ¡å™¨éƒ½å¯ä»¥å¤„ç†è¿™ä¸¤ç§æƒ…å†µã€‚</p>
<p>å¦‚æœæœåŠ¡å™¨æ”¶åˆ°URLç¼–ç çš„å­—ç¬¦ä¸²ï¼Œå°±å¯ä»¥å¯¹å…¶è¿›è¡Œè§£ç ï¼Œè¿˜åŸæˆåŸå§‹å­—ç¬¦ä¸²ã€‚Javaæ ‡å‡†åº“çš„<code>URLDecoder</code>å°±å¯ä»¥è§£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String decoded = URLDecoder.decode(<span class="string">&quot;%E4%B8%AD%E6%96%87%21&quot;</span>, StandardCharsets.UTF_8);</span><br><span class="line">        System.out.println(decoded);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="5-Base64ç¼–ç "><a href="#5-Base64ç¼–ç " class="headerlink" title="5. Base64ç¼–ç "></a>5. Base64ç¼–ç </h2><p>Base64ç¼–ç æ˜¯å¯¹äºŒè¿›åˆ¶æ•°æ®è¿›è¡Œç¼–ç ï¼Œè¡¨ç¤ºæˆæ–‡æœ¬æ ¼å¼ã€‚</p>
<p>Base64ç¼–ç å¯ä»¥æŠŠä»»æ„é•¿åº¦çš„äºŒè¿›åˆ¶æ•°æ®å˜ä¸ºçº¯æ–‡æœ¬ï¼Œä¸”åªåŒ…å«<code>A</code><del><code>Z</code>ã€<code>a</code></del><code>z</code>ã€<code>0</code>~`9<code>ã€</code>+<code>ã€</code>/<code>ã€</code>=`è¿™äº›å­—ç¬¦ã€‚</p>
<p>å®ƒçš„åŸç†æ˜¯æŠŠ3å­—èŠ‚çš„äºŒè¿›åˆ¶æ•°æ®æŒ‰6bitä¸€ç»„ï¼Œç”¨4ä¸ªintæ•´æ•°è¡¨ç¤ºï¼Œç„¶åæŸ¥è¡¨ï¼ŒæŠŠintæ•´æ•°ç”¨ç´¢å¼•å¯¹åº”åˆ°å­—ç¬¦ï¼Œå¾—åˆ°ç¼–ç åçš„å­—ç¬¦ä¸²ã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼š3ä¸ªbyteæ•°æ®åˆ†åˆ«æ˜¯<code>e4</code>ã€<code>b8</code>ã€<code>ad</code>ï¼ŒæŒ‰6bitåˆ†ç»„å¾—åˆ°<code>39</code>ã€<code>0b</code>ã€<code>22</code>å’Œ<code>2d</code>ï¼š</p>
<p>å› ä¸º6ä½æ•´æ•°çš„èŒƒå›´æ€»æ˜¯<code>0</code><del><code>63</code>ï¼Œæ‰€ä»¥ï¼Œèƒ½ç”¨64ä¸ªå­—ç¬¦è¡¨ç¤ºï¼šå­—ç¬¦<code>A</code></del><code>Z</code>å¯¹åº”ç´¢å¼•<code>0</code><del><code>25</code>ï¼Œå­—ç¬¦<code>a</code></del><code>z</code>å¯¹åº”ç´¢å¼•<code>26</code><del><code>51</code>ï¼Œå­—ç¬¦<code>0</code></del><code>9</code>å¯¹åº”ç´¢å¼•<code>52</code>~`61<code>ï¼Œæœ€åä¸¤ä¸ªç´¢å¼•</code>62<code>ã€</code>63<code>åˆ†åˆ«ç”¨å­—ç¬¦</code>+<code>å’Œ</code>/`è¡¨ç¤ºã€‚</p>
<p><img src="https://raw.githubusercontent.com/ghj1998/image_repository/main/image-20210506163708576.png" alt="image-20210506163708576"></p>
<p>åœ¨Javaä¸­ï¼ŒäºŒè¿›åˆ¶æ•°æ®å°±æ˜¯<code>byte[]</code>æ•°ç»„ã€‚</p>
<p>ç¼–ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">byte</span>[] input = <span class="keyword">new</span> <span class="keyword">byte</span>[] &#123; (<span class="keyword">byte</span>) <span class="number">0xe4</span>, (<span class="keyword">byte</span>) <span class="number">0xb8</span>, (<span class="keyword">byte</span>) <span class="number">0xad</span> &#125;;</span><br><span class="line">        String b64encoded = Base64.getEncoder().encodeToString(input);</span><br><span class="line">        System.out.println(b64encoded);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">5Lit</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p>è§£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">byte</span>[] output = Base64.getDecoder().decode(<span class="string">&quot;5Lit&quot;</span>);</span><br><span class="line">        System.out.println(Arrays.toString(output)); <span class="comment">// [-28, -72, -83]</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœè¾“å…¥çš„<code>byte[]</code>æ•°ç»„é•¿åº¦ä¸æ˜¯3çš„æ•´æ•°å€è‚¿ä¹ˆåŠï¼Ÿè¿™ç§æƒ…å†µä¸‹ï¼Œéœ€è¦å¯¹è¾“å…¥çš„æœ«å°¾è¡¥ä¸€ä¸ªæˆ–ä¸¤ä¸ª<code>0x00</code>ï¼Œç¼–ç åï¼Œåœ¨ç»“å°¾åŠ ä¸€ä¸ª<code>=</code>è¡¨ç¤ºè¡¥å……äº†1ä¸ª<code>0x00</code>ï¼ŒåŠ ä¸¤ä¸ª<code>=</code>è¡¨ç¤ºè¡¥å……äº†2ä¸ª<code>0x00</code>ï¼Œè§£ç çš„æ—¶å€™ï¼Œå»æ‰æœ«å°¾è¡¥å……çš„ä¸€ä¸ªæˆ–ä¸¤ä¸ª<code>0x00</code>å³å¯ã€‚</p>
<p>PS:ç¼–ç ååŠ ä¸åŠ <code>=</code>å…¶å®æ²¡æœ‰å½±å“ï¼Œå› ä¸ºç¼–ç åçš„å­—ç¬¦ä¸²å¿…å®šæ˜¯4çš„å€æ•°ï¼Œæ‰€ä»¥å¯ä»¥æ ¹æ®é•¿åº¦æ¥é¢„æµ‹åŠ äº†å‡ ä¸ª<code>=</code>ã€‚</p>
<p>ase64ç¼–ç çš„æ—¶å€™å¯ä»¥ç”¨<code>withoutPadding()</code>å»æ‰<code>=</code>:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">byte</span>[] input = <span class="keyword">new</span> <span class="keyword">byte</span>[] &#123; (<span class="keyword">byte</span>) <span class="number">0xe4</span>, (<span class="keyword">byte</span>) <span class="number">0xb8</span>, (<span class="keyword">byte</span>) <span class="number">0xad</span>, <span class="number">0x21</span> &#125;;</span><br><span class="line">        String b64encoded = Base64.getEncoder().encodeToString(input);</span><br><span class="line">        String b64encoded2 = Base64.getEncoder().withoutPadding().encodeToString(input);</span><br><span class="line">        System.out.println(b64encoded);</span><br><span class="line">        System.out.println(b64encoded2);</span><br><span class="line">        <span class="keyword">byte</span>[] output = Base64.getDecoder().decode(b64encoded2);</span><br><span class="line">        System.out.println(Arrays.toString(output));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">5LitIQ==</span></span><br><span class="line"><span class="comment">5LitIQ</span></span><br><span class="line"><span class="comment">[-28, -72, -83, 33]</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p>å› ä¸ºæ ‡å‡†çš„Base64ç¼–ç ä¼šå‡ºç°<code>+</code>ã€<code>/</code>å’Œ<code>=</code>ï¼Œæ‰€ä»¥ä¸é€‚åˆæŠŠBase64ç¼–ç åçš„å­—ç¬¦ä¸²æ”¾åˆ°URLä¸­ã€‚ä¸€ç§é’ˆå¯¹URLçš„Base64ç¼–ç å¯ä»¥åœ¨URLä¸­ä½¿ç”¨çš„Base64ç¼–ç ï¼Œå®ƒä»…ä»…æ˜¯æŠŠ<code>+</code>å˜æˆ<code>-</code>ï¼Œ<code>/</code>å˜æˆ<code>_</code>ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">byte</span>[] input = <span class="keyword">new</span> <span class="keyword">byte</span>[] &#123; <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x7f</span>, <span class="number">0x00</span> &#125;;</span><br><span class="line">        String b64encoded = Base64.getUrlEncoder().encodeToString(input);</span><br><span class="line">        System.out.println(b64encoded);</span><br><span class="line">        <span class="keyword">byte</span>[] output = Base64.getUrlDecoder().decode(b64encoded);</span><br><span class="line">        System.out.println(Arrays.toString(output));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">AQJ_AA==</span></span><br><span class="line"><span class="comment">[1, 2, 127, 0]</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p>Base64ç¼–ç çš„ç›®çš„æ˜¯æŠŠäºŒè¿›åˆ¶æ•°æ®å˜æˆæ–‡æœ¬æ ¼å¼ï¼Œè¿™æ ·åœ¨å¾ˆå¤šæ–‡æœ¬ä¸­å°±å¯ä»¥å¤„ç†äºŒè¿›åˆ¶æ•°æ®ã€‚ä¾‹å¦‚ï¼Œç”µå­é‚®ä»¶åè®®å°±æ˜¯æ–‡æœ¬åè®®ï¼Œå¦‚æœè¦åœ¨ç”µå­é‚®ä»¶ä¸­æ·»åŠ ä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå°±å¯ä»¥ç”¨Base64ç¼–ç ï¼Œç„¶åä»¥æ–‡æœ¬çš„å½¢å¼ä¼ é€ã€‚</p>
<p>Base64ç¼–ç çš„ç¼ºç‚¹æ˜¯ä¼ è¾“æ•ˆç‡ä¼šé™ä½ï¼Œå› ä¸ºå®ƒæŠŠåŸå§‹æ•°æ®çš„é•¿åº¦å¢åŠ äº†1/3ã€‚</p>
<p>å¦‚æœæŠŠBase64çš„64ä¸ªå­—ç¬¦ç¼–ç è¡¨æ¢æˆ32ä¸ªã€48ä¸ªæˆ–è€…58ä¸ªï¼Œå°±å¯ä»¥ä½¿ç”¨Base32ç¼–ç ï¼ŒBase48ç¼–ç å’ŒBase58ç¼–ç ã€‚å­—ç¬¦è¶Šå°‘ï¼Œç¼–ç çš„æ•ˆç‡å°±ä¼šè¶Šä½ã€‚</p>
]]></content>
      <tags>
        <tag>JAVA</tag>
        <tag>ç¼–ç </tag>
      </tags>
  </entry>
  <entry>
    <title>è®¾è®¡æ¨¡å¼</title>
    <url>/2021/05/10/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/</url>
    <content><![CDATA[]]></content>
  </entry>
  <entry>
    <title>JAVA-IO</title>
    <url>/2021/04/21/JAVA%E2%80%94IO/</url>
    <content><![CDATA[<h1 id="IO"><a href="#IO" class="headerlink" title="IO"></a>IO</h1><p>IOæµæ˜¯ä¸€ç§é¡ºåºè¯»å†™æ•°æ®çš„æ¨¡å¼ï¼Œå®ƒçš„ç‰¹ç‚¹æ˜¯å•å‘æµåŠ¨ã€‚æ•°æ®ç±»ä¼¼è‡ªæ¥æ°´ä¸€æ ·åœ¨æ°´ç®¡ä¸­æµåŠ¨ï¼Œæ‰€ä»¥æˆ‘ä»¬æŠŠå®ƒç§°ä¸ºIOæµã€‚</p>
<p>åœ¨Javaä¸­ï¼Œ<code>InputStream</code>ä»£è¡¨è¾“å…¥å­—èŠ‚æµï¼Œ<code>OuputStream</code>ä»£è¡¨è¾“å‡ºå­—èŠ‚æµï¼Œè¿™æ˜¯æœ€åŸºæœ¬çš„ä¸¤ç§IOæµã€‚</p>
<p>Javaæä¾›äº†<code>Reader</code>å’Œ<code>Writer</code>è¡¨ç¤ºå­—ç¬¦æµï¼Œå­—ç¬¦æµä¼ è¾“çš„æœ€å°æ•°æ®å•ä½æ˜¯<code>char</code>ã€‚</p>
<h2 id="1-Fileå¯¹è±¡"><a href="#1-Fileå¯¹è±¡" class="headerlink" title="1. Fileå¯¹è±¡"></a>1. Fileå¯¹è±¡</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        File f = <span class="keyword">new</span> File(<span class="string">&quot;C:\\Windows\\notepad.exe&quot;</span>);</span><br><span class="line">        System.out.println(f);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ„é€ Fileå¯¹è±¡æ—¶ï¼Œæ—¢å¯ä»¥ä¼ å…¥ç»å¯¹è·¯å¾„ï¼Œä¹Ÿå¯ä»¥ä¼ å…¥ç›¸å¯¹è·¯å¾„ã€‚ç»å¯¹è·¯å¾„æ˜¯ä»¥æ ¹ç›®å½•å¼€å¤´çš„å®Œæ•´è·¯å¾„ï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">File f = <span class="keyword">new</span> File(<span class="string">&quot;C:\\Windows\\notepad.exe&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„Windowså¹³å°ä½¿ç”¨<code>\</code>ä½œä¸ºè·¯å¾„åˆ†éš”ç¬¦ï¼Œåœ¨Javaå­—ç¬¦ä¸²ä¸­éœ€è¦ç”¨<code>\\</code>è¡¨ç¤ºä¸€ä¸ª<code>\</code>ã€‚Linuxå¹³å°ä½¿ç”¨<code>/</code>ä½œä¸ºè·¯å¾„åˆ†éš”ç¬¦ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">File f = <span class="keyword">new</span> File(<span class="string">&quot;/usr/bin/javac&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>Fileå¯¹è±¡æœ‰3ç§å½¢å¼è¡¨ç¤ºçš„è·¯å¾„ï¼Œä¸€ç§æ˜¯<code>getPath()</code>ï¼Œè¿”å›æ„é€ æ–¹æ³•ä¼ å…¥çš„è·¯å¾„ï¼Œä¸€ç§æ˜¯<code>getAbsolutePath()</code>ï¼Œè¿”å›ç»å¯¹è·¯å¾„ï¼Œä¸€ç§æ˜¯<code>getCanonicalPath</code>ï¼Œå®ƒå’Œç»å¯¹è·¯å¾„ç±»ä¼¼ï¼Œä½†æ˜¯è¿”å›çš„æ˜¯è§„èŒƒè·¯å¾„ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        File f = <span class="keyword">new</span> File(<span class="string">&quot;..&quot;</span>);</span><br><span class="line">        System.out.println(f.getPath());</span><br><span class="line">        System.out.println(f.getAbsolutePath());</span><br><span class="line">        System.out.println(f.getCanonicalPath());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*è¾“å‡ºï¼š</span></span><br><span class="line"><span class="comment">..</span></span><br><span class="line"><span class="comment">/app/..</span></span><br><span class="line"><span class="comment">/</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p>ç”¨<code>File</code>å¯¹è±¡è·å–åˆ°ä¸€ä¸ªæ–‡ä»¶æ—¶ï¼Œè¿˜å¯ä»¥è¿›ä¸€æ­¥åˆ¤æ–­æ–‡ä»¶çš„æƒé™å’Œå¤§å°ï¼š</p>
<ul>
<li><code>boolean canRead()</code>ï¼šæ˜¯å¦å¯è¯»ï¼›</li>
<li><code>boolean canWrite()</code>ï¼šæ˜¯å¦å¯å†™ï¼›</li>
<li><code>boolean canExecute()</code>ï¼šæ˜¯å¦å¯æ‰§è¡Œï¼›</li>
<li><code>long length()</code>ï¼šæ–‡ä»¶å­—èŠ‚å¤§å°ã€‚</li>
</ul>
<p><strong>åˆ›å»ºå’Œåˆ é™¤æ–‡ä»¶</strong></p>
<p>å½“Fileå¯¹è±¡è¡¨ç¤ºä¸€ä¸ªæ–‡ä»¶æ—¶ï¼Œå¯ä»¥é€šè¿‡<code>createNewFile()</code>åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶ï¼Œç”¨<code>delete()</code>åˆ é™¤è¯¥æ–‡ä»¶ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">File file = <span class="keyword">new</span> File(<span class="string">&quot;/path/to/file&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (file.createNewFile()) &#123;</span><br><span class="line">    <span class="comment">// æ–‡ä»¶åˆ›å»ºæˆåŠŸ:</span></span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span></span></span><br><span class="line">    <span class="keyword">if</span> (file.delete()) &#123;</span><br><span class="line">        <span class="comment">// åˆ é™¤æ–‡ä»¶æˆåŠŸ:</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Fileå¯¹è±¡æä¾›äº†<code>createTempFile()</code>æ¥åˆ›å»ºä¸€ä¸ªä¸´æ—¶æ–‡ä»¶ï¼Œä»¥åŠ<code>deleteOnExit()</code>åœ¨JVMé€€å‡ºæ—¶è‡ªåŠ¨åˆ é™¤è¯¥æ–‡ä»¶ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        File f = File.createTempFile(<span class="string">&quot;tmp-&quot;</span>, <span class="string">&quot;.txt&quot;</span>); <span class="comment">// æä¾›ä¸´æ—¶æ–‡ä»¶çš„å‰ç¼€å’Œåç¼€</span></span><br><span class="line">        f.deleteOnExit(); <span class="comment">// JVMé€€å‡ºæ—¶è‡ªåŠ¨åˆ é™¤</span></span><br><span class="line">        System.out.println(f.isFile());</span><br><span class="line">        System.out.println(f.getAbsolutePath());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>éå†æ–‡ä»¶å’Œç›®å½•</strong></p>
<p>å½“Fileå¯¹è±¡è¡¨ç¤ºä¸€ä¸ªç›®å½•æ—¶ï¼Œå¯ä»¥ä½¿ç”¨<code>list()</code>å’Œ<code>listFiles()</code>åˆ—å‡ºç›®å½•ä¸‹çš„æ–‡ä»¶å’Œå­ç›®å½•åã€‚<code>listFiles()</code>æä¾›äº†ä¸€ç³»åˆ—é‡è½½æ–¹æ³•ï¼Œå¯ä»¥è¿‡æ»¤ä¸æƒ³è¦çš„æ–‡ä»¶å’Œç›®å½•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        File f = <span class="keyword">new</span> File(<span class="string">&quot;C:\\Windows&quot;</span>);</span><br><span class="line">        File[] fs1 = f.listFiles(); <span class="comment">// åˆ—å‡ºæ‰€æœ‰æ–‡ä»¶å’Œå­ç›®å½•</span></span><br><span class="line">        printFiles(fs1);</span><br><span class="line">        File[] fs2 = f.listFiles(<span class="keyword">new</span> FilenameFilter() &#123; <span class="comment">// ä»…åˆ—å‡º.exeæ–‡ä»¶</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">accept</span><span class="params">(File dir, String name)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> name.endsWith(<span class="string">&quot;.exe&quot;</span>); <span class="comment">// è¿”å›trueè¡¨ç¤ºæ¥å—è¯¥æ–‡ä»¶</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        printFiles(fs2);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">printFiles</span><span class="params">(File[] files)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;==========&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (files != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (File f : files) &#123;</span><br><span class="line">                System.out.println(f);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;==========&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å’Œæ–‡ä»¶æ“ä½œç±»ä¼¼ï¼ŒFileå¯¹è±¡å¦‚æœè¡¨ç¤ºä¸€ä¸ªç›®å½•ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹æ³•åˆ›å»ºå’Œåˆ é™¤ç›®å½•ï¼š</p>
<ul>
<li><code>boolean mkdir()</code>ï¼šåˆ›å»ºå½“å‰Fileå¯¹è±¡è¡¨ç¤ºçš„ç›®å½•ï¼›</li>
<li><code>boolean mkdirs()</code>ï¼šåˆ›å»ºå½“å‰Fileå¯¹è±¡è¡¨ç¤ºçš„ç›®å½•ï¼Œå¹¶åœ¨å¿…è¦æ—¶å°†ä¸å­˜åœ¨çš„çˆ¶ç›®å½•ä¹Ÿåˆ›å»ºå‡ºæ¥ï¼›</li>
<li><code>boolean delete()</code>ï¼šåˆ é™¤å½“å‰Fileå¯¹è±¡è¡¨ç¤ºçš„ç›®å½•ï¼Œå½“å‰ç›®å½•å¿…é¡»ä¸ºç©ºæ‰èƒ½åˆ é™¤æˆåŠŸã€‚</li>
</ul>
<p><strong>Path</strong></p>
<p>Javaæ ‡å‡†åº“è¿˜æä¾›äº†ä¸€ä¸ª<code>Path</code>å¯¹è±¡ï¼Œå®ƒä½äº<code>java.nio.file</code>åŒ…ã€‚<code>Path</code>å¯¹è±¡å’Œ<code>File</code>å¯¹è±¡ç±»ä¼¼ï¼Œä½†æ“ä½œæ›´åŠ ç®€å•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        Path p1 = Paths.get(<span class="string">&quot;.&quot;</span>, <span class="string">&quot;project&quot;</span>, <span class="string">&quot;study&quot;</span>); <span class="comment">// æ„é€ ä¸€ä¸ªPathå¯¹è±¡</span></span><br><span class="line">        System.out.println(p1);</span><br><span class="line">        Path p2 = p1.toAbsolutePath(); <span class="comment">// è½¬æ¢ä¸ºç»å¯¹è·¯å¾„</span></span><br><span class="line">        System.out.println(p2);</span><br><span class="line">        Path p3 = p2.normalize(); <span class="comment">// è½¬æ¢ä¸ºè§„èŒƒè·¯å¾„</span></span><br><span class="line">        System.out.println(p3);</span><br><span class="line">        File f = p3.toFile(); <span class="comment">// è½¬æ¢ä¸ºFileå¯¹è±¡</span></span><br><span class="line">        System.out.println(f);</span><br><span class="line">        <span class="keyword">for</span> (Path p : Paths.get(<span class="string">&quot;..&quot;</span>).toAbsolutePath()) &#123; <span class="comment">// å¯ä»¥ç›´æ¥éå†Path</span></span><br><span class="line">            System.out.println(<span class="string">&quot;  &quot;</span> + p);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-InputStream"><a href="#2-InputStream" class="headerlink" title="2. InputStream"></a>2. InputStream</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">readFile</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> (InputStream input = <span class="keyword">new</span> FileInputStream(<span class="string">&quot;src/readme.txt&quot;</span>)) &#123;</span><br><span class="line">        <span class="keyword">int</span> n;</span><br><span class="line">        <span class="keyword">while</span> ((n = input.read()) != -<span class="number">1</span>) &#123;</span><br><span class="line">            System.out.println(n);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="comment">// ç¼–è¯‘å™¨åœ¨æ­¤è‡ªåŠ¨ä¸ºæˆ‘ä»¬å†™å…¥finallyå¹¶è°ƒç”¨close()</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>InputStream</code>å°±æ˜¯Javaæ ‡å‡†åº“æä¾›çš„æœ€åŸºæœ¬çš„è¾“å…¥æµã€‚</p>
<p><code>FileInputStream</code>æ˜¯<code>InputStream</code>çš„ä¸€ä¸ªå­ç±»ã€‚</p>
<p><strong>ç¼“å†²</strong></p>
<p><code>InputStream</code>æä¾›äº†ä¸¤ä¸ªé‡è½½æ–¹æ³•æ¥æ”¯æŒè¯»å–å¤šä¸ªå­—èŠ‚ï¼š</p>
<ul>
<li><code>int read(byte[] b)</code>ï¼šè¯»å–è‹¥å¹²å­—èŠ‚å¹¶å¡«å……åˆ°<code>byte[]</code>æ•°ç»„ï¼Œè¿”å›è¯»å–çš„å­—èŠ‚æ•°</li>
<li><code>int read(byte[] b, int off, int len)</code>ï¼šæŒ‡å®š<code>byte[]</code>æ•°ç»„çš„åç§»é‡å’Œæœ€å¤§å¡«å……æ•°</li>
</ul>
<p>å…ˆå®šä¹‰ä¸€ä¸ª<code>byte[]</code>æ•°ç»„ä½œä¸ºç¼“å†²åŒºï¼Œ<code>read()</code>æ–¹æ³•ä¼šå°½å¯èƒ½å¤šåœ°è¯»å–å­—èŠ‚åˆ°ç¼“å†²åŒºï¼Œ ä½†ä¸ä¼šè¶…è¿‡ç¼“å†²åŒºçš„å¤§å°ã€‚<code>read()</code>æ–¹æ³•çš„è¿”å›å€¼ä¸å†æ˜¯å­—èŠ‚çš„<code>int</code>å€¼ï¼Œè€Œæ˜¯è¿”å›å®é™…è¯»å–äº†å¤šå°‘ä¸ªå­—èŠ‚ã€‚</p>
<p>å¦‚æœè¿”å›<code>-1</code>ï¼Œè¡¨ç¤ºæ²¡æœ‰æ›´å¤šçš„æ•°æ®äº†ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">readFile</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> (InputStream input = <span class="keyword">new</span> FileInputStream(<span class="string">&quot;src/readme.txt&quot;</span>)) &#123;</span><br><span class="line">        <span class="comment">// å®šä¹‰1000ä¸ªå­—èŠ‚å¤§å°çš„ç¼“å†²åŒº:</span></span><br><span class="line">        <span class="keyword">byte</span>[] buffer = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1000</span>];</span><br><span class="line">        <span class="keyword">int</span> n;</span><br><span class="line">        <span class="keyword">while</span> ((n = input.read(buffer)) != -<span class="number">1</span>) &#123; <span class="comment">// è¯»å–åˆ°ç¼“å†²åŒº</span></span><br><span class="line">            System.out.println(<span class="string">&quot;read &quot;</span> + n + <span class="string">&quot; bytes.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>é˜»å¡</strong></p>
<p>åœ¨è°ƒç”¨<code>InputStream</code>çš„<code>read()</code>æ–¹æ³•è¯»å–æ•°æ®æ—¶ï¼Œæˆ‘ä»¬è¯´<code>read()</code>æ–¹æ³•æ˜¯é˜»å¡ï¼ˆBlockingï¼‰çš„ã€‚å®ƒçš„æ„æ€æ˜¯ï¼Œå¯¹äºä¸‹é¢çš„ä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">int</span> n;</span><br><span class="line">n = input.read(); <span class="comment">// å¿…é¡»ç­‰å¾…read()æ–¹æ³•è¿”å›æ‰èƒ½æ‰§è¡Œä¸‹ä¸€è¡Œä»£ç </span></span><br><span class="line"><span class="keyword">int</span> m = n;</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œåˆ°ç¬¬äºŒè¡Œä»£ç æ—¶ï¼Œå¿…é¡»ç­‰<code>read()</code>æ–¹æ³•è¿”å›åæ‰èƒ½ç»§ç»­ã€‚å› ä¸ºè¯»å–IOæµç›¸æ¯”æ‰§è¡Œæ™®é€šä»£ç ï¼Œé€Ÿåº¦ä¼šæ…¢å¾ˆå¤šï¼Œå› æ­¤ï¼Œæ— æ³•ç¡®å®š<code>read()</code>æ–¹æ³•è°ƒç”¨åˆ°åº•è¦èŠ±è´¹å¤šé•¿æ—¶é—´ã€‚</p>
<p><strong>InputStreamå®ç°ç±»</strong></p>
<p>ç”¨<code>FileInputStream</code>å¯ä»¥ä»æ–‡ä»¶è·å–è¾“å…¥æµï¼Œè¿™æ˜¯<code>InputStream</code>å¸¸ç”¨çš„ä¸€ä¸ªå®ç°ç±»ã€‚æ­¤å¤–ï¼Œ<code>ByteArrayInputStream</code>å¯ä»¥åœ¨å†…å­˜ä¸­æ¨¡æ‹Ÿä¸€ä¸ª<code>InputStream</code>ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="keyword">byte</span>[] data = &#123; <span class="number">72</span>, <span class="number">101</span>, <span class="number">108</span>, <span class="number">108</span>, <span class="number">111</span>, <span class="number">33</span> &#125;;</span><br><span class="line">        <span class="keyword">try</span> (InputStream input = <span class="keyword">new</span> ByteArrayInputStream(data)) &#123;</span><br><span class="line">            <span class="keyword">int</span> n;</span><br><span class="line">            <span class="keyword">while</span> ((n = input.read()) != -<span class="number">1</span>) &#123;</span><br><span class="line">                System.out.println((<span class="keyword">char</span>)n);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">H</span></span><br><span class="line"><span class="comment">e</span></span><br><span class="line"><span class="comment">l</span></span><br><span class="line"><span class="comment">l</span></span><br><span class="line"><span class="comment">o</span></span><br><span class="line"><span class="comment">!</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p><code>ByteArrayInputStream</code>å®é™…ä¸Šæ˜¯æŠŠä¸€ä¸ª<code>byte[]</code>æ•°ç»„åœ¨å†…å­˜ä¸­å˜æˆä¸€ä¸ª<code>InputStream</code>ï¼Œè™½ç„¶å®é™…åº”ç”¨ä¸å¤šï¼Œä½†æµ‹è¯•çš„æ—¶å€™ï¼Œå¯ä»¥ç”¨å®ƒæ¥æ„é€ ä¸€ä¸ª<code>InputStream</code>ã€‚</p>
<h2 id="3-OutputStream"><a href="#3-OutputStream" class="headerlink" title="3. OutputStream"></a>3. OutputStream</h2><p>å’Œ<code>InputStream</code>ç±»ä¼¼ï¼Œ<code>OutputStream</code>ä¹Ÿæ˜¯æŠ½è±¡ç±»ï¼Œå®ƒæ˜¯æ‰€æœ‰è¾“å‡ºæµçš„è¶…ç±»ã€‚è¿™ä¸ªæŠ½è±¡ç±»å®šä¹‰çš„ä¸€ä¸ªæœ€é‡è¦çš„æ–¹æ³•å°±æ˜¯<code>void write(int b)</code>ã€‚</p>
<p><code>OutputStream</code>ä¹Ÿæä¾›äº†<code>close()</code>æ–¹æ³•å…³é—­è¾“å‡ºæµï¼Œä»¥ä¾¿é‡Šæ”¾ç³»ç»Ÿèµ„æºã€‚è¦ç‰¹åˆ«æ³¨æ„ï¼š<code>OutputStream</code>è¿˜æä¾›äº†ä¸€ä¸ª<code>flush()</code>æ–¹æ³•ï¼Œå®ƒçš„ç›®çš„æ˜¯å°†ç¼“å†²åŒºçš„å†…å®¹çœŸæ­£è¾“å‡ºåˆ°ç›®çš„åœ°ã€‚</p>
<p><strong>FileOutputStream</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">writeFile</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> (OutputStream output = <span class="keyword">new</span> FileOutputStream(<span class="string">&quot;out/readme.txt&quot;</span>)) &#123;</span><br><span class="line">        output.write(<span class="string">&quot;Hello&quot;</span>.getBytes(<span class="string">&quot;UTF-8&quot;</span>)); <span class="comment">// Hello</span></span><br><span class="line">    &#125; <span class="comment">// ç¼–è¯‘å™¨åœ¨æ­¤è‡ªåŠ¨ä¸ºæˆ‘ä»¬å†™å…¥finallyå¹¶è°ƒç”¨close()</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">writeFile</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> (OutputStream output = <span class="keyword">new</span> FileOutputStream(<span class="string">&quot;out/readme.txt&quot;</span>,<span class="keyword">true</span>)) &#123;</span><br><span class="line">        output.write(<span class="string">&quot;Hello&quot;</span>.getBytes(<span class="string">&quot;UTF-8&quot;</span>)); <span class="comment">// Hello</span></span><br><span class="line">    &#125; <span class="comment">// ç¼–è¯‘å™¨åœ¨æ­¤è‡ªåŠ¨ä¸ºæˆ‘ä»¬å†™å…¥finallyå¹¶è°ƒç”¨close()</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>FileOutputStream</code>ç¬¬äºŒä¸ªå‚æ•°å¦‚æœä¸º<code>true</code>è¡¨ç¤ºå¾€æ–‡ä»¶åè¿½åŠ ï¼Œé»˜è®¤ä¸º<code>false</code>ã€‚</p>
<p><strong>é˜»å¡</strong></p>
<p>å’Œ<code>InputStream</code>ä¸€æ ·ï¼Œ<code>OutputStream</code>çš„<code>write()</code>æ–¹æ³•ä¹Ÿæ˜¯é˜»å¡çš„ã€‚</p>
<p><strong>OutputStreamå®ç°ç±»</strong></p>
<p>ç”¨<code>FileOutputStream</code>å¯ä»¥ä»æ–‡ä»¶è·å–è¾“å‡ºæµï¼Œè¿™æ˜¯<code>OutputStream</code>å¸¸ç”¨çš„ä¸€ä¸ªå®ç°ç±»ã€‚æ­¤å¤–ï¼Œ<code>ByteArrayOutputStream</code>å¯ä»¥åœ¨å†…å­˜ä¸­æ¨¡æ‹Ÿä¸€ä¸ª<code>OutputStream</code>ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="keyword">byte</span>[] data;</span><br><span class="line">        <span class="keyword">try</span> (ByteArrayOutputStream output = <span class="keyword">new</span> ByteArrayOutputStream()) &#123;</span><br><span class="line">            output.write(<span class="string">&quot;Hello &quot;</span>.getBytes(<span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">            output.write(<span class="string">&quot;world!&quot;</span>.getBytes(<span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">            data = output.toByteArray();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="keyword">new</span> String(data, <span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>ByteArrayOutputStream</code>å®é™…ä¸Šæ˜¯æŠŠä¸€ä¸ª<code>byte[]</code>æ•°ç»„åœ¨å†…å­˜ä¸­å˜æˆä¸€ä¸ª<code>OutputStream</code>ï¼Œè™½ç„¶å®é™…åº”ç”¨ä¸å¤šï¼Œä½†æµ‹è¯•çš„æ—¶å€™ï¼Œå¯ä»¥ç”¨å®ƒæ¥æ„é€ ä¸€ä¸ª<code>OutputStream</code>ã€‚</p>
<p>åŒæ—¶æ“ä½œå¤šä¸ª<code>AutoCloseable</code>èµ„æºæ—¶ï¼Œåœ¨<code>try(resource) &#123; ... &#125;</code>è¯­å¥ä¸­å¯ä»¥åŒæ—¶å†™å‡ºå¤šä¸ªèµ„æºï¼Œç”¨<code>;</code>éš”å¼€ã€‚ä¾‹å¦‚ï¼ŒåŒæ—¶è¯»å†™ä¸¤ä¸ªæ–‡ä»¶ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è¯»å–input.txtï¼Œå†™å…¥output.txt:</span></span><br><span class="line"><span class="keyword">try</span> (InputStream input = <span class="keyword">new</span> FileInputStream(<span class="string">&quot;input.txt&quot;</span>);</span><br><span class="line">     OutputStream output = <span class="keyword">new</span> FileOutputStream(<span class="string">&quot;output.txt&quot;</span>))</span><br><span class="line">&#123;</span><br><span class="line">    input.transferTo(output); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="4-Filteræ¨¡å¼"><a href="#4-Filteræ¨¡å¼" class="headerlink" title="4. Filteræ¨¡å¼"></a>4. Filteræ¨¡å¼</h2><p>Javaçš„IOæ ‡å‡†åº“æä¾›çš„<code>InputStream</code>æ ¹æ®æ¥æºå¯ä»¥åŒ…æ‹¬ï¼š</p>
<ul>
<li><code>FileInputStream</code>ï¼šä»æ–‡ä»¶è¯»å–æ•°æ®ï¼Œæ˜¯æœ€ç»ˆæ•°æ®æºï¼›</li>
<li><code>ServletInputStream</code>ï¼šä»HTTPè¯·æ±‚è¯»å–æ•°æ®ï¼Œæ˜¯æœ€ç»ˆæ•°æ®æºï¼›</li>
<li><code>Socket.getInputStream()</code>ï¼šä»TCPè¿æ¥è¯»å–æ•°æ®ï¼Œæ˜¯æœ€ç»ˆæ•°æ®æºï¼›</li>
<li>â€¦</li>
</ul>
<p>ä¸ºäº†è§£å†³ä¾èµ–ç»§æ‰¿ä¼šå¯¼è‡´å­ç±»æ•°é‡å¤±æ§çš„é—®é¢˜ï¼ŒJDKé¦–å…ˆå°†<code>InputStream</code>åˆ†ä¸ºä¸¤å¤§ç±»ï¼š</p>
<p>ä¸€ç±»æ˜¯ç›´æ¥æä¾›æ•°æ®çš„åŸºç¡€<code>InputStream</code>ï¼Œä¾‹å¦‚ï¼š</p>
<ul>
<li><code>FileInputStream</code></li>
<li><code>ByteArrayInputStream</code></li>
<li><code>ServletInputStream</code></li>
<li>â€¦</li>
</ul>
<p>ä¸€ç±»æ˜¯æä¾›é¢å¤–é™„åŠ åŠŸèƒ½çš„<code>InputStream</code>ï¼Œä¾‹å¦‚ï¼š</p>
<ul>
<li><code>BufferedInputStream</code></li>
<li><code>DigestInputStream</code></li>
<li><code>CipherInputStream</code></li>
<li>â€¦</li>
</ul>
<p>å½“æˆ‘ä»¬éœ€è¦ç»™ä¸€ä¸ªâ€œåŸºç¡€â€<code>InputStream</code>é™„åŠ å„ç§åŠŸèƒ½æ—¶ï¼Œæˆ‘ä»¬å…ˆç¡®å®šè¿™ä¸ªèƒ½æä¾›æ•°æ®æºçš„<code>InputStream</code>ï¼Œå› ä¸ºæˆ‘ä»¬éœ€è¦çš„æ•°æ®æ€»å¾—æ¥è‡ªæŸä¸ªåœ°æ–¹ï¼Œä¾‹å¦‚ï¼Œ<code>FileInputStream</code>ï¼Œæ•°æ®æ¥æºè‡ªæ–‡ä»¶ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">InputStream file = <span class="keyword">new</span> FileInputStream(<span class="string">&quot;test.gz&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>ç´§æ¥ç€ï¼Œæˆ‘ä»¬å¸Œæœ›<code>FileInputStream</code>èƒ½æä¾›ç¼“å†²çš„åŠŸèƒ½æ¥æé«˜è¯»å–çš„æ•ˆç‡ï¼Œå› æ­¤æˆ‘ä»¬ç”¨<code>BufferedInputStream</code>åŒ…è£…è¿™ä¸ª<code>InputStream</code>ï¼Œå¾—åˆ°çš„åŒ…è£…ç±»å‹æ˜¯<code>BufferedInputStream</code>ï¼Œä½†å®ƒä»ç„¶è¢«è§†ä¸ºä¸€ä¸ª<code>InputStream</code>ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">InputStream buffered = <span class="keyword">new</span> BufferedInputStream(file);</span><br></pre></td></tr></table></figure>

<p>æœ€åï¼Œå‡è®¾è¯¥æ–‡ä»¶å·²ç»ç”¨<code>gzip</code>å‹ç¼©äº†ï¼Œæˆ‘ä»¬å¸Œæœ›ç›´æ¥è¯»å–è§£å‹ç¼©çš„å†…å®¹ï¼Œå°±å¯ä»¥å†åŒ…è£…ä¸€ä¸ª<code>GZIPInputStream</code>ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">InputStream gzip = <span class="keyword">new</span> GZIPInputStream(buffered);</span><br></pre></td></tr></table></figure>

<p>æ— è®ºæˆ‘ä»¬åŒ…è£…å¤šå°‘æ¬¡ï¼Œå¾—åˆ°çš„å¯¹è±¡å§‹ç»ˆæ˜¯<code>InputStream</code>ï¼Œæˆ‘ä»¬ç›´æ¥ç”¨<code>InputStream</code>æ¥å¼•ç”¨å®ƒï¼Œå°±å¯ä»¥æ­£å¸¸è¯»å–ï¼š</p>
<p><img src="https://raw.githubusercontent.com/ghj1998/image_repository/main/image-20210414164510382.png" alt="image-20210414164510382"></p>
<p><strong>ç¼–å†™<code>FilterInputStream</code></strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="keyword">byte</span>[] data = <span class="string">&quot;hello, world!&quot;</span>.getBytes(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">        <span class="keyword">try</span> (CountInputStream input = <span class="keyword">new</span> CountInputStream(<span class="keyword">new</span> ByteArrayInputStream(data))) &#123;</span><br><span class="line">            <span class="keyword">int</span> n;</span><br><span class="line">            <span class="keyword">while</span> ((n = input.read()) != -<span class="number">1</span>) &#123;</span><br><span class="line">                System.out.println((<span class="keyword">char</span>)n);</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">&quot;Total read &quot;</span> + input.getBytesRead() + <span class="string">&quot; bytes&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CountInputStream</span> <span class="keyword">extends</span> <span class="title">FilterInputStream</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    CountInputStream(InputStream in) &#123;</span><br><span class="line">        <span class="keyword">super</span>(in);</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getBytesRead</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.count;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">read</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> n = in.read();</span><br><span class="line">        <span class="keyword">if</span> (n != -<span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">this</span>.count ++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> n;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">read</span><span class="params">(<span class="keyword">byte</span>[] b, <span class="keyword">int</span> off, <span class="keyword">int</span> len)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> n = in.read(b, off, len);</span><br><span class="line">        <span class="keyword">if</span> (n != -<span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">this</span>.count += n;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> n;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="5-æ“ä½œZip"><a href="#5-æ“ä½œZip" class="headerlink" title="5. æ“ä½œZip"></a>5. æ“ä½œZip</h2><p><code>ZipInputStream</code>æ˜¯ä¸€ç§<code>FilterInputStream</code>ï¼Œå®ƒå¯ä»¥ç›´æ¥è¯»å–zipåŒ…çš„å†…å®¹ï¼š</p>
<p><img src="https://raw.githubusercontent.com/ghj1998/image_repository/main/image-20210414165125721.png" alt="image-20210414165125721"></p>
<p>æˆ‘ä»¬è¦åˆ›å»ºä¸€ä¸ª<code>ZipInputStream</code>ï¼Œé€šå¸¸æ˜¯ä¼ å…¥ä¸€ä¸ª<code>FileInputStream</code>ä½œä¸ºæ•°æ®æºï¼Œç„¶åï¼Œå¾ªç¯è°ƒç”¨<code>getNextEntry()</code>ï¼Œç›´åˆ°è¿”å›<code>null</code>ï¼Œè¡¨ç¤ºzipæµç»“æŸã€‚</p>
<p>ä¸€ä¸ª<code>ZipEntry</code>è¡¨ç¤ºä¸€ä¸ªå‹ç¼©æ–‡ä»¶æˆ–ç›®å½•ï¼Œå¦‚æœæ˜¯å‹ç¼©æ–‡ä»¶ï¼Œæˆ‘ä»¬å°±ç”¨<code>read()</code>æ–¹æ³•ä¸æ–­è¯»å–ï¼Œç›´åˆ°è¿”å›<code>-1</code>ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span> (ZipInputStream zip = <span class="keyword">new</span> ZipInputStream(<span class="keyword">new</span> FileInputStream(...))) &#123;</span><br><span class="line">    ZipEntry entry = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">while</span> ((entry = zip.getNextEntry()) != <span class="keyword">null</span>) &#123;</span><br><span class="line">        String name = entry.getName();</span><br><span class="line">        <span class="keyword">if</span> (!entry.isDirectory()) &#123;</span><br><span class="line">            <span class="keyword">int</span> n;</span><br><span class="line">            <span class="keyword">while</span> ((n = zip.read()) != -<span class="number">1</span>) &#123;</span><br><span class="line">                ...</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>å†™å…¥ZipåŒ…</strong></p>
<p><code>ZipOutputStream</code>æ˜¯ä¸€ç§<code>FilterOutputStream</code>ï¼Œå®ƒå¯ä»¥ç›´æ¥å†™å…¥å†…å®¹åˆ°zipåŒ…ã€‚æˆ‘ä»¬è¦å…ˆåˆ›å»ºä¸€ä¸ª<code>ZipOutputStream</code>ï¼Œé€šå¸¸æ˜¯åŒ…è£…ä¸€ä¸ª<code>FileOutputStream</code>ï¼Œç„¶åï¼Œæ¯å†™å…¥ä¸€ä¸ªæ–‡ä»¶å‰ï¼Œå…ˆè°ƒç”¨<code>putNextEntry()</code>ï¼Œç„¶åç”¨<code>write()</code>å†™å…¥<code>byte[]</code>æ•°æ®ï¼Œå†™å…¥å®Œæ¯•åè°ƒç”¨<code>closeEntry()</code>ç»“æŸè¿™ä¸ªæ–‡ä»¶çš„æ‰“åŒ…ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span> (ZipOutputStream zip = <span class="keyword">new</span> ZipOutputStream(<span class="keyword">new</span> FileOutputStream(...))) &#123;</span><br><span class="line">    File[] files = ...</span><br><span class="line">    <span class="keyword">for</span> (File file : files) &#123;</span><br><span class="line">        zip.putNextEntry(<span class="keyword">new</span> ZipEntry(file.getName()));</span><br><span class="line">        zip.write(getFileDataAsBytes(file));</span><br><span class="line">        zip.closeEntry();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="6-è¯»å–classpathèµ„æº"><a href="#6-è¯»å–classpathèµ„æº" class="headerlink" title="6. è¯»å–classpathèµ„æº"></a>6. è¯»å–classpathèµ„æº</h2><p>Javaå­˜æ”¾<code>.class</code>çš„ç›®å½•æˆ–jaråŒ…ä¹Ÿå¯ä»¥åŒ…å«ä»»æ„å…¶ä»–ç±»å‹çš„æ–‡ä»¶ï¼Œä¾‹å¦‚ï¼š</p>
<ul>
<li>é…ç½®æ–‡ä»¶ï¼Œä¾‹å¦‚<code>.properties</code>ï¼›</li>
<li>å›¾ç‰‡æ–‡ä»¶ï¼Œä¾‹å¦‚<code>.jpg</code>ï¼›</li>
<li>æ–‡æœ¬æ–‡ä»¶ï¼Œä¾‹å¦‚<code>.txt</code>ï¼Œ<code>.csv</code>ï¼›</li>
<li>â€¦â€¦</li>
</ul>
<p>ä»classpathè¯»å–æ–‡ä»¶å°±å¯ä»¥é¿å…ä¸åŒç¯å¢ƒä¸‹æ–‡ä»¶è·¯å¾„ä¸ä¸€è‡´çš„é—®é¢˜ï¼šå¦‚æœæˆ‘ä»¬æŠŠ<code>default.properties</code>æ–‡ä»¶æ”¾åˆ°classpathä¸­ï¼Œå°±ä¸ç”¨å…³å¿ƒå®ƒçš„å®é™…å­˜æ”¾è·¯å¾„ã€‚</p>
<p>åœ¨classpathä¸­çš„èµ„æºæ–‡ä»¶ï¼Œè·¯å¾„æ€»æ˜¯ä»¥<code>ï¼</code>å¼€å¤´ï¼Œæˆ‘ä»¬å…ˆè·å–å½“å‰çš„<code>Class</code>å¯¹è±¡ï¼Œç„¶åè°ƒç”¨<code>getResourceAsStream()</code>å°±å¯ä»¥ç›´æ¥ä»classpathè¯»å–ä»»æ„çš„èµ„æºæ–‡ä»¶ï¼š</p>
<p>è°ƒç”¨<code>getResourceAsStream()</code>éœ€è¦ç‰¹åˆ«æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼Œå¦‚æœèµ„æºæ–‡ä»¶ä¸å­˜åœ¨ï¼Œå®ƒå°†è¿”å›<code>null</code>ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span> (InputStream input = getClass().getResourceAsStream(<span class="string">&quot;/default.properties&quot;</span>)) &#123;</span><br><span class="line">    <span class="keyword">if</span> (input != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="comment">// <span class="doctag">TODO:</span></span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœæˆ‘ä»¬æŠŠé»˜è®¤çš„é…ç½®æ”¾åˆ°jaråŒ…ä¸­ï¼Œå†ä»å¤–éƒ¨æ–‡ä»¶ç³»ç»Ÿè¯»å–ä¸€ä¸ªå¯é€‰çš„é…ç½®æ–‡ä»¶ï¼Œå°±å¯ä»¥åšåˆ°æ—¢æœ‰é»˜è®¤çš„é…ç½®æ–‡ä»¶ï¼Œåˆå¯ä»¥è®©ç”¨æˆ·è‡ªå·±ä¿®æ”¹é…ç½®ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Properties props = <span class="keyword">new</span> Properties();</span><br><span class="line">props.load(inputStreamFromClassPath(<span class="string">&quot;/default.properties&quot;</span>));</span><br><span class="line">props.load(inputStreamFromFile(<span class="string">&quot;./conf.properties&quot;</span>));</span><br></pre></td></tr></table></figure>

<h2 id="7-åºåˆ—åŒ–"><a href="#7-åºåˆ—åŒ–" class="headerlink" title="7. åºåˆ—åŒ–"></a>7. åºåˆ—åŒ–</h2><p>åºåˆ—åŒ–æ˜¯æŒ‡æŠŠä¸€ä¸ªJavaå¯¹è±¡å˜æˆäºŒè¿›åˆ¶å†…å®¹ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ª<code>byte[]</code>æ•°ç»„ã€‚</p>
<p>æœ‰åºåˆ—åŒ–ï¼Œå°±æœ‰ååºåˆ—åŒ–ï¼Œå³æŠŠä¸€ä¸ªäºŒè¿›åˆ¶å†…å®¹ï¼ˆä¹Ÿå°±æ˜¯<code>byte[]</code>æ•°ç»„ï¼‰å˜å›Javaå¯¹è±¡ã€‚æœ‰äº†ååºåˆ—åŒ–ï¼Œä¿å­˜åˆ°æ–‡ä»¶ä¸­çš„<code>byte[]</code>æ•°ç»„åˆå¯ä»¥â€œå˜å›â€Javaå¯¹è±¡ï¼Œæˆ–è€…ä»ç½‘ç»œä¸Šè¯»å–<code>byte[]</code>å¹¶æŠŠå®ƒâ€œå˜å›â€Javaå¯¹è±¡ã€‚</p>
<p>ä¸€ä¸ªJavaå¯¹è±¡è¦èƒ½åºåˆ—åŒ–ï¼Œå¿…é¡»å®ç°ä¸€ä¸ªç‰¹æ®Šçš„<code>java.io.Serializable</code>æ¥å£ï¼Œå®ƒçš„å®šä¹‰å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>åºåˆ—åŒ–</strong></p>
<p>æŠŠä¸€ä¸ªJavaå¯¹è±¡å˜ä¸º<code>byte[]</code>æ•°ç»„ï¼Œéœ€è¦ä½¿ç”¨<code>ObjectOutputStream</code>ã€‚å®ƒè´Ÿè´£æŠŠä¸€ä¸ªJavaå¯¹è±¡å†™å…¥ä¸€ä¸ªå­—èŠ‚æµï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        ByteArrayOutputStream buffer = <span class="keyword">new</span> ByteArrayOutputStream();</span><br><span class="line">        <span class="keyword">try</span> (ObjectOutputStream output = <span class="keyword">new</span> ObjectOutputStream(buffer)) &#123;</span><br><span class="line">            <span class="comment">// å†™å…¥int:</span></span><br><span class="line">            output.writeInt(<span class="number">12345</span>);</span><br><span class="line">            <span class="comment">// å†™å…¥String:</span></span><br><span class="line">            output.writeUTF(<span class="string">&quot;Hello&quot;</span>);</span><br><span class="line">            <span class="comment">// å†™å…¥Object:</span></span><br><span class="line">            output.writeObject(Double.valueOf(<span class="number">123.456</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(Arrays.toString(buffer.toByteArray()));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>ObjectOutputStream</code>æ—¢å¯ä»¥å†™å…¥åŸºæœ¬ç±»å‹ï¼Œå¦‚<code>int</code>ï¼Œ<code>boolean</code>ï¼Œä¹Ÿå¯ä»¥å†™å…¥<code>String</code>ï¼ˆä»¥UTF-8ç¼–ç ï¼‰ï¼Œè¿˜å¯ä»¥å†™å…¥å®ç°äº†<code>Serializable</code>æ¥å£çš„<code>Object</code>ã€‚</p>
<p><strong>ååºåˆ—åŒ–</strong></p>
<p>å’Œ<code>ObjectOutputStream</code>ç›¸åï¼Œ<code>ObjectInputStream</code>è´Ÿè´£ä»ä¸€ä¸ªå­—èŠ‚æµè¯»å–Javaå¯¹è±¡ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span> (ObjectInputStream input = <span class="keyword">new</span> ObjectInputStream(...)) &#123;</span><br><span class="line">    <span class="keyword">int</span> n = input.readInt();</span><br><span class="line">    String s = input.readUTF();</span><br><span class="line">    Double d = (Double) input.readObject();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>readObject()</code>å¯èƒ½æŠ›å‡ºçš„å¼‚å¸¸æœ‰ï¼š</p>
<ul>
<li><code>ClassNotFoundException</code>ï¼šæ²¡æœ‰æ‰¾åˆ°å¯¹åº”çš„Classï¼›//å‘ç”Ÿåœ¨ä¸¤å°è®¡ç®—æœºä¼ è¾“å¯¹è±¡æ—¶ï¼Œå¦ä¸€å°å¯¹è±¡æ²¡æœ‰å®šä¹‰ä¼ è¾“çš„è¿™ä¸ªç±»ã€‚</li>
<li><code>InvalidClassException</code>ï¼šClassä¸åŒ¹é…ã€‚//ä¾‹å¦‚ååºåˆ—åŒ–æ—¶æŠŠä¸€ä¸ªintç±»å‹ååºåˆ—æˆlongç±»å‹</li>
</ul>
<p>ä¸ºäº†é¿å…è¿™ç§classå®šä¹‰å˜åŠ¨å¯¼è‡´çš„ä¸å…¼å®¹ï¼ŒJavaçš„åºåˆ—åŒ–å…è®¸classå®šä¹‰ä¸€ä¸ªç‰¹æ®Šçš„<code>serialVersionUID</code>é™æ€å˜é‡ï¼Œç”¨äºæ ‡è¯†Javaç±»çš„åºåˆ—åŒ–â€œç‰ˆæœ¬â€ï¼Œé€šå¸¸å¯ä»¥ç”±IDEè‡ªåŠ¨ç”Ÿæˆã€‚å¦‚æœå¢åŠ æˆ–ä¿®æ”¹äº†å­—æ®µï¼Œå¯ä»¥æ”¹å˜<code>serialVersionUID</code>çš„å€¼ï¼Œè¿™æ ·å°±èƒ½è‡ªåŠ¨é˜»æ­¢ä¸åŒ¹é…çš„classç‰ˆæœ¬ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">2709425275741743919L</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å®é™…ä¸Šï¼ŒJavaæœ¬èº«æä¾›çš„åŸºäºå¯¹è±¡çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–æœºåˆ¶æ—¢å­˜åœ¨å®‰å…¨æ€§é—®é¢˜ï¼Œä¹Ÿå­˜åœ¨å…¼å®¹æ€§é—®é¢˜ã€‚æ›´å¥½çš„åºåˆ—åŒ–æ–¹æ³•æ˜¯é€šè¿‡JSONè¿™æ ·çš„é€šç”¨æ•°æ®ç»“æ„æ¥å®ç°ï¼Œåªè¾“å‡ºåŸºæœ¬ç±»å‹ï¼ˆåŒ…æ‹¬Stringï¼‰çš„å†…å®¹ï¼Œè€Œä¸å­˜å‚¨ä»»ä½•ä¸ä»£ç ç›¸å…³çš„ä¿¡æ¯ã€‚</p>
<h2 id="8-Reader"><a href="#8-Reader" class="headerlink" title="8. Reader"></a>8. Reader</h2><p><code>Reader</code>æ˜¯Javaçš„IOåº“æä¾›çš„å¦ä¸€ä¸ªè¾“å…¥æµæ¥å£ã€‚å’Œ<code>InputStream</code>çš„åŒºåˆ«æ˜¯ï¼Œ<code>InputStream</code>æ˜¯ä¸€ä¸ªå­—èŠ‚æµï¼Œå³ä»¥<code>byte</code>ä¸ºå•ä½è¯»å–ï¼Œè€Œ<code>Reader</code>æ˜¯ä¸€ä¸ªå­—ç¬¦æµï¼Œå³ä»¥<code>char</code>ä¸ºå•ä½è¯»å–ï¼š</p>
<table>
<thead>
<tr>
<th align="left">InputStream</th>
<th align="left">Reader</th>
</tr>
</thead>
<tbody><tr>
<td align="left">å­—èŠ‚æµï¼Œä»¥<code>byte</code>ä¸ºå•ä½</td>
<td align="left">å­—ç¬¦æµï¼Œä»¥<code>char</code>ä¸ºå•ä½</td>
</tr>
<tr>
<td align="left">è¯»å–å­—èŠ‚ï¼ˆ-1ï¼Œ0~255ï¼‰ï¼š<code>int read()</code></td>
<td align="left">è¯»å–å­—ç¬¦ï¼ˆ-1ï¼Œ0~65535ï¼‰ï¼š<code>int read()</code></td>
</tr>
<tr>
<td align="left">è¯»åˆ°å­—èŠ‚æ•°ç»„ï¼š<code>int read(byte[] b)</code></td>
<td align="left">è¯»åˆ°å­—ç¬¦æ•°ç»„ï¼š<code>int read(char[] c)</code></td>
</tr>
</tbody></table>
<p><strong>FileReader</strong></p>
<p><code>FileReader</code>æ˜¯<code>Reader</code>çš„ä¸€ä¸ªå­ç±»ï¼Œå®ƒå¯ä»¥æ‰“å¼€æ–‡ä»¶å¹¶è·å–<code>Reader</code>ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">readFile</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> (Reader reader = <span class="keyword">new</span> FileReader(<span class="string">&quot;src/readme.txt&quot;</span>, StandardCharsets.UTF_8)) &#123;</span><br><span class="line">        <span class="keyword">char</span>[] buffer = <span class="keyword">new</span> <span class="keyword">char</span>[<span class="number">1000</span>];</span><br><span class="line">        <span class="keyword">int</span> n;</span><br><span class="line">        <span class="keyword">while</span> ((n = reader.read(buffer)) != -<span class="number">1</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;read &quot;</span> + n + <span class="string">&quot; chars.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>Reader</code>è¿˜æä¾›äº†ä¸€æ¬¡æ€§è¯»å–è‹¥å¹²å­—ç¬¦å¹¶å¡«å……åˆ°<code>char[]</code>æ•°ç»„çš„æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">read</span><span class="params">(<span class="keyword">char</span>[] c)</span> <span class="keyword">throws</span> IOException</span></span><br></pre></td></tr></table></figure>

<p>å®ƒè¿”å›å®é™…è¯»å…¥çš„å­—ç¬¦ä¸ªæ•°ï¼Œæœ€å¤§ä¸è¶…è¿‡<code>char[]</code>æ•°ç»„çš„é•¿åº¦ã€‚è¿”å›<code>-1</code>è¡¨ç¤ºæµç»“æŸã€‚</p>
<p><strong>CharArrayReader</strong></p>
<p><code>CharArrayReader</code>å¯ä»¥åœ¨å†…å­˜ä¸­æ¨¡æ‹Ÿä¸€ä¸ª<code>Reader</code>ï¼Œå®ƒçš„ä½œç”¨å®é™…ä¸Šæ˜¯æŠŠä¸€ä¸ª<code>char[]</code>æ•°ç»„å˜æˆä¸€ä¸ª<code>Reader</code>ï¼Œè¿™å’Œ<code>ByteArrayInputStream</code>éå¸¸ç±»ä¼¼ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span> (Reader reader = <span class="keyword">new</span> CharArrayReader(<span class="string">&quot;Hello&quot;</span>.toCharArray())) &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>StringReader</strong></p>
<p><code>StringReader</code>å¯ä»¥ç›´æ¥æŠŠ<code>String</code>ä½œä¸ºæ•°æ®æºï¼Œå®ƒå’Œ<code>CharArrayReader</code>å‡ ä¹ä¸€æ ·ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span> (Reader reader = <span class="keyword">new</span> StringReader(<span class="string">&quot;Hello&quot;</span>)) &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>InputStreamReader</strong></p>
<p>InputStreamReader<code>æ˜¯ä¸€ä¸ªè½¬æ¢å™¨ï¼Œå®ƒå¯ä»¥æŠŠä»»ä½•</code>InputStream<code>è½¬æ¢ä¸º</code>Readerã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æŒæœ‰InputStream:</span></span><br><span class="line">InputStream input = <span class="keyword">new</span> FileInputStream(<span class="string">&quot;src/readme.txt&quot;</span>);</span><br><span class="line"><span class="comment">// å˜æ¢ä¸ºReader:</span></span><br><span class="line">Reader reader = <span class="keyword">new</span> InputStreamReader(input, <span class="string">&quot;UTF-8&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>ç­‰ä»·äºï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span> (Reader reader = <span class="keyword">new</span> InputStreamReader(<span class="keyword">new</span> FileInputStream(<span class="string">&quot;src/readme.txt&quot;</span>), <span class="string">&quot;UTF-8&quot;</span>)) &#123;</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="9-Writer"><a href="#9-Writer" class="headerlink" title="9. Writer"></a>9. Writer</h2><p><code>Writer</code>å°±æ˜¯å¸¦ç¼–ç è½¬æ¢å™¨çš„<code>OutputStream</code>ï¼Œå®ƒæŠŠ<code>char</code>è½¬æ¢ä¸º<code>byte</code>å¹¶è¾“å‡ºã€‚</p>
<p><code>Writer</code>å’Œ<code>OutputStream</code>çš„åŒºåˆ«å¦‚ä¸‹ï¼š</p>
<table>
<thead>
<tr>
<th align="left">OutputStream</th>
<th align="left">Writer</th>
</tr>
</thead>
<tbody><tr>
<td align="left">å­—èŠ‚æµï¼Œä»¥<code>byte</code>ä¸ºå•ä½</td>
<td align="left">å­—ç¬¦æµï¼Œä»¥<code>char</code>ä¸ºå•ä½</td>
</tr>
<tr>
<td align="left">å†™å…¥å­—èŠ‚ï¼ˆ0~255ï¼‰ï¼š<code>void write(int b)</code></td>
<td align="left">å†™å…¥å­—ç¬¦ï¼ˆ0~65535ï¼‰ï¼š<code>void write(int c)</code></td>
</tr>
<tr>
<td align="left">å†™å…¥å­—èŠ‚æ•°ç»„ï¼š<code>void write(byte[] b)</code></td>
<td align="left">å†™å…¥å­—ç¬¦æ•°ç»„ï¼š<code>void write(char[] c)</code></td>
</tr>
<tr>
<td align="left">æ— å¯¹åº”æ–¹æ³•</td>
<td align="left">å†™å…¥Stringï¼š<code>void write(String s)</code></td>
</tr>
</tbody></table>
<p><code>Writer</code>æ˜¯æ‰€æœ‰å­—ç¬¦è¾“å‡ºæµçš„è¶…ç±»ï¼Œå®ƒæä¾›çš„æ–¹æ³•ä¸»è¦æœ‰ï¼š</p>
<ul>
<li>å†™å…¥ä¸€ä¸ªå­—ç¬¦ï¼ˆ0~65535ï¼‰ï¼š<code>void write(int c)</code>ï¼›</li>
<li>å†™å…¥å­—ç¬¦æ•°ç»„çš„æ‰€æœ‰å­—ç¬¦ï¼š<code>void write(char[] c)</code>ï¼›</li>
<li>å†™å…¥Stringè¡¨ç¤ºçš„æ‰€æœ‰å­—ç¬¦ï¼š<code>void write(String s)</code>ã€‚</li>
</ul>
<p><strong>FileWriter</strong></p>
<p><code>FileWriter</code>å°±æ˜¯å‘æ–‡ä»¶ä¸­å†™å…¥å­—ç¬¦æµçš„<code>Writer</code>ã€‚å®ƒçš„ä½¿ç”¨æ–¹æ³•å’Œ<code>FileReader</code>ç±»ä¼¼ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span> (Writer writer = <span class="keyword">new</span> FileWriter(<span class="string">&quot;readme.txt&quot;</span>, StandardCharsets.UTF_8)) &#123;</span><br><span class="line">    writer.write(<span class="string">&#x27;H&#x27;</span>); <span class="comment">// å†™å…¥å•ä¸ªå­—ç¬¦</span></span><br><span class="line">    writer.write(<span class="string">&quot;Hello&quot;</span>.toCharArray()); <span class="comment">// å†™å…¥char[]</span></span><br><span class="line">    writer.write(<span class="string">&quot;Hello&quot;</span>); <span class="comment">// å†™å…¥String</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>CharArrayWriter</strong></p>
<p><code>CharArrayWriter</code>å¯ä»¥åœ¨å†…å­˜ä¸­åˆ›å»ºä¸€ä¸ª<code>Writer</code>ï¼Œå®ƒçš„ä½œç”¨å®é™…ä¸Šæ˜¯æ„é€ ä¸€ä¸ªç¼“å†²åŒºï¼Œå¯ä»¥å†™å…¥<code>char</code>ï¼Œæœ€åå¾—åˆ°å†™å…¥çš„<code>char[]</code>æ•°ç»„ï¼Œè¿™å’Œ<code>ByteArrayOutputStream</code>éå¸¸ç±»ä¼¼ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span> (CharArrayWriter writer = <span class="keyword">new</span> CharArrayWriter()) &#123;</span><br><span class="line">    writer.write(<span class="number">65</span>);</span><br><span class="line">    writer.write(<span class="number">66</span>);</span><br><span class="line">    writer.write(<span class="number">67</span>);</span><br><span class="line">    <span class="keyword">char</span>[] data = writer.toCharArray(); <span class="comment">// &#123; &#x27;A&#x27;, &#x27;B&#x27;, &#x27;C&#x27; &#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>StringWriter</strong></p>
<p><code>StringWriter</code>ä¹Ÿæ˜¯ä¸€ä¸ªåŸºäºå†…å­˜çš„<code>Writer</code>ï¼Œå®ƒå’Œ<code>CharArrayWriter</code>ç±»ä¼¼ã€‚å®é™…ä¸Šï¼Œ<code>StringWriter</code>åœ¨å†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ª<code>StringBuffer</code>ï¼Œå¹¶å¯¹å¤–æä¾›äº†<code>Writer</code>æ¥å£ã€‚</p>
<p><strong>OutputStreamWriter</strong></p>
<p>é™¤äº†<code>CharArrayWriter</code>å’Œ<code>StringWriter</code>å¤–ï¼Œæ™®é€šçš„Writerå®é™…ä¸Šæ˜¯åŸºäº<code>OutputStream</code>æ„é€ çš„ï¼Œå®ƒæ¥æ”¶<code>char</code>ï¼Œç„¶ååœ¨å†…éƒ¨è‡ªåŠ¨è½¬æ¢æˆä¸€ä¸ªæˆ–å¤šä¸ª<code>byte</code>ï¼Œå¹¶å†™å…¥<code>OutputStream</code>ã€‚å› æ­¤ï¼Œ<code>OutputStreamWriter</code>å°±æ˜¯ä¸€ä¸ªå°†ä»»æ„çš„<code>OutputStream</code>è½¬æ¢ä¸º<code>Writer</code>çš„è½¬æ¢å™¨ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">try (Writer writer &#x3D; new OutputStreamWriter(new FileOutputStream(&quot;readme.txt&quot;), &quot;UTF-8&quot;)) &#123;</span><br><span class="line">    &#x2F;&#x2F; TODO:</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸Šè¿°ä»£ç å®é™…ä¸Šå°±æ˜¯<code>FileWriter</code>çš„ä¸€ç§å®ç°æ–¹å¼ã€‚è¿™å’Œä¸Šä¸€èŠ‚çš„<code>InputStreamReader</code>æ˜¯ä¸€æ ·çš„ã€‚</p>
<h2 id="10-PrintStreamå’ŒPrintWriter"><a href="#10-PrintStreamå’ŒPrintWriter" class="headerlink" title="10. PrintStreamå’ŒPrintWriter"></a>10. PrintStreamå’ŒPrintWriter</h2><p><strong>PrintStream</strong></p>
<p><code>PrintStream</code>æ˜¯ä¸€ç§<code>FilterOutputStream</code>ï¼Œå®ƒåœ¨<code>OutputStream</code>çš„æ¥å£ä¸Šï¼Œé¢å¤–æä¾›äº†ä¸€äº›å†™å…¥å„ç§æ•°æ®ç±»å‹çš„æ–¹æ³•ï¼š</p>
<ul>
<li>å†™å…¥<code>int</code>ï¼š<code>print(int)</code></li>
<li>å†™å…¥<code>boolean</code>ï¼š<code>print(boolean)</code></li>
<li>å†™å…¥<code>String</code>ï¼š<code>print(String)</code></li>
<li>å†™å…¥<code>Object</code>ï¼š<code>print(Object)</code>ï¼Œå®é™…ä¸Šç›¸å½“äº<code>print(object.toString())</code></li>
<li>â€¦</li>
</ul>
<p>ä»¥åŠå¯¹åº”çš„ä¸€ç»„<code>println()</code>æ–¹æ³•ï¼Œå®ƒä¼šè‡ªåŠ¨åŠ ä¸Šæ¢è¡Œç¬¦ã€‚</p>
<p>æˆ‘ä»¬ç»å¸¸ä½¿ç”¨çš„<code>System.out.println()</code>å®é™…ä¸Šå°±æ˜¯ä½¿ç”¨<code>PrintStream</code>æ‰“å°å„ç§æ•°æ®ã€‚å…¶ä¸­ï¼Œ<code>System.out</code>æ˜¯ç³»ç»Ÿé»˜è®¤æä¾›çš„<code>PrintStream</code>ï¼Œè¡¨ç¤ºæ ‡å‡†è¾“å‡ºï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">System.out.print(<span class="number">12345</span>); <span class="comment">// è¾“å‡º12345</span></span><br><span class="line">System.out.print(<span class="keyword">new</span> Object()); <span class="comment">// è¾“å‡ºç±»ä¼¼java.lang.Object@3c7a835a</span></span><br><span class="line">System.out.println(<span class="string">&quot;Hello&quot;</span>); <span class="comment">// è¾“å‡ºHelloå¹¶æ¢è¡Œ</span></span><br></pre></td></tr></table></figure>

<p><strong>PrintWriter</strong></p>
<p><code>PrintStream</code>æœ€ç»ˆè¾“å‡ºçš„æ€»æ˜¯byteæ•°æ®ï¼Œè€Œ<code>PrintWriter</code>åˆ™æ˜¯æ‰©å±•äº†<code>Writer</code>æ¥å£ï¼Œå®ƒçš„<code>print()</code>/<code>println()</code>æ–¹æ³•æœ€ç»ˆè¾“å‡ºçš„æ˜¯<code>char</code>æ•°æ®ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span>     </span>&#123;</span><br><span class="line">        StringWriter buffer = <span class="keyword">new</span> StringWriter();</span><br><span class="line">        <span class="keyword">try</span> (PrintWriter pw = <span class="keyword">new</span> PrintWriter(buffer)) &#123;</span><br><span class="line">            pw.println(<span class="string">&quot;Hello&quot;</span>);</span><br><span class="line">            pw.println(<span class="number">12345</span>);</span><br><span class="line">            pw.println(<span class="keyword">true</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(buffer.toString());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="11-Files"><a href="#11-Files" class="headerlink" title="11. Files"></a>11. Files</h2><p>æŠŠä¸€ä¸ªæ–‡ä»¶çš„å…¨éƒ¨å†…å®¹è¯»å–ä¸ºä¸€ä¸ª<code>byte[]</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">byte</span>[] data = Files.readAllBytes(Paths.get(<span class="string">&quot;/path/to/file.txt&quot;</span>));</span><br></pre></td></tr></table></figure>

<p>å¦‚æœæ˜¯æ–‡æœ¬æ–‡ä»¶ï¼Œå¯ä»¥æŠŠä¸€ä¸ªæ–‡ä»¶çš„å…¨éƒ¨å†…å®¹è¯»å–ä¸º<code>String</code>ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// é»˜è®¤ä½¿ç”¨UTF-8ç¼–ç è¯»å–:</span></span><br><span class="line">String content1 = Files.readString(Paths.get(<span class="string">&quot;/path/to/file.txt&quot;</span>));</span><br><span class="line"><span class="comment">// å¯æŒ‡å®šç¼–ç :</span></span><br><span class="line">String content2 = Files.readString(Paths.get(<span class="string">&quot;/path/to/file.txt&quot;</span>), StandardCharsets.ISO_8859_1);</span><br><span class="line"><span class="comment">// æŒ‰è¡Œè¯»å–å¹¶è¿”å›æ¯è¡Œå†…å®¹:</span></span><br><span class="line">List&lt;String&gt; lines = Files.readAllLines(Paths.get(<span class="string">&quot;/path/to/file.txt&quot;</span>));</span><br></pre></td></tr></table></figure>

<p>å†™å…¥æ–‡ä»¶ä¹Ÿéå¸¸æ–¹ä¾¿ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å†™å…¥äºŒè¿›åˆ¶æ–‡ä»¶:</span></span><br><span class="line"><span class="keyword">byte</span>[] data = ...</span><br><span class="line">Files.write(Paths.get(<span class="string">&quot;/path/to/file.txt&quot;</span>), data);</span><br><span class="line"><span class="comment">// å†™å…¥æ–‡æœ¬å¹¶æŒ‡å®šç¼–ç :</span></span><br><span class="line">Files.writeString(Paths.get(<span class="string">&quot;/path/to/file.txt&quot;</span>), <span class="string">&quot;æ–‡æœ¬å†…å®¹...&quot;</span>, StandardCharsets.ISO_8859_1);</span><br><span class="line"><span class="comment">// æŒ‰è¡Œå†™å…¥æ–‡æœ¬:</span></span><br><span class="line">List&lt;String&gt; lines = ...</span><br><span class="line">Files.write(Paths.get(<span class="string">&quot;/path/to/file.txt&quot;</span>), lines);</span><br></pre></td></tr></table></figure>

<p><code>Files</code>å·¥å…·ç±»è¿˜æœ‰<code>copy()</code>ã€<code>delete()</code>ã€<code>exists()</code>ã€<code>move()</code>ç­‰å¿«æ·æ–¹æ³•æ“ä½œæ–‡ä»¶å’Œç›®å½•ã€‚</p>
]]></content>
      <tags>
        <tag>JAVA</tag>
      </tags>
  </entry>
  <entry>
    <title>JAVA - æ—¶é—´å’Œæ—¥æœŸ</title>
    <url>/2021/04/22/JAVA%E6%97%B6%E9%97%B4%E5%92%8C%E6%97%A5%E6%9C%9F/</url>
    <content><![CDATA[<h1 id="æ—¶é—´å’Œæ—¥æœŸ"><a href="#æ—¶é—´å’Œæ—¥æœŸ" class="headerlink" title="æ—¶é—´å’Œæ—¥æœŸ"></a>æ—¶é—´å’Œæ—¥æœŸ</h1><h2 id="1-æ¦‚å¿µ"><a href="#1-æ¦‚å¿µ" class="headerlink" title="1. æ¦‚å¿µ"></a>1. æ¦‚å¿µ</h2><p><strong>æ—¶åŒº</strong>ï¼š</p>
<ul>
<li>ä»¥<code>GMT</code>æˆ–è€…<code>UTC</code>åŠ æ—¶åŒºåç§»è¡¨ç¤ºï¼Œä¾‹å¦‚ï¼š<code>GMT+08:00</code>æˆ–è€…<code>UTC+08:00</code>è¡¨ç¤ºä¸œå…«åŒºã€‚</li>
<li>ç¼©å†™ï¼Œä¾‹å¦‚ï¼Œ<code>CST</code>è¡¨ç¤º<code>China Standard Time</code>ï¼Œä¹Ÿå°±æ˜¯ä¸­å›½æ ‡å‡†æ—¶é—´ã€‚ä½†æ˜¯<code>CST</code>ä¹Ÿå¯ä»¥è¡¨ç¤ºç¾å›½ä¸­éƒ¨æ—¶é—´<code>Central Standard Time USA</code>ï¼Œå› æ­¤ï¼Œç¼©å†™å®¹æ˜“äº§ç”Ÿæ··æ·†ï¼Œæˆ‘ä»¬å°½é‡ä¸è¦ä½¿ç”¨ç¼©å†™ã€‚</li>
<li>æ´²ï¼åŸå¸‚è¡¨ç¤ºï¼Œä¾‹å¦‚ï¼Œ<code>Asia/Shanghai</code>ï¼Œè¡¨ç¤ºä¸Šæµ·æ‰€åœ¨åœ°çš„æ—¶åŒºã€‚</li>
</ul>
<p><strong>å¤ä»¤æ—¶</strong>ï¼š</p>
<p>æ‰€è°“å¤ä»¤æ—¶ï¼Œå°±æ˜¯å¤å¤©å¼€å§‹çš„æ—¶å€™ï¼ŒæŠŠæ—¶é—´å¾€åæ‹¨1å°æ—¶ï¼Œå¤å¤©ç»“æŸçš„æ—¶å€™ï¼Œå†æŠŠæ—¶é—´å¾€å‰æ‹¨1å°æ—¶ã€‚ç¾å›½ä»åœ¨ç”¨ã€‚</p>
<p> <strong>è®¡ç®—å¤ä»¤æ—¶è¯·ä½¿ç”¨æ ‡å‡†åº“æä¾›çš„ç›¸å…³ç±»ï¼Œä¸è¦è¯•å›¾è‡ªå·±è®¡ç®—å¤ä»¤æ—¶ã€‚</strong></p>
<p><strong>æœ¬åœ°åŒ–</strong></p>
<p>åœ¨è®¡ç®—æœºä¸­ï¼Œé€šå¸¸ä½¿ç”¨<code>Locale</code>è¡¨ç¤ºä¸€ä¸ªå›½å®¶æˆ–åœ°åŒºçš„æ—¥æœŸã€æ—¶é—´ã€æ•°å­—ã€è´§å¸ç­‰æ ¼å¼ã€‚<code>Locale</code>ç”±<code>è¯­è¨€_å›½å®¶</code>çš„å­—æ¯ç¼©å†™æ„æˆï¼Œä¾‹å¦‚ï¼Œ**<code>zh_CN</code><strong>è¡¨ç¤ºä¸­æ–‡+ä¸­å›½ï¼Œ</strong><code>en_US</code>**è¡¨ç¤ºè‹±æ–‡+ç¾å›½ã€‚è¯­è¨€ä½¿ç”¨å°å†™ï¼Œå›½å®¶ä½¿ç”¨å¤§å†™ã€‚</p>
<h2 id="2-Date-å’Œ-Calendar"><a href="#2-Date-å’Œ-Calendar" class="headerlink" title="2. Date å’Œ Calendar"></a>2. Date å’Œ Calendar</h2><p>Javaæ ‡å‡†åº“æä¾›çš„APIã€‚Javaæ ‡å‡†åº“æœ‰ä¸¤å¥—å¤„ç†æ—¥æœŸå’Œæ—¶é—´çš„APIï¼š</p>
<ul>
<li>ä¸€å¥—å®šä¹‰åœ¨<code>java.util</code>è¿™ä¸ªåŒ…é‡Œé¢ï¼Œä¸»è¦åŒ…æ‹¬<code>Date</code>ã€<code>Calendar</code>å’Œ<code>TimeZone</code>è¿™å‡ ä¸ªç±»ï¼›</li>
<li>ä¸€å¥—æ–°çš„APIæ˜¯åœ¨Java 8å¼•å…¥çš„ï¼Œå®šä¹‰åœ¨<code>java.time</code>è¿™ä¸ªåŒ…é‡Œé¢ï¼Œä¸»è¦åŒ…æ‹¬<code>LocalDateTime</code>ã€<code>ZonedDateTime</code>ã€<code>ZoneId</code>ç­‰ã€‚</li>
</ul>
<p>å¾ˆå¤šæºä»£ç ä»åœ¨ä½¿ç”¨æ—§çš„APIï¼Œæ•…ä»è¦å­¦ä¹ æ—§çš„API</p>
<p><strong>Date</strong></p>
<p><code>java.util.Date</code>æ˜¯ç”¨äºè¡¨ç¤ºä¸€ä¸ªæ—¥æœŸå’Œæ—¶é—´çš„å¯¹è±¡</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// è·å–å½“å‰æ—¶é—´:</span></span><br><span class="line">        Date date = <span class="keyword">new</span> Date();</span><br><span class="line">        System.out.println(date.getYear() + <span class="number">1900</span>); <span class="comment">// å¿…é¡»åŠ ä¸Š1900</span></span><br><span class="line">        System.out.println(date.getMonth() + <span class="number">1</span>); <span class="comment">// 0~11ï¼Œå¿…é¡»åŠ ä¸Š1</span></span><br><span class="line">        System.out.println(date.getDate()); <span class="comment">// 1~31ï¼Œä¸èƒ½åŠ 1</span></span><br><span class="line">        <span class="comment">// è½¬æ¢ä¸ºString:</span></span><br><span class="line">        System.out.println(date.toString());</span><br><span class="line">        <span class="comment">// è½¬æ¢ä¸ºGMTæ—¶åŒº:</span></span><br><span class="line">        System.out.println(date.toGMTString());</span><br><span class="line">        <span class="comment">// è½¬æ¢ä¸ºæœ¬åœ°æ—¶åŒº:</span></span><br><span class="line">        System.out.println(date.toLocaleString());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>SimpleDateFormat</code></p>
<ul>
<li>yyyyï¼šå¹´</li>
<li>MMï¼šæœˆ</li>
<li>dd: æ—¥</li>
<li>HH: å°æ—¶</li>
<li>mm: åˆ†é’Ÿ</li>
<li>ss: ç§’</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// è·å–å½“å‰æ—¶é—´:</span></span><br><span class="line">        Date date = <span class="keyword">new</span> Date();</span><br><span class="line">        <span class="keyword">var</span> sdf = <span class="keyword">new</span> SimpleDateFormat(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>);</span><br><span class="line">        System.out.println(sdf.format(date));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 2021-04-21 14:49:09</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// è·å–å½“å‰æ—¶é—´:</span></span><br><span class="line">        Date date = <span class="keyword">new</span> Date();</span><br><span class="line">        <span class="keyword">var</span> sdf = <span class="keyword">new</span> SimpleDateFormat(<span class="string">&quot;E MMM dd, yyyy&quot;</span>);</span><br><span class="line">        System.out.println(sdf.format(date));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Wed Apr 21, 2021</span></span><br></pre></td></tr></table></figure>

<p>ä¸€èˆ¬æ¥è¯´ï¼Œå­—æ¯è¶Šé•¿ï¼Œè¾“å‡ºè¶Šé•¿ã€‚ä»¥<code>M</code>ä¸ºä¾‹ï¼Œå‡è®¾å½“å‰æœˆä»½æ˜¯9æœˆï¼š</p>
<ul>
<li><code>M</code>ï¼šè¾“å‡º<code>9</code></li>
<li><code>MM</code>ï¼šè¾“å‡º<code>09</code></li>
<li><code>MMM</code>ï¼šè¾“å‡º<code>Sep</code></li>
<li><code>MMMM</code>ï¼šè¾“å‡º<code>September</code></li>
</ul>
<p><strong>Calendar</strong></p>
<p><code>Calendar</code>å¯ä»¥ç”¨äºè·å–å¹¶è®¾ç½®å¹´ã€æœˆã€æ—¥ã€æ—¶ã€åˆ†ã€ç§’ï¼Œå®ƒå’Œ<code>Date</code>æ¯”ï¼Œä¸»è¦å¤šäº†ä¸€ä¸ªå¯ä»¥åšç®€å•çš„æ—¥æœŸå’Œæ—¶é—´è¿ç®—çš„åŠŸèƒ½ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// è·å–å½“å‰æ—¶é—´:</span></span><br><span class="line">        Calendar c = Calendar.getInstance();</span><br><span class="line">        <span class="keyword">int</span> y = c.get(Calendar.YEAR);</span><br><span class="line">        <span class="keyword">int</span> m = <span class="number">1</span> + c.get(Calendar.MONTH);</span><br><span class="line">        <span class="keyword">int</span> d = c.get(Calendar.DAY_OF_MONTH);</span><br><span class="line">        <span class="keyword">int</span> w = c.get(Calendar.DAY_OF_WEEK);</span><br><span class="line">        <span class="keyword">int</span> hh = c.get(Calendar.HOUR_OF_DAY);</span><br><span class="line">        <span class="keyword">int</span> mm = c.get(Calendar.MINUTE);</span><br><span class="line">        <span class="keyword">int</span> ss = c.get(Calendar.SECOND);</span><br><span class="line">        <span class="keyword">int</span> ms = c.get(Calendar.MILLISECOND);</span><br><span class="line">        System.out.println(y + <span class="string">&quot;-&quot;</span> + m + <span class="string">&quot;-&quot;</span> + d + <span class="string">&quot; &quot;</span> + w + <span class="string">&quot; &quot;</span> + hh + <span class="string">&quot;:&quot;</span> + mm + <span class="string">&quot;:&quot;</span> + ss + <span class="string">&quot;.&quot;</span> + ms);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 2021-4-21 4 14:50:29.350</span></span><br></pre></td></tr></table></figure>

<p>è¿”å›çš„å¹´ä»½ä¸å¿…è½¬æ¢ï¼Œè¿”å›çš„æœˆä»½ä»ç„¶è¦åŠ 1ï¼Œè¿”å›çš„æ˜ŸæœŸè¦ç‰¹åˆ«æ³¨æ„ï¼Œ<code>1</code>~`7`åˆ†åˆ«è¡¨ç¤ºå‘¨æ—¥ï¼Œå‘¨ä¸€ï¼Œâ€¦â€¦ï¼Œå‘¨å…­ã€‚</p>
<p><code>Calendar</code>åªæœ‰ä¸€ç§æ–¹å¼è·å–ï¼Œå³<code>Calendar.getInstance()</code>ï¼Œè€Œä¸”ä¸€è·å–åˆ°å°±æ˜¯å½“å‰æ—¶é—´ã€‚</p>
<p>è®¾ç½®æ—¶é—´ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// å½“å‰æ—¶é—´:</span></span><br><span class="line">        Calendar c = Calendar.getInstance();</span><br><span class="line">        <span class="comment">// æ¸…é™¤æ‰€æœ‰:</span></span><br><span class="line">        c.clear();    <span class="comment">//ä¸€å¼€å§‹è·å–åˆ°å½“å‰æ—¶é—´ï¼Œè°ƒç”¨clear()åˆ é™¤æ‰</span></span><br><span class="line">        <span class="comment">// è®¾ç½®2019å¹´:</span></span><br><span class="line">        c.set(Calendar.YEAR, <span class="number">2019</span>);</span><br><span class="line">        <span class="comment">// è®¾ç½®9æœˆ:æ³¨æ„8è¡¨ç¤º9æœˆ:</span></span><br><span class="line">        c.set(Calendar.MONTH, <span class="number">8</span>);</span><br><span class="line">        <span class="comment">// è®¾ç½®2æ—¥:</span></span><br><span class="line">        c.set(Calendar.DATE, <span class="number">2</span>);</span><br><span class="line">        <span class="comment">// è®¾ç½®æ—¶é—´:</span></span><br><span class="line">        c.set(Calendar.HOUR_OF_DAY, <span class="number">21</span>);</span><br><span class="line">        c.set(Calendar.MINUTE, <span class="number">22</span>);</span><br><span class="line">        c.set(Calendar.SECOND, <span class="number">23</span>);</span><br><span class="line">        System.out.println(<span class="keyword">new</span> SimpleDateFormat(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>).format(c.getTime()));</span><br><span class="line">        <span class="comment">// 2019-09-02 21:22:23</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>TimeZone</strong></p>
<p><code>Calendar</code>å’Œ<code>Date</code>ç›¸æ¯”ï¼Œå®ƒæä¾›äº†æ—¶åŒºè½¬æ¢çš„åŠŸèƒ½ã€‚æ—¶åŒºç”¨<code>TimeZone</code>å¯¹è±¡è¡¨ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        TimeZone tzDefault = TimeZone.getDefault(); <span class="comment">// å½“å‰æ—¶åŒº</span></span><br><span class="line">        TimeZone tzGMT9 = TimeZone.getTimeZone(<span class="string">&quot;GMT+09:00&quot;</span>); <span class="comment">// GMT+9:00æ—¶åŒº</span></span><br><span class="line">        TimeZone tzNY = TimeZone.getTimeZone(<span class="string">&quot;America/New_York&quot;</span>); <span class="comment">// çº½çº¦æ—¶åŒº</span></span><br><span class="line">        System.out.println(tzDefault.getID()); <span class="comment">// Asia/Shanghai</span></span><br><span class="line">        System.out.println(tzGMT9.getID()); <span class="comment">// GMT+09:00</span></span><br><span class="line">        System.out.println(tzNY.getID()); <span class="comment">// America/New_York</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Etc/UTC</span></span><br><span class="line"><span class="comment">GMT+09:00</span></span><br><span class="line"><span class="comment">America/New_York</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p>æ—¶åŒºçš„å”¯ä¸€æ ‡è¯†æ˜¯ä»¥å­—ç¬¦ä¸²è¡¨ç¤ºçš„IDï¼Œæˆ‘ä»¬è·å–æŒ‡å®š<code>TimeZone</code>å¯¹è±¡ä¹Ÿæ˜¯ä»¥è¿™ä¸ªIDä¸ºå‚æ•°è·å–ã€‚</p>
<p>æœ‰äº†æ—¶åŒºï¼Œæˆ‘ä»¬å°±å¯ä»¥å¯¹æŒ‡å®šæ—¶é—´è¿›è¡Œè½¬æ¢ã€‚ä¾‹å¦‚ï¼Œä¸‹é¢çš„ä¾‹å­æ¼”ç¤ºäº†å¦‚ä½•å°†åŒ—äº¬æ—¶é—´<code>2019-11-20 8:15:00</code>è½¬æ¢ä¸ºçº½çº¦æ—¶é—´ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// å½“å‰æ—¶é—´:</span></span><br><span class="line">        Calendar c = Calendar.getInstance();</span><br><span class="line">        <span class="comment">// æ¸…é™¤æ‰€æœ‰:</span></span><br><span class="line">        c.clear();</span><br><span class="line">        <span class="comment">// è®¾ç½®ä¸ºåŒ—äº¬æ—¶åŒº:</span></span><br><span class="line">        c.setTimeZone(TimeZone.getTimeZone(<span class="string">&quot;Asia/Shanghai&quot;</span>));</span><br><span class="line">        <span class="comment">// è®¾ç½®å¹´æœˆæ—¥æ—¶åˆ†ç§’:</span></span><br><span class="line">        c.set(<span class="number">2019</span>, <span class="number">10</span> <span class="comment">/* 11æœˆ */</span>, <span class="number">20</span>, <span class="number">8</span>, <span class="number">15</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="comment">// æ˜¾ç¤ºæ—¶é—´:</span></span><br><span class="line">        <span class="keyword">var</span> sdf = <span class="keyword">new</span> SimpleDateFormat(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>);</span><br><span class="line">        sdf.setTimeZone(TimeZone.getTimeZone(<span class="string">&quot;America/New_York&quot;</span>));</span><br><span class="line">        System.out.println(sdf.format(c.getTime()));</span><br><span class="line">        <span class="comment">// 2019-11-19 19:15:00</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åˆ©ç”¨<code>Calendar</code>è¿›è¡Œæ—¶åŒºè½¬æ¢çš„æ­¥éª¤æ˜¯ï¼š</p>
<ol>
<li>æ¸…é™¤æ‰€æœ‰å­—æ®µï¼›</li>
<li>è®¾å®šæŒ‡å®šæ—¶åŒºï¼›</li>
<li>è®¾å®šæ—¥æœŸå’Œæ—¶é—´ï¼›</li>
<li>åˆ›å»º<code>SimpleDateFormat</code>å¹¶è®¾å®šç›®æ ‡æ—¶åŒºï¼›</li>
<li>æ ¼å¼åŒ–è·å–çš„<code>Date</code>å¯¹è±¡ï¼ˆæ³¨æ„<code>Date</code>å¯¹è±¡æ— æ—¶åŒºä¿¡æ¯ï¼Œæ—¶åŒºä¿¡æ¯å­˜å‚¨åœ¨<code>SimpleDateFormat</code>ä¸­ï¼‰ã€‚</li>
</ol>
<p><code>Calendar</code>ä¹Ÿå¯ä»¥å¯¹æ—¥æœŸå’Œæ—¶é—´è¿›è¡Œç®€å•çš„åŠ å‡ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// å½“å‰æ—¶é—´:</span></span><br><span class="line">        Calendar c = Calendar.getInstance();</span><br><span class="line">        <span class="comment">// æ¸…é™¤æ‰€æœ‰:</span></span><br><span class="line">        c.clear();</span><br><span class="line">        <span class="comment">// è®¾ç½®å¹´æœˆæ—¥æ—¶åˆ†ç§’:</span></span><br><span class="line">        c.set(<span class="number">2019</span>, <span class="number">10</span> <span class="comment">/* 11æœˆ */</span>, <span class="number">20</span>, <span class="number">8</span>, <span class="number">15</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="comment">// åŠ 5å¤©å¹¶å‡å»2å°æ—¶:</span></span><br><span class="line">        c.add(Calendar.DAY_OF_MONTH, <span class="number">5</span>);</span><br><span class="line">        c.add(Calendar.HOUR_OF_DAY, -<span class="number">2</span>);</span><br><span class="line">        <span class="comment">// æ˜¾ç¤ºæ—¶é—´:</span></span><br><span class="line">        <span class="keyword">var</span> sdf = <span class="keyword">new</span> SimpleDateFormat(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>);</span><br><span class="line">        Date d = c.getTime();</span><br><span class="line">        System.out.println(sdf.format(d));</span><br><span class="line">        <span class="comment">// 2019-11-25 6:15:00</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-LocalDateTime"><a href="#3-LocalDateTime" class="headerlink" title="3. LocalDateTime"></a>3. LocalDateTime</h2><p><code>java.time</code>åŒ…æä¾›äº†æ–°çš„æ—¥æœŸå’Œæ—¶é—´APIï¼Œä¸»è¦æ¶‰åŠçš„ç±»å‹æœ‰ï¼š</p>
<ul>
<li>æœ¬åœ°æ—¥æœŸå’Œæ—¶é—´ï¼š<code>LocalDateTime</code>ï¼Œ<code>LocalDate</code>ï¼Œ<code>LocalTime</code>ï¼›</li>
<li>å¸¦æ—¶åŒºçš„æ—¥æœŸå’Œæ—¶é—´ï¼š<code>ZonedDateTime</code>ï¼›</li>
<li>æ—¶åˆ»ï¼š<code>Instant</code>ï¼›</li>
<li>æ—¶åŒºï¼š<code>ZoneId</code>ï¼Œ<code>ZoneOffset</code>ï¼›</li>
<li>æ—¶é—´é—´éš”ï¼š<code>Duration</code>ã€‚</li>
</ul>
<p>ä»¥åŠä¸€å¥—æ–°çš„ç”¨äºå–ä»£<code>SimpleDateFormat</code>çš„æ ¼å¼åŒ–ç±»å‹<code>DateTimeFormatter</code>ã€‚</p>
<p>æ–°APIçš„ç±»å‹å‡ ä¹å…¨éƒ¨æ˜¯ä¸å˜ç±»å‹ï¼ˆå’ŒStringç±»ä¼¼ï¼‰ï¼Œå¯ä»¥æ”¾å¿ƒä½¿ç”¨ä¸å¿…æ‹…å¿ƒè¢«ä¿®æ”¹ã€‚</p>
<p><strong>LocalDateTime</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">/* </span></span><br><span class="line"><span class="comment">        LocalDate d = LocalDate.now(); // å½“å‰æ—¥æœŸ</span></span><br><span class="line"><span class="comment">        LocalTime t = LocalTime.now(); // å½“å‰æ—¶é—´</span></span><br><span class="line"><span class="comment">        LocalDateTime dt = LocalDateTime.now(); // å½“å‰æ—¥æœŸå’Œæ—¶é—´</span></span><br><span class="line"><span class="comment">        ä¸ºäº†é¿å…ç¨‹åºæ‰§è¡Œæ—¶é—´çš„ä¸ä¸€æ ·ï¼Œå¯¼è‡´æ—¶é—´ä¸å‡†ç¡®ï¼Œé‡‡ç”¨ä¸‹é¢çš„æ–¹æ³•*/</span></span><br><span class="line">        LocalDateTime dt = LocalDateTime.now(); <span class="comment">// å½“å‰æ—¥æœŸå’Œæ—¶</span></span><br><span class="line">        LocalDate d = dt.toLocalDate(); <span class="comment">// è½¬æ¢åˆ°å½“å‰æ—¥æœŸ</span></span><br><span class="line">        LocalTime t = dt.toLocalTime(); <span class="comment">// è½¬æ¢åˆ°å½“å‰æ—¶é—´</span></span><br><span class="line">        System.out.println(d); <span class="comment">// ä¸¥æ ¼æŒ‰ç…§ISO 8601æ ¼å¼æ‰“å°</span></span><br><span class="line">        System.out.println(t); <span class="comment">// ä¸¥æ ¼æŒ‰ç…§ISO 8601æ ¼å¼æ‰“å°</span></span><br><span class="line">        System.out.println(dt); <span class="comment">// ä¸¥æ ¼æŒ‰ç…§ISO 8601æ ¼å¼æ‰“å°</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">2021-04-22</span></span><br><span class="line"><span class="comment">11:36:59.238843262</span></span><br><span class="line"><span class="comment">2021-04-22T11:36:59.238871627</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p>æŒ‡å®šçš„æ—¥æœŸå’Œæ—¶é—´åˆ›å»º<code>LocalDateTime</code>å¯ä»¥é€šè¿‡<code>of()</code>æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æŒ‡å®šæ—¥æœŸå’Œæ—¶é—´:</span></span><br><span class="line">LocalDate d2 = LocalDate.of(<span class="number">2019</span>, <span class="number">11</span>, <span class="number">30</span>); <span class="comment">// 2019-11-30, æ³¨æ„11=11æœˆ</span></span><br><span class="line">LocalTime t2 = LocalTime.of(<span class="number">15</span>, <span class="number">16</span>, <span class="number">17</span>); <span class="comment">// 15:16:17</span></span><br><span class="line">LocalDateTime dt2 = LocalDateTime.of(<span class="number">2019</span>, <span class="number">11</span>, <span class="number">30</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">17</span>);</span><br><span class="line">LocalDateTime dt3 = LocalDateTime.of(d2, t2);</span><br></pre></td></tr></table></figure>

<p>å°†å­—ç¬¦ä¸²è½¬æ¢ä¸º<code>LocalDateTime</code>å°±å¯ä»¥ä¼ å…¥æ ‡å‡†æ ¼å¼ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">LocalDateTime dt = LocalDateTime.parse(<span class="string">&quot;2019-11-19T15:16:17&quot;</span>);</span><br><span class="line">LocalDate d = LocalDate.parse(<span class="string">&quot;2019-11-19&quot;</span>);</span><br><span class="line">LocalTime t = LocalTime.parse(<span class="string">&quot;15:16:17&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ISO 8601è§„å®šçš„æ—¥æœŸå’Œæ—¶é—´åˆ†éš”ç¬¦æ˜¯<code>T</code>ã€‚æ ‡å‡†æ ¼å¼å¦‚ä¸‹ï¼š</p>
<ul>
<li>æ—¥æœŸï¼š<code>yyyy-MM-dd</code></li>
<li>æ—¶é—´ï¼š<code>HH:mm:ss</code></li>
<li>å¸¦æ¯«ç§’çš„æ—¶é—´ï¼š<code>HH:mm:ss.SSS</code></li>
<li>æ—¥æœŸå’Œæ—¶é—´ï¼š<code>yyyy-MM-dd&#39;T&#39;HH:mm:ss</code></li>
<li>å¸¦æ¯«ç§’çš„æ—¥æœŸå’Œæ—¶é—´ï¼š<code>yyyy-MM-dd&#39;T&#39;HH:mm:ss.SSS</code></li>
</ul>
<p><strong>DateTimeFormatter</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// è‡ªå®šä¹‰æ ¼å¼åŒ–:</span></span><br><span class="line">        DateTimeFormatter dtf = DateTimeFormatter.ofPattern(<span class="string">&quot;yyyy/MM/dd HH:mm:ss&quot;</span>);</span><br><span class="line">        System.out.println(dtf.format(LocalDateTime.now()));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ç”¨è‡ªå®šä¹‰æ ¼å¼è§£æ:</span></span><br><span class="line">        LocalDateTime dt2 = LocalDateTime.parse(<span class="string">&quot;2019/11/30 15:16:17&quot;</span>, dtf);</span><br><span class="line">        System.out.println(dt2);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">2021/04/22 11:46:18</span></span><br><span class="line"><span class="comment">2019-11-30T15:16:17</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p><code>LocalDateTime</code>æä¾›äº†å¯¹æ—¥æœŸå’Œæ—¶é—´è¿›è¡ŒåŠ å‡çš„éå¸¸ç®€å•çš„é“¾å¼è°ƒç”¨ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        LocalDateTime dt = LocalDateTime.of(<span class="number">2019</span>, <span class="number">10</span>, <span class="number">26</span>, <span class="number">20</span>, <span class="number">30</span>, <span class="number">59</span>);</span><br><span class="line">        System.out.println(dt);</span><br><span class="line">        <span class="comment">// åŠ 5å¤©å‡3å°æ—¶:</span></span><br><span class="line">        LocalDateTime dt2 = dt.plusDays(<span class="number">5</span>).minusHours(<span class="number">3</span>);</span><br><span class="line">        System.out.println(dt2); <span class="comment">// 2019-10-31T17:30:59</span></span><br><span class="line">        <span class="comment">// å‡1æœˆ:</span></span><br><span class="line">        LocalDateTime dt3 = dt2.minusMonths(<span class="number">1</span>);</span><br><span class="line">        System.out.println(dt3); <span class="comment">// 2019-09-30T17:30:59</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">2019-10-26T20:30:59</span></span><br><span class="line"><span class="comment">2019-10-31T17:30:59</span></span><br><span class="line"><span class="comment">2019-09-30T17:30:59</span></span><br><span class="line"><span class="comment">æœˆä»½åŠ å‡ä¼šè‡ªåŠ¨è°ƒæ•´æ—¥æœŸï¼Œä¾‹å¦‚ä»2019-10-31å‡å»1ä¸ªæœˆå¾—åˆ°çš„ç»“æœæ˜¯2019-09-30ï¼Œå› ä¸º9æœˆæ²¡æœ‰31æ—¥ã€‚</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p>å¯¹æ—¥æœŸå’Œæ—¶é—´è¿›è¡Œè°ƒæ•´åˆ™ä½¿ç”¨<code>withXxx()</code>æ–¹æ³•</p>
<ul>
<li>è°ƒæ•´å¹´ï¼š<code>withYear()</code></li>
<li>è°ƒæ•´æœˆï¼š<code>withMonth()</code></li>
<li>è°ƒæ•´æ—¥ï¼š<code>withDayOfMonth()</code></li>
<li>è°ƒæ•´æ—¶ï¼š<code>withHour()</code></li>
<li>è°ƒæ•´åˆ†ï¼š<code>withMinute()</code></li>
<li>è°ƒæ•´ç§’ï¼š<code>withSecond()</code></li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        LocalDateTime dt = LocalDateTime.of(<span class="number">2019</span>, <span class="number">10</span>, <span class="number">26</span>, <span class="number">20</span>, <span class="number">30</span>, <span class="number">59</span>);</span><br><span class="line">        System.out.println(dt);</span><br><span class="line">        <span class="comment">// æ—¥æœŸå˜ä¸º31æ—¥:</span></span><br><span class="line">        LocalDateTime dt2 = dt.withDayOfMonth(<span class="number">31</span>);</span><br><span class="line">        System.out.println(dt2); <span class="comment">// 2019-10-31T20:30:59</span></span><br><span class="line">        <span class="comment">// æœˆä»½å˜ä¸º9:</span></span><br><span class="line">        LocalDateTime dt3 = dt2.withMonth(<span class="number">9</span>);</span><br><span class="line">        System.out.println(dt3); <span class="comment">// 2019-09-30T20:30:59</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>LocalDateTime</code>è¿˜æœ‰ä¸€ä¸ªé€šç”¨çš„<code>with()</code>æ–¹æ³•:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// æœ¬æœˆç¬¬ä¸€å¤©0:00æ—¶åˆ»:</span></span><br><span class="line">        LocalDateTime firstDay = LocalDate.now().withDayOfMonth(<span class="number">1</span>).atStartOfDay();</span><br><span class="line">        System.out.println(firstDay);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æœ¬æœˆæœ€å1å¤©:</span></span><br><span class="line">        LocalDate lastDay = LocalDate.now().with(TemporalAdjusters.lastDayOfMonth());</span><br><span class="line">        System.out.println(lastDay);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä¸‹æœˆç¬¬1å¤©:</span></span><br><span class="line">        LocalDate nextMonthFirstDay = LocalDate.now().with(TemporalAdjusters.firstDayOfNextMonth());</span><br><span class="line">        System.out.println(nextMonthFirstDay);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æœ¬æœˆç¬¬1ä¸ªå‘¨ä¸€:</span></span><br><span class="line">        LocalDate firstWeekday = LocalDate.now().with(TemporalAdjusters.firstInMonth(DayOfWeek.MONDAY));</span><br><span class="line">        System.out.println(firstWeekday);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¦åˆ¤æ–­ä¸¤ä¸ª<code>LocalDateTime</code>çš„å…ˆåï¼Œå¯ä»¥ä½¿ç”¨<code>isBefore()</code>ã€<code>isAfter()</code>æ–¹æ³•ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">LocalDateTime now = LocalDateTime.now();</span><br><span class="line">LocalDateTime target = LocalDateTime.of(<span class="number">2019</span>, <span class="number">11</span>, <span class="number">19</span>, <span class="number">8</span>, <span class="number">15</span>, <span class="number">0</span>);</span><br><span class="line">System.out.println(now.isBefore(target));</span><br><span class="line">System.out.println(LocalDate.now().isBefore(LocalDate.of(<span class="number">2019</span>, <span class="number">11</span>, <span class="number">19</span>)));</span><br><span class="line">System.out.println(LocalTime.now().isAfter(LocalTime.parse(<span class="string">&quot;08:15:00&quot;</span>)));</span><br></pre></td></tr></table></figure>

<p><strong>Durationå’ŒPeriod</strong></p>
<p><code>Duration</code>è¡¨ç¤ºä¸¤ä¸ªæ—¶åˆ»ä¹‹é—´çš„æ—¶é—´é—´éš”ã€‚å¦ä¸€ä¸ªç±»ä¼¼çš„<code>Period</code>è¡¨ç¤ºä¸¤ä¸ªæ—¥æœŸä¹‹é—´çš„å¤©æ•°ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        LocalDateTime start = LocalDateTime.of(<span class="number">2019</span>, <span class="number">11</span>, <span class="number">19</span>, <span class="number">8</span>, <span class="number">15</span>, <span class="number">0</span>);</span><br><span class="line">        LocalDateTime end = LocalDateTime.of(<span class="number">2020</span>, <span class="number">1</span>, <span class="number">9</span>, <span class="number">19</span>, <span class="number">25</span>, <span class="number">30</span>);</span><br><span class="line">        Duration d = Duration.between(start, end);</span><br><span class="line">        System.out.println(d); <span class="comment">// PT1235H10M30S</span></span><br><span class="line"></span><br><span class="line">        Period p = LocalDate.of(<span class="number">2019</span>, <span class="number">11</span>, <span class="number">19</span>).until(LocalDate.of(<span class="number">2020</span>, <span class="number">1</span>, <span class="number">9</span>));</span><br><span class="line">        System.out.println(p); <span class="comment">// P1M21D</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>Duration</code>å’Œ<code>Period</code>çš„è¡¨ç¤ºæ–¹æ³•,ä»¥<code>P...T...</code>çš„å½¢å¼è¡¨ç¤ºï¼Œ<code>P...T</code>ä¹‹é—´è¡¨ç¤ºæ—¥æœŸé—´éš”ï¼Œ<code>T</code>åé¢è¡¨ç¤ºæ—¶é—´é—´éš”ã€‚å¦‚æœæ˜¯<code>PT...</code>çš„æ ¼å¼è¡¨ç¤ºä»…æœ‰æ—¶é—´é—´éš”ã€‚</p>
<p>åˆ©ç”¨<code>ofXxx()</code>æˆ–è€…<code>parse()</code>æ–¹æ³•ä¹Ÿå¯ä»¥ç›´æ¥åˆ›å»º<code>Duration</code>ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Duration d1 = Duration.ofHours(<span class="number">10</span>); <span class="comment">// 10 hours</span></span><br><span class="line">Duration d2 = Duration.parse(<span class="string">&quot;P1DT2H3M&quot;</span>); <span class="comment">// 1 day, 2 hours, 3 minutes</span></span><br></pre></td></tr></table></figure>

<h2 id="4-ZonedDateTime"><a href="#4-ZonedDateTime" class="headerlink" title="4. ZonedDateTime"></a>4. ZonedDateTime</h2><p><code>LocalDateTime</code>æ€»æ˜¯è¡¨ç¤ºæœ¬åœ°æ—¥æœŸå’Œæ—¶é—´ï¼Œè¦è¡¨ç¤ºä¸€ä¸ªå¸¦æ—¶åŒºçš„æ—¥æœŸå’Œæ—¶é—´ï¼Œæˆ‘ä»¬å°±éœ€è¦<code>ZonedDateTime</code>ã€‚</p>
<p><code>ZonedDateTime</code>ç†è§£æˆ<code>LocalDateTime</code>åŠ <code>ZoneId</code>ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ZonedDateTime zbj = ZonedDateTime.now(); <span class="comment">// é»˜è®¤æ—¶åŒº</span></span><br><span class="line">        ZonedDateTime zny = ZonedDateTime.now(ZoneId.of(<span class="string">&quot;America/New_York&quot;</span>)); <span class="comment">// ç”¨æŒ‡å®šæ—¶åŒºè·å–å½“å‰æ—¶é—´</span></span><br><span class="line">        System.out.println(zbj);</span><br><span class="line">        System.out.println(zny);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">2021-04-22T13:21:21.244909512Z[Etc/UTC]</span></span><br><span class="line"><span class="comment">2021-04-22T09:21:21.246806905-04:00[America/New_York]</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p>é€šè¿‡ç»™ä¸€ä¸ª<code>LocalDateTime</code>é™„åŠ ä¸€ä¸ª<code>ZoneId</code>ï¼Œå°±å¯ä»¥å˜æˆ<code>ZonedDateTime</code>ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        LocalDateTime ldt = LocalDateTime.of(<span class="number">2019</span>, <span class="number">9</span>, <span class="number">15</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">17</span>);</span><br><span class="line">        ZonedDateTime zbj = ldt.atZone(ZoneId.systemDefault());</span><br><span class="line">        ZonedDateTime zny = ldt.atZone(ZoneId.of(<span class="string">&quot;America/New_York&quot;</span>));</span><br><span class="line">        System.out.println(zbj);</span><br><span class="line">        System.out.println(zny);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">2019-09-15T15:16:17Z[Etc/UTC]</span></span><br><span class="line"><span class="comment">2019-09-15T15:16:17-04:00[America/New_York]</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p><strong>æ—¶åŒºè½¬æ¢</strong></p>
<p>è¦è½¬æ¢æ—¶åŒºï¼Œé¦–å…ˆæˆ‘ä»¬éœ€è¦æœ‰ä¸€ä¸ª<code>ZonedDateTime</code>å¯¹è±¡ï¼Œç„¶åï¼Œé€šè¿‡<code>withZoneSameInstant()</code>å°†å…³è”æ—¶åŒºè½¬æ¢åˆ°å¦ä¸€ä¸ªæ—¶åŒºï¼Œè½¬æ¢åæ—¥æœŸå’Œæ—¶é—´éƒ½ä¼šç›¸åº”è°ƒæ•´ã€‚</p>
<p>å°†åŒ—äº¬æ—¶é—´è½¬æ¢ä¸ºçº½çº¦æ—¶é—´ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ä»¥ä¸­å›½æ—¶åŒºè·å–å½“å‰æ—¶é—´:</span></span><br><span class="line">        ZonedDateTime zbj = ZonedDateTime.now(ZoneId.of(<span class="string">&quot;Asia/Shanghai&quot;</span>));</span><br><span class="line">        <span class="comment">// è½¬æ¢ä¸ºçº½çº¦æ—¶é—´:</span></span><br><span class="line">        ZonedDateTime zny = zbj.withZoneSameInstant(ZoneId.of(<span class="string">&quot;America/New_York&quot;</span>));</span><br><span class="line">        System.out.println(zbj);</span><br><span class="line">        System.out.println(zny);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">2021-04-22T21:34:20.051086886+08:00[Asia/Shanghai]</span></span><br><span class="line"><span class="comment">2021-04-22T09:34:20.051086886-04:00[America/New_York]</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<h2 id="5-DateTimeFormatter"><a href="#5-DateTimeFormatter" class="headerlink" title="5. DateTimeFormatter"></a>5. DateTimeFormatter</h2><p>ä½¿ç”¨æ—§çš„<code>Date</code>å¯¹è±¡æ—¶ï¼Œæˆ‘ä»¬ç”¨<code>SimpleDateFormat</code>è¿›è¡Œæ ¼å¼åŒ–æ˜¾ç¤ºã€‚ä½¿ç”¨æ–°çš„<code>LocalDateTime</code>æˆ–<code>ZonedLocalDateTime</code>æ—¶ï¼Œæˆ‘ä»¬è¦è¿›è¡Œæ ¼å¼åŒ–æ˜¾ç¤ºï¼Œå°±è¦ä½¿ç”¨<code>DateTimeFormatter</code>ã€‚</p>
<p>åˆ›å»º<code>DateTimeFormatter</code>æ—¶ï¼Œæˆ‘ä»¬ä»ç„¶é€šè¿‡ä¼ å…¥æ ¼å¼åŒ–å­—ç¬¦ä¸²å®ç°ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">DateTimeFormatter formatter = DateTimeFormatter.ofPattern(<span class="string">&quot;yyyy-MM-dd HH:mm&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨æ–¹å¼ä¸<code>SimpleDateFormat</code>å®Œå…¨ä¸€è‡´ã€‚</p>
<p>å¦ä¸€ç§åˆ›å»º<code>DateTimeFormatter</code>çš„æ–¹æ³•æ˜¯ï¼Œä¼ å…¥æ ¼å¼åŒ–å­—ç¬¦ä¸²æ—¶ï¼ŒåŒæ—¶æŒ‡å®š<code>Locale</code>ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">DateTimeFormatter formatter = DateTimeFormatter.ofPattern(<span class="string">&quot;E, yyyy-MMMM-dd HH:mm&quot;</span>, Locale.US);</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ZonedDateTime zdt = ZonedDateTime.now();</span><br><span class="line">        <span class="keyword">var</span> formatter = DateTimeFormatter.ofPattern(<span class="string">&quot;yyyy-MM-dd&#x27;T&#x27;HH:mm ZZZZ&quot;</span>);</span><br><span class="line">        System.out.println(formatter.format(zdt));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> zhFormatter = DateTimeFormatter.ofPattern(<span class="string">&quot;yyyy MMM dd EE HH:mm&quot;</span>, Locale.CHINA);</span><br><span class="line">        System.out.println(zhFormatter.format(zdt));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> usFormatter = DateTimeFormatter.ofPattern(<span class="string">&quot;E, MMMM/dd/yyyy HH:mm&quot;</span>, Locale.US);</span><br><span class="line">        System.out.println(usFormatter.format(zdt));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">2021-04-22T13:37 GMT</span></span><br><span class="line"><span class="comment">2021 4æœˆ 22 å‘¨å›› 13:37</span></span><br><span class="line"><span class="comment">Thu, April/22/2021 13:37</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡<code>DateTimeFormatter</code>é¢„å®šä¹‰çš„å‡ ä¸ªé™æ€å˜é‡æ¥å¼•ç”¨ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> ldt = LocalDateTime.now();</span><br><span class="line">System.out.println(DateTimeFormatter.ISO_DATE.format(ldt));</span><br><span class="line">System.out.println(DateTimeFormatter.ISO_DATE_TIME.format(ldt));</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">2019-09-15</span></span><br><span class="line"><span class="comment">2019-09-15T23:16:51.56217</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<h2 id="6-Instant"><a href="#6-Instant" class="headerlink" title="6. Instant"></a>6. Instant</h2><p><code>Instant.now()</code>è·å–å½“å‰æ—¶é—´æˆ³ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Instant now = Instant.now();</span><br><span class="line">        System.out.println(now.getEpochSecond()); <span class="comment">// ç§’</span></span><br><span class="line">        System.out.println(now.toEpochMilli()); <span class="comment">// æ¯«ç§’</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">1619098921</span></span><br><span class="line"><span class="comment">1619098921281</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p><code>Instant</code>å°±æ˜¯æ—¶é—´æˆ³ï¼Œé‚£ä¹ˆï¼Œç»™å®ƒé™„åŠ ä¸Šä¸€ä¸ªæ—¶åŒºï¼Œå°±å¯ä»¥åˆ›å»ºå‡º<code>ZonedDateTime</code>ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ä»¥æŒ‡å®šæ—¶é—´æˆ³åˆ›å»ºInstant:</span></span><br><span class="line">Instant ins = Instant.ofEpochSecond(<span class="number">1568568760</span>);</span><br><span class="line">ZonedDateTime zdt = ins.atZone(ZoneId.systemDefault());</span><br><span class="line">System.out.println(zdt); <span class="comment">// 2019-09-16T01:32:40+08:00[Asia/Shanghai]</span></span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/ghj1998/image_repository/main/image-20210422214742768.png" alt="image-20210422214742768"></p>
<h2 id="7-è½¬åŒ–"><a href="#7-è½¬åŒ–" class="headerlink" title="7. è½¬åŒ–"></a>7. è½¬åŒ–</h2><p>å¦‚æœè¦æŠŠæ—§å¼çš„<code>Date</code>æˆ–<code>Calendar</code>è½¬æ¢ä¸ºæ–°APIå¯¹è±¡ï¼Œå¯ä»¥é€šè¿‡<code>toInstant()</code>æ–¹æ³•è½¬æ¢ä¸º<code>Instant</code>å¯¹è±¡ï¼Œå†ç»§ç»­è½¬æ¢ä¸º<code>ZonedDateTime</code>ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Date -&gt; Instant:</span></span><br><span class="line">Instant ins1 = <span class="keyword">new</span> Date().toInstant();</span><br><span class="line"></span><br><span class="line"><span class="comment">// Calendar -&gt; Instant -&gt; ZonedDateTime:</span></span><br><span class="line">Calendar calendar = Calendar.getInstance();</span><br><span class="line">Instant ins2 = calendar.toInstant();</span><br><span class="line">ZonedDateTime zdt = ins2.atZone(calendar.getTimeZone().toZoneId());</span><br></pre></td></tr></table></figure>

<p><strong>æ•°æ®åº“çš„Date</strong></p>
<p>åœ¨ä½¿ç”¨Javaç¨‹åºæ“ä½œæ•°æ®åº“æ—¶ï¼Œæˆ‘ä»¬éœ€è¦æŠŠæ•°æ®åº“ç±»å‹ä¸Javaç±»å‹æ˜ å°„èµ·æ¥ã€‚</p>
<table>
<thead>
<tr>
<th align="left">æ•°æ®åº“</th>
<th align="left">å¯¹åº”Javaç±»ï¼ˆæ—§ï¼‰</th>
<th align="left">å¯¹åº”Javaç±»ï¼ˆæ–°ï¼‰</th>
</tr>
</thead>
<tbody><tr>
<td align="left">DATETIME</td>
<td align="left"><code>java.util.Date</code></td>
<td align="left"><code>LocalDateTime</code></td>
</tr>
<tr>
<td align="left">DATE</td>
<td align="left"><code>java.sql.Date</code></td>
<td align="left"><code>LocalDate</code></td>
</tr>
<tr>
<td align="left">TIME</td>
<td align="left"><code>java.sql.Time</code></td>
<td align="left"><code>LocalTime</code></td>
</tr>
<tr>
<td align="left">TIMESTAMP</td>
<td align="left"><code>java.sql.Timestamp</code></td>
<td align="left"><code>LocalDateTime</code></td>
</tr>
</tbody></table>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">long</span> ts = <span class="number">1574208900000L</span>;</span><br><span class="line">        System.out.println(timestampToString(ts, Locale.CHINA, <span class="string">&quot;Asia/Shanghai&quot;</span>));</span><br><span class="line">        System.out.println(timestampToString(ts, Locale.US, <span class="string">&quot;America/New_York&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">static</span> String <span class="title">timestampToString</span><span class="params">(<span class="keyword">long</span> epochMilli, Locale lo, String zoneId)</span> </span>&#123;</span><br><span class="line">        Instant ins = Instant.ofEpochMilli(epochMilli);</span><br><span class="line">        DateTimeFormatter f = DateTimeFormatter.ofLocalizedDateTime(FormatStyle.MEDIUM, FormatStyle.SHORT);</span><br><span class="line">        <span class="keyword">return</span> f.withLocale(lo).format(ZonedDateTime.ofInstant(ins, ZoneId.of(zoneId)));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">2019å¹´11æœˆ20æ—¥ ä¸Šåˆ8:15</span></span><br><span class="line"><span class="comment">Nov 19, 2019, 7:15 PM</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

]]></content>
      <tags>
        <tag>JAVA</tag>
      </tags>
  </entry>
  <entry>
    <title>JAVA-æ ¸å¿ƒç±»</title>
    <url>/2021/04/02/JAVA%E6%A0%B8%E5%BF%83%E7%B1%BB/</url>
    <content><![CDATA[<h1 id="JAVAæ ¸å¿ƒç±»"><a href="#JAVAæ ¸å¿ƒç±»" class="headerlink" title="JAVAæ ¸å¿ƒç±»"></a>JAVAæ ¸å¿ƒç±»</h1><p>æ„Ÿè°¢å»–é›ªå³°è€å¸ˆçš„æ•™ç¨‹ï¼</p>
<p><a href="https://www.liaoxuefeng.com/wiki/1252599548343744">JAVAæ•™ç¨‹</a></p>
<h2 id="1-å­—ç¬¦ä¸²String"><a href="#1-å­—ç¬¦ä¸²String" class="headerlink" title="1. å­—ç¬¦ä¸²String"></a>1. å­—ç¬¦ä¸²String</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">String s1 &#x3D; &quot;Hello!&quot;;</span><br></pre></td></tr></table></figure>

<p>å­—ç¬¦ä¸²å…·æœ‰<strong>ä¸å¯å˜æ€§</strong>ã€‚</p>
<p><strong>å­—ç¬¦ä¸²æ¯”è¾ƒ</strong></p>
<p>æ¯”è¾ƒå­—ç¬¦ä¸²å¿…é¡»ä½¿ç”¨<code>equals()</code>ï¼Œä¸èƒ½ä½¿ç”¨==ã€‚</p>
<p>è¦å¿½ç•¥å¤§å°å†™æ¯”è¾ƒï¼Œä½¿ç”¨<code>equalsIgnoreCase()</code>æ–¹æ³•ã€‚</p>
<p><strong>Stringå¸¸ç”¨çš„æ–¹æ³•</strong></p>
<ul>
<li>æœç´¢å­ä¸²</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;Hello&quot;</span>.contains(<span class="string">&quot;ll&quot;</span>); <span class="comment">// true</span></span><br><span class="line"><span class="string">&quot;Hello&quot;</span>.indexOf(<span class="string">&quot;l&quot;</span>); <span class="comment">// 2</span></span><br><span class="line"><span class="string">&quot;Hello&quot;</span>.lastIndexOf(<span class="string">&quot;l&quot;</span>); <span class="comment">// 3</span></span><br><span class="line"><span class="string">&quot;Hello&quot;</span>.startsWith(<span class="string">&quot;He&quot;</span>); <span class="comment">// true</span></span><br><span class="line"><span class="string">&quot;Hello&quot;</span>.endsWith(<span class="string">&quot;lo&quot;</span>); <span class="comment">// true</span></span><br></pre></td></tr></table></figure>

<ul>
<li>æå–å­ä¸²</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;Hello&quot;</span>.substring(<span class="number">2</span>); <span class="comment">// &quot;llo&quot;</span></span><br><span class="line"><span class="string">&quot;Hello&quot;</span>.substring(<span class="number">2</span>, <span class="number">4</span>); <span class="string">&quot;ll&quot;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>å»é™¤é¦–ä½ç©ºç™½å­—ç¬¦    <code>\t \r \n</code></li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;  \tHello\r\n &quot;</span>.trim(); <span class="comment">// &quot;Hello&quot;</span></span><br></pre></td></tr></table></figure>

<p><code>strip()</code>ä¸<code>trim()</code>ä¸åŒçš„æ˜¯ï¼Œ<code>strip()</code>èƒ½å¤Ÿç§»é™¤ä¸­æ–‡ç©ºæ ¼ï¼Œæ‰€ä»¥ç«‹å³æ¨ï¼Œç”¨<code>strip()</code>å°±å¯ä»¥äº†ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;\u3000Hello\u3000&quot;</span>.strip(); <span class="comment">// &quot;Hello&quot;</span></span><br><span class="line"><span class="string">&quot; Hello &quot;</span>.stripLeading(); <span class="comment">// &quot;Hello &quot;</span></span><br><span class="line"><span class="string">&quot; Hello &quot;</span>.stripTrailing(); <span class="comment">// &quot; Hello&quot;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>åˆ¤æ–­æ˜¯å¦ä¸ºç©º</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;&quot;</span>.isEmpty(); <span class="comment">// trueï¼Œå› ä¸ºå­—ç¬¦ä¸²é•¿åº¦ä¸º0</span></span><br><span class="line"><span class="string">&quot;  &quot;</span>.isEmpty(); <span class="comment">// falseï¼Œå› ä¸ºå­—ç¬¦ä¸²é•¿åº¦ä¸ä¸º0</span></span><br><span class="line"><span class="string">&quot;  \n&quot;</span>.isBlank(); <span class="comment">// trueï¼Œå› ä¸ºåªåŒ…å«ç©ºç™½å­—ç¬¦</span></span><br><span class="line"><span class="string">&quot; Hello &quot;</span>.isBlank(); <span class="comment">// falseï¼Œå› ä¸ºåŒ…å«éç©ºç™½å­—ç¬¦</span></span><br></pre></td></tr></table></figure>

<ul>
<li>æ›¿æ¢å­ä¸²</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">String s = <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">s.replace(<span class="string">&#x27;l&#x27;</span>, <span class="string">&#x27;w&#x27;</span>); <span class="comment">// &quot;hewwo&quot;ï¼Œæ‰€æœ‰å­—ç¬¦&#x27;l&#x27;è¢«æ›¿æ¢ä¸º&#x27;w&#x27;</span></span><br><span class="line">s.replace(<span class="string">&quot;ll&quot;</span>, <span class="string">&quot;~~&quot;</span>); <span class="comment">// &quot;he~~o&quot;ï¼Œæ‰€æœ‰å­ä¸²&quot;ll&quot;è¢«æ›¿æ¢ä¸º&quot;~~&quot;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">String s = <span class="string">&quot;A,,B;C ,D&quot;</span>;</span><br><span class="line">s.replaceAll(<span class="string">&quot;[\\,\\;\\s]+&quot;</span>, <span class="string">&quot;,&quot;</span>); <span class="comment">// &quot;A,B,C,D&quot;</span></span><br></pre></td></tr></table></figure>

<p>æ­£åˆ™è¡¨è¾¾å¼(åé¢å­¦)æ›¿æ¢ã€‚<em>PSï¼šæ­£åˆ™è¡¨è¾¾å¼å¿’çƒ¦äº†</em></p>
<ul>
<li>åˆ†å‰²å­—ç¬¦ä¸²</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">String s &#x3D; &quot;A,B,C,D&quot;;</span><br><span class="line">String[] ss &#x3D; s.split(&quot;\\,&quot;); &#x2F;&#x2F; &#123;&quot;A&quot;, &quot;B&quot;, &quot;C&quot;, &quot;D&quot;&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>æ‹¼æ¥å­—ç¬¦ä¸²</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">String[] arr &#x3D; &#123;&quot;A&quot;, &quot;B&quot;, &quot;C&quot;&#125;;</span><br><span class="line">String s &#x3D; String.join(&quot;***&quot;, arr); &#x2F;&#x2F; &quot;A***B***C&quot;</span><br></pre></td></tr></table></figure>

<ul>
<li>æ ¼å¼åŒ–å­—ç¬¦ä¸²</li>
</ul>
<p>å­—ç¬¦ä¸²æä¾›äº†<code>formatted()</code>æ–¹æ³•å’Œ<code>format()</code>é™æ€æ–¹æ³•ï¼Œå¯ä»¥ä¼ å…¥å…¶ä»–å‚æ•°ï¼Œæ›¿æ¢å ä½ç¬¦ï¼Œç„¶åç”Ÿæˆæ–°çš„å­—ç¬¦ä¸²ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String s = <span class="string">&quot;Hi %s, your score is %d!&quot;</span>;</span><br><span class="line">        System.out.println(s.formatted(<span class="string">&quot;Alice&quot;</span>, <span class="number">80</span>));</span><br><span class="line">        System.out.println(String.format(<span class="string">&quot;Hi %s, your score is %.2f!&quot;</span>, <span class="string">&quot;Bob&quot;</span>, <span class="number">59.5</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¸¸ç”¨çš„å ä½ç¬¦ï¼š</p>
<ol>
<li><p><code>%s</code>ï¼šæ˜¾ç¤ºå­—ç¬¦ä¸²ï¼›</p>
</li>
<li><p><code>%d</code>ï¼šæ˜¾ç¤ºæ•´æ•°ï¼›</p>
</li>
<li><p><code>%x</code>ï¼šæ˜¾ç¤ºåå…­è¿›åˆ¶æ•´æ•°ï¼›</p>
</li>
<li><p><code>%f</code>ï¼šæ˜¾ç¤ºæµ®ç‚¹æ•°ã€‚</p>
</li>
</ol>
<p>å ä½ç¬¦è¿˜å¯ä»¥å¸¦æ ¼å¼ï¼Œä¾‹å¦‚<code>%.2f</code>è¡¨ç¤ºæ˜¾ç¤ºä¸¤ä½å°æ•°ã€‚</p>
<ul>
<li>ç±»å‹è½¬åŒ– ï¼šä½¿ç”¨é™æ€æ–¹æ³•valueof</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">String.valueOf(<span class="number">123</span>); <span class="comment">// &quot;123&quot;</span></span><br><span class="line">String.valueOf(<span class="number">45.67</span>); <span class="comment">// &quot;45.67&quot;</span></span><br><span class="line">String.valueOf(<span class="keyword">true</span>); <span class="comment">// &quot;true&quot;</span></span><br><span class="line">String.valueOf(<span class="keyword">new</span> Object()); <span class="comment">// ç±»ä¼¼java.lang.Object@636be97c</span></span><br></pre></td></tr></table></figure>

<p>è¦æŠŠå­—ç¬¦ä¸²è½¬æ¢ä¸ºå…¶ä»–ç±»å‹ï¼Œå°±éœ€è¦æ ¹æ®æƒ…å†µã€‚ä¾‹å¦‚ï¼ŒæŠŠå­—ç¬¦ä¸²è½¬æ¢ä¸º<code>int</code>ç±»å‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">int</span> n1 = Integer.parseInt(<span class="string">&quot;123&quot;</span>); <span class="comment">// 123</span></span><br><span class="line"><span class="keyword">int</span> n2 = Integer.parseInt(<span class="string">&quot;ff&quot;</span>, <span class="number">16</span>); <span class="comment">// æŒ‰åå…­è¿›åˆ¶è½¬æ¢ï¼Œ255</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">boolean</span> b1 = Boolean.parseBoolean(<span class="string">&quot;true&quot;</span>); <span class="comment">// true</span></span><br><span class="line"><span class="keyword">boolean</span> b2 = Boolean.parseBoolean(<span class="string">&quot;FALSE&quot;</span>); <span class="comment">// false</span></span><br></pre></td></tr></table></figure>

<ul>
<li>è½¬åŒ–æˆ<code>char[]</code></li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">char</span>[] cs = <span class="string">&quot;Hello&quot;</span>.toCharArray(); <span class="comment">// String -&gt; char[]</span></span><br><span class="line">String s = <span class="keyword">new</span> String(cs); <span class="comment">// char[] -&gt; String</span></span><br></pre></td></tr></table></figure>

<h2 id="2-StringBuilder"><a href="#2-StringBuilder" class="headerlink" title="2. StringBuilder"></a>2. StringBuilder</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">String s = <span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">1000</span>; i++) &#123;</span><br><span class="line">    s = s + <span class="string">&quot;,&quot;</span> + i;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>String</code>æ¯ä¸€æ¬¡æ‹¼æ¥å­—ç¬¦ä¸²éƒ½ä¼šæŠŠæ—§çš„æ‰”æ‰ï¼Œç„¶åæ¢æ–°çš„ï¼Œæµªè´¹å†…å­˜ï¼Œæ•ˆç‡ä½ã€‚</p>
<p><code>StringBuilder</code>è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼Œ<code>StringBuilder</code>æ˜¯ä¸€ä¸ªå¯å˜å¯¹è±¡ï¼Œå¯ä»¥é¢„åˆ†é…ç¼“å†²åŒºï¼Œå¾€<code>StringBuilder</code>å¢åŠ å­—ç¬¦æ—¶ï¼Œä¸ä¼šåˆ›å»ºæ–°çš„ä¸´æ—¶å¯¹è±¡ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">StringBuilder sb = <span class="keyword">new</span> StringBuilder(<span class="number">1024</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">1000</span>; i++) &#123;</span><br><span class="line">    sb.append(<span class="string">&#x27;,&#x27;</span>);</span><br><span class="line">    sb.append(i);</span><br><span class="line">&#125;</span><br><span class="line">String s = sb.toString();</span><br></pre></td></tr></table></figure>

<p><code>StringBuilder</code>è¿˜å¯ä»¥è¿›è¡Œé“¾å¼æ“ä½œï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> sb = <span class="keyword">new</span> StringBuilder(<span class="number">1024</span>);</span><br><span class="line">        sb.append(<span class="string">&quot;Mr &quot;</span>)</span><br><span class="line">          .append(<span class="string">&quot;Bob&quot;</span>)</span><br><span class="line">          .append(<span class="string">&quot;!&quot;</span>)</span><br><span class="line">          .insert(<span class="number">0</span>, <span class="string">&quot;Hello, &quot;</span>);</span><br><span class="line">        System.out.println(sb.toString());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>StringBuilder</code>æœ‰<code>append</code>å’Œ<code>insert</code>çš„æ–¹æ³•ã€‚</p>
<p>å¯¹äºæ™®é€šçš„å­—ç¬¦ä¸²<code>+</code>æ“ä½œï¼Œå¹¶ä¸éœ€è¦æˆ‘ä»¬å°†å…¶æ”¹å†™ä¸º<code>StringBuilder</code>ï¼Œå› ä¸ºJavaç¼–è¯‘å™¨åœ¨ç¼–è¯‘æ—¶å°±è‡ªåŠ¨æŠŠå¤šä¸ªè¿ç»­çš„<code>+</code>æ“ä½œç¼–ç ä¸º<code>StringConcatFactory</code>çš„æ“ä½œã€‚åœ¨è¿è¡ŒæœŸï¼Œ<code>StringConcatFactory</code>ä¼šè‡ªåŠ¨æŠŠå­—ç¬¦ä¸²è¿æ¥æ“ä½œä¼˜åŒ–ä¸ºæ•°ç»„å¤åˆ¶æˆ–è€…<code>StringBuilder</code>æ“ä½œã€‚</p>
<h2 id="3-StringJoiner"><a href="#3-StringJoiner" class="headerlink" title="3. StringJoiner"></a>3. StringJoiner</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String[] names = &#123;<span class="string">&quot;Bob&quot;</span>, <span class="string">&quot;Alice&quot;</span>, <span class="string">&quot;Grace&quot;</span>&#125;;</span><br><span class="line">        <span class="keyword">var</span> sb = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        sb.append(<span class="string">&quot;Hello &quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (String name : names) &#123;</span><br><span class="line">            sb.append(name).append(<span class="string">&quot;, &quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// æ³¨æ„å»æ‰æœ€åçš„&quot;, &quot;:</span></span><br><span class="line">        sb.delete(sb.length() - <span class="number">2</span>, sb.length());</span><br><span class="line">        sb.append(<span class="string">&quot;!&quot;</span>);</span><br><span class="line">        System.out.println(sb.toString());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨<code>StringBuilder</code>æ‹¼æ¥å­—ç¬¦ä¸²å¤ªå¤æ‚äº†ã€‚</p>
<p>ä¸ºäº†å¾ˆå¥½çš„æ‹¼æ¥æ•°ç»„ï¼ŒJavaæ ‡å‡†åº“è¿˜æä¾›äº†ä¸€ä¸ª<code>StringJoiner</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String[] names = &#123;<span class="string">&quot;Bob&quot;</span>, <span class="string">&quot;Alice&quot;</span>, <span class="string">&quot;Grace&quot;</span>&#125;;</span><br><span class="line">        <span class="keyword">var</span> sj = <span class="keyword">new</span> StringJoiner(<span class="string">&quot;, &quot;</span>, <span class="string">&quot;Hello &quot;</span>, <span class="string">&quot;!&quot;</span>);</span><br><span class="line">        <span class="comment">//ä¸ºString joineræŒ‡å®šå¼€å¤´å’Œç»“å°¾</span></span><br><span class="line">        <span class="keyword">for</span> (String name : names) &#123;</span><br><span class="line">            sj.add(name);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(sj.toString());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>String</code>è¿˜æä¾›äº†ä¸€ä¸ªé™æ€æ–¹æ³•<code>join()</code>ï¼Œè¿™ä¸ªæ–¹æ³•åœ¨å†…éƒ¨ä½¿ç”¨äº†<code>StringJoiner</code>æ¥æ‹¼æ¥å­—ç¬¦ä¸²ï¼Œåœ¨ä¸éœ€è¦æŒ‡å®šâ€œå¼€å¤´â€å’Œâ€œç»“å°¾â€çš„æ—¶å€™ï¼Œç”¨<code>String.join()</code>æ›´æ–¹ä¾¿ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">String[] names = &#123;<span class="string">&quot;Bob&quot;</span>, <span class="string">&quot;Alice&quot;</span>, <span class="string">&quot;Grace&quot;</span>&#125;;</span><br><span class="line"><span class="keyword">var</span> s = String.join(<span class="string">&quot;, &quot;</span>, names);</span><br></pre></td></tr></table></figure>

<h2 id="4-åŒ…è£…ç±»å‹"><a href="#4-åŒ…è£…ç±»å‹" class="headerlink" title="4. åŒ…è£…ç±»å‹"></a>4. åŒ…è£…ç±»å‹</h2><p>å°†åŸºç¡€ç±»å‹ï¼š<code>byte</code>ï¼Œ<code>short</code>ï¼Œ<code>int</code>ï¼Œ<code>long</code>ï¼Œ<code>boolean</code>ï¼Œ<code>float</code>ï¼Œ<code>double</code>ï¼Œ<code>char</code>å°è£…æˆç±»ã€‚</p>
<table>
<thead>
<tr>
<th align="left">åŸºæœ¬ç±»å‹</th>
<th align="left">å¯¹åº”çš„å¼•ç”¨ç±»å‹</th>
</tr>
</thead>
<tbody><tr>
<td align="left">boolean</td>
<td align="left">java.lang.Boolean</td>
</tr>
<tr>
<td align="left">byte</td>
<td align="left">java.lang.Byte</td>
</tr>
<tr>
<td align="left">short</td>
<td align="left">java.lang.Short</td>
</tr>
<tr>
<td align="left">int</td>
<td align="left">java.lang.Integer</td>
</tr>
<tr>
<td align="left">long</td>
<td align="left">java.lang.Long</td>
</tr>
<tr>
<td align="left">float</td>
<td align="left">java.lang.Float</td>
</tr>
<tr>
<td align="left">double</td>
<td align="left">java.lang.Double</td>
</tr>
<tr>
<td align="left">char</td>
<td align="left">java.lang.Character</td>
</tr>
</tbody></table>
<p><code>int</code>ç±»å‹è½¬åŒ–æˆ<code>Interger</code>å¯¹è±¡ï¼š</p>
<ul>
<li><p><code>Integer n1 = new Integer(i);</code></p>
<p>é€šè¿‡æ„é€ æ–¹æ³•å°†<code>int</code>ç±»å‹åŒ…è£…æˆ<code>Interger</code>å¯¹è±¡ã€‚</p>
</li>
<li><p>é€šè¿‡<code>Integer</code>çš„é™æ€æ–¹æ³•<code>valueOf(i)</code>å°†<code>i</code>åŒ…è£…æˆ<code>Interger</code>å¯¹è±¡ã€‚</p>
</li>
<li><p>é€šè¿‡é™æ€æ–¹æ³•valueOf(String)åˆ›å»ºIntegerå®ä¾‹:</p>
<p><code>Integer n3 = Integer.valueOf(&quot;100&quot;);</code></p>
</li>
</ul>
<p><code>Interger</code>å¯¹è±¡è½¬åŒ–æˆ<code>int</code>ç±»å‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">int</span> n3 = n1.intValue();    <span class="comment">//n1æ˜¯ä¸€ä¸ªIntergerå¯¹è±¡</span></span><br></pre></td></tr></table></figure>



<p><strong>Auto Boxing</strong></p>
<p>Javaç¼–è¯‘å™¨å¯ä»¥å¸®åŠ©æˆ‘ä»¬è‡ªåŠ¨åœ¨<code>int</code>å’Œ<code>Integer</code>ä¹‹é—´è½¬å‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Integer n &#x3D; 100; &#x2F;&#x2F; ç¼–è¯‘å™¨è‡ªåŠ¨ä½¿ç”¨Integer.valueOf(int)</span><br><span class="line">int x &#x3D; n; &#x2F;&#x2F; ç¼–è¯‘å™¨è‡ªåŠ¨ä½¿ç”¨Integer.intValue()</span><br></pre></td></tr></table></figure>

<p>è¿™ç§ç›´æ¥æŠŠ<code>int</code>å˜ä¸º<code>Integer</code>çš„èµ‹å€¼å†™æ³•ï¼Œç§°ä¸º<strong>è‡ªåŠ¨è£…ç®±ï¼ˆAuto Boxingï¼‰</strong>ã€‚</p>
<p>åè¿‡æ¥ï¼ŒæŠŠ<code>Integer</code>å˜ä¸º<code>int</code>çš„èµ‹å€¼å†™æ³•ï¼Œç§°ä¸º<strong>è‡ªåŠ¨æ‹†ç®±ï¼ˆAuto Unboxingï¼‰</strong>ã€‚</p>
<p><code>Integer</code>å¯¹è±¡ä¹‹é—´çš„æ¯”è¾ƒå¿…é¡»ä½¿ç”¨<code>equals()</code>ã€‚</p>
<p><code>Integer</code>ç±»æœ¬èº«è¿˜æä¾›äº†å¤§é‡æ–¹æ³•ï¼Œä¾‹å¦‚ï¼Œæœ€å¸¸ç”¨çš„é™æ€æ–¹æ³•<code>parseInt()</code>å¯ä»¥æŠŠå­—ç¬¦ä¸²è§£ææˆä¸€ä¸ªæ•´æ•°ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">int</span> x1 = Integer.parseInt(<span class="string">&quot;100&quot;</span>); <span class="comment">// 100</span></span><br><span class="line"><span class="keyword">int</span> x2 = Integer.parseInt(<span class="string">&quot;100&quot;</span>, <span class="number">16</span>); <span class="comment">// 256,å› ä¸ºæŒ‰16è¿›åˆ¶è§£æ</span></span><br></pre></td></tr></table></figure>

<p><code>Integer</code>è¿˜å¯ä»¥æŠŠæ•´æ•°æ ¼å¼åŒ–ä¸ºæŒ‡å®šè¿›åˆ¶çš„å­—ç¬¦ä¸²ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Integer.toString(<span class="number">100</span>);    <span class="comment">//&quot;100&quot;,è¡¨ç¤ºä¸º10è¿›åˆ¶</span></span><br><span class="line">Integer.toString(<span class="number">100</span>, <span class="number">36</span>);   <span class="comment">// &quot;2s&quot;,è¡¨ç¤ºä¸º36è¿›åˆ¶</span></span><br><span class="line">Integer.toHexString(<span class="number">100</span>);   <span class="comment">// &quot;64&quot;,è¡¨ç¤ºä¸º16è¿›åˆ¶</span></span><br><span class="line">Integer.toOctalString(<span class="number">100</span>);   <span class="comment">// &quot;144&quot;,è¡¨ç¤ºä¸º8è¿›åˆ¶</span></span><br><span class="line">Integer.toBinaryString(<span class="number">100</span>);   <span class="comment">// &quot;1100100&quot;,è¡¨ç¤ºä¸º2è¿›åˆ¶</span></span><br></pre></td></tr></table></figure>

<p>åŒ…è£…ç±»å‹å®šä¹‰äº†ä¸€äº›æœ‰ç”¨çš„é™æ€å˜é‡ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// booleanåªæœ‰ä¸¤ä¸ªå€¼true/falseï¼Œå…¶åŒ…è£…ç±»å‹åªéœ€è¦å¼•ç”¨Booleanæä¾›çš„é™æ€å­—æ®µ:</span></span><br><span class="line">Boolean t = Boolean.TRUE;</span><br><span class="line">Boolean f = Boolean.FALSE;</span><br><span class="line"><span class="comment">// intå¯è¡¨ç¤ºçš„æœ€å¤§/æœ€å°å€¼:</span></span><br><span class="line"><span class="keyword">int</span> max = Integer.MAX_VALUE; <span class="comment">// 2147483647</span></span><br><span class="line"><span class="keyword">int</span> min = Integer.MIN_VALUE; <span class="comment">// -2147483648</span></span><br><span class="line"><span class="comment">// longç±»å‹å ç”¨çš„bitå’Œbyteæ•°é‡:</span></span><br><span class="line"><span class="keyword">int</span> sizeOfLong = Long.SIZE; <span class="comment">// 64 (bits)</span></span><br><span class="line"><span class="keyword">int</span> bytesOfLong = Long.BYTES; <span class="comment">// 8 (bytes)</span></span><br></pre></td></tr></table></figure>

<p>æ‰€æœ‰çš„æ•´æ•°å’Œæµ®ç‚¹æ•°çš„åŒ…è£…ç±»å‹éƒ½ç»§æ‰¿è‡ª<code>Number</code>ï¼Œå¯ä»¥éå¸¸æ–¹ä¾¿åœ°ç›´æ¥é€šè¿‡åŒ…è£…ç±»å‹è·å–å„ç§åŸºæœ¬ç±»å‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å‘ä¸Šè½¬å‹ä¸ºNumber:</span></span><br><span class="line">Number num = <span class="keyword">new</span> Integer(<span class="number">999</span>);</span><br><span class="line"><span class="comment">// è·å–byte, int, long, float, double:</span></span><br><span class="line"><span class="keyword">byte</span> b = num.byteValue();</span><br><span class="line"><span class="keyword">int</span> n = num.intValue();</span><br><span class="line"><span class="keyword">long</span> ln = num.longValue();</span><br><span class="line"><span class="keyword">float</span> f = num.floatValue();</span><br><span class="line"><span class="keyword">double</span> d = num.doubleValue();</span><br></pre></td></tr></table></figure>

<p>å¤„ç†æ— ç¬¦å·æ•´å‹å˜é‡</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">byte</span> x = -<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">byte</span> y = <span class="number">127</span>;</span><br><span class="line">        System.out.println(Byte.toUnsignedInt(x)); <span class="comment">// 255</span></span><br><span class="line">        System.out.println(Byte.toUnsignedInt(y)); <span class="comment">// 127</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="5-JavaBean"><a href="#5-JavaBean" class="headerlink" title="5. JavaBean"></a>5. JavaBean</h2><p>JavaBeanæ˜¯ä¸€ç§ç¬¦åˆå‘½åè§„èŒƒçš„<code>class</code>ï¼Œå®ƒé€šè¿‡<code>getter</code>å’Œ<code>setter</code>æ¥å®šä¹‰å±æ€§ï¼›</p>
<p>å±æ€§æ˜¯ä¸€ç§é€šç”¨çš„å«æ³•ï¼Œå¹¶éJavaè¯­æ³•è§„å®šï¼›</p>
<p>å¯ä»¥åˆ©ç”¨IDEå¿«é€Ÿç”Ÿæˆ<code>getter</code>å’Œ<code>setter</code>ï¼›</p>
<p>ä½¿ç”¨<code>Introspector.getBeanInfo()</code>å¯ä»¥è·å–å±æ€§åˆ—è¡¨ã€‚</p>
<p>æ€»ç»“ï¼š</p>
<p>1ã€ æ‰€æœ‰å±æ€§ä¸º<code>private</code><br>2ã€ æä¾›é»˜è®¤æ„é€ æ–¹æ³•<br>3ã€ æä¾›<code>getter</code>å’Œ<code>setter</code><br>4ã€ å®ç°<code>serializable</code>æ¥å£</p>
<p>çš„<code>class</code>å«åšJavaBean</p>
<h2 id="6-æšä¸¾ç±»"><a href="#6-æšä¸¾ç±»" class="headerlink" title="6. æšä¸¾ç±»"></a>6. æšä¸¾ç±»</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">Weekday</span> </span>&#123;</span><br><span class="line">    SUN, MON, TUE, WED, THU, FRI, SAT;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Weekday day = Weekday.SUN;</span><br><span class="line">        <span class="keyword">if</span> (day == Weekday.SAT || day == Weekday.SUN) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Work at home!&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Work at office!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>enum</code>ç±»å‹çš„æ¯ä¸ªå¸¸é‡åœ¨JVMä¸­åªæœ‰ä¸€ä¸ªå”¯ä¸€å®ä¾‹ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥ç”¨<code>==</code>æ¯”è¾ƒï¼š</p>
<p><strong>å¸¸ç”¨æ–¹æ³•</strong>ï¼š</p>
<ul>
<li>name()</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">String s = Weekday.SUN.name(); <span class="comment">// &quot;SUN&quot;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>ordinal()</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">int</span> n = Weekday.MON.ordinal(); <span class="comment">// 1</span></span><br></pre></td></tr></table></figure>

<p>æšä¸¾ç±»å¯ä»¥åº”ç”¨åœ¨<code>switch</code>è¯­å¥ä¸­ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Weekday day = Weekday.SUN;</span><br><span class="line">        <span class="keyword">switch</span>(day) &#123;</span><br><span class="line">        <span class="keyword">case</span> MON:</span><br><span class="line">        <span class="keyword">case</span> TUE:</span><br><span class="line">        <span class="keyword">case</span> WED:</span><br><span class="line">        <span class="keyword">case</span> THU:</span><br><span class="line">        <span class="keyword">case</span> FRI:</span><br><span class="line">            System.out.println(<span class="string">&quot;Today is &quot;</span> + day + <span class="string">&quot;. Work at office!&quot;</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> SAT:</span><br><span class="line">        <span class="keyword">case</span> SUN:</span><br><span class="line">            System.out.println(<span class="string">&quot;Today is &quot;</span> + day + <span class="string">&quot;. Work at home!&quot;</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">&quot;cannot process &quot;</span> + day);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">Weekday</span> </span>&#123;</span><br><span class="line">    MON, TUE, WED, THU, FRI, SAT, SUN;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Javaä½¿ç”¨<code>enum</code>å®šä¹‰æšä¸¾ç±»å‹ï¼Œå®ƒè¢«ç¼–è¯‘å™¨ç¼–è¯‘ä¸º<code>final class Xxx extends Enum &#123; â€¦ &#125;</code>ï¼›</p>
<p>é€šè¿‡<code>name()</code>è·å–å¸¸é‡å®šä¹‰çš„å­—ç¬¦ä¸²ï¼Œæ³¨æ„ä¸è¦ä½¿ç”¨<code>toString()</code>ï¼›</p>
<p>é€šè¿‡<code>ordinal()</code>è¿”å›å¸¸é‡å®šä¹‰çš„é¡ºåºï¼ˆæ— å®è´¨æ„ä¹‰ï¼‰ï¼›</p>
<p>å¯ä»¥ä¸º<code>enum</code>ç¼–å†™æ„é€ æ–¹æ³•ã€å­—æ®µå’Œæ–¹æ³•</p>
<p><code>enum</code>çš„æ„é€ æ–¹æ³•è¦å£°æ˜ä¸º<code>private</code>ï¼Œå­—æ®µå¼ºçƒˆå»ºè®®å£°æ˜ä¸º<code>final</code>ï¼›</p>
<p><code>enum</code>é€‚åˆç”¨åœ¨<code>switch</code>è¯­å¥ä¸­ã€‚</p>
<h2 id="7-è®°å½•ç±»-ï¼ˆJava14ï¼‰"><a href="#7-è®°å½•ç±»-ï¼ˆJava14ï¼‰" class="headerlink" title="7. è®°å½•ç±»  ï¼ˆJava14ï¼‰"></a>7. è®°å½•ç±»  ï¼ˆJava14ï¼‰</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Point p = <span class="keyword">new</span> Point(<span class="number">123</span>, <span class="number">456</span>);</span><br><span class="line">        System.out.println(p.x());</span><br><span class="line">        System.out.println(p.y());</span><br><span class="line">        System.out.println(p);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> record <span class="title">Point</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨<code>record</code>å®šä¹‰çš„æ˜¯ä¸å˜ç±»</p>
<p>ç¼–è¯‘å™¨é»˜è®¤æŒ‰ç…§<code>record</code>å£°æ˜çš„å˜é‡é¡ºåºè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªæ„é€ æ–¹æ³•ï¼Œå¹¶åœ¨æ–¹æ³•å†…ç»™å­—æ®µèµ‹å€¼ã€‚é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œå¦‚æœæˆ‘ä»¬è¦æ£€æŸ¥å‚æ•°ï¼Œåº”è¯¥æ€ä¹ˆåŠï¼Ÿ</p>
<p>å‡è®¾<code>Point</code>ç±»çš„<code>x</code>ã€<code>y</code>ä¸å…è®¸è´Ÿæ•°ï¼Œæˆ‘ä»¬å°±å¾—ç»™<code>Point</code>çš„æ„é€ æ–¹æ³•åŠ ä¸Šæ£€æŸ¥é€»è¾‘ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> record <span class="title">Point</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> Point &#123;</span><br><span class="line">        <span class="keyword">if</span> (x &lt; <span class="number">0</span> || y &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="8-BigInteger"><a href="#8-BigInteger" class="headerlink" title="8. BigInteger"></a>8. BigInteger</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">BigInteger bi = <span class="keyword">new</span> BigInteger(<span class="string">&quot;1234567890&quot;</span>);</span><br><span class="line">System.out.println(bi.pow(<span class="number">5</span>)); <span class="comment">// 2867971860299718107233761438093672048294900000</span></span><br></pre></td></tr></table></figure>

<p>å¯¹<code>BigInteger</code>åšè¿ç®—çš„æ—¶å€™ï¼Œåªèƒ½ä½¿ç”¨å®ä¾‹æ–¹æ³•ï¼Œä¾‹å¦‚ï¼ŒåŠ æ³•è¿ç®—ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">BigInteger i1 = <span class="keyword">new</span> BigInteger(<span class="string">&quot;1234567890&quot;</span>);</span><br><span class="line">BigInteger i2 = <span class="keyword">new</span> BigInteger(<span class="string">&quot;12345678901234567890&quot;</span>);</span><br><span class="line">BigInteger sum = i1.add(i2); <span class="comment">// 12345678902469135780</span></span><br></pre></td></tr></table></figure>

<p><code>BigInteger</code>å’Œ0<code>Integer</code>ã€<code>Long</code>ä¸€æ ·ï¼Œä¹Ÿæ˜¯ä¸å¯å˜ç±»ï¼Œå¹¶ä¸”ä¹Ÿç»§æ‰¿è‡ª<code>Number</code>ç±»ã€‚å› ä¸º<code>Number</code>å®šä¹‰äº†è½¬æ¢ä¸ºåŸºæœ¬ç±»å‹çš„å‡ ä¸ªæ–¹æ³•ï¼š</p>
<ul>
<li>è½¬æ¢ä¸º<code>byte</code>ï¼š<code>byteValue()</code></li>
<li>è½¬æ¢ä¸º<code>short</code>ï¼š<code>shortValue()</code></li>
<li>è½¬æ¢ä¸º<code>int</code>ï¼š<code>intValue()</code></li>
<li>è½¬æ¢ä¸º<code>long</code>ï¼š<code>longValue()</code></li>
<li>è½¬æ¢ä¸º<code>float</code>ï¼š<code>floatValue()</code></li>
<li>è½¬æ¢ä¸º<code>double</code>ï¼š<code>doubleValue()</code></li>
</ul>
<p>å¦‚æœéœ€è¦å‡†ç¡®åœ°è½¬æ¢æˆåŸºæœ¬ç±»å‹ï¼Œå¯ä»¥ä½¿ç”¨<code>intValueExact()</code>ã€<code>longValueExact()</code>ç­‰æ–¹æ³•ï¼Œåœ¨è½¬æ¢æ—¶å¦‚æœè¶…å‡ºèŒƒå›´ï¼Œå°†ç›´æ¥æŠ›å‡º<code>ArithmeticException</code>å¼‚å¸¸ã€‚</p>
<h2 id="9-BigDecimal"><a href="#9-BigDecimal" class="headerlink" title="9. BigDecimal"></a>9. BigDecimal</h2><p>å’Œ<code>BigInteger</code>ç±»ä¼¼ï¼Œ<code>BigDecimal</code>å¯ä»¥è¡¨ç¤ºä¸€ä¸ªä»»æ„å¤§å°ä¸”ç²¾åº¦å®Œå…¨å‡†ç¡®çš„æµ®ç‚¹æ•°ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">BigDecimal bd = <span class="keyword">new</span> BigDecimal(<span class="string">&quot;123.4567&quot;</span>);</span><br><span class="line">System.out.println(bd.multiply(bd)); <span class="comment">// 15241.55677489</span></span><br></pre></td></tr></table></figure>

<p><code>BigDecimal</code>ç”¨<code>scale()</code>è¡¨ç¤ºå°æ•°ä½æ•°ï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">BigDecimal d1 = <span class="keyword">new</span> BigDecimal(<span class="string">&quot;123.45&quot;</span>);</span><br><span class="line">BigDecimal d2 = <span class="keyword">new</span> BigDecimal(<span class="string">&quot;123.4500&quot;</span>);</span><br><span class="line">BigDecimal d3 = <span class="keyword">new</span> BigDecimal(<span class="string">&quot;1234500&quot;</span>);</span><br><span class="line">System.out.println(d1.scale()); <span class="comment">// 2,ä¸¤ä½å°æ•°</span></span><br><span class="line">System.out.println(d2.scale()); <span class="comment">// 4</span></span><br><span class="line">System.out.println(d3.scale()); <span class="comment">// 0</span></span><br></pre></td></tr></table></figure>

<p>é€šè¿‡<code>BigDecimal</code>çš„<code>stripTrailingZeros()</code>æ–¹æ³•ï¼Œå¯ä»¥å°†ä¸€ä¸ª<code>BigDecimal</code>æ ¼å¼åŒ–ä¸ºä¸€ä¸ªç›¸ç­‰çš„ï¼Œä½†å»æ‰äº†æœ«å°¾0çš„<code>BigDecimal</code>ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">BigDecimal d1 = <span class="keyword">new</span> BigDecimal(<span class="string">&quot;123.4500&quot;</span>);</span><br><span class="line">BigDecimal d2 = d1.stripTrailingZeros();</span><br><span class="line">System.out.println(d1.scale()); <span class="comment">// 4</span></span><br><span class="line">System.out.println(d2.scale()); <span class="comment">// 2,å› ä¸ºå»æ‰äº†00</span></span><br><span class="line"></span><br><span class="line">BigDecimal d3 = <span class="keyword">new</span> BigDecimal(<span class="string">&quot;1234500&quot;</span>);</span><br><span class="line">BigDecimal d4 = d3.stripTrailingZeros();</span><br><span class="line">System.out.println(d3.scale()); <span class="comment">// 0</span></span><br><span class="line">System.out.println(d4.scale()); <span class="comment">// -2</span></span><br></pre></td></tr></table></figure>

<p>å¦‚æœä¸€ä¸ª<code>BigDecimal</code>çš„<code>scale()</code>è¿”å›è´Ÿæ•°ï¼Œä¾‹å¦‚ï¼Œ<code>-2</code>ï¼Œè¡¨ç¤ºè¿™ä¸ªæ•°æ˜¯ä¸ªæ•´æ•°ï¼Œå¹¶ä¸”æœ«å°¾æœ‰2ä¸ª0ã€‚</p>
<p>å¯ä»¥å¯¹ä¸€ä¸ª<code>BigDecimal</code>è®¾ç½®å®ƒçš„<code>scale</code>ï¼Œå¦‚æœç²¾åº¦æ¯”åŸå§‹å€¼ä½ï¼Œé‚£ä¹ˆæŒ‰ç…§æŒ‡å®šçš„æ–¹æ³•è¿›è¡Œå››èˆäº”å…¥æˆ–è€…ç›´æ¥æˆªæ–­ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">BigDecimal d2 = d1.setScale(<span class="number">4</span>, RoundingMode.HALF_UP); <span class="comment">// å››èˆäº”å…¥ï¼Œ123.4568</span></span><br><span class="line">BigDecimal d3 = d1.setScale(<span class="number">4</span>, RoundingMode.DOWN); <span class="comment">// ç›´æ¥æˆªæ–­ï¼Œ123.4567</span></span><br></pre></td></tr></table></figure>

<p>å¯¹<code>BigDecimal</code>åšåŠ ã€å‡ã€ä¹˜æ—¶ï¼Œç²¾åº¦ä¸ä¼šä¸¢å¤±ï¼Œä½†æ˜¯åšé™¤æ³•æ—¶ï¼Œå­˜åœ¨æ— æ³•é™¤å°½çš„æƒ…å†µï¼Œè¿™æ—¶ï¼Œå°±å¿…é¡»æŒ‡å®šç²¾åº¦ä»¥åŠå¦‚ä½•è¿›è¡Œæˆªæ–­ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">BigDecimal d1 = <span class="keyword">new</span> BigDecimal(<span class="string">&quot;123.456&quot;</span>);</span><br><span class="line">BigDecimal d2 = <span class="keyword">new</span> BigDecimal(<span class="string">&quot;23.456789&quot;</span>);</span><br><span class="line">BigDecimal d3 = d1.divide(d2, <span class="number">10</span>, RoundingMode.HALF_UP); <span class="comment">// ä¿ç•™10ä½å°æ•°å¹¶å››èˆäº”å…¥</span></span><br><span class="line">BigDecimal d4 = d1.divide(d2); <span class="comment">// æŠ¥é”™ï¼šArithmeticExceptionï¼Œå› ä¸ºé™¤ä¸å°½</span></span><br></pre></td></tr></table></figure>

<p>è¿˜å¯ä»¥å¯¹<code>BigDecimal</code>åšé™¤æ³•çš„åŒæ—¶æ±‚ä½™æ•°ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        BigDecimal n = <span class="keyword">new</span> BigDecimal(<span class="string">&quot;12.345&quot;</span>);</span><br><span class="line">        BigDecimal m = <span class="keyword">new</span> BigDecimal(<span class="string">&quot;0.12&quot;</span>);</span><br><span class="line">        BigDecimal[] dr = n.divideAndRemainder(m);</span><br><span class="line">        System.out.println(dr[<span class="number">0</span>]); <span class="comment">// 102</span></span><br><span class="line">        System.out.println(dr[<span class="number">1</span>]); <span class="comment">// 0.105</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è°ƒç”¨<code>divideAndRemainder()</code>æ–¹æ³•æ—¶ï¼Œè¿”å›çš„æ•°ç»„åŒ…å«ä¸¤ä¸ª<code>BigDecimal</code>ï¼Œåˆ†åˆ«æ˜¯å•†å’Œä½™æ•°ï¼Œå…¶ä¸­å•†æ€»æ˜¯æ•´æ•°ï¼Œä½™æ•°ä¸ä¼šå¤§äºé™¤æ•°ã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ–¹æ³•åˆ¤æ–­ä¸¤ä¸ª<code>BigDecimal</code>æ˜¯å¦æ˜¯æ•´æ•°å€æ•°ï¼š</p>
<p>åœ¨æ¯”è¾ƒä¸¤ä¸ª<code>BigDecimal</code>çš„å€¼æ˜¯å¦ç›¸ç­‰æ—¶ï¼Œè¦ç‰¹åˆ«æ³¨æ„ï¼Œä½¿ç”¨<code>equals()</code>æ–¹æ³•ä¸ä½†è¦æ±‚ä¸¤ä¸ª<code>BigDecimal</code>çš„å€¼ç›¸ç­‰ï¼Œè¿˜è¦æ±‚å®ƒä»¬çš„<code>scale()</code>ç›¸ç­‰ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">BigDecimal d1 = <span class="keyword">new</span> BigDecimal(<span class="string">&quot;123.456&quot;</span>);</span><br><span class="line">BigDecimal d2 = <span class="keyword">new</span> BigDecimal(<span class="string">&quot;123.45600&quot;</span>);</span><br><span class="line">System.out.println(d1.equals(d2)); <span class="comment">// false,å› ä¸ºscaleä¸åŒ</span></span><br><span class="line">System.out.println(d1.equals(d2.stripTrailingZeros())); <span class="comment">// true,å› ä¸ºd2å»é™¤å°¾éƒ¨0åscaleå˜ä¸º2</span></span><br><span class="line">System.out.println(d1.compareTo(d2)); <span class="comment">// 0</span></span><br></pre></td></tr></table></figure>

<p>å¿…é¡»ä½¿ç”¨<code>compareTo()</code>æ–¹æ³•æ¥æ¯”è¾ƒï¼Œå®ƒæ ¹æ®ä¸¤ä¸ªå€¼çš„å¤§å°åˆ†åˆ«è¿”å›è´Ÿæ•°ã€æ­£æ•°å’Œ<code>0</code>ï¼Œåˆ†åˆ«è¡¨ç¤ºå°äºã€å¤§äºå’Œç­‰äºã€‚</p>
<h2 id="10-å·¥å…·ç±»"><a href="#10-å·¥å…·ç±»" class="headerlink" title="10. å·¥å…·ç±»"></a>10. å·¥å…·ç±»</h2><p><strong>Math</strong></p>
<p>æ±‚ç»å¯¹å€¼ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Math.abs(-100); &#x2F;&#x2F; 100</span><br><span class="line">Math.abs(-7.8); &#x2F;&#x2F; 7.8</span><br></pre></td></tr></table></figure>

<p>å–æœ€å¤§æˆ–æœ€å°å€¼ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Math.max(100, 99); &#x2F;&#x2F; 100</span><br><span class="line">Math.min(1.2, 2.3); &#x2F;&#x2F; 1.2</span><br></pre></td></tr></table></figure>

<p>è®¡ç®—xyæ¬¡æ–¹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Math.pow(2, 10); &#x2F;&#x2F; 2çš„10æ¬¡æ–¹&#x3D;1024</span><br></pre></td></tr></table></figure>

<p>è®¡ç®—âˆšxï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Math.sqrt(2); &#x2F;&#x2F; 1.414...</span><br></pre></td></tr></table></figure>

<p>è®¡ç®—exæ¬¡æ–¹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Math.exp(2); &#x2F;&#x2F; 7.389...</span><br></pre></td></tr></table></figure>

<p>è®¡ç®—ä»¥eä¸ºåº•çš„å¯¹æ•°ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Math.log(4); &#x2F;&#x2F; 1.386...</span><br></pre></td></tr></table></figure>

<p>è®¡ç®—ä»¥10ä¸ºåº•çš„å¯¹æ•°ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Math.log10(100); &#x2F;&#x2F; 2</span><br></pre></td></tr></table></figure>

<p>ä¸‰è§’å‡½æ•°ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Math.sin(3.14); &#x2F;&#x2F; 0.00159...</span><br><span class="line">Math.cos(3.14); &#x2F;&#x2F; -0.9999...</span><br><span class="line">Math.tan(3.14); &#x2F;&#x2F; -0.0015...</span><br><span class="line">Math.asin(1.0); &#x2F;&#x2F; 1.57079...</span><br><span class="line">Math.acos(1.0); &#x2F;&#x2F; 0.0</span><br></pre></td></tr></table></figure>

<p>Mathè¿˜æä¾›äº†å‡ ä¸ªæ•°å­¦å¸¸é‡ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">double pi &#x3D; Math.PI; &#x2F;&#x2F; 3.14159...</span><br><span class="line">double e &#x3D; Math.E; &#x2F;&#x2F; 2.7182818...</span><br><span class="line">Math.sin(Math.PI &#x2F; 6); &#x2F;&#x2F; sin(Ï€&#x2F;6) &#x3D; 0.5</span><br></pre></td></tr></table></figure>

<p>ç”Ÿæˆä¸€ä¸ªéšæœºæ•°xï¼Œxçš„èŒƒå›´æ˜¯<code>0 &lt;= x &lt; 1</code>ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Math.random(); &#x2F;&#x2F; 0.53907... æ¯æ¬¡éƒ½ä¸ä¸€æ ·</span><br></pre></td></tr></table></figure>

<p><strong>Random</strong></p>
<p><code>Random</code>ç”¨æ¥åˆ›å»ºä¼ªéšæœºæ•°ã€‚æ‰€è°“ä¼ªéšæœºæ•°ï¼Œæ˜¯æŒ‡åªè¦ç»™å®šä¸€ä¸ªåˆå§‹çš„ç§å­ï¼Œäº§ç”Ÿçš„éšæœºæ•°åºåˆ—æ˜¯å®Œå…¨ä¸€æ ·çš„ã€‚</p>
<p>è¦ç”Ÿæˆä¸€ä¸ªéšæœºæ•°ï¼Œå¯ä»¥ä½¿ç”¨<code>nextInt()</code>ã€<code>nextLong()</code>ã€<code>nextFloat()</code>ã€<code>nextDouble()</code>ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Random r &#x3D; new Random();</span><br><span class="line">r.nextInt(); &#x2F;&#x2F; 2071575453,æ¯æ¬¡éƒ½ä¸ä¸€æ ·</span><br><span class="line">r.nextInt(10); &#x2F;&#x2F; 5,ç”Ÿæˆä¸€ä¸ª[0,10)ä¹‹é—´çš„int</span><br><span class="line">r.nextLong(); &#x2F;&#x2F; 8811649292570369305,æ¯æ¬¡éƒ½ä¸ä¸€æ ·</span><br><span class="line">r.nextFloat(); &#x2F;&#x2F; 0.54335...ç”Ÿæˆä¸€ä¸ª[0,1)ä¹‹é—´çš„float</span><br><span class="line">r.nextDouble(); &#x2F;&#x2F; 0.3716...ç”Ÿæˆä¸€ä¸ª[0,1)ä¹‹é—´çš„double</span><br></pre></td></tr></table></figure>

<p><strong>SecureRandom</strong></p>
<p><code>SecureRandom</code>å°±æ˜¯ç”¨æ¥åˆ›å»ºå®‰å…¨çš„éšæœºæ•°çš„ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">SecureRandom sr = <span class="keyword">new</span> SecureRandom();</span><br><span class="line">System.out.println(sr.nextInt(<span class="number">100</span>));</span><br></pre></td></tr></table></figure>

]]></content>
      <tags>
        <tag>JAVA</tag>
      </tags>
  </entry>
  <entry>
    <title>JAVA - é›†åˆ</title>
    <url>/2021/04/19/JAVA%E9%9B%86%E5%90%88/</url>
    <content><![CDATA[<h1 id="JAVAé›†åˆ"><a href="#JAVAé›†åˆ" class="headerlink" title="JAVAé›†åˆ"></a>JAVAé›†åˆ</h1><h2 id="1-é›†åˆå®šä¹‰"><a href="#1-é›†åˆå®šä¹‰" class="headerlink" title="1. é›†åˆå®šä¹‰"></a>1. é›†åˆå®šä¹‰</h2><p>ä»€ä¹ˆæ˜¯é›†åˆï¼ˆCollectionï¼‰ï¼Ÿé›†åˆå°±æ˜¯â€œç”±è‹¥å¹²ä¸ªç¡®å®šçš„å…ƒç´ æ‰€æ„æˆçš„æ•´ä½“â€ã€‚</p>
<p>åœ¨Javaä¸­ï¼Œå¦‚æœä¸€ä¸ªJavaå¯¹è±¡å¯ä»¥åœ¨å†…éƒ¨æŒæœ‰è‹¥å¹²å…¶ä»–Javaå¯¹è±¡ï¼Œå¹¶å¯¹å¤–æä¾›è®¿é—®æ¥å£ï¼Œæˆ‘ä»¬æŠŠè¿™ç§Javaå¯¹è±¡ç§°ä¸ºé›†åˆã€‚å¾ˆæ˜¾ç„¶ï¼ŒJavaçš„æ•°ç»„å¯ä»¥çœ‹ä½œæ˜¯ä¸€ç§é›†åˆï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">String[] ss = <span class="keyword">new</span> String[<span class="number">10</span>]; <span class="comment">// å¯ä»¥æŒæœ‰10ä¸ªStringå¯¹è±¡</span></span><br><span class="line">ss[<span class="number">0</span>] = <span class="string">&quot;Hello&quot;</span>; <span class="comment">// å¯ä»¥æ”¾å…¥Stringå¯¹è±¡</span></span><br><span class="line">String first = ss[<span class="number">0</span>]; <span class="comment">// å¯ä»¥è·å–Stringå¯¹è±¡</span></span><br></pre></td></tr></table></figure>

<p>Javaçš„<code>java.util</code>åŒ…æä¾›äº†ä»¥ä¸‹ä¸‰ç§ç±»å‹çš„é›†åˆï¼š</p>
<ul>
<li><code>List</code>ï¼šä¸€ç§æœ‰åºåˆ—è¡¨çš„é›†åˆï¼Œä¾‹å¦‚ï¼ŒæŒ‰ç´¢å¼•æ’åˆ—çš„<code>Student</code>çš„<code>List</code>ï¼›</li>
<li><code>Set</code>ï¼šä¸€ç§ä¿è¯æ²¡æœ‰é‡å¤å…ƒç´ çš„é›†åˆï¼Œä¾‹å¦‚ï¼Œæ‰€æœ‰æ— é‡å¤åç§°çš„<code>Student</code>çš„<code>Set</code>ï¼›</li>
<li><code>Map</code>ï¼šä¸€ç§é€šè¿‡é”®å€¼ï¼ˆkey-valueï¼‰æŸ¥æ‰¾çš„æ˜ å°„è¡¨é›†åˆï¼Œä¾‹å¦‚ï¼Œæ ¹æ®<code>Student</code>çš„<code>name</code>æŸ¥æ‰¾å¯¹åº”<code>Student</code>çš„<code>Map</code>ã€‚</li>
</ul>
<p>Javaè®¿é—®é›†åˆæ€»æ˜¯é€šè¿‡ç»Ÿä¸€çš„æ–¹å¼â€”â€”è¿­ä»£å™¨ï¼ˆIteratorï¼‰æ¥å®ç°ï¼Œå®ƒæœ€æ˜æ˜¾çš„å¥½å¤„åœ¨äºæ— éœ€çŸ¥é“é›†åˆå†…éƒ¨å…ƒç´ æ˜¯æŒ‰ä»€ä¹ˆæ–¹å¼å­˜å‚¨çš„ã€‚</p>
<h2 id="2-List"><a href="#2-List" class="headerlink" title="2. List"></a>2. List</h2><p><code>List</code>çš„è¡Œä¸ºå’Œæ•°ç»„å‡ ä¹å®Œå…¨ç›¸åŒã€‚</p>
<p><code>ArrayList</code>æŠŠæ·»åŠ å’Œåˆ é™¤çš„æ“ä½œå°è£…èµ·æ¥ï¼Œè®©æˆ‘ä»¬æ“ä½œ<code>List</code>ç±»ä¼¼äºæ“ä½œæ•°ç»„ï¼Œå´ä¸ç”¨å…³å¿ƒå†…éƒ¨å…ƒç´ å¦‚ä½•ç§»åŠ¨ã€‚</p>
<p>å‡ ä¸ªä¸»è¦çš„æ¥å£æ–¹æ³•ï¼š</p>
<ul>
<li>åœ¨æœ«å°¾æ·»åŠ ä¸€ä¸ªå…ƒç´ ï¼š<code>boolean add(E e)</code></li>
<li>åœ¨æŒ‡å®šç´¢å¼•æ·»åŠ ä¸€ä¸ªå…ƒç´ ï¼š<code>boolean add(int index, E e)</code></li>
<li>åˆ é™¤æŒ‡å®šç´¢å¼•çš„å…ƒç´ ï¼š<code>int remove(int index)</code></li>
<li>åˆ é™¤æŸä¸ªå…ƒç´ ï¼š<code>int remove(Object e)</code></li>
<li>è·å–æŒ‡å®šç´¢å¼•çš„å…ƒç´ ï¼š<code>E get(int index)</code></li>
<li>è·å–é“¾è¡¨å¤§å°ï¼ˆåŒ…å«å…ƒç´ çš„ä¸ªæ•°ï¼‰ï¼š<code>int size()</code></li>
</ul>
<p>å®ç°<code>List</code>æ¥å£å¹¶éåªèƒ½é€šè¿‡æ•°ç»„ï¼ˆå³<code>ArrayList</code>çš„å®ç°æ–¹å¼ï¼‰æ¥å®ç°ï¼Œå¦ä¸€ç§<code>LinkedList</code>é€šè¿‡â€œé“¾è¡¨â€ä¹Ÿå®ç°äº†Listæ¥å£ã€‚</p>
<p><img src="https://raw.githubusercontent.com/ghj1998/image_repository/main/image-20210329222122956.png" alt="ArrayList" title="ArrayList"></p>
<p>â€‹                                                                    ArrayLIst</p>
<p><img src="https://raw.githubusercontent.com/ghj1998/image_repository/main/image-20210329222407584.png" alt="image-20210329222407584" title="LinkList"></p>
<p>â€‹                                                                    LinkedList</p>
<table>
<thead>
<tr>
<th align="left"></th>
<th align="left">ArrayList</th>
<th>LinkedList</th>
</tr>
</thead>
<tbody><tr>
<td align="left">è·å–æŒ‡å®šå…ƒç´ </td>
<td align="left">é€Ÿåº¦å¾ˆå¿«</td>
<td>éœ€è¦ä»å¤´å¼€å§‹æŸ¥æ‰¾å…ƒç´ </td>
</tr>
<tr>
<td align="left">æ·»åŠ å…ƒç´ åˆ°æœ«å°¾</td>
<td align="left">é€Ÿåº¦å¾ˆå¿«</td>
<td>é€Ÿåº¦å¾ˆå¿«</td>
</tr>
<tr>
<td align="left">åœ¨æŒ‡å®šä½ç½®æ·»åŠ /åˆ é™¤</td>
<td align="left">éœ€è¦ç§»åŠ¨å…ƒç´ </td>
<td>ä¸éœ€è¦ç§»åŠ¨å…ƒç´ </td>
</tr>
<tr>
<td align="left">å†…å­˜å ç”¨</td>
<td align="left">å°‘</td>
<td>è¾ƒå¤§</td>
</tr>
</tbody></table>
<p><strong>åˆ›å»ºList</strong></p>
<p>ä½¿ç”¨<code>ArrayList</code>å’Œ<code>LinkedList</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">List&lt;String&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">List&lt;String&gt; list = <span class="keyword">new</span> LinkedList&lt;&gt;();</span><br></pre></td></tr></table></figure>

<p><code>List</code>æ¥å£æä¾›çš„<code>of()</code>æ–¹æ³•</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">List&lt;Integer&gt; list = List.of(<span class="number">1</span>, <span class="number">2</span>, <span class="number">5</span>);</span><br></pre></td></tr></table></figure>

<p><strong>éå†List</strong></p>
<p>ä½¿ç”¨è¿­ä»£å™¨<code>Iterator</code>æ¥è®¿é—®<code>List</code>ã€‚</p>
<p>è¿­ä»£å™¨é€šè¿‡<code>List</code>çš„å®ä¾‹è°ƒç”¨<code>iterator()</code>æ–¹æ³•ã€‚</p>
<p><code>Iterator</code>å¯¹è±¡æœ‰ä¸¤ä¸ªæ–¹æ³•ï¼š<code>boolean hasNext()</code>åˆ¤æ–­æ˜¯å¦æœ‰ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œ<code>E next()</code>è¿”å›ä¸‹ä¸€ä¸ªå…ƒç´ ã€‚</p>
<p>ä½¿ç”¨<code>Iterator</code>éå†<code>List</code>ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        List&lt;String&gt; list = List.of(<span class="string">&quot;apple&quot;</span>, <span class="string">&quot;pear&quot;</span>, <span class="string">&quot;banana&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (Iterator&lt;String&gt; it = list.iterator(); it.hasNext(); ) &#123;</span><br><span class="line">            String s = it.next();</span><br><span class="line">            System.out.println(s);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Javaçš„<code>for each</code>å¾ªç¯æœ¬èº«å°±å¯ä»¥å¸®æˆ‘ä»¬ä½¿ç”¨<code>Iterator</code>éå†ã€‚</p>
<p>å¯ä»¥æŠŠä¸Šé¢çš„ä»£ç æ”¹æˆï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        List&lt;String&gt; list = List.of(<span class="string">&quot;apple&quot;</span>, <span class="string">&quot;pear&quot;</span>, <span class="string">&quot;banana&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (String s : list) &#123;</span><br><span class="line">            System.out.println(s);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>List å’Œ Arrayè½¬åŒ–</strong></p>
<p>æ–¹æ³•1ï¼šè°ƒç”¨<code>toArray()</code>æ–¹æ³•</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        List&lt;String&gt; list = List.of(<span class="string">&quot;apple&quot;</span>, <span class="string">&quot;pear&quot;</span>, <span class="string">&quot;banana&quot;</span>);</span><br><span class="line">        Object[] array = list.toArray();</span><br><span class="line">        <span class="keyword">for</span> (Object s : array) &#123;</span><br><span class="line">            System.out.println(s);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™ç§æ–¹æ³•ä¼šä¸¢å¤±ç±»å‹ä¿¡æ¯ï¼Œæ‰€ä»¥å®é™…åº”ç”¨å¾ˆå°‘ã€‚</p>
<p>æ–¹æ³•2ï¼šç»™<code>toArray(T[])</code>ä¼ å…¥ä¸€ä¸ªç±»å‹ç›¸åŒçš„<code>Array</code>ï¼Œ<code>List</code>å†…éƒ¨è‡ªåŠ¨æŠŠå…ƒç´ å¤åˆ¶åˆ°ä¼ å…¥çš„<code>Array</code>ä¸­ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//æŠŠlistè½¬åŒ–æˆIntegeræ•°ç»„</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        List&lt;Integer&gt; list = List.of(<span class="number">12</span>, <span class="number">34</span>, <span class="number">56</span>);</span><br><span class="line">        Integer[] array = list.toArray(<span class="keyword">new</span> Integer[<span class="number">3</span>]);</span><br><span class="line">        <span class="keyword">for</span> (Integer n : array) &#123;</span><br><span class="line">            System.out.println(n);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//æŠŠlistè½¬åŒ–æˆNumberæ•°ç»„</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        List&lt;Integer&gt; list = List.of(<span class="number">12</span>, <span class="number">34</span>, <span class="number">56</span>);</span><br><span class="line">        Number[] array = list.toArray(<span class="keyword">new</span> Number[<span class="number">3</span>]);</span><br><span class="line">        <span class="keyword">for</span> (Number n : array) &#123;</span><br><span class="line">            System.out.println(n);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœæˆ‘ä»¬ä¼ å…¥ç±»å‹ä¸åŒ¹é…çš„æ•°ç»„ï¼Œä¾‹å¦‚ï¼Œ<code>String[]</code>ç±»å‹çš„æ•°ç»„ï¼Œç”±äº<code>List</code>çš„å…ƒç´ æ˜¯<code>Integer</code>ï¼Œæ‰€ä»¥æ— æ³•æ”¾å…¥<code>String</code>æ•°ç»„ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šæŠ›å‡º<code>ArrayStoreException</code>ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Integer[] array = list.toArray(<span class="keyword">new</span> Integer[list.size()]);</span><br></pre></td></tr></table></figure>

<p>é€šå¸¸ä½¿ç”¨<code>list.size()</code>æ¥ä½œä¸ºæ•°ç»„å¤§å°ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Integer[] array = list.toArray(Integer[]::<span class="keyword">new</span>);</span><br></pre></td></tr></table></figure>

<p>è¿™æ˜¯å¦å¤–ä¸€ç§ç®€å•çš„å†™æ³•ã€‚</p>
<p>æŠŠ<code>Array</code>å˜ä¸º<code>List</code>ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Integer[] array = &#123; <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span> &#125;;</span><br><span class="line">List&lt;Integer&gt; list = List.of(array);</span><br></pre></td></tr></table></figure>

<p>è¿”å›çš„æ˜¯ä¸€ä¸ªåªè¯»<code>List</code>ï¼Œå¯¹åªè¯»<code>List</code>è°ƒç”¨<code>add()</code>ã€<code>remove()</code>æ–¹æ³•ä¼šæŠ›å‡º<code>UnsupportedOperationException</code>ã€‚</p>
<h2 id="3-ç¼–å†™equalsæ–¹æ³•"><a href="#3-ç¼–å†™equalsæ–¹æ³•" class="headerlink" title="3. ç¼–å†™equalsæ–¹æ³•"></a>3. ç¼–å†™equalsæ–¹æ³•</h2><p>åœ¨<code>List</code>ä¸­æŸ¥æ‰¾å…ƒç´ æ—¶ï¼Œ<code>List</code>çš„å®ç°ç±»é€šè¿‡å…ƒç´ çš„<code>equals()</code>æ–¹æ³•æ¯”è¾ƒä¸¤ä¸ªå…ƒç´ æ˜¯å¦ç›¸ç­‰ï¼Œå› æ­¤ï¼Œ<strong>æ”¾å…¥çš„å…ƒç´ </strong>å¿…é¡»æ­£ç¡®è¦†å†™<code>equals()</code>æ–¹æ³•ï¼ŒJavaæ ‡å‡†åº“æä¾›çš„<code>String</code>ã€<code>Integer</code>ç­‰å·²ç»è¦†å†™äº†<code>equals()</code>æ–¹æ³•ï¼›</p>
<p><code>equals()</code>æ–¹æ³•è¦æ±‚æˆ‘ä»¬å¿…é¡»æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š</p>
<ul>
<li>è‡ªåæ€§ï¼ˆReflexiveï¼‰ï¼šå¯¹äºé<code>null</code>çš„<code>x</code>æ¥è¯´ï¼Œ<code>x.equals(x)</code>å¿…é¡»è¿”å›<code>true</code>ï¼›</li>
<li>å¯¹ç§°æ€§ï¼ˆSymmetricï¼‰ï¼šå¯¹äºé<code>null</code>çš„<code>x</code>å’Œ<code>y</code>æ¥è¯´ï¼Œå¦‚æœ<code>x.equals(y)</code>ä¸º<code>true</code>ï¼Œåˆ™<code>y.equals(x)</code>ä¹Ÿå¿…é¡»ä¸º<code>true</code>ï¼›</li>
<li>ä¼ é€’æ€§ï¼ˆTransitiveï¼‰ï¼šå¯¹äºé<code>null</code>çš„<code>x</code>ã€<code>y</code>å’Œ<code>z</code>æ¥è¯´ï¼Œå¦‚æœ<code>x.equals(y)</code>ä¸º<code>true</code>ï¼Œ<code>y.equals(z)</code>ä¹Ÿä¸º<code>true</code>ï¼Œé‚£ä¹ˆ<code>x.equals(z)</code>ä¹Ÿå¿…é¡»ä¸º<code>true</code>ï¼›</li>
<li>ä¸€è‡´æ€§ï¼ˆConsistentï¼‰ï¼šå¯¹äºé<code>null</code>çš„<code>x</code>å’Œ<code>y</code>æ¥è¯´ï¼Œåªè¦<code>x</code>å’Œ<code>y</code>çŠ¶æ€ä¸å˜ï¼Œåˆ™<code>x.equals(y)</code>æ€»æ˜¯ä¸€è‡´åœ°è¿”å›<code>true</code>æˆ–è€…<code>false</code>ï¼›</li>
<li>å¯¹<code>null</code>çš„æ¯”è¾ƒï¼šå³<code>x.equals(null)</code>æ°¸è¿œè¿”å›<code>false</code>ã€‚</li>
</ul>
<p>ä¸¾ä¾‹å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (o <span class="keyword">instanceof</span> Person) &#123;</span><br><span class="line">        Person p = (Person) o;</span><br><span class="line">        <span class="keyword">boolean</span> nameEquals = <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.name == <span class="keyword">null</span> &amp;&amp; p.name == <span class="keyword">null</span>) &#123;</span><br><span class="line">            nameEquals = <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.name != <span class="keyword">null</span>) &#123;</span><br><span class="line">            nameEquals = <span class="keyword">this</span>.name.equals(p.name);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> nameEquals &amp;&amp; <span class="keyword">this</span>.age == p.age;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨<code>Objects.equals()</code>é™æ€æ–¹æ³•å¯¹å…¶è¿›è¡Œä¼˜åŒ–ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (o <span class="keyword">instanceof</span> Person) &#123;</span><br><span class="line">        Person p = (Person) o;</span><br><span class="line">        <span class="keyword">return</span> Objects.equals(<span class="keyword">this</span>.name, p.name) &amp;&amp; <span class="keyword">this</span>.age == p.age;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ€»ç»“ä¸€ä¸‹<code>equals()</code>æ–¹æ³•çš„æ­£ç¡®ç¼–å†™æ–¹æ³•ï¼š</p>
<ol>
<li>å…ˆç¡®å®šå®ä¾‹â€œç›¸ç­‰â€çš„é€»è¾‘ï¼Œå³å“ªäº›å­—æ®µç›¸ç­‰ï¼Œå°±è®¤ä¸ºå®ä¾‹ç›¸ç­‰ï¼›</li>
<li>ç”¨<code>instanceof</code>åˆ¤æ–­ä¼ å…¥çš„å¾…æ¯”è¾ƒçš„<code>Object</code>æ˜¯ä¸æ˜¯å½“å‰ç±»å‹ï¼Œå¦‚æœæ˜¯ï¼Œç»§ç»­æ¯”è¾ƒï¼Œå¦åˆ™ï¼Œè¿”å›<code>false</code>ï¼›</li>
<li>å¯¹å¼•ç”¨ç±»å‹ç”¨<code>Objects.equals()</code>æ¯”è¾ƒï¼Œå¯¹åŸºæœ¬ç±»å‹ç›´æ¥ç”¨<code>==</code>æ¯”è¾ƒã€‚</li>
</ol>
<h2 id="4-Map"><a href="#4-Map" class="headerlink" title="4. Map"></a>4. Map</h2><p><code>Map</code>è¿™ç§é”®å€¼ï¼ˆkey-valueï¼‰æ˜ å°„è¡¨çš„æ•°æ®ç»“æ„ï¼Œä½œç”¨å°±æ˜¯èƒ½é«˜æ•ˆé€šè¿‡<code>key</code>å¿«é€ŸæŸ¥æ‰¾<code>value</code>ï¼ˆå…ƒç´ ï¼‰ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Student s = <span class="keyword">new</span> Student(<span class="string">&quot;Xiao Ming&quot;</span>, <span class="number">99</span>);</span><br><span class="line">        Map&lt;String, Student&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">&quot;Xiao Ming&quot;</span>, s); <span class="comment">// å°†&quot;Xiao Ming&quot;å’ŒStudentå®ä¾‹æ˜ å°„å¹¶å…³è”</span></span><br><span class="line">        Student target = map.get(<span class="string">&quot;Xiao Ming&quot;</span>); <span class="comment">// é€šè¿‡keyæŸ¥æ‰¾å¹¶è¿”å›æ˜ å°„çš„Studentå®ä¾‹</span></span><br><span class="line">        System.out.println(target == s); <span class="comment">// trueï¼ŒåŒä¸€ä¸ªå®ä¾‹</span></span><br><span class="line">        System.out.println(target.score); <span class="comment">// 99</span></span><br><span class="line">        Student another = map.get(<span class="string">&quot;Bob&quot;</span>); <span class="comment">// é€šè¿‡å¦ä¸€ä¸ªkeyæŸ¥æ‰¾</span></span><br><span class="line">        System.out.println(another); <span class="comment">// æœªæ‰¾åˆ°è¿”å›null</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>Map&lt;K, V&gt;</code>æ˜¯ä¸€ç§é”®-å€¼æ˜ å°„è¡¨ï¼Œå½“æˆ‘ä»¬è°ƒç”¨<code>put(K key, V value)</code>æ–¹æ³•æ—¶ï¼Œå°±æŠŠ<code>key</code>å’Œ<code>value</code>åšäº†æ˜ å°„å¹¶æ”¾å…¥<code>Map</code>ã€‚</p>
<p><code>put()</code>æ–¹æ³•çš„ç­¾åæ˜¯<code>V put(K key, V value)</code>ï¼Œå¦‚æœæ”¾å…¥çš„<code>key</code>å·²ç»å­˜åœ¨ï¼Œ<code>put()</code>æ–¹æ³•ä¼šè¿”å›è¢«åˆ é™¤çš„æ—§çš„<code>value</code>ï¼Œå¦åˆ™ï¼Œè¿”å›<code>null</code>ã€‚</p>
<p>å½“æˆ‘ä»¬è°ƒç”¨<code>V get(K key)</code>æ—¶ï¼Œå°±å¯ä»¥é€šè¿‡<code>key</code>è·å–åˆ°å¯¹åº”çš„<code>value</code>ã€‚å¦‚æœ<code>key</code>ä¸å­˜åœ¨ï¼Œåˆ™è¿”å›<code>null</code>ã€‚å’Œ<code>List</code>ç±»ä¼¼ï¼Œ<code>Map</code>ä¹Ÿæ˜¯ä¸€ä¸ªæ¥å£ï¼Œæœ€å¸¸ç”¨çš„å®ç°ç±»æ˜¯<code>HashMap</code>ã€‚</p>
<p>å¦‚æœåªæ˜¯æƒ³æŸ¥è¯¢æŸä¸ª<code>key</code>æ˜¯å¦å­˜åœ¨ï¼Œå¯ä»¥è°ƒç”¨<code>boolean containsKey(K key)</code>æ–¹æ³•ã€‚</p>
<p><strong>éå†Map</strong></p>
<p>å¯¹<code>Map</code>æ¥è¯´ï¼Œè¦éå†<code>key</code>å¯ä»¥ä½¿ç”¨<code>for each</code>å¾ªç¯éå†<code>Map</code>å®ä¾‹çš„<code>keySet()</code>æ–¹æ³•è¿”å›çš„<code>Set</code>é›†åˆï¼Œå®ƒåŒ…å«ä¸é‡å¤çš„<code>key</code>çš„é›†åˆã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Map&lt;String, Integer&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">&quot;apple&quot;</span>, <span class="number">123</span>);</span><br><span class="line">        map.put(<span class="string">&quot;pear&quot;</span>, <span class="number">456</span>);</span><br><span class="line">        map.put(<span class="string">&quot;banana&quot;</span>, <span class="number">789</span>);</span><br><span class="line">        <span class="keyword">for</span> (String key : map.keySet()) &#123;</span><br><span class="line">            Integer value = map.get(key);</span><br><span class="line">            System.out.println(key + <span class="string">&quot; = &quot;</span> + value);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åŒæ—¶éå†<code>key</code>å’Œ<code>value</code>å¯ä»¥ä½¿ç”¨<code>for each</code>å¾ªç¯éå†<code>Map</code>å¯¹è±¡çš„<code>entrySet()</code>é›†åˆï¼Œå®ƒåŒ…å«æ¯ä¸€ä¸ª<code>key-value</code>æ˜ å°„ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Map&lt;String, Integer&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">&quot;apple&quot;</span>, <span class="number">123</span>);</span><br><span class="line">        map.put(<span class="string">&quot;pear&quot;</span>, <span class="number">456</span>);</span><br><span class="line">        map.put(<span class="string">&quot;banana&quot;</span>, <span class="number">789</span>);</span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;String, Integer&gt; entry : map.entrySet()) &#123;</span><br><span class="line">            String key = entry.getKey();</span><br><span class="line">            Integer value = entry.getValue();</span><br><span class="line">            System.out.println(key + <span class="string">&quot; = &quot;</span> + value);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ­£ç¡®ä½¿ç”¨<code>Map</code>å¿…é¡»ä¿è¯ï¼š</p>
<ol>
<li>ä½œä¸º<code>key</code>çš„å¯¹è±¡å¿…é¡»æ­£ç¡®è¦†å†™<code>equals()</code>æ–¹æ³•ï¼Œç›¸ç­‰çš„ä¸¤ä¸ª<code>key</code>å®ä¾‹è°ƒç”¨<code>equals()</code>å¿…é¡»è¿”å›<code>true</code>ï¼›</li>
<li>ä½œä¸º<code>key</code>çš„å¯¹è±¡è¿˜å¿…é¡»æ­£ç¡®è¦†å†™<code>hashCode()</code>æ–¹æ³•ï¼Œä¸”<code>hashCode()</code>æ–¹æ³•è¦ä¸¥æ ¼éµå¾ªä»¥ä¸‹è§„èŒƒï¼š<ul>
<li>å¦‚æœä¸¤ä¸ªå¯¹è±¡ç›¸ç­‰ï¼Œåˆ™ä¸¤ä¸ªå¯¹è±¡çš„<code>hashCode()</code>å¿…é¡»ç›¸ç­‰ã€‚</li>
<li>å¦‚æœä¸¤ä¸ªå¯¹è±¡ä¸ç›¸ç­‰ï¼Œåˆ™ä¸¤ä¸ªå¯¹è±¡çš„<code>hashCode()</code>å°½é‡ä¸è¦ç›¸ç­‰ã€‚</li>
</ul>
</li>
</ol>
<p>è¦†å†™<code>equals()</code>æ–¹æ³•çœ‹ä¸Šä¸€èŠ‚ã€‚</p>
<p>æ¯”å¦‚è¯´<code>Person</code>ç±»ä½œä¸º<code>key</code>ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    String firstName;</span><br><span class="line">    String lastName;</span><br><span class="line">    <span class="keyword">int</span> age;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨æ­£ç¡®å®ç°<code>equals()</code>çš„åŸºç¡€ä¸Šï¼Œæˆ‘ä»¬è¿˜éœ€è¦æ­£ç¡®å®ç°<code>hashCode()</code>ï¼Œå³ä¸Šè¿°3ä¸ªå­—æ®µåˆ†åˆ«ç›¸åŒçš„å®ä¾‹ï¼Œ<code>hashCode()</code>è¿”å›çš„<code>int</code>å¿…é¡»ç›¸åŒã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    String firstName;</span><br><span class="line">    String lastName;</span><br><span class="line">    <span class="keyword">int</span> age;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> h = <span class="number">0</span>;</span><br><span class="line">        h = <span class="number">31</span> * h + firstName.hashCode();</span><br><span class="line">        h = <span class="number">31</span> * h + lastName.hashCode();</span><br><span class="line">        h = <span class="number">31</span> * h + age;</span><br><span class="line">        <span class="keyword">return</span> h;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>String</code>ç±»å·²ç»æ­£ç¡®å®ç°äº†<code>hashCode()</code>æ–¹æ³•ï¼Œæˆ‘ä»¬åœ¨è®¡ç®—<code>Person</code>çš„<code>hashCode()</code>æ—¶ï¼Œåå¤ä½¿ç”¨<code>31*h</code>ï¼Œè¿™æ ·åšçš„ç›®çš„æ˜¯ä¸ºäº†å°½é‡æŠŠä¸åŒçš„<code>Person</code>å®ä¾‹çš„<code>hashCode()</code>å‡åŒ€åˆ†å¸ƒåˆ°æ•´ä¸ª<code>int</code>èŒƒå›´ã€‚</p>
<p>æœ<code>firstName</code>æˆ–<code>lastName</code>ä¸º<code>null</code>ï¼Œä¸Šè¿°ä»£ç å·¥ä½œèµ·æ¥å°±ä¼šæŠ›<code>NullPointerException</code>ã€‚æˆ‘ä»¬åœ¨è®¡ç®—<code>hashCode()</code>çš„æ—¶å€™ï¼Œç»å¸¸å€ŸåŠ©<code>Objects.hash()</code>æ¥è®¡ç®—ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> Objects.hash(firstName, lastName, age);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åŸåˆ™ï¼š</p>
<p><code>equals()</code>ç”¨åˆ°çš„ç”¨äºæ¯”è¾ƒçš„æ¯ä¸€ä¸ªå­—æ®µï¼Œéƒ½å¿…é¡»åœ¨<code>hashCode()</code>ä¸­ç”¨äºè®¡ç®—ï¼›<code>equals()</code>ä¸­æ²¡æœ‰ä½¿ç”¨åˆ°çš„å­—æ®µï¼Œç»ä¸å¯æ”¾åœ¨<code>hashCode()</code>ä¸­è®¡ç®—ã€‚</p>
<p><strong>EnumMap</strong></p>
<p>å¦‚æœ<code>Map</code>çš„keyæ˜¯<code>enum</code>ç±»å‹ï¼Œæ¨èä½¿ç”¨<code>EnumMap</code></p>
<p>ä½¿ç”¨<code>EnumMap</code>çš„æ—¶å€™ï¼Œæ ¹æ®é¢å‘æŠ½è±¡ç¼–ç¨‹çš„åŸåˆ™ï¼Œåº”æŒæœ‰<code>Map</code>æ¥å£ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Map&lt;DayOfWeek, String&gt; map = <span class="keyword">new</span> EnumMap&lt;&gt;(DayOfWeek.class);</span><br><span class="line">        map.put(DayOfWeek.MONDAY, <span class="string">&quot;æ˜ŸæœŸä¸€&quot;</span>);</span><br><span class="line">        map.put(DayOfWeek.TUESDAY, <span class="string">&quot;æ˜ŸæœŸäºŒ&quot;</span>);</span><br><span class="line">        map.put(DayOfWeek.WEDNESDAY, <span class="string">&quot;æ˜ŸæœŸä¸‰&quot;</span>);</span><br><span class="line">        map.put(DayOfWeek.THURSDAY, <span class="string">&quot;æ˜ŸæœŸå››&quot;</span>);</span><br><span class="line">        map.put(DayOfWeek.FRIDAY, <span class="string">&quot;æ˜ŸæœŸäº”&quot;</span>);</span><br><span class="line">        map.put(DayOfWeek.SATURDAY, <span class="string">&quot;æ˜ŸæœŸå…­&quot;</span>);</span><br><span class="line">        map.put(DayOfWeek.SUNDAY, <span class="string">&quot;æ˜ŸæœŸæ—¥&quot;</span>);</span><br><span class="line">        System.out.println(map);</span><br><span class="line">        System.out.println(map.get(DayOfWeek.MONDAY));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>TreeMap</strong></p>
<p>è¿˜æœ‰ä¸€ç§<code>Map</code>ï¼Œå®ƒåœ¨å†…éƒ¨ä¼šå¯¹Keyè¿›è¡Œæ’åºï¼Œè¿™ç§<code>Map</code>å°±æ˜¯<code>SortedMap</code>ã€‚æ³¨æ„åˆ°<code>SortedMap</code>æ˜¯æ¥å£ï¼Œå®ƒçš„å®ç°ç±»æ˜¯<code>TreeMap</code>ã€‚</p>
<p><img src="https://raw.githubusercontent.com/ghj1998/image_repository/main/image-20210330103050799.png" alt="image-20210330103050799"></p>
<p><code>SortedMap</code>ä¿è¯éå†æ—¶ä»¥Keyçš„é¡ºåºæ¥è¿›è¡Œæ’åºã€‚ä¾‹å¦‚ï¼Œæ”¾å…¥çš„Keyæ˜¯<code>&quot;apple&quot;</code>ã€<code>&quot;pear&quot;</code>ã€<code>&quot;orange&quot;</code>ï¼Œéå†çš„é¡ºåºä¸€å®šæ˜¯<code>&quot;apple&quot;</code>ã€<code>&quot;orange&quot;</code>ã€<code>&quot;pear&quot;</code>ï¼Œå› ä¸º<code>String</code>é»˜è®¤æŒ‰å­—æ¯æ’åºï¼š</p>
<p>ä½¿ç”¨<code>TreeMap</code>æ—¶ï¼Œæ”¾å…¥çš„Keyå¿…é¡»å®ç°<code>Comparable</code>æ¥å£ã€‚<code>String</code>ã€<code>Integer</code>è¿™äº›ç±»å·²ç»å®ç°äº†<code>Comparable</code>æ¥å£ï¼Œå› æ­¤å¯ä»¥ç›´æ¥ä½œä¸ºKeyä½¿ç”¨ã€‚</p>
<p>å¦‚æœä½œä¸ºKeyçš„classæ²¡æœ‰å®ç°<code>Comparable</code>æ¥å£ï¼Œé‚£ä¹ˆï¼Œå¿…é¡»åœ¨åˆ›å»º<code>TreeMap</code>æ—¶åŒæ—¶æŒ‡å®šä¸€ä¸ªè‡ªå®šä¹‰æ’åºç®—æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Map&lt;Person, Integer&gt; map = <span class="keyword">new</span> TreeMap&lt;&gt;(<span class="keyword">new</span> Comparator&lt;Person&gt;() &#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compare</span><span class="params">(Person p1, Person p2)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> p1.name.compareTo(p2.name);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        map.put(<span class="keyword">new</span> Person(<span class="string">&quot;Tom&quot;</span>), <span class="number">1</span>);</span><br><span class="line">        map.put(<span class="keyword">new</span> Person(<span class="string">&quot;Bob&quot;</span>), <span class="number">2</span>);</span><br><span class="line">        map.put(<span class="keyword">new</span> Person(<span class="string">&quot;Lily&quot;</span>), <span class="number">3</span>);</span><br><span class="line">        <span class="keyword">for</span> (Person key : map.keySet()) &#123;</span><br><span class="line">            System.out.println(key);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// &#123;Person: Bob&#125;, &#123;Person: Lily&#125;, &#123;Person: Tom&#125;</span></span><br><span class="line">        System.out.println(map.get(<span class="keyword">new</span> Person(<span class="string">&quot;Bob&quot;</span>))); <span class="comment">// 2</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> String name;</span><br><span class="line">    Person(String name) &#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&#123;Person: &quot;</span> + name + <span class="string">&quot;&#125;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>æ³¨æ„åˆ°<code>Person</code>ç±»å¹¶æœªè¦†å†™<code>equals()</code>å’Œ<code>hashCode()</code>ï¼Œå› ä¸º<code>TreeMap</code>ä¸ä½¿ç”¨<code>equals()</code>å’Œ<code>hashCode()</code>ã€‚</p>
<h2 id="5-Properties"><a href="#5-Properties" class="headerlink" title="5. Properties"></a>5. Properties</h2><p>åœ¨ç¼–å†™åº”ç”¨ç¨‹åºçš„æ—¶å€™ï¼Œç»å¸¸éœ€è¦è¯»å†™é…ç½®æ–‡ä»¶ã€‚</p>
<p>é…ç½®æ–‡ä»¶çš„ç‰¹ç‚¹æ˜¯ï¼Œå®ƒçš„Key-Valueä¸€èˆ¬éƒ½æ˜¯<code>String</code>-<code>String</code>ç±»å‹çš„ï¼Œå› æ­¤æˆ‘ä»¬å®Œå…¨å¯ä»¥ç”¨<code>Map&lt;String, String&gt;</code>æ¥è¡¨ç¤ºå®ƒã€‚</p>
<p>Javaé›†åˆåº“æä¾›äº†ä¸€ä¸ª<code>Properties</code>æ¥è¡¨ç¤ºä¸€ç»„â€œé…ç½®â€ã€‚</p>
<p><strong>è¯»å–é…ç½®æ–‡ä»¶</strong></p>
<p>ç”¨<code>Properties</code>è¯»å–é…ç½®æ–‡ä»¶éå¸¸ç®€å•ã€‚Javaé»˜è®¤é…ç½®æ–‡ä»¶ä»¥<code>.properties</code>ä¸ºæ‰©å±•åï¼Œæ¯è¡Œä»¥<code>key=value</code>è¡¨ç¤ºï¼Œä»¥<code>#</code>è¯¾å¼€å¤´çš„æ˜¯æ³¨é‡Šã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªå…¸å‹çš„é…ç½®æ–‡ä»¶ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"># setting.properties</span><br><span class="line"></span><br><span class="line">last_open_file=/data/hello.txt</span><br><span class="line">auto_save_interval=<span class="number">60</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">String f = <span class="string">&quot;setting.properties&quot;</span>;</span><br><span class="line">Properties props = <span class="keyword">new</span> Properties();</span><br><span class="line">props.load(<span class="keyword">new</span> java.io.FileInputStream(f));</span><br><span class="line"></span><br><span class="line">String filepath = props.getProperty(<span class="string">&quot;last_open_file&quot;</span>);</span><br><span class="line">String interval = props.getProperty(<span class="string">&quot;auto_save_interval&quot;</span>, <span class="string">&quot;120&quot;</span>);</span><br><span class="line"><span class="comment">// è°ƒç”¨getProperty()è·å–é…ç½®æ—¶ï¼Œå¦‚æœkeyä¸å­˜åœ¨ï¼Œå°†è¿”å›nullã€‚æˆ‘ä»¬è¿˜å¯ä»¥æä¾›ä¸€ä¸ªé»˜è®¤å€¼ï¼Œè¿™æ ·ï¼Œå½“keyä¸å­˜åœ¨çš„æ—¶å€™ï¼Œå°±è¿”å›é»˜è®¤å€¼ã€‚</span></span><br></pre></td></tr></table></figure>

<p>å¯è§ï¼Œç”¨<code>Properties</code>è¯»å–é…ç½®æ–‡ä»¶ï¼Œä¸€å…±æœ‰ä¸‰æ­¥ï¼š</p>
<ol>
<li>åˆ›å»º<code>Properties</code>å®ä¾‹ï¼›</li>
<li>è°ƒç”¨<code>load()</code>è¯»å–æ–‡ä»¶ï¼›</li>
<li>è°ƒç”¨<code>getProperty()</code>è·å–é…ç½®ã€‚</li>
</ol>
<p>å¦‚æœæœ‰å¤šä¸ª<code>.properties</code>æ–‡ä»¶ï¼Œå¯ä»¥åå¤è°ƒç”¨<code>load()</code>è¯»å–ï¼Œåè¯»å–çš„key-valueä¼šè¦†ç›–å·²è¯»å–çš„key-valueï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Properties props = <span class="keyword">new</span> Properties();</span><br><span class="line">props.load(getClass().getResourceAsStream(<span class="string">&quot;/common/setting.properties&quot;</span>));</span><br><span class="line">props.load(<span class="keyword">new</span> FileInputStream(<span class="string">&quot;C:\\conf\\setting.properties&quot;</span>));</span><br></pre></td></tr></table></figure>

<p><strong>å†™å…¥é…ç½®æ–‡ä»¶</strong></p>
<p>å¦‚æœé€šè¿‡<code>setProperty()</code>ä¿®æ”¹äº†<code>Properties</code>å®ä¾‹ï¼Œå¯ä»¥æŠŠé…ç½®å†™å…¥æ–‡ä»¶ï¼Œä»¥ä¾¿ä¸‹æ¬¡å¯åŠ¨æ—¶è·å¾—æœ€æ–°é…ç½®ã€‚å†™å…¥é…ç½®æ–‡ä»¶ä½¿ç”¨<code>store()</code>æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Properties props = <span class="keyword">new</span> Properties();</span><br><span class="line">props.setProperty(<span class="string">&quot;url&quot;</span>, <span class="string">&quot;http://www.liaoxuefeng.com&quot;</span>);</span><br><span class="line">props.setProperty(<span class="string">&quot;language&quot;</span>, <span class="string">&quot;Java&quot;</span>);</span><br><span class="line">props.store(<span class="keyword">new</span> FileOutputStream(<span class="string">&quot;C:\\conf\\setting.properties&quot;</span>), <span class="string">&quot;è¿™æ˜¯å†™å…¥çš„propertiesæ³¨é‡Š&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>ç”±äº<code>load(InputStream)</code>é»˜è®¤æ€»æ˜¯ä»¥ASCIIç¼–ç è¯»å–å­—èŠ‚æµï¼Œæ‰€ä»¥ä¼šå¯¼è‡´è¯»åˆ°ä¹±ç ã€‚æˆ‘ä»¬éœ€è¦ç”¨å¦ä¸€ä¸ªé‡è½½æ–¹æ³•<code>load(Reader)</code>è¯»å–ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Properties props = <span class="keyword">new</span> Properties();</span><br><span class="line">props.load(<span class="keyword">new</span> FileReader(<span class="string">&quot;settings.properties&quot;</span>, StandardCharsets.UTF_8));</span><br></pre></td></tr></table></figure>

<p>å°±å¯ä»¥æ­£å¸¸è¯»å–ä¸­æ–‡ã€‚</p>
<h2 id="6-Set"><a href="#6-Set" class="headerlink" title="6. Set"></a>6. Set</h2><p><code>Set</code>ç”¨äºå­˜å‚¨ä¸é‡å¤çš„å…ƒç´ é›†åˆï¼Œå®ƒä¸»è¦æä¾›ä»¥ä¸‹å‡ ä¸ªæ–¹æ³•ï¼š</p>
<ul>
<li>å°†å…ƒç´ æ·»åŠ è¿›<code>Set&lt;E&gt;</code>ï¼š<code>boolean add(E e)</code></li>
<li>å°†å…ƒç´ ä»<code>Set&lt;E&gt;</code>åˆ é™¤ï¼š<code>boolean remove(Object e)</code></li>
<li>åˆ¤æ–­æ˜¯å¦åŒ…å«å…ƒç´ ï¼š<code>boolean contains(Object e)</code></li>
</ul>
<p>æœ€å¸¸ç”¨çš„<code>Set</code>å®ç°ç±»æ˜¯<code>HashSet</code></p>
<p>æŠŠ<code>HashSet</code>æ¢æˆ<code>TreeSet</code>ï¼Œåœ¨éå†<code>TreeSet</code>æ—¶ï¼Œè¾“å‡ºå°±æ˜¯æœ‰åºçš„ï¼Œè¿™ä¸ªé¡ºåºæ˜¯å…ƒç´ çš„æ’åºé¡ºåºï¼š</p>
<p>ä½¿ç”¨<code>TreeSet</code>å’Œä½¿ç”¨<code>TreeMap</code>çš„è¦æ±‚ä¸€æ ·ï¼Œæ·»åŠ çš„å…ƒç´ å¿…é¡»æ­£ç¡®å®ç°<code>Comparable</code>æ¥å£ï¼Œå¦‚æœæ²¡æœ‰å®ç°<code>Comparable</code>æ¥å£ï¼Œé‚£ä¹ˆåˆ›å»º<code>TreeSet</code>æ—¶å¿…é¡»ä¼ å…¥ä¸€ä¸ª<code>Comparator</code>å¯¹è±¡ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Set&lt;String&gt; set = <span class="keyword">new</span> HashSet&lt;&gt;();</span><br><span class="line">        System.out.println(set.add(<span class="string">&quot;abc&quot;</span>)); <span class="comment">// true</span></span><br><span class="line">        System.out.println(set.add(<span class="string">&quot;xyz&quot;</span>)); <span class="comment">// true</span></span><br><span class="line">        System.out.println(set.add(<span class="string">&quot;xyz&quot;</span>)); <span class="comment">// falseï¼Œæ·»åŠ å¤±è´¥ï¼Œå› ä¸ºå…ƒç´ å·²å­˜åœ¨</span></span><br><span class="line">        System.out.println(set.contains(<span class="string">&quot;xyz&quot;</span>)); <span class="comment">// trueï¼Œå…ƒç´ å­˜åœ¨</span></span><br><span class="line">        System.out.println(set.contains(<span class="string">&quot;XYZ&quot;</span>)); <span class="comment">// falseï¼Œå…ƒç´ ä¸å­˜åœ¨</span></span><br><span class="line">        System.out.println(set.remove(<span class="string">&quot;hello&quot;</span>)); <span class="comment">// falseï¼Œåˆ é™¤å¤±è´¥ï¼Œå› ä¸ºå…ƒç´ ä¸å­˜åœ¨</span></span><br><span class="line">        System.out.println(set.size()); <span class="comment">// 2ï¼Œä¸€å…±ä¸¤ä¸ªå…ƒç´ </span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="7-Queue"><a href="#7-Queue" class="headerlink" title="7. Queue"></a>7. Queue</h2><p>é˜Ÿåˆ—ï¼ˆ<code>Queue</code>ï¼‰æ˜¯ä¸€ç§ç»å¸¸ä½¿ç”¨çš„é›†åˆã€‚<code>Queue</code>å®é™…ä¸Šæ˜¯å®ç°äº†ä¸€ä¸ªå…ˆè¿›å…ˆå‡ºï¼ˆFIFOï¼šFirst In First Outï¼‰çš„æœ‰åºè¡¨ã€‚å®ƒå’Œ<code>List</code>çš„åŒºåˆ«åœ¨äºï¼Œ<code>List</code>å¯ä»¥åœ¨ä»»æ„ä½ç½®æ·»åŠ å’Œåˆ é™¤å…ƒç´ ï¼Œè€Œ<code>Queue</code>åªæœ‰ä¸¤ä¸ªæ“ä½œï¼š</p>
<ul>
<li>æŠŠå…ƒç´ æ·»åŠ åˆ°é˜Ÿåˆ—æœ«å°¾ï¼›</li>
<li>ä»é˜Ÿåˆ—å¤´éƒ¨å–å‡ºå…ƒç´ ã€‚</li>
</ul>
<p>é˜Ÿåˆ—æ¥å£<code>Queue</code>å®šä¹‰äº†ä»¥ä¸‹å‡ ä¸ªæ–¹æ³•ï¼š</p>
<ul>
<li><code>int size()</code>ï¼šè·å–é˜Ÿåˆ—é•¿åº¦ï¼›</li>
<li><code>boolean add(E)</code>/<code>boolean offer(E)</code>ï¼šæ·»åŠ å…ƒç´ åˆ°é˜Ÿå°¾ï¼›</li>
<li><code>E remove()</code>/<code>E poll()</code>ï¼šè·å–é˜Ÿé¦–å…ƒç´ å¹¶ä»é˜Ÿåˆ—ä¸­åˆ é™¤ï¼›</li>
<li><code>E element()</code>/<code>E peek()</code>ï¼šè·å–é˜Ÿé¦–å…ƒç´ ä½†å¹¶ä¸ä»é˜Ÿåˆ—ä¸­åˆ é™¤ã€‚</li>
</ul>
<table>
<thead>
<tr>
<th align="left">throw Exception</th>
<th align="left">è¿”å›falseæˆ–null</th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td align="left">æ·»åŠ å…ƒç´ åˆ°é˜Ÿå°¾</td>
<td align="left">add(E e)</td>
<td>boolean offer(E e)</td>
</tr>
<tr>
<td align="left">å–é˜Ÿé¦–å…ƒç´ å¹¶åˆ é™¤</td>
<td align="left">E remove()</td>
<td>E poll()</td>
</tr>
<tr>
<td align="left">å–é˜Ÿé¦–å…ƒç´ ä½†ä¸åˆ é™¤</td>
<td align="left">E element()</td>
<td>E peek()</td>
</tr>
</tbody></table>
<h2 id="8-PriorityQueue"><a href="#8-PriorityQueue" class="headerlink" title="8. PriorityQueue"></a>8. PriorityQueue</h2><p><code>PriorityQueue</code>å’Œ<code>Queue</code>çš„åŒºåˆ«åœ¨äºï¼Œå®ƒçš„å‡ºé˜Ÿé¡ºåºä¸å…ƒç´ çš„ä¼˜å…ˆçº§æœ‰å…³ï¼Œå¯¹<code>PriorityQueue</code>è°ƒç”¨<code>remove()</code>æˆ–<code>poll()</code>æ–¹æ³•ï¼Œè¿”å›çš„æ€»æ˜¯ä¼˜å…ˆçº§æœ€é«˜çš„å…ƒç´ ã€‚</p>
<p>è¦ä½¿ç”¨<code>PriorityQueue</code>ï¼Œæˆ‘ä»¬å°±å¿…é¡»ç»™æ¯ä¸ªå…ƒç´ å®šä¹‰â€œä¼˜å…ˆçº§â€ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Queue&lt;String&gt; q = <span class="keyword">new</span> PriorityQueue&lt;&gt;();</span><br><span class="line">        <span class="comment">// æ·»åŠ 3ä¸ªå…ƒç´ åˆ°é˜Ÿåˆ—:</span></span><br><span class="line">        q.offer(<span class="string">&quot;apple&quot;</span>);</span><br><span class="line">        q.offer(<span class="string">&quot;pear&quot;</span>);</span><br><span class="line">        q.offer(<span class="string">&quot;banana&quot;</span>);</span><br><span class="line">        System.out.println(q.poll()); <span class="comment">// apple</span></span><br><span class="line">        System.out.println(q.poll()); <span class="comment">// banana</span></span><br><span class="line">        System.out.println(q.poll()); <span class="comment">// pear</span></span><br><span class="line">        System.out.println(q.poll()); <span class="comment">// null,å› ä¸ºé˜Ÿåˆ—ä¸ºç©º</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬æ”¾å…¥çš„é¡ºåºæ˜¯<code>&quot;apple&quot;</code>ã€<code>&quot;pear&quot;</code>ã€<code>&quot;banana&quot;</code>ï¼Œä½†æ˜¯å–å‡ºçš„é¡ºåºå´æ˜¯<code>&quot;apple&quot;</code>ã€<code>&quot;banana&quot;</code>ã€<code>&quot;pear&quot;</code>ï¼Œè¿™æ˜¯å› ä¸ºä»å­—ç¬¦ä¸²çš„æ’åºçœ‹ï¼Œ<code>&quot;apple&quot;</code>æ’åœ¨æœ€å‰é¢ï¼Œ<code>&quot;pear&quot;</code>æ’åœ¨æœ€åé¢ã€‚</p>
<p>å› æ­¤ï¼Œæ”¾å…¥<code>PriorityQueue</code>çš„å…ƒç´ ï¼Œå¿…é¡»å®ç°<code>Comparable</code>æ¥å£ï¼Œ<code>PriorityQueue</code>ä¼šæ ¹æ®å…ƒç´ çš„æ’åºé¡ºåºå†³å®šå‡ºé˜Ÿçš„ä¼˜å…ˆçº§ã€‚</p>
<p><code>PriorityQueue</code>å…è®¸æˆ‘ä»¬æä¾›ä¸€ä¸ª<code>Comparator</code>å¯¹è±¡æ¥åˆ¤æ–­ä¸¤ä¸ªå…ƒç´ çš„é¡ºåºã€‚æˆ‘ä»¬ä»¥é“¶è¡Œæ’é˜Ÿä¸šåŠ¡ä¸ºä¾‹ï¼Œå®ç°ä¸€ä¸ª<code>PriorityQueue</code>ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Queue&lt;User&gt; q = <span class="keyword">new</span> PriorityQueue&lt;&gt;(<span class="keyword">new</span> UserComparator());</span><br><span class="line">        <span class="comment">// æ·»åŠ 3ä¸ªå…ƒç´ åˆ°é˜Ÿåˆ—:</span></span><br><span class="line">        q.offer(<span class="keyword">new</span> User(<span class="string">&quot;Bob&quot;</span>, <span class="string">&quot;A1&quot;</span>));</span><br><span class="line">        q.offer(<span class="keyword">new</span> User(<span class="string">&quot;Alice&quot;</span>, <span class="string">&quot;A2&quot;</span>));</span><br><span class="line">        q.offer(<span class="keyword">new</span> User(<span class="string">&quot;Boss&quot;</span>, <span class="string">&quot;V1&quot;</span>));</span><br><span class="line">        System.out.println(q.poll()); <span class="comment">// Boss/V1</span></span><br><span class="line">        System.out.println(q.poll()); <span class="comment">// Bob/A1</span></span><br><span class="line">        System.out.println(q.poll()); <span class="comment">// Alice/A2</span></span><br><span class="line">        System.out.println(q.poll()); <span class="comment">// null,å› ä¸ºé˜Ÿåˆ—ä¸ºç©º</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserComparator</span> <span class="keyword">implements</span> <span class="title">Comparator</span>&lt;<span class="title">User</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compare</span><span class="params">(User u1, User u2)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (u1.number.charAt(<span class="number">0</span>) == u2.number.charAt(<span class="number">0</span>)) &#123;</span><br><span class="line">            <span class="comment">// å¦‚æœä¸¤äººçš„å·éƒ½æ˜¯Aå¼€å¤´æˆ–è€…éƒ½æ˜¯Vå¼€å¤´,æ¯”è¾ƒå·çš„å¤§å°:</span></span><br><span class="line">            <span class="keyword">return</span> u1.number.compareTo(u2.number);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (u1.number.charAt(<span class="number">0</span>) == <span class="string">&#x27;V&#x27;</span>) &#123;</span><br><span class="line">            <span class="comment">// u1çš„å·ç æ˜¯Vå¼€å¤´,ä¼˜å…ˆçº§é«˜:</span></span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> String name;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> String number;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">(String name, String number)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.number = number;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name + <span class="string">&quot;/&quot;</span> + number;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="9-Deque"><a href="#9-Deque" class="headerlink" title="9.Deque"></a>9.Deque</h2><p>åŒç«¯é˜Ÿåˆ—ï¼ˆDouble Ended Queueï¼‰ï¼Œå­¦å<code>Deque</code>ã€‚</p>
<p>Javaé›†åˆæä¾›äº†æ¥å£<code>Deque</code>æ¥å®ç°ä¸€ä¸ªåŒç«¯é˜Ÿåˆ—ï¼Œå®ƒçš„åŠŸèƒ½æ˜¯ï¼š</p>
<ul>
<li>æ—¢å¯ä»¥æ·»åŠ åˆ°é˜Ÿå°¾ï¼Œä¹Ÿå¯ä»¥æ·»åŠ åˆ°é˜Ÿé¦–ï¼›</li>
<li>æ—¢å¯ä»¥ä»é˜Ÿé¦–è·å–ï¼Œåˆå¯ä»¥ä»é˜Ÿå°¾è·å–ã€‚</li>
</ul>
<table>
<thead>
<tr>
<th align="left"></th>
<th align="left">Queue</th>
<th align="left">Deque</th>
</tr>
</thead>
<tbody><tr>
<td align="left">æ·»åŠ å…ƒç´ åˆ°é˜Ÿå°¾</td>
<td align="left">add(E e) / offer(E e)</td>
<td align="left">addLast(E e) / offerLast(E e)</td>
</tr>
<tr>
<td align="left">å–é˜Ÿé¦–å…ƒç´ å¹¶åˆ é™¤</td>
<td align="left">E remove() / E poll()</td>
<td align="left">E removeFirst() / E pollFirst()</td>
</tr>
<tr>
<td align="left">å–é˜Ÿé¦–å…ƒç´ ä½†ä¸åˆ é™¤</td>
<td align="left">E element() / E peek()</td>
<td align="left">E getFirst() / E peekFirst()</td>
</tr>
<tr>
<td align="left">æ·»åŠ å…ƒç´ åˆ°é˜Ÿé¦–</td>
<td align="left">æ— </td>
<td align="left">addFirst(E e) / offerFirst(E e)</td>
</tr>
<tr>
<td align="left">å–é˜Ÿå°¾å…ƒç´ å¹¶åˆ é™¤</td>
<td align="left">æ— </td>
<td align="left">E removeLast() / E pollLast()</td>
</tr>
<tr>
<td align="left">å–é˜Ÿå°¾å…ƒç´ ä½†ä¸åˆ é™¤</td>
<td align="left">æ— </td>
<td align="left">E getLast() / E peekLast()</td>
</tr>
</tbody></table>
<p><code>Deque</code>æ˜¯ä¸€ä¸ªæ¥å£ï¼Œå®ƒçš„å®ç°ç±»æœ‰<code>ArrayDeque</code>å’Œ<code>LinkedList</code>ã€‚</p>
<p>ä½¿ç”¨<code>LinkedList</code>è¦æŠŠåŒºåˆ†å¼€ã€‚å¦‚ä¸‹æ‰€ç¤ºã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ä¸æ¨èçš„å†™æ³•:</span></span><br><span class="line">LinkedList&lt;String&gt; d1 = <span class="keyword">new</span> LinkedList&lt;&gt;();</span><br><span class="line">d1.offerLast(<span class="string">&quot;z&quot;</span>);</span><br><span class="line"><span class="comment">// æ¨èçš„å†™æ³•ï¼š</span></span><br><span class="line">Deque&lt;String&gt; d2 = <span class="keyword">new</span> LinkedList&lt;&gt;();</span><br><span class="line">d2.offerLast(<span class="string">&quot;z&quot;</span>);</span><br></pre></td></tr></table></figure>

<h2 id="10-Stack"><a href="#10-Stack" class="headerlink" title="10. Stack"></a>10. Stack</h2><p>æ ˆï¼ˆStackï¼‰æ˜¯ä¸€ç§åè¿›å…ˆå‡ºï¼ˆLIFOï¼šLast In First Outï¼‰çš„æ•°æ®ç»“æ„ã€‚</p>
<p><code>Stack</code>åªæœ‰å…¥æ ˆå’Œå‡ºæ ˆçš„æ“ä½œï¼š</p>
<ul>
<li>æŠŠå…ƒç´ å‹æ ˆï¼š<code>push(E)</code>ï¼›</li>
<li>æŠŠæ ˆé¡¶çš„å…ƒç´ â€œå¼¹å‡ºâ€ï¼š<code>pop()</code>ï¼›</li>
<li>å–æ ˆé¡¶å…ƒç´ ä½†ä¸å¼¹å‡ºï¼š<code>peek()</code>ã€‚</li>
</ul>
<p>åœ¨Javaä¸­ï¼Œæˆ‘ä»¬ç”¨<code>Deque</code>å¯ä»¥å®ç°<code>Stack</code>çš„åŠŸèƒ½ï¼š</p>
<ul>
<li>æŠŠå…ƒç´ å‹æ ˆï¼š<code>push(E)</code>/<code>addFirst(E)</code>ï¼›</li>
<li>æŠŠæ ˆé¡¶çš„å…ƒç´ â€œå¼¹å‡ºâ€ï¼š<code>pop()</code>/<code>removeFirst()</code>ï¼›</li>
<li>å–æ ˆé¡¶å…ƒç´ ä½†ä¸å¼¹å‡ºï¼š<code>peek()</code>/<code>peekFirst()</code>ã€‚</li>
</ul>
<p>å½“æˆ‘ä»¬æŠŠ<code>Deque</code>ä½œä¸º<code>Stack</code>ä½¿ç”¨æ—¶ï¼Œæ³¨æ„åªè°ƒç”¨<code>push()</code>/<code>pop()</code>/<code>peek()</code>æ–¹æ³•ï¼Œä¸è¦è°ƒç”¨<code>addFirst()</code>/<code>removeFirst()</code>/<code>peekFirst()</code>æ–¹æ³•ï¼Œè¿™æ ·ä»£ç æ›´åŠ æ¸…æ™°ã€‚</p>
<p><em>å› ä¸ºJAVAä¸­æœ‰ä¸ªé—ç•™ç±»Stackï¼Œæ‰€ä»¥æ²¡æœ‰å•ç‹¬çš„Stackæ¥å£</em></p>
<h2 id="11-Iterator"><a href="#11-Iterator" class="headerlink" title="11. Iterator"></a>11. Iterator</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">List&lt;String&gt; list = List.of(<span class="string">&quot;Apple&quot;</span>, <span class="string">&quot;Orange&quot;</span>, <span class="string">&quot;Pear&quot;</span>);</span><br><span class="line"><span class="keyword">for</span> (String s : list) &#123;</span><br><span class="line">    System.out.println(s);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç­‰ä»·äº</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> (Iterator&lt;String&gt; it = list.iterator(); it.hasNext(); ) &#123;</span><br><span class="line">     String s = it.next();</span><br><span class="line">     System.out.println(s);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™ç§é€šè¿‡<code>Iterator</code>å¯¹è±¡éå†é›†åˆçš„æ¨¡å¼ç§°ä¸ºè¿­ä»£å™¨ã€‚</p>
<p>å¦‚æœæˆ‘ä»¬è‡ªå·±ç¼–å†™äº†ä¸€ä¸ªé›†åˆç±»ï¼Œæƒ³è¦ä½¿ç”¨<code>for each</code>å¾ªç¯ï¼Œåªéœ€æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š</p>
<ul>
<li>é›†åˆç±»å®ç°<code>Iterable</code>æ¥å£ï¼Œè¯¥æ¥å£è¦æ±‚è¿”å›ä¸€ä¸ª<code>Iterator</code>å¯¹è±¡ï¼›</li>
<li>ç”¨<code>Iterator</code>å¯¹è±¡è¿­ä»£é›†åˆå†…éƒ¨æ•°æ®ã€‚</li>
</ul>
<p>ä¾‹å¦‚ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ReverseList&lt;String&gt; rlist = <span class="keyword">new</span> ReverseList&lt;&gt;();</span><br><span class="line">        rlist.add(<span class="string">&quot;Apple&quot;</span>);</span><br><span class="line">        rlist.add(<span class="string">&quot;Orange&quot;</span>);</span><br><span class="line">        rlist.add(<span class="string">&quot;Pear&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (String s : rlist) &#123;</span><br><span class="line">            System.out.println(s);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ReverseList</span>&lt;<span class="title">T</span>&gt; <span class="keyword">implements</span> <span class="title">Iterable</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> List&lt;T&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(T t)</span> </span>&#123;</span><br><span class="line">        list.add(t);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Iterator&lt;T&gt; <span class="title">iterator</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ReverseIterator(list.size());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">ReverseIterator</span> <span class="keyword">implements</span> <span class="title">Iterator</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> index;</span><br><span class="line"></span><br><span class="line">        ReverseIterator(<span class="keyword">int</span> index) &#123;</span><br><span class="line">            <span class="keyword">this</span>.index = index;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasNext</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> index &gt; <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> T <span class="title">next</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            index--;</span><br><span class="line">            <span class="keyword">return</span> ReverseList.<span class="keyword">this</span>.list.get(index);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="12-Collections"><a href="#12-Collections" class="headerlink" title="12. Collections"></a>12. Collections</h2><p> æ³¨æ„Collectionsç»“å°¾å¤šäº†ä¸€ä¸ªsï¼Œä¸æ˜¯Collectionï¼</p>
<p>ä¸€èˆ¬çœ‹æ–¹æ³•åå’Œå‚æ•°å°±å¯ä»¥ç¡®è®¤<code>Collections</code>æä¾›çš„è¯¥æ–¹æ³•çš„åŠŸèƒ½ã€‚ä¾‹å¦‚ï¼Œå¯¹äºä»¥ä¸‹é™æ€æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">addAll</span><span class="params">(Collection&lt;? <span class="keyword">super</span> T&gt; c, T... elements)</span> </span>&#123; ... &#125;</span><br></pre></td></tr></table></figure>

<p><code>addAll()</code>æ–¹æ³•å¯ä»¥ç»™ä¸€ä¸ª<code>Collection</code>ç±»å‹çš„é›†åˆæ·»åŠ è‹¥å¹²å…ƒç´ ã€‚å› ä¸ºæ–¹æ³•ç­¾åæ˜¯<code>Collection</code>ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä¼ å…¥<code>List</code>ï¼Œ<code>Set</code>ç­‰å„ç§é›†åˆç±»å‹ã€‚</p>
<p><strong>åˆ›å»ºç©ºé›†åˆ</strong></p>
<p><code>Collections</code>æä¾›äº†ä¸€ç³»åˆ—æ–¹æ³•æ¥åˆ›å»ºç©ºé›†åˆï¼š</p>
<ul>
<li>åˆ›å»ºç©ºListï¼š<code>List&lt;T&gt; emptyList()</code></li>
<li>åˆ›å»ºç©ºMapï¼š<code>Map&lt;K, V&gt; emptyMap()</code></li>
<li>åˆ›å»ºç©ºSetï¼š<code>Set&lt;T&gt; emptySet()</code></li>
</ul>
<p>è¦æ³¨æ„åˆ°è¿”å›çš„ç©ºé›†åˆæ˜¯ä¸å¯å˜é›†åˆï¼Œæ— æ³•å‘å…¶ä¸­æ·»åŠ æˆ–åˆ é™¤å…ƒç´ ã€‚</p>
<p>æ­¤å¤–ï¼Œä¹Ÿå¯ä»¥ç”¨å„ä¸ªé›†åˆæ¥å£æä¾›çš„<code>of(T...)</code>æ–¹æ³•åˆ›å»ºç©ºé›†åˆã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹åˆ›å»ºç©º<code>List</code>çš„ä¸¤ä¸ªæ–¹æ³•æ˜¯ç­‰ä»·çš„ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">List&lt;String&gt; list1 = List.of();</span><br><span class="line">List&lt;String&gt; list2 = Collections.emptyList();</span><br></pre></td></tr></table></figure>

<p><strong>åˆ›å»ºå•å…ƒç´ é›†åˆ</strong></p>
<p><code>Collections</code>æä¾›äº†ä¸€ç³»åˆ—æ–¹æ³•æ¥åˆ›å»ºä¸€ä¸ªå•å…ƒç´ é›†åˆï¼š</p>
<ul>
<li>åˆ›å»ºä¸€ä¸ªå…ƒç´ çš„Listï¼š<code>List&lt;T&gt; singletonList(T o)</code></li>
<li>åˆ›å»ºä¸€ä¸ªå…ƒç´ çš„Mapï¼š<code>Map&lt;K, V&gt; singletonMap(K key, V value)</code></li>
<li>åˆ›å»ºä¸€ä¸ªå…ƒç´ çš„Setï¼š<code>Set&lt;T&gt; singleton(T o)</code></li>
</ul>
<p>è¿”å›çš„å•å…ƒç´ é›†åˆä¹Ÿæ˜¯ä¸å¯å˜é›†åˆï¼Œæ— æ³•å‘å…¶ä¸­æ·»åŠ æˆ–åˆ é™¤å…ƒç´ ã€‚</p>
<p>å®é™…ä¸Šï¼Œä½¿ç”¨<code>List.of(T...)</code>æ›´æ–¹ä¾¿ï¼Œå› ä¸ºå®ƒæ—¢å¯ä»¥åˆ›å»ºç©ºé›†åˆï¼Œä¹Ÿå¯ä»¥åˆ›å»ºå•å…ƒç´ é›†åˆï¼Œè¿˜å¯ä»¥åˆ›å»ºä»»æ„ä¸ªå…ƒç´ çš„é›†åˆï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">List&lt;String&gt; list1 = List.of(); <span class="comment">// empty list</span></span><br><span class="line">List&lt;String&gt; list2 = List.of(<span class="string">&quot;apple&quot;</span>); <span class="comment">// 1 element</span></span><br><span class="line">List&lt;String&gt; list3 = List.of(<span class="string">&quot;apple&quot;</span>, <span class="string">&quot;pear&quot;</span>); <span class="comment">// 2 elements</span></span><br><span class="line">List&lt;String&gt; list4 = List.of(<span class="string">&quot;apple&quot;</span>, <span class="string">&quot;pear&quot;</span>, <span class="string">&quot;orange&quot;</span>); <span class="comment">// 3 elements</span></span><br></pre></td></tr></table></figure>

<p><strong>æ’åº</strong></p>
<p><code>Collections</code>å¯ä»¥å¯¹<code>List</code>è¿›è¡Œæ’åºã€‚å› ä¸ºæ’åºä¼šç›´æ¥ä¿®æ”¹<code>List</code>å…ƒç´ çš„ä½ç½®ï¼Œå› æ­¤å¿…é¡»ä¼ å…¥å¯å˜<code>List</code>ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        List&lt;String&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        list.add(<span class="string">&quot;apple&quot;</span>);</span><br><span class="line">        list.add(<span class="string">&quot;pear&quot;</span>);</span><br><span class="line">        list.add(<span class="string">&quot;orange&quot;</span>);</span><br><span class="line">        <span class="comment">// æ’åºå‰:</span></span><br><span class="line">        System.out.println(list);</span><br><span class="line">        Collections.sort(list);</span><br><span class="line">        <span class="comment">// æ’åºå:</span></span><br><span class="line">        System.out.println(list);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>æ´—ç‰Œ</strong></p>
<p><code>Collections</code>æä¾›äº†æ´—ç‰Œç®—æ³•ï¼Œå³ä¼ å…¥ä¸€ä¸ªæœ‰åºçš„<code>List</code>ï¼Œå¯ä»¥éšæœºæ‰“ä¹±<code>List</code>å†…éƒ¨å…ƒç´ çš„é¡ºåºï¼Œæ•ˆæœç›¸å½“äºè®©è®¡ç®—æœºæ´—ç‰Œï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        List&lt;Integer&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">10</span>; i++) &#123;</span><br><span class="line">            list.add(i);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// æ´—ç‰Œå‰:</span></span><br><span class="line">        System.out.println(list);</span><br><span class="line">        Collections.shuffle(list);</span><br><span class="line">        <span class="comment">// æ´—ç‰Œå:</span></span><br><span class="line">        System.out.println(list);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>ä¸å¯å˜é›†åˆ</strong></p>
<p><code>Collections</code>è¿˜æä¾›äº†ä¸€ç»„æ–¹æ³•æŠŠå¯å˜é›†åˆå°è£…æˆä¸å¯å˜é›†åˆï¼š</p>
<ul>
<li>å°è£…æˆä¸å¯å˜Listï¼š<code>List&lt;T&gt; unmodifiableList(List&lt;? extends T&gt; list)</code></li>
<li>å°è£…æˆä¸å¯å˜Setï¼š<code>Set&lt;T&gt; unmodifiableSet(Set&lt;? extends T&gt; set)</code></li>
<li>å°è£…æˆä¸å¯å˜Mapï¼š<code>Map&lt;K, V&gt; unmodifiableMap(Map&lt;? extends K, ? extends V&gt; m)</code></li>
</ul>
<p>ä¾‹å¦‚ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        List&lt;String&gt; mutable = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        mutable.add(<span class="string">&quot;apple&quot;</span>);</span><br><span class="line">        mutable.add(<span class="string">&quot;pear&quot;</span>);</span><br><span class="line">        <span class="comment">// å˜ä¸ºä¸å¯å˜é›†åˆ:</span></span><br><span class="line">        List&lt;String&gt; immutable = Collections.unmodifiableList(mutable);</span><br><span class="line">        immutable.add(<span class="string">&quot;orange&quot;</span>); <span class="comment">// UnsupportedOperationException!</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç»§ç»­å¯¹åŸå§‹çš„å¯å˜<code>List</code>è¿›è¡Œå¢åˆ æ˜¯å¯ä»¥çš„ï¼Œå¹¶ä¸”ï¼Œä¼šç›´æ¥å½±å“åˆ°å°è£…åçš„â€œä¸å¯å˜â€<code>List</code>ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        List&lt;String&gt; mutable = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        mutable.add(<span class="string">&quot;apple&quot;</span>);</span><br><span class="line">        mutable.add(<span class="string">&quot;pear&quot;</span>);</span><br><span class="line">        <span class="comment">// å˜ä¸ºä¸å¯å˜é›†åˆ:</span></span><br><span class="line">        List&lt;String&gt; immutable = Collections.unmodifiableList(mutable);</span><br><span class="line">        mutable.add(<span class="string">&quot;orange&quot;</span>);</span><br><span class="line">        System.out.println(immutable);</span><br><span class="line">        <span class="comment">//&quot;apple&quot;,&quot;pear&quot;,&quot;orange&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœæˆ‘ä»¬å¸Œæœ›æŠŠä¸€ä¸ªå¯å˜<code>List</code>å°è£…æˆä¸å¯å˜<code>List</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        List&lt;String&gt; mutable = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        mutable.add(<span class="string">&quot;apple&quot;</span>);</span><br><span class="line">        mutable.add(<span class="string">&quot;pear&quot;</span>);</span><br><span class="line">        <span class="comment">// å˜ä¸ºä¸å¯å˜é›†åˆ:</span></span><br><span class="line">        List&lt;String&gt; immutable = Collections.unmodifiableList(mutable);</span><br><span class="line">        <span class="comment">// ç«‹åˆ»æ‰”æ‰mutableçš„å¼•ç”¨:</span></span><br><span class="line">        mutable = <span class="keyword">null</span>;</span><br><span class="line">        System.out.println(immutable);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

]]></content>
      <tags>
        <tag>JAVA</tag>
      </tags>
  </entry>
  <entry>
    <title>JAVA - é¢å‘å¯¹è±¡åŸºç¡€</title>
    <url>/2021/04/02/JAVA%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E5%9F%BA%E7%A1%80/</url>
    <content><![CDATA[<h1 id="JAVAé¢å‘å¯¹è±¡åŸºç¡€"><a href="#JAVAé¢å‘å¯¹è±¡åŸºç¡€" class="headerlink" title="JAVAé¢å‘å¯¹è±¡åŸºç¡€"></a>JAVAé¢å‘å¯¹è±¡åŸºç¡€</h1><p>æ„Ÿè°¢å»–é›ªå³°è€å¸ˆçš„æ•™ç¨‹ï¼</p>
<p><a href="https://www.liaoxuefeng.com/wiki/1252599548343744">JAVAæ•™ç¨‹</a></p>
<h2 id="1-æ–¹æ³•class"><a href="#1-æ–¹æ³•class" class="headerlink" title="1. æ–¹æ³•class"></a>1. æ–¹æ³•class</h2><p><code>class</code>ç”±<code>field</code>å’Œ<code>method</code>ç»„æˆã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">(String name)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>private</code>ä¿®é¥°çš„<code>field</code>æ— æ³•ç›´æ¥å¤–éƒ¨è®¿é—®ï¼Œä½†æ˜¯å¯ä»¥è¢«<code>method</code>æ¥è®¿é—®ä»¥åŠä¿®æ”¹ã€‚</p>
<p>åœ¨æ–¹æ³•å†…éƒ¨ï¼Œå¯ä»¥ä½¿ç”¨ä¸€ä¸ªéšå«çš„å˜é‡<code>this</code>ï¼Œå®ƒå§‹ç»ˆæŒ‡å‘å½“å‰å®ä¾‹ã€‚å› æ­¤ï¼Œé€šè¿‡<code>this.field</code>å°±å¯ä»¥è®¿é—®å½“å‰å®ä¾‹çš„å­—æ®µã€‚</p>
<p>å¯å˜å‚æ•°ç”¨<code>ç±»å‹...</code>å®šä¹‰ï¼Œå¯å˜å‚æ•°ç›¸å½“äºæ•°ç»„ç±»å‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Group</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String[] names;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setNames</span><span class="params">(String... names)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.names = names;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Group g = <span class="keyword">new</span> Group();</span><br><span class="line">g.setNames(<span class="string">&quot;Xiao Ming&quot;</span>, <span class="string">&quot;Xiao Hong&quot;</span>, <span class="string">&quot;Xiao Jun&quot;</span>); <span class="comment">// ä¼ å…¥3ä¸ªString</span></span><br><span class="line">g.setNames(<span class="string">&quot;Xiao Ming&quot;</span>, <span class="string">&quot;Xiao Hong&quot;</span>); <span class="comment">// ä¼ å…¥2ä¸ªString</span></span><br><span class="line">g.setNames(<span class="string">&quot;Xiao Ming&quot;</span>); <span class="comment">// ä¼ å…¥1ä¸ªString</span></span><br><span class="line">g.setNames(); <span class="comment">// ä¼ å…¥0ä¸ªString</span></span><br></pre></td></tr></table></figure>

<h2 id="2-æ„é€ æ–¹æ³•"><a href="#2-æ„é€ æ–¹æ³•" class="headerlink" title="2. æ„é€ æ–¹æ³•"></a>2. æ„é€ æ–¹æ³•</h2><p>åˆ›å»ºå®ä¾‹çš„æ—¶å€™ï¼Œå®é™…ä¸Šæ˜¯é€šè¿‡æ„é€ æ–¹æ³•æ¥åˆå§‹åŒ–å®ä¾‹çš„ã€‚æˆ‘ä»¬å…ˆæ¥å®šä¹‰ä¸€ä¸ªæ„é€ æ–¹æ³•ï¼Œèƒ½åœ¨åˆ›å»º<code>Person</code>å®ä¾‹çš„æ—¶å€™ï¼Œä¸€æ¬¡æ€§ä¼ å…¥<code>name</code>å’Œ<code>age</code>ï¼Œå®Œæˆåˆå§‹åŒ–ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Person</span><span class="params">(String name, <span class="keyword">int</span> age)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getAge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.age;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>é€šè¿‡<code>Person p = new Person(&quot;Xiao Ming&quot;, 15);</code>ä½¿ç”¨æ„é€ å‡½æ•°å®Œæˆåˆå§‹åŒ–ã€‚</p>
<p>å¦‚æœæ²¡æœ‰æ„é€ æ–¹æ³•ï¼Œç¼–è¯‘å™¨ä¼šç”Ÿæˆé»˜è®¤çš„æ„é€ æ–¹æ³•ã€‚</p>
<p>å¯ä»¥åœ¨ä¸€ä¸ªç±»ä¸­å®šä¹‰å¤šä¸ªæ„é€ æ–¹æ³•ï¼ŒåŒæ—¶ä¸åŒæ„é€ æ–¹æ³•ä¹‹é—´ä¹Ÿå¯ä»¥ç›¸äº’è°ƒç”¨ã€‚</p>
<h2 id="3-æ–¹æ³•é‡è½½ï¼ˆoverloadï¼‰"><a href="#3-æ–¹æ³•é‡è½½ï¼ˆoverloadï¼‰" class="headerlink" title="3.æ–¹æ³•é‡è½½ï¼ˆoverloadï¼‰"></a>3.æ–¹æ³•é‡è½½ï¼ˆoverloadï¼‰</h2><p>å®šä¹‰åŒåæ–¹æ³•ï¼Œä½†æ˜¯å‚æ•°ä¸åŒï¼Œå«åšæ–¹æ³•é‡è½½ã€‚</p>
<p>ä¾‹å¦‚ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Hello</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">hello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Hello, world!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">hello</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Hello, &quot;</span> + name + <span class="string">&quot;!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">hello</span><span class="params">(String name, <span class="keyword">int</span> age)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (age &lt; <span class="number">18</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Hi, &quot;</span> + name + <span class="string">&quot;!&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Hello, &quot;</span> + name + <span class="string">&quot;!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="4-ç»§æ‰¿"><a href="#4-ç»§æ‰¿" class="headerlink" title="4. ç»§æ‰¿"></a>4. ç»§æ‰¿</h2><p>ç»§æ‰¿æ˜¯é¢å‘å¯¹è±¡ç¼–ç¨‹ä¸­éå¸¸å¼ºå¤§çš„ä¸€ç§æœºåˆ¶ï¼Œå®ƒé¦–å…ˆå¯ä»¥å¤ç”¨ä»£ç ã€‚å½“æˆ‘ä»¬è®©<code>Student</code>ä»<code>Person</code>ç»§æ‰¿æ—¶ï¼Œ<code>Student</code>å°±è·å¾—äº†<code>Person</code>çš„æ‰€æœ‰åŠŸèƒ½ï¼Œæˆ‘ä»¬åªéœ€è¦ä¸º<code>Student</code>ç¼–å†™æ–°å¢çš„åŠŸèƒ½ã€‚</p>
<p><strong>extends</strong></p>
<p>Javaä½¿ç”¨<code>extends</code>å…³é”®å­—æ¥å®ç°ç»§æ‰¿ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;...&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;...&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getAge</span><span class="params">()</span> </span>&#123;...&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAge</span><span class="params">(<span class="keyword">int</span> age)</span> </span>&#123;...&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span> <span class="keyword">extends</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ä¸è¦é‡å¤nameå’Œageå­—æ®µ/æ–¹æ³•,</span></span><br><span class="line">    <span class="comment">// åªéœ€è¦å®šä¹‰æ–°å¢scoreå­—æ®µ/æ–¹æ³•:</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> score;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getScore</span><span class="params">()</span> </span>&#123; â€¦ &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setScore</span><span class="params">(<span class="keyword">int</span> score)</span> </span>&#123; â€¦ &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>protected</strong><br>ç»§æ‰¿æœ‰ä¸ªç‰¹ç‚¹ï¼Œå°±æ˜¯å­ç±»æ— æ³•è®¿é—®çˆ¶ç±»çš„<code>private</code>å­—æ®µæˆ–è€…<code>private</code>æ–¹æ³•ã€‚ä¾‹å¦‚ï¼Œ<code>Student</code>ç±»å°±æ— æ³•è®¿é—®<code>Person</code>ç±»çš„<code>name</code>å’Œ<code>age</code>å­—æ®µï¼š</p>
<p>æˆ‘ä»¬éœ€è¦æŠŠ<code>private</code>æ”¹ä¸º<code>protected</code>ã€‚ç”¨<code>protected</code>ä¿®é¥°çš„å­—æ®µå¯ä»¥è¢«å­ç±»è®¿é—®</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> String name;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">int</span> age;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span> <span class="keyword">extends</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">hello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Hello, &quot;</span> + name; <span class="comment">// OK!</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>super</strong><br>superå…³é”®å­—è¡¨ç¤ºçˆ¶ç±»ï¼ˆè¶…ç±»ï¼‰ã€‚å­ç±»å¼•ç”¨çˆ¶ç±»çš„å­—æ®µæ—¶ï¼Œå¯ä»¥ç”¨<code>super.fieldName</code>ã€‚<br>è¿™æ˜¯å› ä¸ºåœ¨Javaä¸­ï¼Œä»»ä½•classçš„æ„é€ æ–¹æ³•ï¼Œç¬¬ä¸€è¡Œè¯­å¥å¿…é¡»æ˜¯è°ƒç”¨çˆ¶ç±»çš„æ„é€ æ–¹æ³•ã€‚å¦‚æœæ²¡æœ‰æ˜ç¡®åœ°è°ƒç”¨çˆ¶ç±»çš„æ„é€ æ–¹æ³•ï¼Œç¼–è¯‘å™¨ä¼šå¸®æˆ‘ä»¬è‡ªåŠ¨åŠ ä¸€å¥super();ï¼Œæ‰€ä»¥ï¼ŒStudentç±»çš„æ„é€ æ–¹æ³•å®é™…ä¸Šæ˜¯è¿™æ ·ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span> <span class="keyword">extends</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">int</span> score;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Student</span><span class="params">(String name, <span class="keyword">int</span> age, <span class="keyword">int</span> score)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(name, age); <span class="comment">// è°ƒç”¨çˆ¶ç±»çš„æ„é€ æ–¹æ³•Person(String, int)</span></span><br><span class="line">        <span class="keyword">this</span>.score = score;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>é˜»æ­¢ç»§æ‰¿ï¼ˆJAVA15ï¼‰</strong></p>
<p>æ­£å¸¸æƒ…å†µä¸‹ï¼Œåªè¦æŸä¸ªclassæ²¡æœ‰<code>final</code>ä¿®é¥°ç¬¦ï¼Œé‚£ä¹ˆä»»ä½•ç±»éƒ½å¯ä»¥ä»è¯¥classç»§æ‰¿ã€‚</p>
<p>ä»Java 15å¼€å§‹ï¼Œå…è®¸ä½¿ç”¨<code>sealed</code>ä¿®é¥°classï¼Œå¹¶é€šè¿‡<code>permits</code>æ˜ç¡®å†™å‡ºèƒ½å¤Ÿä»è¯¥classç»§æ‰¿çš„å­ç±»åç§°ã€‚</p>
<p>ä¾‹å¦‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> sealed <span class="class"><span class="keyword">class</span> <span class="title">Shape</span> <span class="title">permits</span> <span class="title">Rect</span>, <span class="title">Circle</span>, <span class="title">Triangle</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¡¨ç¤º<code>Shape</code>åªèƒ½è¢«<code>Rect</code>ã€<code>Circle</code>ã€<code>Triangle</code>ç»§æ‰¿ã€‚</p>
<p><strong>å‘ä¸‹è½¬å‹</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Person p1 = <span class="keyword">new</span> Student(); <span class="comment">// upcasting, ok</span></span><br><span class="line">Person p2 = <span class="keyword">new</span> Person();</span><br><span class="line">Student s1 = (Student) p1; <span class="comment">// ok</span></span><br><span class="line">Student s2 = (Student) p2; <span class="comment">// runtime error! ClassCastException!</span></span><br></pre></td></tr></table></figure>

<p>ä¸ºäº†é¿å…Errorï¼Œå¯ä»¥ä½¿ç”¨<code>instanceof</code>æ“ä½œç¬¦æ¥åˆ¤æ–­æŸä¸ªå®ä¾‹ç©¶ç«Ÿæ˜¯ä¸æ˜¯æŸç§ç±»ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Person p = <span class="keyword">new</span> Person();</span><br><span class="line">System.out.println(p <span class="keyword">instanceof</span> Person); <span class="comment">// true</span></span><br><span class="line">System.out.println(p <span class="keyword">instanceof</span> Student); <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line">Student s = <span class="keyword">new</span> Student();</span><br><span class="line">System.out.println(s <span class="keyword">instanceof</span> Person); <span class="comment">// true</span></span><br><span class="line">System.out.println(s <span class="keyword">instanceof</span> Student); <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line">Student n = <span class="keyword">null</span>;</span><br><span class="line">System.out.println(n <span class="keyword">instanceof</span> Student); <span class="comment">// false</span></span><br></pre></td></tr></table></figure>

<p>åœ¨<strong>java14</strong>åï¼Œåˆ¤æ–­åå¯ä»¥ç›´æ¥è½¬å‹æˆæŒ‡å®šå˜é‡ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Object obj = <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span> (obj <span class="keyword">instanceof</span> String s) &#123;</span><br><span class="line">            <span class="comment">// å¯ä»¥ç›´æ¥ä½¿ç”¨å˜é‡s:</span></span><br><span class="line">            System.out.println(s.toUpperCase());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·æ›´ç®€æ´ã€‚</p>
<h2 id="5-å¤šæ€"><a href="#5-å¤šæ€" class="headerlink" title="5. å¤šæ€"></a>5. å¤šæ€</h2><p>åœ¨ç»§æ‰¿å…³ç³»ä¸­ï¼Œå­ç±»å¦‚æœå®šä¹‰äº†ä¸€ä¸ªä¸çˆ¶ç±»æ–¹æ³•ç­¾åå®Œå…¨ç›¸åŒçš„æ–¹æ³•ï¼Œè¢«ç§°ä¸º<strong>è¦†å†™ï¼ˆOverrideï¼‰</strong>ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Person.run&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span> <span class="keyword">extends</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Student.run&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>æ³¨æ„ï¼šæ–¹æ³•åç›¸åŒï¼Œæ–¹æ³•å‚æ•°ç›¸åŒï¼Œä½†æ–¹æ³•è¿”å›å€¼ä¸åŒï¼Œä¹Ÿæ˜¯ä¸åŒçš„æ–¹æ³•ã€‚åœ¨Javaç¨‹åºä¸­ï¼Œå‡ºç°è¿™ç§æƒ…å†µï¼Œç¼–è¯‘å™¨ä¼šæŠ¥é”™ã€‚</p>
</blockquote>
<p><strong>å¤šæ€</strong>æ˜¯æŒ‡ï¼Œé’ˆå¯¹æŸä¸ªç±»å‹çš„æ–¹æ³•è°ƒç”¨ï¼Œå…¶çœŸæ­£æ‰§è¡Œçš„æ–¹æ³•å–å†³äºè¿è¡Œæ—¶æœŸå®é™…ç±»å‹çš„æ–¹æ³•ã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ç»™ä¸€ä¸ªæœ‰æ™®é€šæ”¶å…¥ã€å·¥èµ„æ”¶å…¥å’Œäº«å—å›½åŠ¡é™¢ç‰¹æ®Šæ´¥è´´çš„å°ä¼™ä¼´ç®—ç¨:</span></span><br><span class="line">        Income[] incomes = <span class="keyword">new</span> Income[] &#123;</span><br><span class="line">            <span class="keyword">new</span> Income(<span class="number">3000</span>),</span><br><span class="line">            <span class="keyword">new</span> Salary(<span class="number">7500</span>),</span><br><span class="line">            <span class="keyword">new</span> StateCouncilSpecialAllowance(<span class="number">15000</span>)</span><br><span class="line">        &#125;;</span><br><span class="line">        System.out.println(totalTax(incomes));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">double</span> <span class="title">totalTax</span><span class="params">(Income... incomes)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">double</span> total = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (Income income: incomes) &#123;</span><br><span class="line">            total = total + income.getTax();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> total;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Income</span> </span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">double</span> income;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Income</span><span class="params">(<span class="keyword">double</span> income)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.income = income;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">getTax</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> income * <span class="number">0.1</span>; <span class="comment">// ç¨ç‡10%</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Salary</span> <span class="keyword">extends</span> <span class="title">Income</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Salary</span><span class="params">(<span class="keyword">double</span> income)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(income);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">getTax</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (income &lt;= <span class="number">5000</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> (income - <span class="number">5000</span>) * <span class="number">0.2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StateCouncilSpecialAllowance</span> <span class="keyword">extends</span> <span class="title">Income</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">StateCouncilSpecialAllowance</span><span class="params">(<span class="keyword">double</span> income)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(income);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">getTax</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å…·ä½“å®ä¾‹è°ƒç”¨æ—¶é€‰æ‹©çš„æ–¹æ³•æ˜¯å®ä¾‹è‡ªå·±çš„<code>getTax()</code></p>
<p><strong>è¦†å†™Objectæ–¹æ³•</strong></p>
<p>å› ä¸ºæ‰€æœ‰çš„<code>class</code>æœ€ç»ˆéƒ½ç»§æ‰¿è‡ª<code>Object</code>ï¼Œè€Œ<code>Object</code>å®šä¹‰äº†å‡ ä¸ªé‡è¦çš„æ–¹æ³•ï¼š</p>
<ul>
<li><code>toString()</code>ï¼šæŠŠinstanceè¾“å‡ºä¸º<code>String</code>ï¼›</li>
<li><code>equals()</code>ï¼šåˆ¤æ–­ä¸¤ä¸ªinstanceæ˜¯å¦é€»è¾‘ç›¸ç­‰ï¼›</li>
<li><code>hashCode()</code>ï¼šè®¡ç®—ä¸€ä¸ªinstanceçš„å“ˆå¸Œå€¼ã€‚</li>
</ul>
<p>åœ¨å¿…è¦çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥è¦†å†™<code>Object</code>çš„è¿™å‡ ä¸ªæ–¹æ³•ã€‚</p>
<p><strong>è°ƒç”¨super</strong></p>
<p>åœ¨å­ç±»çš„è¦†å†™æ–¹æ³•ä¸­ï¼Œå¦‚æœè¦è°ƒç”¨çˆ¶ç±»çš„è¢«è¦†å†™çš„æ–¹æ³•ï¼Œå¯ä»¥é€šè¿‡<code>super</code>æ¥è°ƒç”¨ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> String name;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">hello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Hello, &quot;</span> + name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Student extends Person &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">hello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// è°ƒç”¨çˆ¶ç±»çš„hello()æ–¹æ³•:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.hello() + <span class="string">&quot;!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>final</strong></p>
<p>ç»§æ‰¿å¯ä»¥å…è®¸å­ç±»è¦†å†™çˆ¶ç±»çš„æ–¹æ³•ã€‚å¦‚æœä¸€ä¸ªçˆ¶ç±»<strong>ä¸å…è®¸å­ç±»å¯¹å®ƒçš„æŸä¸ªæ–¹æ³•è¿›è¡Œè¦†å†™</strong>ï¼Œå¯ä»¥æŠŠè¯¥æ–¹æ³•æ ‡è®°ä¸º<code>final</code>ã€‚ç”¨<code>final</code>ä¿®é¥°çš„æ–¹æ³•ä¸èƒ½è¢«<code>Override</code></p>
<p>å¦‚æœä¸€ä¸ªç±»<strong>ä¸å¸Œæœ›ä»»ä½•å…¶ä»–ç±»ç»§æ‰¿</strong>è‡ªå®ƒï¼Œé‚£ä¹ˆå¯ä»¥æŠŠè¿™ä¸ªç±»æœ¬èº«æ ‡è®°ä¸º<code>final</code>ã€‚ç”¨<code>final</code>ä¿®é¥°çš„ç±»ä¸èƒ½è¢«ç»§æ‰¿ï¼š</p>
<p>å¯¹äºä¸€ä¸ªç±»çš„<strong>å®ä¾‹å­—æ®µ</strong>ï¼ŒåŒæ ·å¯ä»¥ç”¨<code>final</code>ä¿®é¥°ã€‚ç”¨<code>final</code>ä¿®é¥°çš„å­—æ®µåœ¨<strong>åˆå§‹åŒ–åä¸èƒ½è¢«ä¿®æ”¹</strong>ã€‚</p>
<h2 id="6-æŠ½è±¡ç±»"><a href="#6-æŠ½è±¡ç±»" class="headerlink" title="6.æŠ½è±¡ç±»"></a>6.æŠ½è±¡ç±»</h2><p>å¦‚æœçˆ¶ç±»çš„æ–¹æ³•æœ¬èº«ä¸éœ€è¦å®ç°ä»»ä½•åŠŸèƒ½ï¼Œä»…ä»…æ˜¯ä¸ºäº†å®šä¹‰æ–¹æ³•ç­¾åï¼Œç›®çš„æ˜¯è®©å­ç±»å»è¦†å†™å®ƒï¼Œé‚£ä¹ˆï¼Œå¯ä»¥æŠŠçˆ¶ç±»çš„æ–¹æ³•å£°æ˜ä¸ºæŠ½è±¡æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p><strong>ç±»å’Œæ–¹æ³•éƒ½å¿…é¡»æ ‡æ³¨å‡º<code>abstract</code></strong></p>
</li>
<li><p><strong>è¡¨æ˜æŠ½è±¡æ–¹æ³•å’ŒæŠ½è±¡ç±»åï¼Œè¯¥ç±»æ— æ³•å®ä¾‹åŒ–</strong>ã€‚</p>
</li>
<li><p><strong>æŠ½è±¡ç±»çš„å­ç±»å¿…é¡»é‡å†™æŠ½è±¡æ–¹æ³•</strong></p>
</li>
<li><p><strong>å¼•ç”¨ç±»æ—¶å°½é‡å¼•ç”¨é«˜å±‚ç±»å‹ï¼Œé¿å…ä½¿ç”¨å®é™…å­ç±»å‹ã€‚</strong></p>
</li>
</ul>
<h2 id="7-æ¥å£"><a href="#7-æ¥å£" class="headerlink" title="7. æ¥å£"></a>7. æ¥å£</h2><p>å¦‚æœä¸€ä¸ªæŠ½è±¡ç±»æ²¡æœ‰å­—æ®µï¼Œæ‰€æœ‰æ–¹æ³•å…¨éƒ¨éƒ½æ˜¯æŠ½è±¡æ–¹æ³•ï¼Œå°±å¯ä»¥æŠŠè¯¥æŠ½è±¡ç±»æ”¹å†™ä¸ºæ¥å£ï¼š<code>interface</code>ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function">String <span class="title">getName</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å› ä¸ºæ¥å£å®šä¹‰çš„æ‰€æœ‰æ–¹æ³•é»˜è®¤éƒ½æ˜¯<code>public abstract</code>çš„ï¼Œæ‰€ä»¥è¿™ä¸¤ä¸ªä¿®é¥°ç¬¦ä¸éœ€è¦å†™å‡ºæ¥ã€‚</p>
<p>å½“ä¸€ä¸ªå…·ä½“çš„<code>class</code>å»å®ç°ä¸€ä¸ª<code>interface</code>æ—¶ï¼Œéœ€è¦ä½¿ç”¨<code>implements</code>å…³é”®å­—ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span> <span class="keyword">implements</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Student</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="keyword">this</span>.name + <span class="string">&quot; run&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸€ä¸ªç±»å¯ä»¥å®ç°å¤šä¸ª<code>interface</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span> <span class="keyword">implements</span> <span class="title">Person</span>, <span class="title">Hello</span> </span>&#123; <span class="comment">// å®ç°äº†ä¸¤ä¸ªinterface</span></span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th align="center"></th>
<th>abstract class</th>
<th>interface</th>
</tr>
</thead>
<tbody><tr>
<td align="center">ç»§æ‰¿</td>
<td>åªèƒ½extendä¸€ä¸ªclass</td>
<td>å¯ä»¥implementså¤šä¸ªinterface</td>
</tr>
<tr>
<td align="center">å­—æ®µ</td>
<td>å¯ä»¥å®šä¹‰å®ä¾‹å­—æ®µ</td>
<td>ä¸èƒ½å®šä¹‰å®ä¾‹å­—æ®µ</td>
</tr>
<tr>
<td align="center">æŠ½è±¡æ–¹æ³•</td>
<td>å¯ä»¥å®šä¹‰æŠ½è±¡æ–¹æ³•</td>
<td>å¯ä»¥å®šä¹‰æŠ½è±¡æ–¹æ³•</td>
</tr>
<tr>
<td align="center">éæŠ½è±¡æ–¹æ³•</td>
<td>å¯ä»¥å®šä¹‰éæŠ½è±¡æ–¹æ³•</td>
<td>å¯ä»¥å®šä¹‰<code>default</code>æ–¹æ³•</td>
</tr>
</tbody></table>
<p> <strong><code>default</code>æ–¹æ³•:</strong></p>
 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="function">String <span class="title">getName</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">default</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(getName() + <span class="string">&quot; run&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> å®ç°ç±»å¯ä»¥ä¸ç”¨é‡å†™defaultæ–¹æ³•ã€‚</p>
<p><strong>ç»§æ‰¿å…³ç³»ï¼š</strong></p>
<p><img src="https://raw.githubusercontent.com/ghj1998/image_repository/main/%E7%BB%A7%E6%89%BF%E5%85%B3%E7%B3%BB.png" alt="image-20210321205845624"></p>
<h2 id="8-é™æ€å­—æ®µå’Œé™æ€æ–¹æ³•"><a href="#8-é™æ€å­—æ®µå’Œé™æ€æ–¹æ³•" class="headerlink" title="8.é™æ€å­—æ®µå’Œé™æ€æ–¹æ³•"></a>8.é™æ€å­—æ®µå’Œé™æ€æ–¹æ³•</h2><p>ç”¨<code>static</code>ä¿®é¥°çš„å­—æ®µï¼Œç§°ä¸ºé™æ€å­—æ®µï¼š<code>static field</code>ã€‚</p>
<p>é™æ€å­—æ®µé€šå¸¸ä½¿ç”¨ <code>ç±»å.é™æ€å­—æ®µ</code>è®¿é—®é™æ€å¯¹è±¡ã€‚</p>
<p><img src="https://raw.githubusercontent.com/ghj1998/image_repository/main/%E9%9D%99%E6%80%81%E5%AD%97%E6%AE%B5.png" alt="image-20210321210415333"></p>
<p>æ‰€æœ‰å®ä¾‹å’Œç±»å…±äº«åŒä¸€ä¸ªé™æ€å­—æ®µã€‚</p>
<p>é™æ€æ–¹æ³•ä¹Ÿæ˜¯ç›¸åŒçš„ã€‚ç”¨<code>static</code>ä¿®é¥°çš„æ–¹æ³•ç§°ä¸ºé™æ€æ–¹æ³•ã€‚é€šè¿‡ç±»åå¯ä»¥è°ƒç”¨é™æ€æ–¹æ³•ã€‚</p>
<p>é™æ€æ–¹æ³•ç»å¸¸ç”¨äºå·¥å…·ç±»ï¼Œä¾‹å¦‚<code>Arrays.sort()</code>,<code>Math.random()</code></p>
<p><code>interface</code>  æ˜¯æŠ½è±¡ç±»ï¼Œä¸èƒ½å®šä¹‰å®ä¾‹å­—æ®µï¼Œä½†æ˜¯å¯ä»¥å®šä¹‰é™æ€å­—æ®µã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MALE = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> FEMALE = <span class="number">2</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>public static final</code>å¯ä»¥ä¸ç”¨å†™ï¼Œé»˜è®¤ä¸º<code>public static final</code>ã€‚</p>
<h2 id="9-åŒ…"><a href="#9-åŒ…" class="headerlink" title="9. åŒ…"></a>9. åŒ…</h2><p>Javaå®šä¹‰äº†ä¸€ç§åå­—ç©ºé—´ï¼Œç§°ä¹‹ä¸ºåŒ…ï¼š<code>package</code>ã€‚ä¸€ä¸ªç±»æ€»æ˜¯å±äºæŸä¸ªåŒ…ï¼Œç±»åï¼ˆæ¯”å¦‚<code>Person</code>ï¼‰åªæ˜¯ä¸€ä¸ªç®€å†™ï¼ŒçœŸæ­£çš„å®Œæ•´ç±»åæ˜¯<code>åŒ…å.ç±»å</code>ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> ming; <span class="comment">// ç”³æ˜åŒ…åming</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åŒ…åä¸åŒï¼Œç±»å°±ä¸åŒã€‚ä¾‹å¦‚<code>ming.Person</code>å’Œ<code>hong.Person</code>æ˜¯ä¸¤ä¸ªä¸åŒçš„ç±»ã€‚</p>
<p>åŒ…å¯ä»¥æ˜¯å¤šå±‚ç»“æ„ï¼Œç”¨<code>.</code>éš”å¼€ã€‚ä¾‹å¦‚ï¼š<code>java.util</code>ã€‚</p>
<p>åŒ…æ²¡æœ‰çˆ¶å­å…³ç³»ã€‚<code>java.util</code>å’Œ<code>java.util.zip</code>æ˜¯ä¸åŒçš„åŒ…ï¼Œä¸¤è€…æ²¡æœ‰ä»»ä½•ç»§æ‰¿å…³ç³»ã€‚</p>
<p>è¿˜éœ€è¦æŒ‰ç…§åŒ…ç»“æ„æŠŠä¸Šé¢çš„Javaæ–‡ä»¶ç»„ç»‡èµ·æ¥ã€‚</p>
<p><img src="https://raw.githubusercontent.com/ghj1998/image_repository/main/%E7%9B%AE%E5%BD%95%E5%92%8C%E5%8C%85.png" alt="image-20210321211340003"></p>
<p>ä½äºåŒä¸€ä¸ªåŒ…çš„ç±»ï¼Œå¯ä»¥è®¿é—®åŒ…ä½œç”¨åŸŸçš„å­—æ®µå’Œæ–¹æ³•ã€‚</p>
<p><strong>import</strong></p>
<p>åœ¨ä¸€ä¸ª<code>class</code>ä¸­ï¼Œæˆ‘ä»¬æ€»ä¼šå¼•ç”¨å…¶ä»–çš„<code>class</code>ã€‚</p>
<p>æœ‰<strong>ä¸‰ç§å†™æ³•</strong>ï¼š</p>
<ol>
<li><p>ç›´æ¥å†™å‡ºå®Œæ•´ç±»åã€‚<code>mr.jun.Arrays arrays = new mr.jun.Arrays();</code></p>
</li>
<li><p>ä½¿ç”¨importè¯­å¥ã€‚<code>import mr.jun.Arrays;Arrays arrays = new Arrays();</code>åŒæ—¶å¯ä»¥ç›´æ¥*å°†åŒ…ä¸‹é¢çš„æ‰€æœ‰<code>class</code>éƒ½å¯¼å…¥è¿›æ¥ã€‚</p>
</li>
<li><p><code>import static</code>å¯¼å…¥ä¸€ä¸ªç±»çš„é™æ€å­—æ®µå’Œé™æ€æ–¹æ³•ã€‚</p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯¼å…¥Systemç±»çš„æ‰€æœ‰é™æ€å­—æ®µå’Œé™æ€æ–¹æ³•:</span></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> java.lang.System.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ç›¸å½“äºè°ƒç”¨System.out.println(â€¦)</span></span><br><span class="line">        out.println(<span class="string">&quot;Hello, world!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>æŸ¥æ‰¾é¡ºåºï¼š</strong></p>
<ul>
<li>å¦‚æœæ˜¯å®Œæ•´ç±»åï¼Œå°±ç›´æ¥æ ¹æ®å®Œæ•´ç±»åæŸ¥æ‰¾è¿™ä¸ª<code>class</code>ï¼›</li>
<li>å¦‚æœæ˜¯ç®€å•ç±»åï¼ŒæŒ‰ä¸‹é¢çš„é¡ºåºä¾æ¬¡æŸ¥æ‰¾ï¼š<ul>
<li>æŸ¥æ‰¾å½“å‰<code>package</code>æ˜¯å¦å­˜åœ¨è¿™ä¸ª<code>class</code>ï¼›</li>
<li>æŸ¥æ‰¾<code>import</code>çš„åŒ…æ˜¯å¦åŒ…å«è¿™ä¸ª<code>class</code>ï¼›</li>
<li>æŸ¥æ‰¾<code>java.lang</code>åŒ…æ˜¯å¦åŒ…å«è¿™ä¸ª<code>class</code>ã€‚</li>
</ul>
</li>
</ul>
<p><strong>æœ€ä½³å®è·µ</strong></p>
<p>æœ€å¥½ä½¿ç”¨å€’ç½®çš„åŸŸåæ¥ç¡®ä¿å”¯ä¸€æ€§ã€‚ä¾‹å¦‚</p>
<ul>
<li><code>org.apache</code></li>
<li><code>org.apache.commons.log</code></li>
<li><code>com.liaoxuefeng.sample</code></li>
</ul>
<h2 id="10-ä½œç”¨åŸŸ"><a href="#10-ä½œç”¨åŸŸ" class="headerlink" title="10. ä½œç”¨åŸŸ"></a>10. ä½œç”¨åŸŸ</h2><p><strong>private</strong></p>
<p>å®šä¹‰ä¸º<code>public</code>çš„<code>class</code>ã€<code>interface</code>å¯ä»¥è¢«å…¶ä»–ä»»ä½•ç±»è®¿é—®ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> abc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Hello</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">hi</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> xyz;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">foo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Mainå¯ä»¥è®¿é—®Hello</span></span><br><span class="line">        Hello h = <span class="keyword">new</span> Hello();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å®šä¹‰ä¸º<code>public</code>çš„<code>field</code>ã€<code>method</code>å¯ä»¥è¢«å…¶ä»–ç±»è®¿é—®ï¼Œå‰ææ˜¯é¦–å…ˆæœ‰è®¿é—®<code>class</code>çš„æƒé™ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> abc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Hello</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">hi</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> xyz;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">foo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Hello h = <span class="keyword">new</span> Hello();</span><br><span class="line">        h.hi();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>private</strong></p>
<p>å®šä¹‰ä¸º<code>private</code>çš„<code>field</code>ã€<code>method</code>æ— æ³•è¢«å…¶ä»–ç±»è®¿é—®ï¼š</p>
<p>å¦‚æœä¸€ä¸ªç±»å†…éƒ¨è¿˜å®šä¹‰äº†åµŒå¥—ç±»ï¼Œé‚£ä¹ˆï¼ŒåµŒå¥—ç±»æ‹¥æœ‰è®¿é—®<code>private</code>çš„æƒé™</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> abc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Hello</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ä¸èƒ½è¢«å…¶ä»–ç±»è°ƒç”¨:</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">hi</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">hello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.hi();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>protected</strong></p>
<p><code>protected</code>ä½œç”¨äºç»§æ‰¿å…³ç³»ã€‚å®šä¹‰ä¸º<code>protected</code>çš„å­—æ®µå’Œæ–¹æ³•å¯ä»¥è¢«å­ç±»è®¿é—®ï¼Œä»¥åŠå­ç±»çš„å­ç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> abc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Hello</span> </span>&#123;</span><br><span class="line">    <span class="comment">// protectedæ–¹æ³•:</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">hi</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> xyz;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Main</span> <span class="keyword">extends</span> <span class="title">Hello</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">foo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// å¯ä»¥è®¿é—®protectedæ–¹æ³•:</span></span><br><span class="line">        hi();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>package</strong></p>
<p>åŒ…ä½œç”¨åŸŸæ˜¯æŒ‡ä¸€ä¸ªç±»å…è®¸è®¿é—®åŒä¸€ä¸ª<code>package</code>çš„æ²¡æœ‰<code>public</code>ã€<code>private</code>ä¿®é¥°çš„<code>class</code>ï¼Œä»¥åŠæ²¡æœ‰<code>public</code>ã€<code>protected</code>ã€<code>private</code>ä¿®é¥°çš„å­—æ®µå’Œæ–¹æ³•ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> abc;</span><br><span class="line"><span class="comment">// packageæƒé™çš„ç±»:</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Hello</span> </span>&#123;</span><br><span class="line">    <span class="comment">// packageæƒé™çš„æ–¹æ³•:</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">hi</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> abc;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">foo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// å¯ä»¥è®¿é—®packageæƒé™çš„ç±»:</span></span><br><span class="line">        Hello h = <span class="keyword">new</span> Hello();</span><br><span class="line">        <span class="comment">// å¯ä»¥è°ƒç”¨packageæƒé™çš„æ–¹æ³•:</span></span><br><span class="line">        h.hi();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>å±€éƒ¨å˜é‡</strong></p>
<p>åœ¨æ–¹æ³•å†…éƒ¨å®šä¹‰çš„å˜é‡ç§°ä¸ºå±€éƒ¨å˜é‡ï¼Œå±€éƒ¨å˜é‡ä½œç”¨åŸŸä»å˜é‡å£°æ˜å¤„å¼€å§‹åˆ°å¯¹åº”çš„å—ç»“æŸã€‚æ–¹æ³•å‚æ•°ä¹Ÿæ˜¯å±€éƒ¨å˜é‡ã€‚</p>
<p><strong>final</strong></p>
<p>ç”¨<code>final</code>ä¿®é¥°<code>class</code>å¯ä»¥é˜»æ­¢è¢«ç»§æ‰¿ã€‚</p>
<p>ç”¨<code>final</code>ä¿®é¥°<code>method</code>å¯ä»¥é˜»æ­¢è¢«å­ç±»è¦†å†™ã€‚</p>
<p>ç”¨<code>final</code>ä¿®é¥°<code>field</code>å¯ä»¥é˜»æ­¢è¢«é‡æ–°èµ‹å€¼ã€‚</p>
<p>ç”¨<code>final</code>ä¿®é¥°å±€éƒ¨å˜é‡å¯ä»¥é˜»æ­¢è¢«é‡æ–°èµ‹å€¼ã€‚</p>
<p><strong>æ€»ç»“</strong></p>
<p>å¦‚æœä¸ç¡®å®šæ˜¯å¦éœ€è¦<code>public</code>ï¼Œå°±ä¸å£°æ˜ä¸º<code>public</code>, å°½å¯èƒ½å°‘æš´éœ²å¯¹å¤–çš„å­—æ®µå’Œæ–¹æ³•ã€‚</p>
<p>æŠŠæ–¹æ³•å®šä¹‰ä¸º<code>package</code>æƒé™æœ‰åŠ©äºæµ‹è¯•ï¼Œå› ä¸ºæµ‹è¯•ç±»å’Œè¢«æµ‹è¯•ç±»åªè¦ä½äºåŒä¸€ä¸ª<code>package</code>ï¼Œæµ‹è¯•ä»£ç å°±å¯ä»¥è®¿é—®è¢«æµ‹è¯•ç±»çš„<code>package</code>æƒé™æ–¹æ³•ã€‚</p>
<p>ä¸€ä¸ª<code>.java</code>æ–‡ä»¶åªèƒ½åŒ…å«ä¸€ä¸ª<code>public</code>ç±»ï¼Œä½†å¯ä»¥åŒ…å«å¤šä¸ªé<code>public</code>ç±»ã€‚å¦‚æœæœ‰<code>public</code>ç±»ï¼Œæ–‡ä»¶åå¿…é¡»å’Œ<code>public</code>ç±»çš„åå­—ç›¸åŒã€‚</p>
<p><strong><code>pubilc &gt; package &gt; protected &gt; private</code></strong></p>
<h2 id="11-å†…éƒ¨ç±»"><a href="#11-å†…éƒ¨ç±»" class="headerlink" title="11. å†…éƒ¨ç±»"></a>11. å†…éƒ¨ç±»</h2><p>æœ‰ä¸€ç§ç±»ï¼Œå®ƒè¢«å®šä¹‰åœ¨å¦ä¸€ä¸ªç±»çš„å†…éƒ¨ï¼Œæ‰€ä»¥ç§°ä¸º<strong>å†…éƒ¨ç±»ï¼ˆNested Classï¼‰</strong>ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Outer</span> </span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Inner</span> </span>&#123;</span><br><span class="line">        <span class="comment">// å®šä¹‰äº†ä¸€ä¸ªInner Class</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>**<code>Inner</code>**æ˜¯ä¸€ä¸ªInner Classï¼Œå®ƒä¸æ™®é€šç±»æœ‰ä¸ªæœ€å¤§çš„ä¸åŒï¼Œå°±æ˜¯Inner Classçš„å®ä¾‹ä¸èƒ½å•ç‹¬å­˜åœ¨ï¼Œå¿…é¡»ä¾é™„äºä¸€ä¸ªOuter Classçš„å®ä¾‹ã€‚</p>
<p>å…ˆå®ä¾‹åŒ–å¤–éƒ¨ç±»ï¼Œå†è°ƒç”¨å¤–éƒ¨ç±»çš„newæ¥åˆ›å»ºå†…éƒ¨ç±»çš„å®ä¾‹ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Outer outer = <span class="keyword">new</span> Outer(<span class="string">&quot;Nested&quot;</span>); <span class="comment">// å®ä¾‹åŒ–ä¸€ä¸ªOuter</span></span><br><span class="line">        Outer.Inner inner = outer.<span class="function">new <span class="title">Inner</span><span class="params">()</span></span>; <span class="comment">// å®ä¾‹åŒ–ä¸€ä¸ªInner</span></span><br><span class="line">        inner.hello();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Outer</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    Outer(String name) &#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Inner</span> </span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">hello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Hello, &quot;</span> + Outer.<span class="keyword">this</span>.name);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>åŒ¿åç±»Anonymous Class</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Outer outer = <span class="keyword">new</span> Outer(<span class="string">&quot;Nested&quot;</span>);</span><br><span class="line">        outer.asyncHello();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Outer</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    Outer(String name) &#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">asyncHello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Runnable r = <span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;Hello, &quot;</span> + Outer.<span class="keyword">this</span>.name);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">new</span> Thread(r).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨æ–¹æ³•å†…éƒ¨å®ä¾‹åŒ–äº†ä¸€ä¸ª<code>Runnable</code>ã€‚<code>Runnable</code>æœ¬èº«æ˜¯æ¥å£ï¼Œæ¥å£æ˜¯ä¸èƒ½å®ä¾‹åŒ–çš„ï¼Œæ‰€ä»¥è¿™é‡Œå®é™…ä¸Šæ˜¯å®šä¹‰äº†ä¸€ä¸ªå®ç°äº†<code>Runnable</code>æ¥å£çš„åŒ¿åç±»ï¼Œå¹¶ä¸”é€šè¿‡<code>new</code>å®ä¾‹åŒ–è¯¥åŒ¿åç±»ï¼Œç„¶åè½¬å‹ä¸º<code>Runnable</code>ã€‚åœ¨å®šä¹‰åŒ¿åç±»çš„æ—¶å€™å°±å¿…é¡»å®ä¾‹åŒ–å®ƒï¼Œå®šä¹‰åŒ¿åç±»çš„å†™æ³•å¦‚ä¸‹ï¼š</p>
<p><code>Runnable</code>å’Œ<code>Thread</code>æ˜¯å¤šçº¿ç¨‹ç¼–ç¨‹éƒ¨åˆ†çš„å†…å®¹ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Runnable r = <span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">    <span class="comment">// å®ç°å¿…è¦çš„æŠ½è±¡æ–¹æ³•...</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>



<p><strong>é™æ€å†…éƒ¨ç±»</strong></p>
<p>é™æ€å†…éƒ¨ç±»å’ŒInner Classç±»ä¼¼ï¼Œä½†æ˜¯ä½¿ç”¨<code>static</code>ä¿®é¥°ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Outer.StaticNested sn = <span class="keyword">new</span> Outer.StaticNested();</span><br><span class="line">        sn.hello();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Outer</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String NAME = <span class="string">&quot;OUTER&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    </span><br><span class="line">    Outer(String name) &#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">StaticNested</span> </span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">hello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Hello, &quot;</span> + Outer.NAME);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç”¨<code>static</code>ä¿®é¥°çš„å†…éƒ¨ç±»å’ŒInner Classæœ‰å¾ˆå¤§çš„ä¸åŒï¼Œå®ƒä¸å†ä¾é™„äº<code>Outer</code>çš„å®ä¾‹ï¼Œè€Œæ˜¯ä¸€ä¸ªå®Œå…¨ç‹¬ç«‹çš„ç±»ï¼Œå› æ­¤æ— æ³•å¼•ç”¨<code>Outer.this</code>ï¼Œä½†å®ƒå¯ä»¥è®¿é—®<code>Outer</code>çš„<code>private</code>é™æ€å­—æ®µå’Œé™æ€æ–¹æ³•ã€‚å¦‚æœæŠŠ<code>StaticNested</code>ç§»åˆ°<code>Outer</code>ä¹‹å¤–ï¼Œå°±å¤±å»äº†è®¿é—®<code>private</code>çš„æƒé™ã€‚</p>
<h2 id="12-classpathå’Œjar"><a href="#12-classpathå’Œjar" class="headerlink" title="12. classpathå’Œjar"></a>12. <code>classpath</code>å’Œ<code>jar</code></h2><p>JVMé€šè¿‡ç¯å¢ƒå˜é‡<code>classpath</code>å†³å®šæœç´¢<code>class</code>çš„è·¯å¾„å’Œé¡ºåºï¼›</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">java -cp .;C:\work\project1\bin;C:\shared abc.xyz.Hello</span><br></pre></td></tr></table></figure>

<p>å½“JVMåœ¨åŠ è½½<code>abc.xyz.Hello</code>è¿™ä¸ªç±»æ—¶ï¼Œä¼šä¾æ¬¡æŸ¥æ‰¾ï¼š</p>
<ul>
<li><code>&lt;å½“å‰ç›®å½•&gt;\abc\xyz\Hello.class</code></li>
<li><code>C:\work\project1\bin\abc\xyz\Hello.class</code></li>
<li><code>C:\shared\abc\xyz\Hello.class</code></li>
</ul>
<p>ä¸æ¨èè®¾ç½®ç³»ç»Ÿç¯å¢ƒå˜é‡<code>classpath</code>ï¼Œå§‹ç»ˆå»ºè®®é€šè¿‡<code>-cp</code>å‘½ä»¤ä¼ å…¥ï¼›</p>
<p><strong>jaråŒ…</strong>ç›¸å½“äºç›®å½•ï¼Œå¯ä»¥åŒ…å«å¾ˆå¤š<code>.class</code>æ–‡ä»¶ï¼Œæ–¹ä¾¿ä¸‹è½½å’Œä½¿ç”¨ï¼›</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">java -cp ./hello.jar abc.xyz.Hello</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·JVMä¼šè‡ªåŠ¨åœ¨<code>hello.jar</code>æ–‡ä»¶é‡Œå»æœç´¢æŸä¸ªç±»ã€‚</p>
<p>jaråŒ…çš„æ ¼å¼å¦‚å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://raw.githubusercontent.com/ghj1998/image_repository/main/jar%E5%8C%85%E7%9A%84%E6%A0%BC%E5%BC%8F.png" alt="image-20210321230823218"></p>
<p><code>MANIFEST.MF</code>æ–‡ä»¶å¯ä»¥æä¾›jaråŒ…çš„ä¿¡æ¯ï¼Œå¦‚<code>Main-Class</code>ï¼Œè¿™æ ·å¯ä»¥ç›´æ¥è¿è¡ŒjaråŒ…ã€‚<code>MANIFEST.MF</code>æ˜¯çº¯æ–‡æœ¬ï¼Œå¯ä»¥æŒ‡å®š<code>Main-Class</code>å’Œå…¶å®ƒä¿¡æ¯ã€‚JVMä¼šè‡ªåŠ¨è¯»å–è¿™ä¸ª<code>MANIFEST.MF</code>æ–‡ä»¶ï¼Œå¦‚æœå­˜åœ¨<code>Main-Class</code>ï¼Œæˆ‘ä»¬å°±ä¸å¿…åœ¨å‘½ä»¤è¡ŒæŒ‡å®šå¯åŠ¨çš„ç±»åï¼Œè€Œæ˜¯ç”¨æ›´æ–¹ä¾¿çš„å‘½ä»¤ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">java -jar hello.jar</span><br></pre></td></tr></table></figure>

<p>åœ¨å¤§å‹é¡¹ç›®ä¸­ï¼Œä¸å¯èƒ½æ‰‹åŠ¨ç¼–å†™<code>MANIFEST.MF</code>æ–‡ä»¶ï¼Œå†æ‰‹åŠ¨åˆ›å»ºzipåŒ…ã€‚Javaç¤¾åŒºæä¾›äº†å¤§é‡çš„å¼€æºæ„å»ºå·¥å…·ï¼Œä¾‹å¦‚<a href="https://www.liaoxuefeng.com/wiki/1252599548343744/1255945359327200">Maven</a>ï¼Œå¯ä»¥éå¸¸æ–¹ä¾¿åœ°åˆ›å»ºjaråŒ…ã€‚</p>
<h2 id="13-æ¨¡å—"><a href="#13-æ¨¡å—" class="headerlink" title="13. æ¨¡å—"></a>13. æ¨¡å—</h2><p>ä»Java 9å¼€å§‹ï¼ŒåŸæœ‰çš„Javaæ ‡å‡†åº“å·²ç»ç”±ä¸€ä¸ªå•ä¸€å·¨å¤§çš„<code>rt.jar</code>åˆ†æ‹†æˆäº†å‡ åä¸ªæ¨¡å—ï¼Œè¿™äº›æ¨¡å—ä»¥<code>.jmod</code>æ‰©å±•åæ ‡è¯†ï¼Œå¯ä»¥åœ¨<code>$JAVA_HOME/jmods</code>ç›®å½•ä¸‹æ‰¾åˆ°å®ƒä»¬ï¼š</p>
<ul>
<li><code>java.base.jmod</code></li>
<li><code>ava.compiler.jmod</code></li>
<li><code>java.datatransfer.jmod</code></li>
<li><code>java.desktop.jmod</code></li>
<li>â€¦</li>
</ul>
<p>è¿™äº›<code>.jmod</code>æ–‡ä»¶æ¯ä¸€ä¸ªéƒ½æ˜¯ä¸€ä¸ªæ¨¡å—ï¼Œæ¨¡å—åå°±æ˜¯æ–‡ä»¶åã€‚ä¾‹å¦‚ï¼šæ¨¡å—<code>java.base</code>å¯¹åº”çš„æ–‡ä»¶å°±æ˜¯<code>java.base.jmod</code>ã€‚æ¨¡å—ä¹‹é—´çš„ä¾èµ–å…³ç³»å·²ç»è¢«å†™å…¥åˆ°æ¨¡å—å†…çš„<code>module-info.class</code>æ–‡ä»¶äº†ã€‚æ‰€æœ‰çš„æ¨¡å—éƒ½ä¾èµ–<code>java.base</code>æ¨¡å—ï¼Œåªæœ‰<code>java.base</code>æ¨¡å—ä¸ä¾èµ–ä»»ä½•æ¨¡å—ï¼Œå®ƒå¯ä»¥è¢«çœ‹ä½œæ˜¯â€œæ ¹æ¨¡å—â€ï¼Œå¥½æ¯”æ‰€æœ‰çš„ç±»éƒ½æ˜¯ä»<code>Object</code>ç›´æ¥æˆ–é—´æ¥ç»§æ‰¿è€Œæ¥ã€‚</p>
<p>æŠŠclasså°è£…æˆåŒ…ä¸ä»…è¦æ‰“åŒ…ï¼Œè€Œä¸”è¦å†™å…¥ä¾èµ–å…³ç³»ã€‚</p>
<p><img src="https://raw.githubusercontent.com/ghj1998/image_repository/main/%E5%8C%85%E7%9A%84%E7%BB%93%E6%9E%84.png" alt="image-20210321231547669"></p>
<p>åŒ…çš„æœºæ„ä¸Javaé¡¹ç›®ç±»ä¼¼ï¼Œmodule-info.javaå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">module</span> hello.world &#123;</span><br><span class="line">	<span class="keyword">requires</span> java.base; <span class="comment">// å¯ä¸å†™ï¼Œä»»ä½•æ¨¡å—éƒ½ä¼šè‡ªåŠ¨å¼•å…¥java.base</span></span><br><span class="line">	<span class="keyword">requires</span> java.xml;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>module</code>æ˜¯å…³é”®å­—ï¼Œåé¢çš„<code>hello.world</code>æ˜¯æ¨¡å—çš„åç§°ï¼Œå®ƒçš„å‘½åè§„èŒƒä¸åŒ…ä¸€è‡´ã€‚èŠ±æ‹¬å·çš„<code>requires xxx;</code>è¡¨ç¤ºè¿™ä¸ªæ¨¡å—éœ€è¦å¼•ç”¨çš„å…¶ä»–æ¨¡å—åã€‚é™¤äº†<code>java.base</code>å¯ä»¥è¢«è‡ªåŠ¨å¼•å…¥å¤–ï¼Œè¿™é‡Œæˆ‘ä»¬å¼•å…¥äº†ä¸€ä¸ª<code>java.xml</code>çš„æ¨¡å—ã€‚</p>
<p>å½“æˆ‘ä»¬ä½¿ç”¨æ¨¡å—å£°æ˜äº†ä¾èµ–å…³ç³»åï¼Œæ‰èƒ½ä½¿ç”¨å¼•å…¥çš„æ¨¡å—ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itranswarp.sample;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¿…é¡»å¼•å…¥java.xmlæ¨¡å—åæ‰èƒ½ä½¿ç”¨å…¶ä¸­çš„ç±»:</span></span><br><span class="line"><span class="keyword">import</span> javax.xml.XMLConstants;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		Greeting g = <span class="keyword">new</span> Greeting();</span><br><span class="line">		System.out.println(g.hello(XMLConstants.XML_NS_PREFIX));</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯¹<code>oop-module</code>é¡¹ç›®è¿›è¡Œç¼–è¯‘</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ javac -d bin src/module-info.java src/com/itranswarp/sample/*.java</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/ghj1998/image_repository/main/%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84.png" alt="image-20210321232103842"></p>
<p>ä¸‹ä¸€æ­¥å°†binç›®å½•ä¸‹çš„classæ‰“åŒ…æˆjarã€‚ä¼ å…¥<code>--main-class</code>å‚æ•°ï¼Œè®©è¿™ä¸ªjaråŒ…èƒ½è‡ªå·±å®šä½<code>main</code>æ–¹æ³•æ‰€åœ¨çš„ç±»ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ jar --create --file hello.jar --main-class com.itranswarp.sample.Main -C bin .</span><br></pre></td></tr></table></figure>

<p>ç»§ç»­ä½¿ç”¨JDKè‡ªå¸¦çš„<code>jmod</code>å‘½ä»¤æŠŠä¸€ä¸ªjaråŒ…è½¬æ¢æˆæ¨¡å—ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ jmod create --class-path hello.jar hello.jmod</span><br></pre></td></tr></table></figure>

<p><strong>è¿è¡Œæ¨¡å—</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ java --module-path hello.jar --module hello.world</span><br><span class="line">Hello, xml!</span><br></pre></td></tr></table></figure>

<p><strong>æ‰“åŒ…JRE</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ jlink --module-path hello.jmod --add-modules java.base,java.xml,hello.world --output jre/</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ jre/bin/java --module hello.world</span><br><span class="line">Hello, xml!</span><br></pre></td></tr></table></figure>]]></content>
      <tags>
        <tag>JAVA</tag>
      </tags>
  </entry>
  <entry>
    <title>Mavenä½¿ç”¨</title>
    <url>/2021/05/07/Maven%E4%BD%BF%E7%94%A8/</url>
    <content><![CDATA[<h1 id="Maven"><a href="#Maven" class="headerlink" title="Maven"></a>Maven</h1><h2 id="1-Mavenç®€ä»‹"><a href="#1-Mavenç®€ä»‹" class="headerlink" title="1. Mavenç®€ä»‹"></a>1. Mavenç®€ä»‹</h2><p>Mavenå°±æ˜¯æ˜¯ä¸“é—¨ä¸ºJavaé¡¹ç›®æ‰“é€ çš„ç®¡ç†å’Œæ„å»ºå·¥å…·ï¼Œå®ƒçš„ä¸»è¦åŠŸèƒ½æœ‰ï¼š</p>
<ul>
<li>æä¾›äº†ä¸€å¥—æ ‡å‡†åŒ–çš„é¡¹ç›®ç»“æ„ï¼›</li>
<li>æä¾›äº†ä¸€å¥—æ ‡å‡†åŒ–çš„æ„å»ºæµç¨‹ï¼ˆç¼–è¯‘ï¼Œæµ‹è¯•ï¼Œæ‰“åŒ…ï¼Œå‘å¸ƒâ€¦â€¦ï¼‰ï¼›</li>
<li>æä¾›äº†ä¸€å¥—ä¾èµ–ç®¡ç†æœºåˆ¶ã€‚</li>
</ul>
<h3 id="1-1-Mavené¡¹ç›®ç»“æ„"><a href="#1-1-Mavené¡¹ç›®ç»“æ„" class="headerlink" title="1.1 Mavené¡¹ç›®ç»“æ„"></a>1.1 Mavené¡¹ç›®ç»“æ„</h3><p><img src="https://raw.githubusercontent.com/ghj1998/image_repository/main/image-20210507085528340.png" alt="image-20210507085528340"></p>
<p>é¡¹ç›®çš„æ ¹ç›®å½•<code>a-maven-project</code>æ˜¯é¡¹ç›®åï¼Œå®ƒæœ‰ä¸€ä¸ªé¡¹ç›®æè¿°æ–‡ä»¶<code>pom.xml</code>ï¼Œå­˜æ”¾Javaæºç çš„ç›®å½•æ˜¯<code>src/main/java</code>ï¼Œå­˜æ”¾èµ„æºæ–‡ä»¶çš„ç›®å½•æ˜¯<code>src/main/resources</code>ï¼Œå­˜æ”¾æµ‹è¯•æºç çš„ç›®å½•æ˜¯<code>src/test/java</code>ï¼Œå­˜æ”¾æµ‹è¯•èµ„æºçš„ç›®å½•æ˜¯<code>src/test/resources</code>ï¼Œæœ€åï¼Œæ‰€æœ‰ç¼–è¯‘ã€æ‰“åŒ…ç”Ÿæˆçš„æ–‡ä»¶éƒ½æ”¾åœ¨<code>target</code>ç›®å½•é‡Œã€‚è¿™äº›å°±æ˜¯ä¸€ä¸ªMavené¡¹ç›®çš„æ ‡å‡†ç›®å½•ç»“æ„ã€‚</p>
<p>ä½¿ç”¨æ ‡å‡†ç»“æ„ä¸éœ€è¦åšä»»ä½•é…ç½®ï¼ŒMavenå°±å¯ä»¥æ­£å¸¸ä½¿ç”¨ã€‚</p>
<h3 id="1-2-é¡¹ç›®æè¿°æ–‡ä»¶pom-xml"><a href="#1-2-é¡¹ç›®æè¿°æ–‡ä»¶pom-xml" class="headerlink" title="1.2 é¡¹ç›®æè¿°æ–‡ä»¶pom.xml"></a>1.2 é¡¹ç›®æè¿°æ–‡ä»¶<code>pom.xml</code></h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">...</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.itranswarp.learnjava<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hello<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">packaging</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        ...</span><br><span class="line">	<span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-logging<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-logging<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>groupId</code>ç±»ä¼¼äºJavaçš„åŒ…åï¼Œé€šå¸¸æ˜¯å…¬å¸æˆ–ç»„ç»‡åç§°ï¼Œ<code>artifactId</code>ç±»ä¼¼äºJavaçš„ç±»åï¼Œé€šå¸¸æ˜¯é¡¹ç›®åç§°ï¼Œå†åŠ ä¸Š<code>version</code>ï¼Œä¸€ä¸ªMavenå·¥ç¨‹å°±æ˜¯ç”±<code>groupId</code>ï¼Œ<code>artifactId</code>å’Œ<code>version</code>ä½œä¸ºå”¯ä¸€æ ‡è¯†ã€‚</p>
<p>æˆ‘ä»¬åœ¨å¼•ç”¨å…¶ä»–ç¬¬ä¸‰æ–¹åº“çš„æ—¶å€™ï¼Œä¹Ÿæ˜¯é€šè¿‡è¿™3ä¸ªå˜é‡ç¡®å®šã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-logging<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-logging<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨<code>&lt;dependency&gt;</code>å£°æ˜ä¸€ä¸ªä¾èµ–åï¼ŒMavenå°±ä¼šè‡ªåŠ¨ä¸‹è½½è¿™ä¸ªä¾èµ–åŒ…å¹¶æŠŠå®ƒæ”¾åˆ°classpathä¸­ã€‚</p>
<h2 id="2-ä¾èµ–ç®¡ç†"><a href="#2-ä¾èµ–ç®¡ç†" class="headerlink" title="2. ä¾èµ–ç®¡ç†"></a>2. ä¾èµ–ç®¡ç†</h2><p>Mavençš„ç¬¬ä¸€ä¸ªä½œç”¨å°±æ˜¯è§£å†³ä¾èµ–ç®¡ç†ã€‚æˆ‘ä»¬å£°æ˜äº†è‡ªå·±çš„é¡¹ç›®éœ€è¦<code>abc</code>ï¼ŒMavenä¼šè‡ªåŠ¨å¯¼å…¥<code>abc</code>çš„jaråŒ…ï¼Œå†åˆ¤æ–­å‡º<code>abc</code>éœ€è¦<code>xyz</code>ï¼Œåˆä¼šè‡ªåŠ¨å¯¼å…¥<code>xyz</code>çš„jaråŒ…ï¼Œè¿™æ ·ï¼Œæœ€ç»ˆæˆ‘ä»¬çš„é¡¹ç›®ä¼šä¾èµ–<code>abc</code>å’Œ<code>xyz</code>ä¸¤ä¸ªjaråŒ…ã€‚</p>
<p>å½“æˆ‘ä»¬å£°æ˜ä¸€ä¸ª<code>spring-boot-starter-web</code>ä¾èµ–æ—¶ï¼ŒMavenä¼šè‡ªåŠ¨è§£æå¹¶åˆ¤æ–­æœ€ç»ˆéœ€è¦å¤§æ¦‚äºŒä¸‰åä¸ªå…¶ä»–ä¾èµ–ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4.2.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-1-ä¾èµ–å…³ç³»"><a href="#2-1-ä¾èµ–å…³ç³»" class="headerlink" title="2.1 ä¾èµ–å…³ç³»"></a>2.1 ä¾èµ–å…³ç³»</h3><p>Mavenå®šä¹‰äº†å‡ ç§ä¾èµ–å…³ç³»ï¼Œåˆ†åˆ«æ˜¯<code>compile</code>ã€<code>test</code>ã€<code>runtime</code>å’Œ<code>provided</code>ï¼š</p>
<table>
<thead>
<tr>
<th align="left">scope</th>
<th align="left">è¯´æ˜</th>
<th align="left">ç¤ºä¾‹</th>
</tr>
</thead>
<tbody><tr>
<td align="left">compile</td>
<td align="left">ç¼–è¯‘æ—¶éœ€è¦ç”¨åˆ°è¯¥jaråŒ…ï¼ˆé»˜è®¤ï¼‰</td>
<td align="left">commons-logging</td>
</tr>
<tr>
<td align="left">test</td>
<td align="left">ç¼–è¯‘Testæ—¶éœ€è¦ç”¨åˆ°è¯¥jaråŒ…</td>
<td align="left">junit</td>
</tr>
<tr>
<td align="left">runtime</td>
<td align="left">ç¼–è¯‘æ—¶ä¸éœ€è¦ï¼Œä½†è¿è¡Œæ—¶éœ€è¦ç”¨åˆ°</td>
<td align="left">mysql</td>
</tr>
<tr>
<td align="left">provided</td>
<td align="left">ç¼–è¯‘æ—¶éœ€è¦ç”¨åˆ°ï¼Œä½†è¿è¡Œæ—¶ç”±JDKæˆ–æŸä¸ªæœåŠ¡å™¨æä¾›</td>
<td align="left">servlet-api</td>
</tr>
</tbody></table>
<p>å…¶ä¸­ï¼Œé»˜è®¤çš„<code>compile</code>æ˜¯æœ€å¸¸ç”¨çš„ï¼ŒMavenä¼šæŠŠè¿™ç§ç±»å‹çš„ä¾èµ–ç›´æ¥æ”¾å…¥classpathã€‚</p>
<p><code>test</code>ä¾èµ–è¡¨ç¤ºä»…åœ¨æµ‹è¯•æ—¶ä½¿ç”¨ï¼Œæ­£å¸¸è¿è¡Œæ—¶å¹¶ä¸éœ€è¦ã€‚æœ€å¸¸ç”¨çš„<code>test</code>ä¾èµ–å°±æ˜¯JUnitï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.junit.jupiter<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit-jupiter-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.3.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>runtime</code>ä¾èµ–è¡¨ç¤ºç¼–è¯‘æ—¶ä¸éœ€è¦ï¼Œä½†è¿è¡Œæ—¶éœ€è¦ã€‚æœ€å…¸å‹çš„<code>runtime</code>ä¾èµ–æ˜¯JDBCé©±åŠ¨ï¼Œä¾‹å¦‚MySQLé©±åŠ¨ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.48<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>provided</code>ä¾èµ–è¡¨ç¤ºç¼–è¯‘æ—¶éœ€è¦ï¼Œä½†è¿è¡Œæ—¶ä¸éœ€è¦ã€‚æœ€å…¸å‹çš„<code>provided</code>ä¾èµ–æ˜¯Servlet APIï¼Œç¼–è¯‘çš„æ—¶å€™éœ€è¦ï¼Œä½†æ˜¯è¿è¡Œæ—¶ï¼ŒServletæœåŠ¡å™¨å†…ç½®äº†ç›¸å…³çš„jarï¼Œæ‰€ä»¥è¿è¡ŒæœŸä¸éœ€è¦ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Mavenç»´æŠ¤äº†ä¸€ä¸ªä¸­å¤®ä»“åº“ï¼ˆ<a href="https://repo1.maven.org/">repo1.maven.org</a>ï¼‰ï¼Œç¬¬ä¸‰æ–¹åº“éƒ½ä¼šä»è¿™é‡Œä¸‹è½½ã€‚</p>
<p>ä¸€ä¸ªjaråŒ…ä¸€æ—¦è¢«ä¸‹è½½è¿‡ï¼Œå°±ä¼šè¢«Mavenè‡ªåŠ¨ç¼“å­˜åœ¨æœ¬åœ°ç›®å½•ï¼ˆç”¨æˆ·ä¸»ç›®å½•çš„<code>.m2</code>ç›®å½•ï¼‰ã€‚</p>
<h3 id="2-2-ä¾èµ–ID"><a href="#2-2-ä¾èµ–ID" class="headerlink" title="2.2 ä¾èµ–ID"></a>2.2 ä¾èµ–ID</h3><p>å¯¹äºæŸä¸ªä¾èµ–ï¼ŒMavenåªéœ€è¦3ä¸ªå˜é‡å³å¯å”¯ä¸€ç¡®å®šæŸä¸ªjaråŒ…ï¼š</p>
<ul>
<li>groupIdï¼šå±äºç»„ç»‡çš„åç§°ï¼Œç±»ä¼¼Javaçš„åŒ…åï¼›</li>
<li>artifactIdï¼šè¯¥jaråŒ…è‡ªèº«çš„åç§°ï¼Œç±»ä¼¼Javaçš„ç±»åï¼›</li>
<li>versionï¼šè¯¥jaråŒ…çš„ç‰ˆæœ¬ã€‚</li>
</ul>
<h3 id="2-3-Mavené•œåƒ"><a href="#2-3-Mavené•œåƒ" class="headerlink" title="2.3 Mavené•œåƒ"></a>2.3 Mavené•œåƒ</h3><p>å¦‚æœè®¿é—®Mavençš„ä¸­å¤®ä»“åº“éå¸¸æ…¢ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©ä¸€ä¸ªé€Ÿåº¦è¾ƒå¿«çš„Mavençš„é•œåƒä»“åº“ã€‚Mavené•œåƒä»“åº“å®šæœŸä»ä¸­å¤®ä»“åº“åŒæ­¥ï¼š</p>
<p><img src="https://raw.githubusercontent.com/ghj1998/image_repository/main/image-20210507091224316.png" alt="image-20210507091224316"></p>
<p>ä¸­å›½åŒºç”¨æˆ·å¯ä»¥ä½¿ç”¨é˜¿é‡Œäº‘æä¾›çš„Mavené•œåƒä»“åº“ã€‚ä½¿ç”¨Mavené•œåƒä»“åº“éœ€è¦ä¸€ä¸ªé…ç½®ï¼Œåœ¨ç”¨æˆ·ä¸»ç›®å½•ä¸‹è¿›å…¥<code>.m2</code>ç›®å½•ï¼Œåˆ›å»ºä¸€ä¸ª<code>settings.xml</code>é…ç½®æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mirrors</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mirror</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>aliyun<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">name</span>&gt;</span>aliyun<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>central<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- å›½å†…æ¨èé˜¿é‡Œäº‘çš„Mavené•œåƒ --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">url</span>&gt;</span>https://maven.aliyun.com/repository/central<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mirrors</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>é…ç½®é•œåƒä»“åº“åï¼ŒMavençš„ä¸‹è½½é€Ÿåº¦å°±ä¼šéå¸¸å¿«ã€‚</p>
<h3 id="2-4-å¦‚ä½•è·å–ä¸€ä¸ªä»¥æ¥çš„groupIdã€artifactIdå’Œversionï¼Ÿ"><a href="#2-4-å¦‚ä½•è·å–ä¸€ä¸ªä»¥æ¥çš„groupIdã€artifactIdå’Œversionï¼Ÿ" class="headerlink" title="2.4 å¦‚ä½•è·å–ä¸€ä¸ªä»¥æ¥çš„groupIdã€artifactIdå’Œversionï¼Ÿ"></a>2.4 å¦‚ä½•è·å–ä¸€ä¸ªä»¥æ¥çš„groupId<code>ã€</code>artifactId<code>å’Œ</code>versionï¼Ÿ</h3><p>é€šè¿‡<a href="https://search.maven.org/">search.maven.org</a>æœç´¢å…³é”®å­—ï¼Œæ‰¾åˆ°å¯¹åº”çš„ç»„ä»¶åï¼Œç›´æ¥å¤åˆ¶ï¼š</p>
<p><img src="https://www.liaoxuefeng.com/files/attachments/1322179230695490/l" alt="copy-maven"></p>
<p><a href="https://mvnrepository.com/%E8%BF%99%E4%B8%AA%E4%B9%9F%E6%98%AF%E4%B8%80%E4%B8%AA%E6%90%9C%E7%B4%A2%E7%9A%84%E5%9C%B0%E5%9D%80%EF%BC%8C%E6%9B%B4%E6%96%B0%E7%A8%8D%E5%BE%AE%E5%BF%AB%E4%B8%80%E4%BA%9B%E3%80%82">https://mvnrepository.com/è¿™ä¸ªä¹Ÿæ˜¯ä¸€ä¸ªæœç´¢çš„åœ°å€ï¼Œæ›´æ–°ç¨å¾®å¿«ä¸€äº›ã€‚</a></p>
<h3 id="2-5-å‘½ä»¤è¡Œç¼–è¯‘"><a href="#2-5-å‘½ä»¤è¡Œç¼–è¯‘" class="headerlink" title="2.5 å‘½ä»¤è¡Œç¼–è¯‘"></a>2.5 å‘½ä»¤è¡Œç¼–è¯‘</h3><p>åœ¨å‘½ä»¤ä¸­ï¼Œè¿›å…¥åˆ°<code>pom.xml</code>æ‰€åœ¨ç›®å½•ï¼Œè¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ mvn clean package</span><br></pre></td></tr></table></figure>

<p>å¦‚æœä¸€åˆ‡é¡ºåˆ©ï¼Œå³å¯åœ¨<code>target</code>ç›®å½•ä¸‹è·å¾—ç¼–è¯‘åè‡ªåŠ¨æ‰“åŒ…çš„jarã€‚</p>
<h3 id="2-6-IDEä¸­ä½¿ç”¨MAVEN"><a href="#2-6-IDEä¸­ä½¿ç”¨MAVEN" class="headerlink" title="2.6 IDEä¸­ä½¿ç”¨MAVEN"></a>2.6 IDEä¸­ä½¿ç”¨MAVEN</h3><p>IDEå¯ä»¥ç›´æ¥åˆ›å»ºæˆ–å¯¼å…¥Mavené¡¹ç›®ã€‚å¦‚æœå¯¼å…¥åçš„Mavené¡¹ç›®æœ‰é”™è¯¯ï¼Œå¯ä»¥å°è¯•é€‰æ‹©é¡¹ç›®åç‚¹å‡»å³é”®ï¼Œé€‰æ‹©Maven - Update Projectâ€¦æ›´æ–°ï¼š</p>
<h2 id="3-åˆ›å»ºæµç¨‹"><a href="#3-åˆ›å»ºæµç¨‹" class="headerlink" title="3. åˆ›å»ºæµç¨‹"></a>3. åˆ›å»ºæµç¨‹</h2><p>Mavenä¸ä½†æœ‰æ ‡å‡†åŒ–çš„é¡¹ç›®ç»“æ„ï¼Œè€Œä¸”è¿˜æœ‰ä¸€å¥—æ ‡å‡†åŒ–çš„æ„å»ºæµç¨‹ï¼Œå¯ä»¥è‡ªåŠ¨åŒ–å®ç°ç¼–è¯‘ï¼Œæ‰“åŒ…ï¼Œå‘å¸ƒï¼Œç­‰ç­‰ã€‚</p>
<h3 id="3-1-Lifecycleå’ŒPhase"><a href="#3-1-Lifecycleå’ŒPhase" class="headerlink" title="3.1 Lifecycleå’ŒPhase"></a>3.1 Lifecycleå’ŒPhase</h3><p>Mavençš„ç”Ÿå‘½å‘¨æœŸï¼ˆlifecycleï¼‰ç”±ä¸€ç³»åˆ—é˜¶æ®µï¼ˆphaseï¼‰æ„æˆï¼Œä»¥å†…ç½®çš„ç”Ÿå‘½å‘¨æœŸ<code>default</code>ä¸ºä¾‹ï¼Œå®ƒåŒ…å«ä»¥ä¸‹phaseï¼š</p>
<ul>
<li>validate</li>
<li>initialize</li>
<li>generate-sources</li>
<li>process-sources</li>
<li>generate-resources</li>
<li>process-resources</li>
<li>compile</li>
<li>process-classes</li>
<li>generate-test-sources</li>
<li>process-test-sources</li>
<li>generate-test-resources</li>
<li>process-test-resources</li>
<li>test-compile</li>
<li>process-test-classes</li>
<li>test</li>
<li>prepare-package</li>
<li>package</li>
<li>pre-integration-test</li>
<li>integration-test</li>
<li>post-integration-test</li>
<li>verify</li>
<li>install</li>
<li>deploy</li>
</ul>
<p>å¦‚æœæˆ‘ä»¬è¿è¡Œ<code>mvn package</code>ï¼ŒMavenå°±ä¼šæ‰§è¡Œ<code>default</code>ç”Ÿå‘½å‘¨æœŸï¼Œå®ƒä¼šä»å¼€å§‹ä¸€ç›´è¿è¡Œåˆ°<code>package</code>è¿™ä¸ªphaseä¸ºæ­¢ï¼š</p>
<ul>
<li>validate</li>
<li>â€¦</li>
<li>package</li>
</ul>
<p>å¦‚æœæˆ‘ä»¬è¿è¡Œ<code>mvn compile</code>ï¼ŒMavenä¹Ÿä¼šæ‰§è¡Œ<code>default</code>ç”Ÿå‘½å‘¨æœŸï¼Œä½†è¿™æ¬¡å®ƒåªä¼šè¿è¡Œåˆ°<code>compile</code>ï¼Œå³ä»¥ä¸‹å‡ ä¸ªphaseï¼š</p>
<ul>
<li>validate</li>
<li>â€¦</li>
<li>compile</li>
</ul>
<p>Mavenå¦ä¸€ä¸ªå¸¸ç”¨çš„ç”Ÿå‘½å‘¨æœŸæ˜¯<code>clean</code>ï¼Œå®ƒä¼šæ‰§è¡Œ3ä¸ªphaseï¼š</p>
<ul>
<li>pre-clean</li>
<li>clean ï¼ˆæ³¨æ„è¿™ä¸ªcleanä¸æ˜¯lifecycleè€Œæ˜¯phaseï¼‰</li>
<li>post-clean</li>
</ul>
<p>æˆ‘ä»¬ä½¿ç”¨<code>mvn</code>è¿™ä¸ªå‘½ä»¤æ—¶ï¼Œåé¢çš„å‚æ•°æ˜¯phaseï¼ŒMavenè‡ªåŠ¨æ ¹æ®ç”Ÿå‘½å‘¨æœŸè¿è¡Œåˆ°æŒ‡å®šçš„phaseã€‚</p>
<p>è¿è¡Œ<code>mvn clean package</code>ï¼ŒMavenå…ˆæ‰§è¡Œ<code>clean</code>ç”Ÿå‘½å‘¨æœŸå¹¶è¿è¡Œåˆ°<code>clean</code>è¿™ä¸ªphaseï¼Œç„¶åæ‰§è¡Œ<code>default</code>ç”Ÿå‘½å‘¨æœŸå¹¶è¿è¡Œåˆ°<code>package</code>è¿™ä¸ªphaseï¼Œå®é™…æ‰§è¡Œçš„phaseå¦‚ä¸‹ï¼š</p>
<ul>
<li>pre-clean</li>
<li>clean ï¼ˆæ³¨æ„è¿™ä¸ªcleanæ˜¯phaseï¼‰</li>
<li>validate</li>
<li>â€¦</li>
<li>package</li>
</ul>
<p>åœ¨å®é™…å¼€å‘è¿‡ç¨‹ä¸­ï¼Œç»å¸¸ä½¿ç”¨çš„å‘½ä»¤æœ‰ï¼š</p>
<p><code>mvn clean</code>ï¼šæ¸…ç†æ‰€æœ‰ç”Ÿæˆçš„classå’Œjarï¼›</p>
<p><code>mvn clean compile</code>ï¼šå…ˆæ¸…ç†ï¼Œå†æ‰§è¡Œåˆ°<code>compile</code>ï¼›</p>
<p><code>mvn clean test</code>ï¼šå…ˆæ¸…ç†ï¼Œå†æ‰§è¡Œåˆ°<code>test</code>ï¼Œå› ä¸ºæ‰§è¡Œ<code>test</code>å‰å¿…é¡»æ‰§è¡Œ<code>compile</code>ï¼Œæ‰€ä»¥è¿™é‡Œä¸å¿…æŒ‡å®š<code>compile</code>ï¼›</p>
<p><code>mvn clean package</code>ï¼šå…ˆæ¸…ç†ï¼Œå†æ‰§è¡Œåˆ°<code>package</code>ã€‚</p>
<h3 id="3-2-Goal"><a href="#3-2-Goal" class="headerlink" title="3.2 Goal"></a>3.2 Goal</h3><p>æ‰§è¡Œä¸€ä¸ªphaseåˆä¼šè§¦å‘ä¸€ä¸ªæˆ–å¤šä¸ªgoalï¼š</p>
<table>
<thead>
<tr>
<th align="left">æ‰§è¡Œçš„Phase</th>
<th align="left">å¯¹åº”æ‰§è¡Œçš„Goal</th>
</tr>
</thead>
<tbody><tr>
<td align="left">compile</td>
<td align="left">compiler:compile</td>
</tr>
<tr>
<td align="left">test</td>
<td align="left">compiler:testCompile surefire:test</td>
</tr>
</tbody></table>
<p>goalçš„å‘½åæ€»æ˜¯<code>abc:xyz</code>è¿™ç§å½¢å¼ã€‚</p>
<p>å¤§å¤šæ•°æƒ…å†µï¼Œæˆ‘ä»¬åªè¦æŒ‡å®šphaseï¼Œå°±é»˜è®¤æ‰§è¡Œè¿™äº›phaseé»˜è®¤ç»‘å®šçš„goalï¼Œåªæœ‰å°‘æ•°æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥æŒ‡å®šè¿è¡Œä¸€ä¸ªgoalï¼Œä¾‹å¦‚ï¼Œå¯åŠ¨TomcatæœåŠ¡å™¨ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mvn tomcat:run</span><br></pre></td></tr></table></figure>

<h2 id="4-ä½¿ç”¨æ’ä»¶"><a href="#4-ä½¿ç”¨æ’ä»¶" class="headerlink" title="4. ä½¿ç”¨æ’ä»¶"></a>4. ä½¿ç”¨æ’ä»¶</h2><p>æ‰§è¡Œæ¯ä¸ªphaseï¼Œéƒ½æ˜¯é€šè¿‡æŸä¸ªæ’ä»¶ï¼ˆpluginï¼‰æ¥æ‰§è¡Œçš„ï¼ŒMavenæœ¬èº«å…¶å®å¹¶ä¸çŸ¥é“å¦‚ä½•æ‰§è¡Œ<code>compile</code>ï¼Œå®ƒåªæ˜¯è´Ÿè´£æ‰¾åˆ°å¯¹åº”çš„<code>compiler</code>æ’ä»¶ï¼Œç„¶åæ‰§è¡Œé»˜è®¤çš„<code>compiler:compile</code>è¿™ä¸ªgoalæ¥å®Œæˆç¼–è¯‘ã€‚</p>
<table>
<thead>
<tr>
<th align="left">æ’ä»¶åç§°</th>
<th align="left">å¯¹åº”æ‰§è¡Œçš„phase</th>
</tr>
</thead>
<tbody><tr>
<td align="left">clean</td>
<td align="left">clean</td>
</tr>
<tr>
<td align="left">compiler</td>
<td align="left">compile</td>
</tr>
<tr>
<td align="left">surefire</td>
<td align="left">test</td>
</tr>
<tr>
<td align="left">jar</td>
<td align="left">package</td>
</tr>
</tbody></table>
<p>å¦‚æœæ ‡å‡†æ’ä»¶æ— æ³•æ»¡è¶³éœ€æ±‚ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰æ’ä»¶ã€‚ä½¿ç”¨è‡ªå®šä¹‰æ’ä»¶çš„æ—¶å€™ï¼Œéœ€è¦å£°æ˜ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨<code>maven-shade-plugin</code>å¯ä»¥åˆ›å»ºä¸€ä¸ªå¯æ‰§è¡Œçš„jarï¼Œè¦ä½¿ç”¨è¿™ä¸ªæ’ä»¶ï¼Œéœ€è¦åœ¨<code>pom.xml</code>ä¸­å£°æ˜å®ƒï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line">	<span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-shade-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.2.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">phase</span>&gt;</span>package<span class="tag">&lt;/<span class="name">phase</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">							<span class="tag">&lt;<span class="name">goal</span>&gt;</span>shade<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                            ...</span><br><span class="line">						<span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>è‡ªå®šä¹‰æ’ä»¶å¾€å¾€éœ€è¦ä¸€äº›é…ç½®ï¼Œä¾‹å¦‚ï¼Œ<code>maven-shade-plugin</code>éœ€è¦æŒ‡å®šJavaç¨‹åºçš„å…¥å£ï¼Œå®ƒçš„é…ç½®æ˜¯ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">transformers</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">transformer</span> <span class="attr">implementation</span>=<span class="string">&quot;org.apache.maven.plugins.shade.resource.ManifestResourceTransformer&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">mainClass</span>&gt;</span>com.itranswarp.learnjava.Main<span class="tag">&lt;/<span class="name">mainClass</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">transformer</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">transformers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ä¸€äº›å¸¸ç”¨çš„æ’ä»¶ï¼š</p>
<ul>
<li>maven-shade-pluginï¼šæ‰“åŒ…æ‰€æœ‰ä¾èµ–åŒ…å¹¶ç”Ÿæˆå¯æ‰§è¡Œjarï¼›</li>
<li>cobertura-maven-pluginï¼šç”Ÿæˆå•å…ƒæµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Šï¼›</li>
<li>findbugs-maven-pluginï¼šå¯¹Javaæºç è¿›è¡Œé™æ€åˆ†æä»¥æ‰¾å‡ºæ½œåœ¨é—®é¢˜ã€‚</li>
</ul>
<h2 id="5-æ¨¡å—ç®¡ç†"><a href="#5-æ¨¡å—ç®¡ç†" class="headerlink" title="5. æ¨¡å—ç®¡ç†"></a>5. æ¨¡å—ç®¡ç†</h2><h3 id="5-1-åˆ’åˆ†æ¨¡å—"><a href="#5-1-åˆ’åˆ†æ¨¡å—" class="headerlink" title="5.1 åˆ’åˆ†æ¨¡å—"></a>5.1 åˆ’åˆ†æ¨¡å—</h3><p>åœ¨è½¯ä»¶å¼€å‘ä¸­ï¼ŒæŠŠä¸€ä¸ªå¤§é¡¹ç›®åˆ†æ‹†ä¸ºå¤šä¸ªæ¨¡å—æ˜¯é™ä½è½¯ä»¶å¤æ‚åº¦çš„æœ‰æ•ˆæ–¹æ³•ï¼š</p>
<p><img src="https://raw.githubusercontent.com/ghj1998/image_repository/main/image-20210507095556295.png" alt="image-20210507095556295"></p>
<p>å¯¹äºMavenå·¥ç¨‹æ¥è¯´ï¼ŒåŸæ¥æ˜¯ä¸€ä¸ªå¤§é¡¹ç›®ï¼š<img src="https://raw.githubusercontent.com/ghj1998/image_repository/main/image-20210507095613011.png" alt="image-20210507095613011"></p>
<p>ç°åœ¨å¯ä»¥åˆ†æ‹†æˆ3ä¸ªæ¨¡å—ï¼š<img src="https://raw.githubusercontent.com/ghj1998/image_repository/main/image-20210507095623643.png" alt="image-20210507095623643"></p>
<p>Mavenå¯ä»¥æœ‰æ•ˆåœ°ç®¡ç†å¤šä¸ªæ¨¡å—ï¼Œæˆ‘ä»¬åªéœ€è¦æŠŠæ¯ä¸ªæ¨¡å—å½“ä½œä¸€ä¸ªç‹¬ç«‹çš„Mavené¡¹ç›®ï¼Œå®ƒä»¬æœ‰å„è‡ªç‹¬ç«‹çš„<code>pom.xml</code>ã€‚ä¾‹å¦‚ï¼Œæ¨¡å—Açš„<code>pom.xml</code>ï¼š</p>
<p>ä¸‰ä¸ªmoduleçš„pom.xmlé‡å¤åº¦å¾ˆé«˜ï¼Œå¯ä»¥é‡‡ç”¨è¿™ç§ç»“æ„ï¼š</p>
<p><img src="https://raw.githubusercontent.com/ghj1998/image_repository/main/image-20210507100719011.png" alt="image-20210507100719011"></p>
<p><code>parent</code>æœ¬èº«ä¸å«ä»»ä½•Javaä»£ç ã€‚ç¼–å†™<code>parent</code>çš„<code>pom.xml</code>åªæ˜¯ä¸ºäº†åœ¨å„ä¸ªæ¨¡å—ä¸­å‡å°‘é‡å¤çš„é…ç½®ã€‚</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.itranswarp.learnjava<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>parent<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project.reporting.outputEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.reporting.outputEncoding</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>11<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>11<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>11<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.28<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>ch.qos.logback<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>logback-classic<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.junit.jupiter<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit-jupiter-engine<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.5.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>æ¨¡å—Aå°±å¯ä»¥ç®€åŒ–ä¸ºï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.itranswarp.learnjava<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">relativePath</span>&gt;</span>../parent/pom.xml<span class="tag">&lt;/<span class="name">relativePath</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>module-a<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>module-a<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>æ¨¡å—Bã€æ¨¡å—Céƒ½å¯ä»¥ç›´æ¥ä»<code>parent</code>ç»§æ‰¿ï¼Œå¤§å¹…ç®€åŒ–äº†<code>pom.xml</code>çš„ç¼–å†™ã€‚</p>
<p>å¦‚æœæ¨¡å—Aä¾èµ–æ¨¡å—Bï¼Œåˆ™æ¨¡å—Aéœ€è¦æ¨¡å—Bçš„jaråŒ…æ‰èƒ½æ­£å¸¸ç¼–è¯‘ï¼Œæˆ‘ä»¬éœ€è¦åœ¨æ¨¡å—Aä¸­å¼•å…¥æ¨¡å—Bï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.itranswarp.learnjava<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>module-b<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>åœ¨ç¼–è¯‘çš„æ—¶å€™ï¼Œéœ€è¦åœ¨æ ¹ç›®å½•åˆ›å»ºä¸€ä¸ª<code>pom.xml</code>ç»Ÿä¸€ç¼–è¯‘ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.itranswarp.learnjava<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>build<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>build<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">modules</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span>&gt;</span>parent<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span>&gt;</span>module-a<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span>&gt;</span>module-b<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span>&gt;</span>module-c<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">modules</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>åœ¨æ ¹ç›®å½•æ‰§è¡Œ<code>mvn clean package</code>æ—¶ï¼ŒMavenæ ¹æ®æ ¹ç›®å½•çš„<code>pom.xml</code>æ‰¾åˆ°åŒ…æ‹¬<code>parent</code>åœ¨å†…çš„å…±4ä¸ª<code>&lt;module&gt;</code>ï¼Œä¸€æ¬¡æ€§å…¨éƒ¨ç¼–è¯‘ã€‚</p>
<h3 id="5-2-ä¸­å¤®ä»“åº“-amp-ç§æœ‰ä»“åº“-amp-æœ¬åœ°ä»“åº“"><a href="#5-2-ä¸­å¤®ä»“åº“-amp-ç§æœ‰ä»“åº“-amp-æœ¬åœ°ä»“åº“" class="headerlink" title="5.2 ä¸­å¤®ä»“åº“&amp;ç§æœ‰ä»“åº“&amp;æœ¬åœ°ä»“åº“"></a>5.2 ä¸­å¤®ä»“åº“&amp;ç§æœ‰ä»“åº“&amp;æœ¬åœ°ä»“åº“</h3><p><strong>ä¸­å¤®ä»“åº“</strong>å…¶å®æˆ‘ä»¬ä½¿ç”¨çš„å¤§å¤šæ•°ç¬¬ä¸‰æ–¹æ¨¡å—éƒ½æ˜¯è¿™ä¸ªç”¨æ³•ï¼Œä¾‹å¦‚ï¼Œæˆ‘ä»¬ä½¿ç”¨commons loggingã€log4jè¿™äº›ç¬¬ä¸‰æ–¹æ¨¡å—ï¼Œå°±æ˜¯ç¬¬ä¸‰æ–¹æ¨¡å—çš„å¼€å‘è€…è‡ªå·±æŠŠç¼–è¯‘å¥½çš„jaråŒ…å‘å¸ƒåˆ°Mavençš„ä¸­å¤®ä»“åº“ä¸­ã€‚</p>
<p><strong>ç§æœ‰ä»“åº“</strong>æ˜¯æŒ‡å…¬å¸å†…éƒ¨å¦‚æœä¸å¸Œæœ›æŠŠæºç å’ŒjaråŒ…æ”¾åˆ°å…¬ç½‘ä¸Šï¼Œé‚£ä¹ˆå¯ä»¥æ­å»ºç§æœ‰ä»“åº“ã€‚ç§æœ‰ä»“åº“æ€»æ˜¯åœ¨å…¬å¸å†…éƒ¨ä½¿ç”¨ï¼Œå®ƒåªéœ€è¦åœ¨æœ¬åœ°çš„<code>~/.m2/settings.xml</code>ä¸­é…ç½®å¥½ï¼Œä½¿ç”¨æ–¹å¼å’Œä¸­å¤®ä»“ä½æ²¡æœ‰ä»»ä½•åŒºåˆ«ã€‚</p>
<p><strong>æœ¬åœ°ä»“åº“</strong>æ˜¯æŒ‡æŠŠæœ¬åœ°å¼€å‘çš„é¡¹ç›®â€œå‘å¸ƒâ€åœ¨æœ¬åœ°ï¼Œè¿™æ ·å…¶ä»–é¡¹ç›®å¯ä»¥é€šè¿‡æœ¬åœ°ä»“åº“å¼•ç”¨å®ƒã€‚ä½†æ˜¯æˆ‘ä»¬ä¸æ¨èæŠŠè‡ªå·±çš„æ¨¡å—å®‰è£…åˆ°Mavençš„æœ¬åœ°ä»“åº“ï¼Œå› ä¸ºæ¯æ¬¡ä¿®æ”¹æŸä¸ªæ¨¡å—çš„æºç ï¼Œéƒ½éœ€è¦é‡æ–°å®‰è£…ï¼Œéå¸¸å®¹æ˜“å‡ºç°ç‰ˆæœ¬ä¸ä¸€è‡´çš„æƒ…å†µã€‚æ›´å¥½çš„æ–¹æ³•æ˜¯ä½¿ç”¨æ¨¡å—åŒ–ç¼–è¯‘ï¼Œåœ¨ç¼–è¯‘çš„æ—¶å€™ï¼Œå‘Šè¯‰Mavenå‡ ä¸ªæ¨¡å—ä¹‹é—´å­˜åœ¨ä¾èµ–å…³ç³»ï¼Œéœ€è¦ä¸€å—ç¼–è¯‘ï¼ŒMavenå°±ä¼šè‡ªåŠ¨æŒ‰ä¾èµ–é¡ºåºç¼–è¯‘è¿™äº›æ¨¡å—ã€‚</p>
<h2 id="6-mvnw"><a href="#6-mvnw" class="headerlink" title="6. mvnw"></a>6. mvnw</h2><p>Maven Wrapperå°±æ˜¯ç»™ä¸€ä¸ªé¡¹ç›®æä¾›ä¸€ä¸ªç‹¬ç«‹çš„ï¼ŒæŒ‡å®šç‰ˆæœ¬çš„Mavenç»™å®ƒä½¿ç”¨ã€‚</p>
<h3 id="6-1-å®‰è£…maven-wrapper"><a href="#6-1-å®‰è£…maven-wrapper" class="headerlink" title="6.1 å®‰è£…maven wrapper"></a>6.1 å®‰è£…maven wrapper</h3><p>å®‰è£…Maven Wrapperæœ€ç®€å•çš„æ–¹å¼æ˜¯åœ¨é¡¹ç›®çš„æ ¹ç›®å½•ï¼ˆå³<code>pom.xml</code>æ‰€åœ¨çš„ç›®å½•ï¼‰ä¸‹è¿è¡Œå®‰è£…å‘½ä»¤ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mvn -N io.takari:maven:0.7.6:wrapper</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„<code>0.7.6</code>æ˜¯Maven Wrapperçš„ç‰ˆæœ¬ã€‚æœ€æ–°çš„Maven Wrapperç‰ˆæœ¬å¯ä»¥å»<a href="https://github.com/takari/maven-wrapper">å®˜æ–¹ç½‘ç«™</a>æŸ¥çœ‹ã€‚</p>
<p>å¦‚æœè¦æŒ‡å®šä½¿ç”¨çš„Mavenç‰ˆæœ¬ï¼Œä½¿ç”¨ä¸‹é¢çš„å®‰è£…å‘½ä»¤æŒ‡å®šç‰ˆæœ¬ï¼Œä¾‹å¦‚<code>3.3.3</code>ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mvn -N io.takari:maven:0.7.6:wrapper -Dmaven=3.3.3</span><br></pre></td></tr></table></figure>

<p>é¡¹ç›®ç»“æ„</p>
<p><img src="https://raw.githubusercontent.com/ghj1998/image_repository/main/image-20210507101314481.png" alt="image-20210507101314481"></p>
<p>å¤šäº†<code>mvnw</code>ã€<code>mvnw.cmd</code>å’Œ<code>.mvn</code>ç›®å½•ï¼Œæˆ‘ä»¬åªéœ€è¦æŠŠ<code>mvn</code>å‘½ä»¤æ”¹æˆ<code>mvnw</code>å°±å¯ä»¥ä½¿ç”¨è·Ÿé¡¹ç›®å…³è”çš„Mavenã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mvnw clean package</span><br></pre></td></tr></table></figure>

<p>åœ¨Linuxæˆ–macOSä¸‹è¿è¡Œæ—¶éœ€è¦åŠ ä¸Š<code>./</code>ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">./mvnw clean package</span><br></pre></td></tr></table></figure>

<h2 id="7-å‘å¸ƒArtifact"><a href="#7-å‘å¸ƒArtifact" class="headerlink" title="7. å‘å¸ƒArtifact"></a>7. å‘å¸ƒArtifact</h2><p>å¦‚ä½•å‘å¸ƒè‡ªå·±çš„åº“åˆ°Mavençš„repoä¸­ï¼Ÿ</p>
<h3 id="7-1-é™æ€æ–‡ä»¶å‘å¸ƒ"><a href="#7-1-é™æ€æ–‡ä»¶å‘å¸ƒ" class="headerlink" title="7.1 é™æ€æ–‡ä»¶å‘å¸ƒ"></a>7.1 é™æ€æ–‡ä»¶å‘å¸ƒ</h3><p>å…ˆåˆ›å»ºMavenå·¥ç¨‹ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š</p>
<p><img src="https://raw.githubusercontent.com/ghj1998/image_repository/main/image-20210507102738176.png" alt="image-20210507102738176"></p>
<p>â€‹    åœ¨<code>pom.xml</code>ä¸­æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">...</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="tag">&lt;<span class="name">distributionManagement</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>local-repo-release<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">name</span>&gt;</span>GitHub Release<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">url</span>&gt;</span>file://$&#123;project.basedir&#125;/maven-repo<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">distributionManagement</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-source-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">id</span>&gt;</span>attach-sources<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">phase</span>&gt;</span>package<span class="tag">&lt;/<span class="name">phase</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">goal</span>&gt;</span>jar-no-fork<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-javadoc-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">id</span>&gt;</span>attach-javadocs<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">phase</span>&gt;</span>package<span class="tag">&lt;/<span class="name">phase</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">goal</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>&lt;distributionManagement&gt;</code>ï¼Œå®ƒæŒ‡ç¤ºäº†å‘å¸ƒçš„è½¯ä»¶åŒ…çš„ä½ç½®ï¼Œè¿™é‡Œçš„<code>&lt;url&gt;</code>æ˜¯é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„<code>maven-repo</code>ç›®å½•ï¼Œåœ¨<code>&lt;build&gt;</code>ä¸­å®šä¹‰çš„ä¸¤ä¸ªæ’ä»¶<code>maven-source-plugin</code>å’Œ<code>maven-javadoc-plugin</code>åˆ†åˆ«ç”¨æ¥åˆ›å»ºæºç å’Œjavadocï¼Œå¦‚æœä¸æƒ³å‘å¸ƒæºç ï¼Œå¯ä»¥æŠŠå¯¹åº”çš„æ’ä»¶å»æ‰ã€‚</p>
<p>æˆ‘ä»¬ç›´æ¥åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹è¿è¡ŒMavenå‘½ä»¤<code>mvn clean package deploy</code>ï¼Œå¦‚æœä¸€åˆ‡é¡ºåˆ©ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨<code>maven-repo</code>ç›®å½•ä¸‹æ‰¾åˆ°éƒ¨ç½²åçš„æ‰€æœ‰æ–‡ä»¶å¦‚ä¸‹ï¼š</p>
<p><img src="https://raw.githubusercontent.com/ghj1998/image_repository/main/image-20210507103421389.png" alt="image-20210507103421389"></p>
<p>æœ€åä¸€æ­¥ï¼Œæ˜¯æŠŠè¿™ä¸ªå·¥ç¨‹æ¨åˆ°GitHubä¸Šï¼Œå¹¶é€‰æ‹©<code>Settings</code>-<code>GitHub Pages</code>ï¼Œé€‰æ‹©<code>master branch</code>å¯ç”¨PagesæœåŠ¡ï¼š</p>
<p>è¿™æ ·ï¼ŒæŠŠå…¨éƒ¨å†…å®¹æ¨é€è‡³GitHubåï¼Œå³å¯ä½œä¸ºé™æ€ç½‘ç«™è®¿é—®Mavençš„repoï¼Œå®ƒçš„åœ°å€æ˜¯<a href="https://michaelliao.github.io/how-to-become-rich/maven-repo/%E3%80%82%E7%89%88%E6%9C%AC%601.0.0%60%E5%AF%B9%E5%BA%94%E7%9A%84jar%E5%8C%85%E5%9C%B0%E5%9D%80%E6%98%AF%EF%BC%9A">https://michaelliao.github.io/how-to-become-rich/maven-repo/ã€‚ç‰ˆæœ¬`1.0.0`å¯¹åº”çš„jaråŒ…åœ°å€æ˜¯ï¼š</a></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https:&#x2F;&#x2F;michaelliao.github.io&#x2F;how-to-become-rich&#x2F;maven-repo&#x2F;com&#x2F;itranswarp&#x2F;rich&#x2F;how-to-become-rich&#x2F;1.0.0&#x2F;how-to-become-rich-1.0.0.jar</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨ï¼Œå¦‚æœå…¶ä»–äººå¸Œæœ›å¼•ç”¨è¿™ä¸ªMavenåŒ…ï¼Œæˆ‘ä»¬å¯ä»¥å‘ŠçŸ¥å¦‚ä¸‹ä¾èµ–å³å¯ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.itranswarp.rich<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>how-to-become-rich<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>é™¤äº†æ­£å¸¸å¯¼å…¥ä¾èµ–å¤–ï¼Œå¯¹æ–¹è¿˜éœ€è¦å†æ·»åŠ ä¸€ä¸ª<code>&lt;repository&gt;</code>çš„å£°æ˜ï¼Œå³ä½¿ç”¨æ–¹å®Œæ•´çš„<code>pom.xml</code>å¦‚ä¸‹ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>how-to-become-rich-usage<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>11<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>11<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>11<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">repositories</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>github-rich-repo<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">name</span>&gt;</span>The Maven Repository on Github<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">url</span>&gt;</span>https://michaelliao.github.io/how-to-become-rich/maven-repo/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">repositories</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.itranswarp.rich<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>how-to-become-rich<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>åœ¨<code>&lt;repository&gt;</code>ä¸­ï¼Œæˆ‘ä»¬å¿…é¡»å£°æ˜å‘å¸ƒçš„Mavençš„repoåœ°å€ï¼Œå…¶ä¸­<code>&lt;id&gt;</code>å’Œ<code>&lt;name&gt;</code>å¯ä»¥ä»»æ„å¡«å†™ï¼Œ<code>&lt;url&gt;</code>å¡«å…¥GitHub Pagesæä¾›çš„åœ°å€+<code>/maven-repo/</code>åç¼€ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Millionaire millionaire = <span class="keyword">new</span> Millionaire();</span><br><span class="line">System.out.println(millionaire.howToBecomeRich());</span><br></pre></td></tr></table></figure>

<p>å‘å¸ƒåˆ°ä¸­å¤®ä»“åº“åï¼Œä¸éœ€è¦å‘Šè¯‰Mavenä»“åº“åœ°å€ï¼Œå› ä¸ºå®ƒçŸ¥é“ä¸­å¤®ä»“åº“çš„åœ°å€é»˜è®¤æ˜¯<a href="https://repo1.maven.org/maven2/">https://repo1.maven.org/maven2/</a></p>
<p>å› ä¸ºGitHub Pageså¹¶ä¸ä¼šæŠŠæˆ‘ä»¬å‘å¸ƒçš„MavenåŒ…åŒæ­¥åˆ°ä¸­å¤®ä»“åº“ï¼Œæ‰€ä»¥è‡ªç„¶ä½¿ç”¨æ–¹å¿…é¡»æ‰‹åŠ¨æ·»åŠ ä¸€ä¸ªæˆ‘ä»¬æä¾›çš„ä»“åº“åœ°å€ã€‚</p>
<h3 id="7-2-é€šè¿‡Nexuså‘å¸ƒåˆ°ä¸­å¤®ä»“åº“"><a href="#7-2-é€šè¿‡Nexuså‘å¸ƒåˆ°ä¸­å¤®ä»“åº“" class="headerlink" title="7.2 é€šè¿‡Nexuså‘å¸ƒåˆ°ä¸­å¤®ä»“åº“"></a>7.2 é€šè¿‡Nexuså‘å¸ƒåˆ°ä¸­å¤®ä»“åº“</h3><p><a href="https://www.sonatype.com/nexus-repository-oss">Nexus</a>æ˜¯ä¸€ä¸ªæ”¯æŒMavenä»“åº“çš„è½¯ä»¶ï¼Œç”±Sonatypeå¼€å‘ï¼Œæœ‰å…è´¹ç‰ˆå’Œä¸“ä¸šç‰ˆä¸¤ä¸ªç‰ˆæœ¬ï¼Œå¾ˆå¤šå¤§å…¬å¸å†…éƒ¨éƒ½ä½¿ç”¨Nexusä½œä¸ºè‡ªå·±çš„ç§æœ‰Mavenä»“åº“ï¼Œè€Œè¿™ä¸ª<a href="https://central.sonatype.org/">central.sonatype.org</a>ç›¸å½“äºé¢å‘å¼€æºçš„ä¸€ä¸ªNexuså…¬å…±æœåŠ¡ã€‚</p>
<p>æˆ‘ä»¬æŠŠè‡ªå·±çš„ä»“åº“å‘å¸ƒåˆ°<a href="https://central.sonatype.org/">central.sonatype.org</a>ï¼Œå®ƒä¼šå®šæœŸè‡ªåŠ¨åŒæ­¥åˆ°Mavençš„ä¸­å¤®ä»“åº“ã€‚</p>
<p>å…·ä½“ç”¨åˆ°äº†å†æŸ¥èµ„æ–™ã€‚</p>
<h3 id="7-3-å‘å¸ƒåˆ°ç§æœ‰ä»“åº“"><a href="#7-3-å‘å¸ƒåˆ°ç§æœ‰ä»“åº“" class="headerlink" title="7.3 å‘å¸ƒåˆ°ç§æœ‰ä»“åº“"></a>7.3 å‘å¸ƒåˆ°ç§æœ‰ä»“åº“</h3><p>é€šè¿‡<code>nexus-staging-maven-plugin</code>é™¤äº†å¯ä»¥å‘å¸ƒåˆ°<a href="https://central.sonatype.org/">central.sonatype.org</a>å¤–ï¼Œä¹Ÿå¯ä»¥å‘å¸ƒåˆ°ç§æœ‰ä»“åº“ï¼Œä¾‹å¦‚ï¼Œå…¬å¸å†…éƒ¨è‡ªå·±æ­å»ºçš„NexusæœåŠ¡å™¨ã€‚</p>
<p>å¦‚æœæ²¡æœ‰ç§æœ‰NexusæœåŠ¡å™¨ï¼Œè¿˜å¯ä»¥å‘å¸ƒåˆ°<a href="https://github.com/features/packages">GitHub Packages</a>ã€‚GitHub Packagesæ˜¯GitHubæä¾›çš„ä»“åº“æœåŠ¡ï¼Œæ”¯æŒMavenã€NPMã€Dockerç­‰ã€‚ä½¿ç”¨GitHub Packagesæ—¶ï¼Œæ— è®ºæ˜¯å‘å¸ƒArtifactï¼Œè¿˜æ˜¯å¼•ç”¨å·²å‘å¸ƒçš„Artifactï¼Œéƒ½éœ€è¦æ˜ç¡®çš„æˆæƒTokenï¼Œå› æ­¤ï¼ŒGitHub Packagesåªèƒ½ä½œä¸ºç§æœ‰ä»“åº“ä½¿ç”¨ã€‚</p>
<p>åœ¨å‘å¸ƒå‰ï¼Œæˆ‘ä»¬å¿…é¡»é¦–å…ˆç™»å½•ååœ¨ç”¨æˆ·çš„<code>Settings</code>-<code>Developer settings</code>-<code>Personal access tokens</code>ä¸­åˆ›å»ºä¸¤ä¸ªTokenï¼Œä¸€ä¸ªç”¨äºå‘å¸ƒï¼Œä¸€ä¸ªç”¨äºä½¿ç”¨ã€‚å‘å¸ƒArtifactçš„Tokenå¿…é¡»æœ‰<code>repo</code>ã€<code>write:packages</code>å’Œ<code>read:packages</code>æƒé™ï¼š</p>
<p><img src="https://www.liaoxuefeng.com/files/attachments/1347999282233410/l" alt="token-scopes"></p>
<p>ä½¿ç”¨Artifactçš„Tokenåªéœ€è¦<code>read:packages</code>æƒé™ã€‚</p>
<p>åœ¨å‘å¸ƒç«¯ï¼ŒæŠŠGitHubçš„ç”¨æˆ·åå’Œå‘å¸ƒTokenå†™å…¥<code>~/.m2/settings.xml</code>é…ç½®ä¸­ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">settings</span> <span class="attr">...</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="tag">&lt;<span class="name">servers</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">server</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>github-release<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">username</span>&gt;</span>GITHUB-USERNAME<span class="tag">&lt;/<span class="name">username</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">password</span>&gt;</span>f052...c21f<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">server</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ç„¶åï¼Œåœ¨éœ€è¦å‘å¸ƒçš„Artifactçš„<code>pom.xml</code>ä¸­ï¼Œæ·»åŠ ä¸€ä¸ª<code>&lt;repository&gt;</code>å£°æ˜ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">...</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="tag">&lt;<span class="name">distributionManagement</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>github-release<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">name</span>&gt;</span>GitHub Release<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">url</span>&gt;</span>https://maven.pkg.github.com/michaelliao/complex<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">distributionManagement</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>æ³¨æ„åˆ°<code>&lt;id&gt;</code>å’Œ<code>~/.m2/settings.xml</code>é…ç½®ä¸­çš„<code>&lt;id&gt;</code>è¦ä¿æŒä¸€è‡´ï¼Œå› ä¸ºå‘å¸ƒæ—¶Mavenæ ¹æ®idæ‰¾åˆ°ç”¨äºç™»å½•çš„ç”¨æˆ·åå’ŒTokenï¼Œæ‰èƒ½æˆåŠŸä¸Šä¼ æ–‡ä»¶åˆ°GitHubã€‚æˆ‘ä»¬ç›´æ¥é€šè¿‡å‘½ä»¤<code>mvn clean package deploy</code>éƒ¨ç½²ï¼ŒæˆåŠŸåï¼Œåœ¨GitHubç”¨æˆ·é¡µé¢å¯ä»¥çœ‹åˆ°è¯¥Artifactï¼š</p>
<p><img src="https://www.liaoxuefeng.com/files/attachments/1348000710393922/l" alt="github-packages"></p>
<p>ä½¿ç”¨è¯¥Artifactæ—¶ï¼Œå› ä¸ºGitHubçš„Packageåªèƒ½ä½œä¸ºç§æœ‰ä»“åº“ä½¿ç”¨ï¼Œæ‰€ä»¥é™¤äº†åœ¨ä½¿ç”¨æ–¹çš„<code>pom.xml</code>ä¸­å£°æ˜<code>&lt;repository&gt;</code>å¤–ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">...</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="tag">&lt;<span class="name">repositories</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>github-release<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">name</span>&gt;</span>GitHub Release<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">url</span>&gt;</span>https://maven.pkg.github.com/michaelliao/complex<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">repositories</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.itranswarp<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>complex<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>è¿˜éœ€è¦æŠŠæœ‰è¯»æƒé™çš„Tokené…ç½®åˆ°<code>~/.m2/settings.xml</code>æ–‡ä»¶ä¸­ã€‚</p>
]]></content>
      <tags>
        <tag>JAVA</tag>
        <tag>Maven</tag>
      </tags>
  </entry>
  <entry>
    <title>å¤šç§åŠ å¯†ç®—æ³•</title>
    <url>/2021/05/06/%E5%A4%9A%E7%A7%8D%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95/</url>
    <content><![CDATA[<h1 id="å¤šç§åŠ å¯†ç®—æ³•"><a href="#å¤šç§åŠ å¯†ç®—æ³•" class="headerlink" title="å¤šç§åŠ å¯†ç®—æ³•"></a>å¤šç§åŠ å¯†ç®—æ³•</h1><h2 id="1-å¯¹ç§°åŠ å¯†ç®—æ³•"><a href="#1-å¯¹ç§°åŠ å¯†ç®—æ³•" class="headerlink" title="1. å¯¹ç§°åŠ å¯†ç®—æ³•"></a>1. å¯¹ç§°åŠ å¯†ç®—æ³•</h2><p>å¯¹ç§°åŠ å¯†ç®—æ³•å°±æ˜¯ä¼ ç»Ÿçš„ç”¨ä¸€ä¸ªå¯†ç è¿›è¡ŒåŠ å¯†å’Œè§£å¯†ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¸¸ç”¨çš„WinZIPå’ŒWinRARå¯¹å‹ç¼©åŒ…çš„åŠ å¯†å’Œè§£å¯†ï¼Œå°±æ˜¯ä½¿ç”¨å¯¹ç§°åŠ å¯†ç®—æ³•ï¼š</p>
<p>åŠ å¯†å…¶å®å°±æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œè¾“å…¥å¯†ç å’Œæ˜æ–‡ï¼Œå¾—åˆ°å¯†æ–‡ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">secret = encrypt(key, message);</span><br></pre></td></tr></table></figure>

<p>è§£å¯†å°±æ˜¯æ¥æ”¶å¯†ç å’Œå¯†æ–‡ï¼Œå¾—åˆ°æ˜æ–‡ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">plain = decrypt(key, secret);</span><br></pre></td></tr></table></figure>

<p>è½¯ä»¶å¼€å‘ä¸­ï¼Œå¸¸ç”¨çš„å¯¹ç§°åŠ å¯†ç®—æ³•æœ‰ï¼š</p>
<table>
<thead>
<tr>
<th align="left">ç®—æ³•</th>
<th align="left">å¯†é’¥é•¿åº¦</th>
<th align="left">å·¥ä½œæ¨¡å¼</th>
<th align="left">å¡«å……æ¨¡å¼</th>
</tr>
</thead>
<tbody><tr>
<td align="left">DES</td>
<td align="left">56/64</td>
<td align="left">ECB/CBC/PCBC/CTR/â€¦</td>
<td align="left">NoPadding/PKCS5Padding/â€¦</td>
</tr>
<tr>
<td align="left">AES</td>
<td align="left">128/192/256</td>
<td align="left">ECB/CBC/PCBC/CTR/â€¦</td>
<td align="left">NoPadding/PKCS5Padding/PKCS7Padding/â€¦</td>
</tr>
<tr>
<td align="left">IDEA</td>
<td align="left">128</td>
<td align="left">ECB</td>
<td align="left">PKCS5Padding/PKCS7Padding/â€¦</td>
</tr>
</tbody></table>
<p><em>DESç”±äºå¯†é’¥è¿‡çŸ­ï¼Œå®¹æ˜“è¢«ç ´è§£ï¼Œå·²ç»ä¸å®‰å…¨ã€‚</em></p>
<h3 id="1-1-AESåŠ å¯†"><a href="#1-1-AESåŠ å¯†" class="headerlink" title="1.1 AESåŠ å¯†"></a>1.1 AESåŠ å¯†</h3><p>AESç®—æ³•æ˜¯ç›®å‰åº”ç”¨æœ€å¹¿æ³›çš„åŠ å¯†ç®—æ³•ã€‚æˆ‘ä»¬å…ˆç”¨ECBæ¨¡å¼åŠ å¯†å¹¶è§£å¯†ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.security.*;</span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.crypto.*;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.spec.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// åŸæ–‡:</span></span><br><span class="line">        String message = <span class="string">&quot;Hello, world!&quot;</span>;</span><br><span class="line">        System.out.println(<span class="string">&quot;Message: &quot;</span> + message);</span><br><span class="line">        <span class="comment">// 128ä½å¯†é’¥ = 16 bytes Key:</span></span><br><span class="line">        <span class="keyword">byte</span>[] key = <span class="string">&quot;1234567890abcdef&quot;</span>.getBytes(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">        <span class="comment">// åŠ å¯†:</span></span><br><span class="line">        <span class="keyword">byte</span>[] data = message.getBytes(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">        <span class="keyword">byte</span>[] encrypted = encrypt(key, data);</span><br><span class="line">        System.out.println(<span class="string">&quot;Encrypted: &quot;</span> + Base64.getEncoder().encodeToString(encrypted));</span><br><span class="line">        <span class="comment">// è§£å¯†:</span></span><br><span class="line">        <span class="keyword">byte</span>[] decrypted = decrypt(key, encrypted);</span><br><span class="line">        System.out.println(<span class="string">&quot;Decrypted: &quot;</span> + <span class="keyword">new</span> String(decrypted, <span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åŠ å¯†:</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">byte</span>[] encrypt(<span class="keyword">byte</span>[] key, <span class="keyword">byte</span>[] input) <span class="keyword">throws</span> GeneralSecurityException &#123;</span><br><span class="line">        Cipher cipher = Cipher.getInstance(<span class="string">&quot;AES/ECB/PKCS5Padding&quot;</span>);</span><br><span class="line">        SecretKey keySpec = <span class="keyword">new</span> SecretKeySpec(key, <span class="string">&quot;AES&quot;</span>);</span><br><span class="line">        cipher.init(Cipher.ENCRYPT_MODE, keySpec);</span><br><span class="line">        <span class="keyword">return</span> cipher.doFinal(input);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è§£å¯†:</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">byte</span>[] decrypt(<span class="keyword">byte</span>[] key, <span class="keyword">byte</span>[] input) <span class="keyword">throws</span> GeneralSecurityException &#123;</span><br><span class="line">        Cipher cipher = Cipher.getInstance(<span class="string">&quot;AES/ECB/PKCS5Padding&quot;</span>);</span><br><span class="line">        SecretKey keySpec = <span class="keyword">new</span> SecretKeySpec(key, <span class="string">&quot;AES&quot;</span>);</span><br><span class="line">        cipher.init(Cipher.DECRYPT_MODE, keySpec);</span><br><span class="line">        <span class="keyword">return</span> cipher.doFinal(input);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Message: Hello, world!</span></span><br><span class="line"><span class="comment">Encrypted: 2xiGROlFBhC57b7EGu5c3g==</span></span><br><span class="line"><span class="comment">Decrypted: Hello, world!</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p>Javaæ ‡å‡†åº“æä¾›çš„å¯¹ç§°åŠ å¯†æ¥å£éå¸¸ç®€å•ï¼Œä½¿ç”¨æ—¶æŒ‰ä»¥ä¸‹æ­¥éª¤ç¼–å†™ä»£ç ï¼š</p>
<ol>
<li>æ ¹æ®ç®—æ³•åç§°/å·¥ä½œæ¨¡å¼/å¡«å……æ¨¡å¼è·å–Cipherå®ä¾‹ï¼›</li>
<li>æ ¹æ®ç®—æ³•åç§°åˆå§‹åŒ–ä¸€ä¸ªSecretKeyå®ä¾‹ï¼Œå¯†é’¥å¿…é¡»æ˜¯æŒ‡å®šé•¿åº¦ï¼›</li>
<li>ä½¿ç”¨SerectKeyåˆå§‹åŒ–Cipherå®ä¾‹ï¼Œå¹¶è®¾ç½®åŠ å¯†æˆ–è§£å¯†æ¨¡å¼ï¼›</li>
<li>ä¼ å…¥æ˜æ–‡æˆ–å¯†æ–‡ï¼Œè·å¾—å¯†æ–‡æˆ–æ˜æ–‡ã€‚</li>
</ol>
<p>ECBæ¨¡å¼æ˜¯æœ€ç®€å•çš„AESåŠ å¯†æ¨¡å¼ï¼Œå®ƒåªéœ€è¦ä¸€ä¸ªå›ºå®šé•¿åº¦çš„å¯†é’¥ï¼Œå›ºå®šçš„æ˜æ–‡ä¼šç”Ÿæˆå›ºå®šçš„å¯†æ–‡ï¼Œè¿™ç§ä¸€å¯¹ä¸€çš„åŠ å¯†æ–¹å¼ä¼šå¯¼è‡´å®‰å…¨æ€§é™ä½ï¼Œæ›´å¥½çš„æ–¹å¼æ˜¯é€šè¿‡<strong>CBCæ¨¡å¼</strong>ï¼Œå®ƒéœ€è¦<strong>ä¸€ä¸ªéšæœºæ•°ä½œä¸ºIVå‚æ•°</strong>ï¼Œè¿™æ ·å¯¹äºåŒä¸€ä»½æ˜æ–‡ï¼Œæ¯æ¬¡ç”Ÿæˆçš„å¯†æ–‡éƒ½ä¸åŒï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// åŸæ–‡:</span></span><br><span class="line">        String message = <span class="string">&quot;Hello, world!&quot;</span>;</span><br><span class="line">        System.out.println(<span class="string">&quot;Message: &quot;</span> + message);</span><br><span class="line">        <span class="comment">// 256ä½å¯†é’¥ = 32 bytes Key:</span></span><br><span class="line">        <span class="keyword">byte</span>[] key = <span class="string">&quot;1234567890abcdef1234567890abcdef&quot;</span>.getBytes(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">        <span class="comment">// åŠ å¯†:</span></span><br><span class="line">        <span class="keyword">byte</span>[] data = message.getBytes(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">        <span class="keyword">byte</span>[] encrypted = encrypt(key, data);</span><br><span class="line">        System.out.println(<span class="string">&quot;Encrypted: &quot;</span> + Base64.getEncoder().encodeToString(encrypted));</span><br><span class="line">        <span class="comment">// è§£å¯†:</span></span><br><span class="line">        <span class="keyword">byte</span>[] decrypted = decrypt(key, encrypted);</span><br><span class="line">        System.out.println(<span class="string">&quot;Decrypted: &quot;</span> + <span class="keyword">new</span> String(decrypted, <span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åŠ å¯†:</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">byte</span>[] encrypt(<span class="keyword">byte</span>[] key, <span class="keyword">byte</span>[] input) <span class="keyword">throws</span> GeneralSecurityException &#123;</span><br><span class="line">        Cipher cipher = Cipher.getInstance(<span class="string">&quot;AES/CBC/PKCS5Padding&quot;</span>);</span><br><span class="line">        SecretKeySpec keySpec = <span class="keyword">new</span> SecretKeySpec(key, <span class="string">&quot;AES&quot;</span>);</span><br><span class="line">        <span class="comment">// CBCæ¨¡å¼éœ€è¦ç”Ÿæˆä¸€ä¸ª16 bytesçš„initialization vector:</span></span><br><span class="line">        SecureRandom sr = SecureRandom.getInstanceStrong();</span><br><span class="line">        <span class="keyword">byte</span>[] iv = sr.generateSeed(<span class="number">16</span>);</span><br><span class="line">        IvParameterSpec ivps = <span class="keyword">new</span> IvParameterSpec(iv);</span><br><span class="line">        cipher.init(Cipher.ENCRYPT_MODE, keySpec, ivps);</span><br><span class="line">        <span class="keyword">byte</span>[] data = cipher.doFinal(input);</span><br><span class="line">        <span class="comment">// IVä¸éœ€è¦ä¿å¯†ï¼ŒæŠŠIVå’Œå¯†æ–‡ä¸€èµ·è¿”å›:</span></span><br><span class="line">        <span class="keyword">return</span> join(iv, data);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è§£å¯†:</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">byte</span>[] decrypt(<span class="keyword">byte</span>[] key, <span class="keyword">byte</span>[] input) <span class="keyword">throws</span> GeneralSecurityException &#123;</span><br><span class="line">        <span class="comment">// æŠŠinputåˆ†å‰²æˆIVå’Œå¯†æ–‡:</span></span><br><span class="line">        <span class="keyword">byte</span>[] iv = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">16</span>];</span><br><span class="line">        <span class="keyword">byte</span>[] data = <span class="keyword">new</span> <span class="keyword">byte</span>[input.length - <span class="number">16</span>];</span><br><span class="line">        System.arraycopy(input, <span class="number">0</span>, iv, <span class="number">0</span>, <span class="number">16</span>);</span><br><span class="line">        System.arraycopy(input, <span class="number">16</span>, data, <span class="number">0</span>, data.length);</span><br><span class="line">        <span class="comment">// è§£å¯†:</span></span><br><span class="line">        Cipher cipher = Cipher.getInstance(<span class="string">&quot;AES/CBC/PKCS5Padding&quot;</span>);</span><br><span class="line">        SecretKeySpec keySpec = <span class="keyword">new</span> SecretKeySpec(key, <span class="string">&quot;AES&quot;</span>);</span><br><span class="line">        IvParameterSpec ivps = <span class="keyword">new</span> IvParameterSpec(iv);</span><br><span class="line">        cipher.init(Cipher.DECRYPT_MODE, keySpec, ivps);</span><br><span class="line">        <span class="keyword">return</span> cipher.doFinal(data);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">byte</span>[] join(<span class="keyword">byte</span>[] bs1, <span class="keyword">byte</span>[] bs2) &#123;</span><br><span class="line">        <span class="keyword">byte</span>[] r = <span class="keyword">new</span> <span class="keyword">byte</span>[bs1.length + bs2.length];</span><br><span class="line">        System.arraycopy(bs1, <span class="number">0</span>, r, <span class="number">0</span>, bs1.length);</span><br><span class="line">        System.arraycopy(bs2, <span class="number">0</span>, r, bs1.length, bs2.length);</span><br><span class="line">        <span class="keyword">return</span> r;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨CBCæ¨¡å¼ä¸‹ï¼Œéœ€è¦ä¸€ä¸ªéšæœºç”Ÿæˆçš„16å­—èŠ‚IVå‚æ•°ï¼Œå¿…é¡»ä½¿ç”¨<code>SecureRandom</code>ç”Ÿæˆã€‚å› ä¸ºå¤šäº†ä¸€ä¸ª<code>IvParameterSpec</code>å®ä¾‹ï¼Œå› æ­¤ï¼Œåˆå§‹åŒ–æ–¹æ³•éœ€è¦è°ƒç”¨<code>Cipher</code>çš„ä¸€ä¸ªé‡è½½æ–¹æ³•å¹¶ä¼ å…¥<code>IvParameterSpec</code>ã€‚</p>
<h2 id="2-å£ä»¤åŠ å¯†ç®—æ³•"><a href="#2-å£ä»¤åŠ å¯†ç®—æ³•" class="headerlink" title="2. å£ä»¤åŠ å¯†ç®—æ³•"></a>2. å£ä»¤åŠ å¯†ç®—æ³•</h2><p>å®é™…ä¸Šç”¨æˆ·è¾“å…¥çš„å£ä»¤å¹¶ä¸èƒ½ç›´æ¥ä½œä¸ºAESçš„å¯†é’¥è¿›è¡ŒåŠ å¯†ï¼ˆé™¤éé•¿åº¦æ°å¥½æ˜¯128/192/256ä½ï¼‰ï¼Œå¹¶ä¸”ç”¨æˆ·è¾“å…¥çš„å£ä»¤ä¸€èˆ¬éƒ½æœ‰è§„å¾‹ï¼Œå®‰å…¨æ€§è¿œè¿œä¸å¦‚å®‰å…¨éšæœºæ•°äº§ç”Ÿçš„éšæœºå£ä»¤ã€‚å› æ­¤ï¼Œç”¨æˆ·è¾“å…¥çš„å£ä»¤ï¼Œé€šå¸¸è¿˜éœ€è¦ä½¿ç”¨PBEç®—æ³•ï¼Œé‡‡ç”¨éšæœºæ•°æ‚å‡‘è®¡ç®—å‡ºçœŸæ­£çš„å¯†é’¥ï¼Œå†è¿›è¡ŒåŠ å¯†ã€‚</p>
<p>PBEå°±æ˜¯Password Based Encryptionçš„ç¼©å†™ï¼Œå®ƒçš„ä½œç”¨å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">key = generate(userPassword, secureRandomPassword);</span><br></pre></td></tr></table></figure>

<p>PBEçš„ä½œç”¨å°±æ˜¯æŠŠç”¨æˆ·è¾“å…¥çš„å£ä»¤å’Œä¸€ä¸ªå®‰å…¨éšæœºçš„å£ä»¤é‡‡ç”¨æ‚å‡‘åè®¡ç®—å‡ºçœŸæ­£çš„å¯†é’¥ã€‚</p>
<p>ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// æŠŠBouncyCastleä½œä¸ºProvideræ·»åŠ åˆ°java.security:</span></span><br><span class="line">        Security.addProvider(<span class="keyword">new</span> BouncyCastleProvider());</span><br><span class="line">        <span class="comment">// åŸæ–‡:</span></span><br><span class="line">        String message = <span class="string">&quot;Hello, world!&quot;</span>;</span><br><span class="line">        <span class="comment">// åŠ å¯†å£ä»¤:</span></span><br><span class="line">        String password = <span class="string">&quot;hello12345&quot;</span>;</span><br><span class="line">        <span class="comment">// 16 byteséšæœºSalt:</span></span><br><span class="line">        <span class="keyword">byte</span>[] salt = SecureRandom.getInstanceStrong().generateSeed(<span class="number">16</span>);</span><br><span class="line">        System.out.printf(<span class="string">&quot;salt: %032x\n&quot;</span>, <span class="keyword">new</span> BigInteger(<span class="number">1</span>, salt));</span><br><span class="line">        <span class="comment">// åŠ å¯†:</span></span><br><span class="line">        <span class="keyword">byte</span>[] data = message.getBytes(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">        <span class="keyword">byte</span>[] encrypted = encrypt(password, salt, data);</span><br><span class="line">        System.out.println(<span class="string">&quot;encrypted: &quot;</span> + Base64.getEncoder().encodeToString(encrypted));</span><br><span class="line">        <span class="comment">// è§£å¯†:</span></span><br><span class="line">        <span class="keyword">byte</span>[] decrypted = decrypt(password, salt, encrypted);</span><br><span class="line">        System.out.println(<span class="string">&quot;decrypted: &quot;</span> + <span class="keyword">new</span> String(decrypted, <span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åŠ å¯†:</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">byte</span>[] encrypt(String password, <span class="keyword">byte</span>[] salt, <span class="keyword">byte</span>[] input) <span class="keyword">throws</span> GeneralSecurityException &#123;</span><br><span class="line">        PBEKeySpec keySpec = <span class="keyword">new</span> PBEKeySpec(password.toCharArray());</span><br><span class="line">        SecretKeyFactory skeyFactory = SecretKeyFactory.getInstance(<span class="string">&quot;PBEwithSHA1and128bitAES-CBC-BC&quot;</span>);</span><br><span class="line">        SecretKey skey = skeyFactory.generateSecret(keySpec);</span><br><span class="line">        PBEParameterSpec pbeps = <span class="keyword">new</span> PBEParameterSpec(salt, <span class="number">1000</span>);</span><br><span class="line">        Cipher cipher = Cipher.getInstance(<span class="string">&quot;PBEwithSHA1and128bitAES-CBC-BC&quot;</span>);</span><br><span class="line">        cipher.init(Cipher.ENCRYPT_MODE, skey, pbeps);</span><br><span class="line">        <span class="keyword">return</span> cipher.doFinal(input);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è§£å¯†:</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">byte</span>[] decrypt(String password, <span class="keyword">byte</span>[] salt, <span class="keyword">byte</span>[] input) <span class="keyword">throws</span> GeneralSecurityException &#123;</span><br><span class="line">        PBEKeySpec keySpec = <span class="keyword">new</span> PBEKeySpec(password.toCharArray());</span><br><span class="line">        SecretKeyFactory skeyFactory = SecretKeyFactory.getInstance(<span class="string">&quot;PBEwithSHA1and128bitAES-CBC-BC&quot;</span>);</span><br><span class="line">        SecretKey skey = skeyFactory.generateSecret(keySpec);</span><br><span class="line">        PBEParameterSpec pbeps = <span class="keyword">new</span> PBEParameterSpec(salt, <span class="number">1000</span>);</span><br><span class="line">        Cipher cipher = Cipher.getInstance(<span class="string">&quot;PBEwithSHA1and128bitAES-CBC-BC&quot;</span>);</span><br><span class="line">        cipher.init(Cipher.DECRYPT_MODE, skey, pbeps);</span><br><span class="line">        <span class="keyword">return</span> cipher.doFinal(input);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨PBEæ—¶ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å¼•å…¥BouncyCastleï¼Œå¹¶æŒ‡å®šç®—æ³•æ˜¯<code>PBEwithSHA1and128bitAES-CBC-BC</code>ã€‚</p>
<p>å®é™…ä¸ŠçœŸæ­£çš„AESå¯†é’¥æ˜¯è°ƒç”¨<code>Cipher</code>çš„<code>init()</code>æ–¹æ³•æ—¶åŒæ—¶ä¼ å…¥<code>SecretKey</code>å’Œ<code>PBEParameterSpec</code>å®ç°çš„ã€‚åœ¨åˆ›å»º<code>PBEParameterSpec</code>çš„æ—¶å€™ï¼Œæˆ‘ä»¬è¿˜æŒ‡å®šäº†å¾ªç¯æ¬¡æ•°<code>1000</code>ï¼Œå¾ªç¯æ¬¡æ•°è¶Šå¤šï¼Œæš´åŠ›ç ´è§£éœ€è¦çš„è®¡ç®—é‡å°±è¶Šå¤§ã€‚</p>
<p>å¦‚æœæˆ‘ä»¬æŠŠsaltå’Œå¾ªç¯æ¬¡æ•°å›ºå®šï¼Œå°±å¾—åˆ°äº†ä¸€ä¸ªé€šç”¨çš„â€œå£ä»¤â€åŠ å¯†è½¯ä»¶ã€‚å¦‚æœæˆ‘ä»¬æŠŠéšæœºç”Ÿæˆçš„saltå­˜å‚¨åœ¨Uç›˜ï¼Œå°±å¾—åˆ°äº†ä¸€ä¸ªâ€œå£ä»¤â€åŠ USB Keyçš„åŠ å¯†è½¯ä»¶ï¼Œå®ƒçš„å¥½å¤„åœ¨äºï¼Œå³ä½¿ç”¨æˆ·ä½¿ç”¨äº†ä¸€ä¸ªéå¸¸å¼±çš„å£ä»¤ï¼Œæ²¡æœ‰USB Keyä»ç„¶æ— æ³•è§£å¯†ï¼Œå› ä¸ºUSB Keyå­˜å‚¨çš„éšæœºæ•°å¯†é’¥å®‰å…¨æ€§éå¸¸é«˜ã€‚</p>
<h2 id="3-å¯†é’¥äº¤æ¢ç®—æ³•"><a href="#3-å¯†é’¥äº¤æ¢ç®—æ³•" class="headerlink" title="3. å¯†é’¥äº¤æ¢ç®—æ³•"></a>3. å¯†é’¥äº¤æ¢ç®—æ³•</h2><p>å°æ˜è¦å‘è·¯äººç”²å‘é€ä¸€ä¸ªåŠ å¯†æ–‡ä»¶ï¼Œä»–å¯ä»¥å…ˆç”Ÿæˆä¸€ä¸ªAESå¯†é’¥ï¼Œå¯¹æ–‡ä»¶è¿›è¡ŒåŠ å¯†ï¼Œç„¶åæŠŠåŠ å¯†æ–‡ä»¶å‘é€ç»™å¯¹æ–¹ã€‚å› ä¸ºå¯¹æ–¹è¦è§£å¯†ï¼Œå°±å¿…é¡»éœ€è¦å°æ˜ç”Ÿæˆçš„å¯†é’¥ã€‚</p>
<p>å¦‚ä½•åœ¨ä¸å®‰å…¨çš„ä¿¡é“ä¸Šå®‰å…¨åœ°ä¼ è¾“å¯†é’¥ï¼Ÿ</p>
<p>è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¯†é’¥äº¤æ¢ç®—æ³•å³DHç®—æ³•ï¼šDiffie-Hellmanç®—æ³•åº”è¿è€Œç”Ÿã€‚</p>
<p>DHç®—æ³•äº¤æ¢å¯†é’¥çš„æ­¥éª¤ã€‚å‡è®¾ç”²ä¹™åŒæ–¹éœ€è¦ä¼ é€’å¯†é’¥ï¼Œä»–ä»¬ä¹‹é—´å¯ä»¥è¿™ä¹ˆåšï¼š</p>
<ol>
<li>ç”²é¦–é€‰é€‰æ‹©ä¸€ä¸ªç´ æ•°<code>p</code>ï¼Œä¾‹å¦‚509ï¼Œåº•æ•°<code>g</code>ï¼Œä»»é€‰ï¼Œä¾‹å¦‚5ï¼Œéšæœºæ•°<code>a</code>ï¼Œä¾‹å¦‚123ï¼Œç„¶åè®¡ç®—<code>A=g^a mod p</code>ï¼Œç»“æœæ˜¯215ï¼Œç„¶åï¼Œç”²å‘é€<code>pï¼509</code>ï¼Œ<code>g=5</code>ï¼Œ<code>A=215</code>ç»™ä¹™ï¼›</li>
<li>ä¹™æ–¹æ”¶åˆ°åï¼Œä¹Ÿé€‰æ‹©ä¸€ä¸ªéšæœºæ•°<code>b</code>ï¼Œä¾‹å¦‚ï¼Œ456ï¼Œç„¶åè®¡ç®—<code>B=g^b mod p</code>ï¼Œç»“æœæ˜¯181ï¼Œä¹™å†åŒæ—¶è®¡ç®—<code>s=A^b mod p</code>ï¼Œç»“æœæ˜¯121ï¼›</li>
<li>ä¹™æŠŠè®¡ç®—çš„<code>B=181</code>å‘ç»™ç”²ï¼Œç”²è®¡ç®—<code>sï¼B^a mod p</code>çš„ä½™æ•°ï¼Œè®¡ç®—ç»“æœä¸ä¹™ç®—å‡ºçš„ç»“æœä¸€æ ·ï¼Œéƒ½æ˜¯121ã€‚</li>
</ol>
<p>æ‰€ä»¥æœ€ç»ˆåŒæ–¹åå•†å‡ºçš„å¯†é’¥<code>s</code>æ˜¯121ã€‚æ³¨æ„åˆ°è¿™ä¸ªå¯†é’¥<code>s</code>å¹¶æ²¡æœ‰åœ¨ç½‘ç»œä¸Šä¼ è¾“ã€‚è€Œé€šè¿‡ç½‘ç»œä¼ è¾“çš„<code>p</code>ï¼Œ<code>g</code>ï¼Œ<code>A</code>å’Œ<code>B</code>æ˜¯æ— æ³•æ¨ç®—å‡º<code>s</code>çš„ï¼Œå› ä¸ºå®é™…ç®—æ³•é€‰æ‹©çš„ç´ æ•°æ˜¯éå¸¸å¤§çš„ã€‚</p>
<p>æ‰€ä»¥ï¼Œæ›´ç¡®åˆ‡åœ°è¯´ï¼ŒDHç®—æ³•æ˜¯ä¸€ä¸ªå¯†é’¥åå•†ç®—æ³•ï¼ŒåŒæ–¹æœ€ç»ˆåå•†å‡ºä¸€ä¸ªå…±åŒçš„å¯†é’¥ï¼Œè€Œè¿™ä¸ªå¯†é’¥ä¸ä¼šé€šè¿‡ç½‘ç»œä¼ è¾“ã€‚</p>
<p>å¦‚æœæˆ‘ä»¬æŠŠ<code>a</code>çœ‹æˆç”²çš„ç§é’¥ï¼Œ<code>A</code>çœ‹æˆç”²çš„å…¬é’¥ï¼Œ<code>b</code>çœ‹æˆä¹™çš„ç§é’¥ï¼Œ<code>B</code>çœ‹æˆä¹™çš„å…¬é’¥ï¼ŒDHç®—æ³•çš„æœ¬è´¨å°±æ˜¯åŒæ–¹å„è‡ªç”Ÿæˆè‡ªå·±çš„ç§é’¥å’Œå…¬é’¥ï¼Œç§é’¥ä»…å¯¹è‡ªå·±å¯è§ï¼Œç„¶åäº¤æ¢å…¬é’¥ï¼Œå¹¶æ ¹æ®è‡ªå·±çš„ç§é’¥å’Œå¯¹æ–¹çš„å…¬é’¥ï¼Œç”Ÿæˆæœ€ç»ˆçš„å¯†é’¥<code>secretKey</code>ï¼ŒDHç®—æ³•é€šè¿‡æ•°å­¦å®šå¾‹ä¿è¯äº†åŒæ–¹å„è‡ªè®¡ç®—å‡ºçš„<code>secretKey</code>æ˜¯ç›¸åŒçš„ã€‚</p>
<p>JAVAå®ç°å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Bobå’ŒAlice:</span></span><br><span class="line">        Person bob = <span class="keyword">new</span> Person(<span class="string">&quot;Bob&quot;</span>);</span><br><span class="line">        Person alice = <span class="keyword">new</span> Person(<span class="string">&quot;Alice&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å„è‡ªç”ŸæˆKeyPair:</span></span><br><span class="line">        bob.generateKeyPair();</span><br><span class="line">        alice.generateKeyPair();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åŒæ–¹äº¤æ¢å„è‡ªçš„PublicKey:</span></span><br><span class="line">        <span class="comment">// Bobæ ¹æ®Aliceçš„PublicKeyç”Ÿæˆè‡ªå·±çš„æœ¬åœ°å¯†é’¥:</span></span><br><span class="line">        bob.generateSecretKey(alice.publicKey.getEncoded());</span><br><span class="line">        <span class="comment">// Aliceæ ¹æ®Bobçš„PublicKeyç”Ÿæˆè‡ªå·±çš„æœ¬åœ°å¯†é’¥:</span></span><br><span class="line">        alice.generateSecretKey(bob.publicKey.getEncoded());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ£€æŸ¥åŒæ–¹çš„æœ¬åœ°å¯†é’¥æ˜¯å¦ç›¸åŒ:</span></span><br><span class="line">        bob.printKeys();</span><br><span class="line">        alice.printKeys();</span><br><span class="line">        <span class="comment">// åŒæ–¹çš„SecretKeyç›¸åŒï¼Œåç»­é€šä¿¡å°†ä½¿ç”¨SecretKeyä½œä¸ºå¯†é’¥è¿›è¡ŒAESåŠ è§£å¯†...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> PublicKey publicKey;</span><br><span class="line">    <span class="keyword">private</span> PrivateKey privateKey;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">byte</span>[] secretKey;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Person</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç”Ÿæˆæœ¬åœ°KeyPair:</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">generateKeyPair</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            KeyPairGenerator kpGen = KeyPairGenerator.getInstance(<span class="string">&quot;DH&quot;</span>);</span><br><span class="line">            kpGen.initialize(<span class="number">512</span>);</span><br><span class="line">            KeyPair kp = kpGen.generateKeyPair();</span><br><span class="line">            <span class="keyword">this</span>.privateKey = kp.getPrivate();</span><br><span class="line">            <span class="keyword">this</span>.publicKey = kp.getPublic();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (GeneralSecurityException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">generateSecretKey</span><span class="params">(<span class="keyword">byte</span>[] receivedPubKeyBytes)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// ä»byte[]æ¢å¤PublicKey:</span></span><br><span class="line">            X509EncodedKeySpec keySpec = <span class="keyword">new</span> X509EncodedKeySpec(receivedPubKeyBytes);</span><br><span class="line">            KeyFactory kf = KeyFactory.getInstance(<span class="string">&quot;DH&quot;</span>);</span><br><span class="line">            PublicKey receivedPublicKey = kf.generatePublic(keySpec);</span><br><span class="line">            <span class="comment">// ç”Ÿæˆæœ¬åœ°å¯†é’¥:</span></span><br><span class="line">            KeyAgreement keyAgreement = KeyAgreement.getInstance(<span class="string">&quot;DH&quot;</span>);</span><br><span class="line">            keyAgreement.init(<span class="keyword">this</span>.privateKey); <span class="comment">// è‡ªå·±çš„PrivateKey</span></span><br><span class="line">            keyAgreement.doPhase(receivedPublicKey, <span class="keyword">true</span>); <span class="comment">// å¯¹æ–¹çš„PublicKey</span></span><br><span class="line">            <span class="comment">// ç”ŸæˆSecretKeyå¯†é’¥:</span></span><br><span class="line">            <span class="keyword">this</span>.secretKey = keyAgreement.generateSecret();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (GeneralSecurityException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">printKeys</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.printf(<span class="string">&quot;Name: %s\n&quot;</span>, <span class="keyword">this</span>.name);</span><br><span class="line">        System.out.printf(<span class="string">&quot;Private key: %x\n&quot;</span>, <span class="keyword">new</span> BigInteger(<span class="number">1</span>, <span class="keyword">this</span>.privateKey.getEncoded()));</span><br><span class="line">        System.out.printf(<span class="string">&quot;Public key: %x\n&quot;</span>, <span class="keyword">new</span> BigInteger(<span class="number">1</span>, <span class="keyword">this</span>.publicKey.getEncoded()));</span><br><span class="line">        System.out.printf(<span class="string">&quot;Secret key: %x\n&quot;</span>, <span class="keyword">new</span> BigInteger(<span class="number">1</span>, <span class="keyword">this</span>.secretKey));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="4-éå¯¹ç§°åŠ å¯†ç®—æ³•"><a href="#4-éå¯¹ç§°åŠ å¯†ç®—æ³•" class="headerlink" title="4. éå¯¹ç§°åŠ å¯†ç®—æ³•"></a>4. éå¯¹ç§°åŠ å¯†ç®—æ³•</h2><p>éå¯¹ç§°åŠ å¯†å°±æ˜¯åŠ å¯†å’Œè§£å¯†ä½¿ç”¨çš„ä¸æ˜¯ç›¸åŒçš„å¯†é’¥ï¼šåªæœ‰åŒä¸€ä¸ªå…¬é’¥-ç§é’¥å¯¹æ‰èƒ½æ­£å¸¸åŠ è§£å¯†ã€‚</p>
<p>å¦‚æœå°æ˜è¦åŠ å¯†ä¸€ä¸ªæ–‡ä»¶å‘é€ç»™å°çº¢ï¼Œä»–åº”è¯¥é¦–å…ˆå‘å°çº¢ç´¢å–å¥¹çš„å…¬é’¥ï¼Œç„¶åï¼Œä»–ç”¨å°çº¢çš„å…¬é’¥åŠ å¯†ï¼ŒæŠŠåŠ å¯†æ–‡ä»¶å‘é€ç»™å°çº¢ï¼Œæ­¤æ–‡ä»¶åªèƒ½ç”±å°çº¢çš„ç§é’¥è§£å¼€ï¼Œå› ä¸ºå°çº¢çš„ç§é’¥åœ¨å¥¹è‡ªå·±æ‰‹é‡Œï¼Œæ‰€ä»¥ï¼Œé™¤äº†å°çº¢ï¼Œæ²¡æœ‰ä»»ä½•äººèƒ½è§£å¼€æ­¤æ–‡ä»¶ã€‚</p>
<p>éå¯¹ç§°åŠ å¯†çš„å…¸å‹ç®—æ³•å°±æ˜¯RSAç®—æ³•ï¼Œå®ƒæ˜¯ç”±Ron Rivestï¼ŒAdi Shamirï¼ŒLeonard Adlemanè¿™ä¸‰ä¸ªå“¥ä»¬ä¸€èµ·å‘æ˜çš„ï¼Œæ‰€ä»¥ç”¨ä»–ä»¬ä»¨çš„å§“çš„é¦–å­—æ¯ç¼©å†™è¡¨ç¤ºã€‚</p>
<p>éå¯¹ç§°åŠ å¯†ç›¸æ¯”å¯¹ç§°åŠ å¯†çš„æ˜¾è‘—ä¼˜ç‚¹åœ¨äºï¼Œå¯¹ç§°åŠ å¯†éœ€è¦åå•†å¯†é’¥ï¼Œè€Œéå¯¹ç§°åŠ å¯†å¯ä»¥å®‰å…¨åœ°å…¬å¼€å„è‡ªçš„å…¬é’¥ï¼Œåœ¨Nä¸ªäººä¹‹é—´é€šä¿¡çš„æ—¶å€™ï¼šä½¿ç”¨éå¯¹ç§°åŠ å¯†åªéœ€è¦Nä¸ªå¯†é’¥å¯¹ï¼Œæ¯ä¸ªäººåªç®¡ç†è‡ªå·±çš„å¯†é’¥å¯¹ã€‚è€Œä½¿ç”¨å¯¹ç§°åŠ å¯†éœ€è¦åˆ™éœ€è¦<code>N*(N-1)/2</code>ä¸ªå¯†é’¥ï¼Œå› æ­¤æ¯ä¸ªäººéœ€è¦ç®¡ç†<code>N-1</code>ä¸ªå¯†é’¥ï¼Œå¯†é’¥ç®¡ç†éš¾åº¦å¤§ï¼Œè€Œä¸”éå¸¸å®¹æ˜“æ³„æ¼ã€‚</p>
<p>åœ¨å®é™…åº”ç”¨çš„æ—¶å€™ï¼Œéå¯¹ç§°åŠ å¯†æ€»æ˜¯å’Œå¯¹ç§°åŠ å¯†ä¸€èµ·ä½¿ç”¨ã€‚</p>
<ol>
<li>å°æ˜ç”Ÿæˆä¸€ä¸ªéšæœºçš„AESå£ä»¤ï¼Œç„¶åç”¨å°çº¢çš„å…¬é’¥é€šè¿‡RSAåŠ å¯†è¿™ä¸ªå£ä»¤ï¼Œå¹¶å‘ç»™å°çº¢ï¼›</li>
<li>å°çº¢ç”¨è‡ªå·±çš„RSAç§é’¥è§£å¯†å¾—åˆ°AESå£ä»¤ï¼›</li>
<li>åŒæ–¹ä½¿ç”¨è¿™ä¸ªå…±äº«çš„AESå£ä»¤ç”¨AESåŠ å¯†é€šä¿¡ã€‚</li>
</ol>
<p>å¯è§éå¯¹ç§°åŠ å¯†å®é™…ä¸Šåº”ç”¨åœ¨ç¬¬ä¸€æ­¥ï¼Œå³åŠ å¯†â€œAESå£ä»¤â€ã€‚è¿™ä¹Ÿæ˜¯æˆ‘ä»¬åœ¨æµè§ˆå™¨ä¸­å¸¸ç”¨çš„HTTPSåè®®çš„åšæ³•ï¼Œå³æµè§ˆå™¨å’ŒæœåŠ¡å™¨å…ˆé€šè¿‡RSAäº¤æ¢AESå£ä»¤ï¼Œæ¥ä¸‹æ¥åŒæ–¹é€šä¿¡å®é™…ä¸Šé‡‡ç”¨çš„æ˜¯é€Ÿåº¦è¾ƒå¿«çš„AESå¯¹ç§°åŠ å¯†ï¼Œè€Œä¸æ˜¯ç¼“æ…¢çš„RSAéå¯¹ç§°åŠ å¯†ã€‚</p>
<p>JAVAå®ç°ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// æ˜æ–‡:</span></span><br><span class="line">        <span class="keyword">byte</span>[] plain = <span class="string">&quot;Hello, encrypt use RSA&quot;</span>.getBytes(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">        <span class="comment">// åˆ›å»ºå…¬é’¥ï¼ç§é’¥å¯¹:</span></span><br><span class="line">        Person alice = <span class="keyword">new</span> Person(<span class="string">&quot;Alice&quot;</span>);</span><br><span class="line">        <span class="comment">// ç”¨Aliceçš„å…¬é’¥åŠ å¯†:</span></span><br><span class="line">        <span class="keyword">byte</span>[] pk = alice.getPublicKey();</span><br><span class="line">        System.out.println(String.format(<span class="string">&quot;public key: %x&quot;</span>, <span class="keyword">new</span> BigInteger(<span class="number">1</span>, pk)));</span><br><span class="line">        <span class="keyword">byte</span>[] encrypted = alice.encrypt(plain);</span><br><span class="line">        System.out.println(String.format(<span class="string">&quot;encrypted: %x&quot;</span>, <span class="keyword">new</span> BigInteger(<span class="number">1</span>, encrypted)));</span><br><span class="line">        <span class="comment">// ç”¨Aliceçš„ç§é’¥è§£å¯†:</span></span><br><span class="line">        <span class="keyword">byte</span>[] sk = alice.getPrivateKey();</span><br><span class="line">        System.out.println(String.format(<span class="string">&quot;private key: %x&quot;</span>, <span class="keyword">new</span> BigInteger(<span class="number">1</span>, sk)));</span><br><span class="line">        <span class="keyword">byte</span>[] decrypted = alice.decrypt(encrypted);</span><br><span class="line">        System.out.println(<span class="keyword">new</span> String(decrypted, <span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    String name;</span><br><span class="line">    <span class="comment">// ç§é’¥:</span></span><br><span class="line">    PrivateKey sk;</span><br><span class="line">    <span class="comment">// å…¬é’¥:</span></span><br><span class="line">    PublicKey pk;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Person</span><span class="params">(String name)</span> <span class="keyword">throws</span> GeneralSecurityException </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="comment">// ç”Ÿæˆå…¬é’¥ï¼ç§é’¥å¯¹:</span></span><br><span class="line">        KeyPairGenerator kpGen = KeyPairGenerator.getInstance(<span class="string">&quot;RSA&quot;</span>);</span><br><span class="line">        kpGen.initialize(<span class="number">1024</span>);</span><br><span class="line">        KeyPair kp = kpGen.generateKeyPair();</span><br><span class="line">        <span class="keyword">this</span>.sk = kp.getPrivate();</span><br><span class="line">        <span class="keyword">this</span>.pk = kp.getPublic();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æŠŠç§é’¥å¯¼å‡ºä¸ºå­—èŠ‚</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">byte</span>[] getPrivateKey() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.sk.getEncoded();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æŠŠå…¬é’¥å¯¼å‡ºä¸ºå­—èŠ‚</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">byte</span>[] getPublicKey() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.pk.getEncoded();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç”¨å…¬é’¥åŠ å¯†:</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">byte</span>[] encrypt(<span class="keyword">byte</span>[] message) <span class="keyword">throws</span> GeneralSecurityException &#123;</span><br><span class="line">        Cipher cipher = Cipher.getInstance(<span class="string">&quot;RSA&quot;</span>);</span><br><span class="line">        cipher.init(Cipher.ENCRYPT_MODE, <span class="keyword">this</span>.pk);</span><br><span class="line">        <span class="keyword">return</span> cipher.doFinal(message);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç”¨ç§é’¥è§£å¯†:</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">byte</span>[] decrypt(<span class="keyword">byte</span>[] input) <span class="keyword">throws</span> GeneralSecurityException &#123;</span><br><span class="line">        Cipher cipher = Cipher.getInstance(<span class="string">&quot;RSA&quot;</span>);</span><br><span class="line">        cipher.init(Cipher.DECRYPT_MODE, <span class="keyword">this</span>.sk);</span><br><span class="line">        <span class="keyword">return</span> cipher.doFinal(input);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>RSAçš„å…¬é’¥å’Œç§é’¥éƒ½å¯ä»¥é€šè¿‡<code>getEncoded()</code>æ–¹æ³•è·å¾—ä»¥<code>byte[]</code>è¡¨ç¤ºçš„äºŒè¿›åˆ¶æ•°æ®ï¼Œå¹¶æ ¹æ®éœ€è¦ä¿å­˜åˆ°æ–‡ä»¶ä¸­ã€‚è¦ä»<code>byte[]</code>æ•°ç»„æ¢å¤å…¬é’¥æˆ–ç§é’¥ï¼Œå¯ä»¥è¿™ä¹ˆå†™ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">byte</span>[] pkData = ...</span><br><span class="line"><span class="keyword">byte</span>[] skData = ...</span><br><span class="line">KeyFactory kf = KeyFactory.getInstance(<span class="string">&quot;RSA&quot;</span>);</span><br><span class="line"><span class="comment">// æ¢å¤å…¬é’¥:</span></span><br><span class="line">X509EncodedKeySpec pkSpec = <span class="keyword">new</span> X509EncodedKeySpec(pkData);</span><br><span class="line">PublicKey pk = kf.generatePublic(pkSpec);</span><br><span class="line"><span class="comment">// æ¢å¤ç§é’¥:</span></span><br><span class="line">PKCS8EncodedKeySpec skSpec = <span class="keyword">new</span> PKCS8EncodedKeySpec(skData);</span><br><span class="line">PrivateKey sk = kf.generatePrivate(skSpec);</span><br></pre></td></tr></table></figure>

<p>ä»¥RSAç®—æ³•ä¸ºä¾‹ï¼Œå®ƒçš„å¯†é’¥æœ‰256/512/1024/2048/4096ç­‰ä¸åŒçš„é•¿åº¦ã€‚é•¿åº¦è¶Šé•¿ï¼Œå¯†ç å¼ºåº¦è¶Šå¤§ï¼Œå½“ç„¶è®¡ç®—é€Ÿåº¦ä¹Ÿè¶Šæ…¢ã€‚</p>
<p>å¦‚æœä¿®æ”¹å¾…åŠ å¯†çš„<code>byte[]</code>æ•°æ®çš„å¤§å°ï¼Œå¯ä»¥å‘ç°ï¼Œä½¿ç”¨512bitçš„RSAåŠ å¯†æ—¶ï¼Œæ˜æ–‡é•¿åº¦ä¸èƒ½è¶…è¿‡53å­—èŠ‚ï¼Œä½¿ç”¨1024bitçš„RSAåŠ å¯†æ—¶ï¼Œæ˜æ–‡é•¿åº¦ä¸èƒ½è¶…è¿‡117å­—èŠ‚ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆä½¿ç”¨RSAçš„æ—¶å€™ï¼Œæ€»æ˜¯é…åˆAESä¸€èµ·ä½¿ç”¨ï¼Œå³ç”¨AESåŠ å¯†ä»»æ„é•¿åº¦çš„æ˜æ–‡ï¼Œç”¨RSAåŠ å¯†AESå£ä»¤ã€‚</p>
<p>æ­¤å¤–ï¼Œåªä½¿ç”¨éå¯¹ç§°åŠ å¯†ç®—æ³•ä¸èƒ½é˜²æ­¢ä¸­é—´äººæ”»å‡»ã€‚</p>
<h2 id="5-ç­¾åç®—æ³•"><a href="#5-ç­¾åç®—æ³•" class="headerlink" title="5. ç­¾åç®—æ³•"></a>5. ç­¾åç®—æ³•</h2><p>ç§é’¥åŠ å¯†å¾—åˆ°çš„å¯†æ–‡å®é™…ä¸Šå°±æ˜¯æ•°å­—ç­¾åï¼Œè¦éªŒè¯è¿™ä¸ªç­¾åæ˜¯å¦æ­£ç¡®ï¼Œåªèƒ½ç”¨ç§é’¥æŒæœ‰è€…çš„å…¬é’¥è¿›è¡Œè§£å¯†éªŒè¯ã€‚ä½¿ç”¨æ•°å­—ç­¾åçš„ç›®çš„æ˜¯ä¸ºäº†ç¡®è®¤æŸä¸ªä¿¡æ¯ç¡®å®æ˜¯ç”±æŸä¸ªå‘é€æ–¹å‘é€çš„ï¼Œä»»ä½•äººéƒ½ä¸å¯èƒ½ä¼ªé€ æ¶ˆæ¯ï¼Œå¹¶ä¸”ï¼Œå‘é€æ–¹ä¹Ÿä¸èƒ½æŠµèµ–ã€‚</p>
<p>åœ¨å®é™…åº”ç”¨çš„æ—¶å€™ï¼Œç­¾åå®é™…ä¸Šå¹¶ä¸æ˜¯é’ˆå¯¹åŸå§‹æ¶ˆæ¯ï¼Œè€Œæ˜¯é’ˆå¯¹åŸå§‹æ¶ˆæ¯çš„å“ˆå¸Œè¿›è¡Œç­¾åï¼Œå³ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">signature = encrypt(privateKey, sha256(message))</span><br></pre></td></tr></table></figure>

<p>å¯¹ç­¾åè¿›è¡ŒéªŒè¯å®é™…ä¸Šå°±æ˜¯ç”¨å…¬é’¥è§£å¯†ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">hash = decrypt(publicKey, signature)</span><br></pre></td></tr></table></figure>

<p>å› ä¸ºç”¨æˆ·æ€»æ˜¯ä½¿ç”¨è‡ªå·±çš„ç§é’¥è¿›è¡Œç­¾åï¼Œæ‰€ä»¥ï¼Œç§é’¥å°±ç›¸å½“äºç”¨æˆ·èº«ä»½ã€‚è€Œå…¬é’¥ç”¨æ¥ç»™å¤–éƒ¨éªŒè¯ç”¨æˆ·èº«ä»½ã€‚</p>
<p>å¸¸ç”¨æ•°å­—ç­¾åç®—æ³•æœ‰ï¼š</p>
<ul>
<li>MD5withRSA</li>
<li>SHA1withRSA</li>
<li>SHA256withRSA</li>
</ul>
<p>JAVAå®ç°ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> GeneralSecurityException </span>&#123;</span><br><span class="line">        <span class="comment">// ç”ŸæˆRSAå…¬é’¥/ç§é’¥:</span></span><br><span class="line">        KeyPairGenerator kpGen = KeyPairGenerator.getInstance(<span class="string">&quot;RSA&quot;</span>);</span><br><span class="line">        kpGen.initialize(<span class="number">1024</span>);</span><br><span class="line">        KeyPair kp = kpGen.generateKeyPair();</span><br><span class="line">        PrivateKey sk = kp.getPrivate();</span><br><span class="line">        PublicKey pk = kp.getPublic();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¾…ç­¾åçš„æ¶ˆæ¯:</span></span><br><span class="line">        <span class="keyword">byte</span>[] message = <span class="string">&quot;Hello, I am Bob!&quot;</span>.getBytes(StandardCharsets.UTF_8);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ç”¨ç§é’¥ç­¾å:</span></span><br><span class="line">        Signature s = Signature.getInstance(<span class="string">&quot;SHA1withRSA&quot;</span>);</span><br><span class="line">        s.initSign(sk);</span><br><span class="line">        s.update(message);</span><br><span class="line">        <span class="keyword">byte</span>[] signed = s.sign();</span><br><span class="line">        System.out.println(String.format(<span class="string">&quot;signature: %x&quot;</span>, <span class="keyword">new</span> BigInteger(<span class="number">1</span>, signed)));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ç”¨å…¬é’¥éªŒè¯:</span></span><br><span class="line">        Signature v = Signature.getInstance(<span class="string">&quot;SHA1withRSA&quot;</span>);</span><br><span class="line">        v.initVerify(pk);</span><br><span class="line">        v.update(message);</span><br><span class="line">        <span class="keyword">boolean</span> valid = v.verify(signed);</span><br><span class="line">        System.out.println(<span class="string">&quot;valid? &quot;</span> + valid);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>DSAç­¾å</strong></p>
<p>é™¤äº†RSAå¯ä»¥ç­¾åå¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨DSAç®—æ³•è¿›è¡Œç­¾åã€‚DSAæ˜¯Digital Signature Algorithmçš„ç¼©å†™ï¼Œå®ƒä½¿ç”¨ElGamalæ•°å­—ç­¾åç®—æ³•ã€‚</p>
<p>DSAåªèƒ½é…åˆSHAä½¿ç”¨ï¼Œå¸¸ç”¨çš„ç®—æ³•æœ‰ï¼š</p>
<ul>
<li>SHA1withDSA</li>
<li>SHA256withDSA</li>
<li>SHA512withDSA</li>
</ul>
<p>å’ŒRSAæ•°å­—ç­¾åç›¸æ¯”ï¼ŒDSAçš„ä¼˜ç‚¹æ˜¯æ›´å¿«ã€‚</p>
<p><strong>ECDSAç­¾å</strong></p>
<p>æ¤­åœ†æ›²çº¿ç­¾åç®—æ³•ECDSAï¼šElliptic Curve Digital Signature Algorithmä¹Ÿæ˜¯ä¸€ç§å¸¸ç”¨çš„ç­¾åç®—æ³•ï¼Œå®ƒçš„ç‰¹ç‚¹æ˜¯å¯ä»¥ä»ç§é’¥æ¨å‡ºå…¬é’¥ã€‚æ¯”ç‰¹å¸çš„ç­¾åç®—æ³•å°±é‡‡ç”¨äº†ECDSAç®—æ³•ï¼Œä½¿ç”¨æ ‡å‡†æ¤­åœ†æ›²çº¿secp256k1ã€‚BouncyCastleæä¾›äº†ECDSAçš„å®Œæ•´å®ç°ã€‚</p>
<h2 id="6-æ•°å­—è¯ä¹¦"><a href="#6-æ•°å­—è¯ä¹¦" class="headerlink" title="6. æ•°å­—è¯ä¹¦"></a>6. æ•°å­—è¯ä¹¦</h2><p>æ‘˜è¦ç®—æ³•ç”¨æ¥ç¡®ä¿æ•°æ®æ²¡æœ‰è¢«ç¯¡æ”¹ï¼Œéå¯¹ç§°åŠ å¯†ç®—æ³•å¯ä»¥å¯¹æ•°æ®è¿›è¡ŒåŠ è§£å¯†ï¼Œç­¾åç®—æ³•å¯ä»¥ç¡®ä¿æ•°æ®å®Œæ•´æ€§å’ŒæŠ—å¦è®¤æ€§ï¼ŒæŠŠè¿™äº›ç®—æ³•é›†åˆåˆ°ä¸€èµ·ï¼Œå¹¶æä¸€å¥—å®Œå–„çš„æ ‡å‡†ï¼Œè¿™å°±æ˜¯æ•°å­—è¯ä¹¦ã€‚</p>
<p>æ•°å­—è¯ä¹¦å°±æ˜¯é›†åˆäº†å¤šç§å¯†ç å­¦ç®—æ³•ï¼Œç”¨äºå®ç°æ•°æ®åŠ è§£å¯†ã€èº«ä»½è®¤è¯ã€ç­¾åç­‰å¤šç§åŠŸèƒ½çš„ä¸€ç§å®‰å…¨æ ‡å‡†ã€‚</p>
<p>æ•°å­—è¯ä¹¦å¯ä»¥é˜²æ­¢ä¸­é—´äººæ”»å‡»ï¼Œå› ä¸ºå®ƒé‡‡ç”¨é“¾å¼ç­¾åè®¤è¯ï¼Œå³é€šè¿‡æ ¹è¯ä¹¦ï¼ˆRoot CAï¼‰å»ç­¾åä¸‹ä¸€çº§è¯ä¹¦ï¼Œè¿™æ ·å±‚å±‚ç­¾åï¼Œç›´åˆ°æœ€ç»ˆçš„ç”¨æˆ·è¯ä¹¦ã€‚è€ŒRoot CAè¯ä¹¦å†…ç½®äºæ“ä½œç³»ç»Ÿä¸­ï¼Œæ‰€ä»¥ï¼Œä»»ä½•ç»è¿‡CAè®¤è¯çš„æ•°å­—è¯ä¹¦éƒ½å¯ä»¥å¯¹å…¶æœ¬èº«è¿›è¡Œæ ¡éªŒï¼Œç¡®ä¿è¯ä¹¦æœ¬èº«ä¸æ˜¯ä¼ªé€ çš„ã€‚</p>
<p>æˆ‘ä»¬åœ¨ä¸Šç½‘æ—¶å¸¸ç”¨çš„HTTPSåè®®å°±æ˜¯æ•°å­—è¯ä¹¦çš„åº”ç”¨ã€‚æµè§ˆå™¨ä¼šè‡ªåŠ¨éªŒè¯è¯ä¹¦çš„æœ‰æ•ˆæ€§ï¼š</p>
<p><img src="https://www.liaoxuefeng.com/files/attachments/1311504758472770/l" alt="cert"></p>
<p>è¦ä½¿ç”¨æ•°å­—è¯ä¹¦ï¼Œé¦–å…ˆéœ€è¦åˆ›å»ºè¯ä¹¦ã€‚æ­£å¸¸æƒ…å†µä¸‹ï¼Œä¸€ä¸ªåˆæ³•çš„æ•°å­—è¯ä¹¦éœ€è¦ç»è¿‡CAç­¾åï¼Œè¿™éœ€è¦è®¤è¯åŸŸåå¹¶æ”¯ä»˜ä¸€å®šçš„è´¹ç”¨ã€‚å¼€å‘çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è‡ªç­¾åçš„è¯ä¹¦ï¼Œè¿™ç§è¯ä¹¦å¯ä»¥æ­£å¸¸å¼€å‘è°ƒè¯•ï¼Œä½†ä¸èƒ½å¯¹å¤–ä½œä¸ºæœåŠ¡ä½¿ç”¨ï¼Œå› ä¸ºå…¶ä»–å®¢æˆ·ç«¯å¹¶ä¸è®¤å¯æœªç»CAç­¾åçš„è¯ä¹¦ã€‚</p>
<p>åœ¨Javaç¨‹åºä¸­ï¼Œæ•°å­—è¯ä¹¦å­˜å‚¨åœ¨ä¸€ç§Javaä¸“ç”¨çš„key storeæ–‡ä»¶ä¸­ï¼ŒJDKæä¾›äº†ä¸€ç³»åˆ—å‘½ä»¤æ¥åˆ›å»ºå’Œç®¡ç†key storeã€‚æˆ‘ä»¬ç”¨ä¸‹é¢çš„å‘½ä»¤åˆ›å»ºä¸€ä¸ªkey storeï¼Œå¹¶è®¾å®šå£ä»¤123456ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">keytool -storepass 123456 -genkeypair -keyalg RSA -keysize 1024 -sigalg SHA1withRSA -validity 3650 -alias mycert -keystore my.keystore -dname &quot;CN&#x3D;www.sample.com, OU&#x3D;sample, O&#x3D;sample, L&#x3D;BJ, ST&#x3D;BJ, C&#x3D;CN&quot;</span><br></pre></td></tr></table></figure>

<p>å‡ ä¸ªä¸»è¦çš„å‚æ•°æ˜¯ï¼š</p>
<ul>
<li>keyalgï¼šæŒ‡å®šRSAåŠ å¯†ç®—æ³•ï¼›</li>
<li>sigalgï¼šæŒ‡å®šSHA1withRSAç­¾åç®—æ³•ï¼›</li>
<li>validityï¼šæŒ‡å®šè¯ä¹¦æœ‰æ•ˆæœŸ3650å¤©ï¼›</li>
<li>aliasï¼šæŒ‡å®šè¯ä¹¦åœ¨ç¨‹åºä¸­å¼•ç”¨çš„åç§°ï¼›</li>
<li>dnameï¼šæœ€é‡è¦çš„<code>CN=www.sample.com</code>æŒ‡å®šäº†<code>Common Name</code>ï¼Œå¦‚æœè¯ä¹¦ç”¨åœ¨HTTPSä¸­ï¼Œè¿™ä¸ªåç§°å¿…é¡»ä¸åŸŸåå®Œå…¨ä¸€è‡´ã€‚</li>
</ul>
<p>æ‰§è¡Œä¸Šè¿°å‘½ä»¤ï¼ŒJDKä¼šåœ¨å½“å‰ç›®å½•åˆ›å»ºä¸€ä¸ª<code>my.keystore</code>æ–‡ä»¶ï¼Œå¹¶å­˜å‚¨åˆ›å»ºæˆåŠŸçš„ä¸€ä¸ªç§é’¥å’Œä¸€ä¸ªè¯ä¹¦ï¼Œå®ƒçš„åˆ«åæ˜¯<code>mycert</code>ã€‚</p>
<p>æœ‰äº†key storeå­˜å‚¨çš„è¯ä¹¦ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡æ•°å­—è¯ä¹¦è¿›è¡ŒåŠ è§£å¯†å’Œç­¾åï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.math.BigInteger;</span><br><span class="line"><span class="keyword">import</span> java.security.*;</span><br><span class="line"><span class="keyword">import</span> java.security.cert.*;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.Cipher;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">byte</span>[] message = <span class="string">&quot;Hello, use X.509 cert!&quot;</span>.getBytes(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">        <span class="comment">// è¯»å–KeyStore:</span></span><br><span class="line">        KeyStore ks = loadKeyStore(<span class="string">&quot;/my.keystore&quot;</span>, <span class="string">&quot;123456&quot;</span>);</span><br><span class="line">        <span class="comment">// è¯»å–ç§é’¥:</span></span><br><span class="line">        PrivateKey privateKey = (PrivateKey) ks.getKey(<span class="string">&quot;mycert&quot;</span>, <span class="string">&quot;123456&quot;</span>.toCharArray());</span><br><span class="line">        <span class="comment">// è¯»å–è¯ä¹¦:</span></span><br><span class="line">        X509Certificate certificate = (X509Certificate) ks.getCertificate(<span class="string">&quot;mycert&quot;</span>);</span><br><span class="line">        <span class="comment">// åŠ å¯†:</span></span><br><span class="line">        <span class="keyword">byte</span>[] encrypted = encrypt(certificate, message);</span><br><span class="line">        System.out.println(String.format(<span class="string">&quot;encrypted: %x&quot;</span>, <span class="keyword">new</span> BigInteger(<span class="number">1</span>, encrypted)));</span><br><span class="line">        <span class="comment">// è§£å¯†:</span></span><br><span class="line">        <span class="keyword">byte</span>[] decrypted = decrypt(privateKey, encrypted);</span><br><span class="line">        System.out.println(<span class="string">&quot;decrypted: &quot;</span> + <span class="keyword">new</span> String(decrypted, <span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">        <span class="comment">// ç­¾å:</span></span><br><span class="line">        <span class="keyword">byte</span>[] sign = sign(privateKey, certificate, message);</span><br><span class="line">        System.out.println(String.format(<span class="string">&quot;signature: %x&quot;</span>, <span class="keyword">new</span> BigInteger(<span class="number">1</span>, sign)));</span><br><span class="line">        <span class="comment">// éªŒè¯ç­¾å:</span></span><br><span class="line">        <span class="keyword">boolean</span> verified = verify(certificate, message, sign);</span><br><span class="line">        System.out.println(<span class="string">&quot;verify: &quot;</span> + verified);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">static</span> KeyStore <span class="title">loadKeyStore</span><span class="params">(String keyStoreFile, String password)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> (InputStream input = Main.class.getResourceAsStream(keyStoreFile)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (input == <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">&quot;file not found in classpath: &quot;</span> + keyStoreFile);</span><br><span class="line">            &#125;</span><br><span class="line">            KeyStore ks = KeyStore.getInstance(KeyStore.getDefaultType());</span><br><span class="line">            ks.load(input, password.toCharArray());</span><br><span class="line">            <span class="keyword">return</span> ks;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">byte</span>[] encrypt(X509Certificate certificate, <span class="keyword">byte</span>[] message) <span class="keyword">throws</span> GeneralSecurityException &#123;</span><br><span class="line">        Cipher cipher = Cipher.getInstance(certificate.getPublicKey().getAlgorithm());</span><br><span class="line">        cipher.init(Cipher.ENCRYPT_MODE, certificate.getPublicKey());</span><br><span class="line">        <span class="keyword">return</span> cipher.doFinal(message);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">byte</span>[] decrypt(PrivateKey privateKey, <span class="keyword">byte</span>[] data) <span class="keyword">throws</span> GeneralSecurityException &#123;</span><br><span class="line">        Cipher cipher = Cipher.getInstance(privateKey.getAlgorithm());</span><br><span class="line">        cipher.init(Cipher.DECRYPT_MODE, privateKey);</span><br><span class="line">        <span class="keyword">return</span> cipher.doFinal(data);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">byte</span>[] sign(PrivateKey privateKey, X509Certificate certificate, <span class="keyword">byte</span>[] message)</span><br><span class="line">            <span class="keyword">throws</span> GeneralSecurityException &#123;</span><br><span class="line">        Signature signature = Signature.getInstance(certificate.getSigAlgName());</span><br><span class="line">        signature.initSign(privateKey);</span><br><span class="line">        signature.update(message);</span><br><span class="line">        <span class="keyword">return</span> signature.sign();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">verify</span><span class="params">(X509Certificate certificate, <span class="keyword">byte</span>[] message, <span class="keyword">byte</span>[] sig)</span> <span class="keyword">throws</span> GeneralSecurityException </span>&#123;</span><br><span class="line">        Signature signature = Signature.getInstance(certificate.getSigAlgName());</span><br><span class="line">        signature.initVerify(certificate);</span><br><span class="line">        signature.update(message);</span><br><span class="line">        <span class="keyword">return</span> signature.verify(sig);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬ä»key storeç›´æ¥è¯»å–äº†ç§é’¥-å…¬é’¥å¯¹ï¼Œç§é’¥ä»¥<code>PrivateKey</code>å®ä¾‹è¡¨ç¤ºï¼Œå…¬é’¥ä»¥<code>X509Certificate</code>è¡¨ç¤ºï¼Œå®é™…ä¸Šæ•°å­—è¯ä¹¦åªåŒ…å«å…¬é’¥ï¼Œå› æ­¤ï¼Œè¯»å–è¯ä¹¦å¹¶ä¸éœ€è¦å£ä»¤ï¼Œåªæœ‰è¯»å–ç§é’¥æ‰éœ€è¦ã€‚å¦‚æœéƒ¨ç½²åˆ°WebæœåŠ¡å™¨ä¸Šï¼Œä¾‹å¦‚Nginxï¼Œéœ€è¦æŠŠç§é’¥å¯¼å‡ºä¸ºPrivate Keyæ ¼å¼ï¼ŒæŠŠè¯ä¹¦å¯¼å‡ºä¸ºX509Certificateæ ¼å¼ã€‚</p>
<p>ä»¥HTTPSåè®®ä¸ºä¾‹ï¼Œæµè§ˆå™¨å’ŒæœåŠ¡å™¨å»ºç«‹å®‰å…¨è¿æ¥çš„æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<ol>
<li>æµè§ˆå™¨å‘æœåŠ¡å™¨å‘èµ·è¯·æ±‚ï¼ŒæœåŠ¡å™¨å‘æµè§ˆå™¨å‘é€è‡ªå·±çš„æ•°å­—è¯ä¹¦ï¼›</li>
<li>æµè§ˆå™¨ç”¨æ“ä½œç³»ç»Ÿå†…ç½®çš„Root CAæ¥éªŒè¯æœåŠ¡å™¨çš„è¯ä¹¦æ˜¯å¦æœ‰æ•ˆï¼Œå¦‚æœæœ‰æ•ˆï¼Œå°±ä½¿ç”¨è¯¥è¯ä¹¦åŠ å¯†ä¸€ä¸ªéšæœºçš„AESå£ä»¤å¹¶å‘é€ç»™æœåŠ¡å™¨ï¼›</li>
<li>æœåŠ¡å™¨ç”¨è‡ªå·±çš„ç§é’¥è§£å¯†è·å¾—AESå£ä»¤ï¼Œå¹¶åœ¨åç»­é€šè®¯ä¸­ä½¿ç”¨AESåŠ å¯†ã€‚</li>
</ol>
<p>æ³¨æ„ï¼šæ•°å­—è¯ä¹¦å­˜å‚¨çš„æ˜¯å…¬é’¥ï¼Œä»¥åŠç›¸å…³çš„è¯ä¹¦é“¾å’Œç®—æ³•ä¿¡æ¯ã€‚ç§é’¥å¿…é¡»ä¸¥æ ¼ä¿å¯†ï¼Œå¦‚æœæ•°å­—è¯ä¹¦å¯¹åº”çš„ç§é’¥æ³„æ¼ï¼Œå°±ä¼šé€ æˆä¸¥é‡çš„å®‰å…¨å¨èƒã€‚å¦‚æœCAè¯ä¹¦çš„ç§é’¥æ³„æ¼ï¼Œé‚£ä¹ˆè¯¥CAè¯ä¹¦ç­¾å‘çš„æ‰€æœ‰è¯ä¹¦å°†ä¸å¯ä¿¡ã€‚æ•°å­—è¯ä¹¦æœåŠ¡å•†<a href="https://en.wikipedia.org/wiki/DigiNotar">DigiNotar</a>å°±å‘ç”Ÿè¿‡ç§é’¥æ³„æ¼å¯¼è‡´å…¬å¸ç ´äº§çš„äº‹æ•…ã€‚</p>
]]></content>
      <tags>
        <tag>JAVA</tag>
        <tag>åŠ å¯†</tag>
        <tag>ç®—æ³•</tag>
      </tags>
  </entry>
  <entry>
    <title>JAVA-å¤šçº¿ç¨‹</title>
    <url>/2021/05/09/JAVA%E5%A4%9A%E7%BA%BF%E7%A8%8B/</url>
    <content><![CDATA[<h1 id="å¤šçº¿ç¨‹"><a href="#å¤šçº¿ç¨‹" class="headerlink" title="å¤šçº¿ç¨‹"></a>å¤šçº¿ç¨‹</h1><h2 id="1-åˆ›å»ºæ–°çº¿ç¨‹"><a href="#1-åˆ›å»ºæ–°çº¿ç¨‹" class="headerlink" title="1. åˆ›å»ºæ–°çº¿ç¨‹"></a>1. åˆ›å»ºæ–°çº¿ç¨‹</h2><p>æ–¹æ³•ä¸€ï¼šä»<code>Thread</code>æ´¾ç”Ÿä¸€ä¸ªè‡ªå®šä¹‰ç±»ï¼Œç„¶åè¦†å†™<code>run()</code>æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Thread t = <span class="keyword">new</span> MyThread();</span><br><span class="line">        t.start(); <span class="comment">// å¯åŠ¨æ–°çº¿ç¨‹</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyThread</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;start new thread!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ–¹æ³•äºŒï¼šåˆ›å»º<code>Thread</code>å®ä¾‹æ—¶ï¼Œä¼ å…¥ä¸€ä¸ª<code>Runnable</code>å®ä¾‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Thread t = <span class="keyword">new</span> Thread(<span class="keyword">new</span> MyRunnable());</span><br><span class="line">        t.start(); <span class="comment">// å¯åŠ¨æ–°çº¿ç¨‹</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyRunnable</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;start new thread!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç”¨lambdaè¯­æ³•è¿›ä¸€æ­¥ç®€å†™ä¸ºï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Thread t = <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;start new thread!&quot;</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">        t.start(); <span class="comment">// å¯åŠ¨æ–°çº¿ç¨‹</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶è¿è¡Œï¼Œç”±æ“ä½œç³»ç»Ÿè°ƒåº¦ï¼Œç¨‹åºæœ¬èº«æ— æ³•ç¡®å®šçº¿ç¨‹çš„è°ƒåº¦é¡ºåºã€‚</p>
<p><code>Thread.sleep(20);``sleep()</code>ä¼ å…¥çš„å‚æ•°æ˜¯æ¯«ç§’ã€‚è°ƒæ•´æš‚åœæ—¶é—´çš„å¤§å°ã€‚</p>
<p>å¿…é¡»è°ƒç”¨<code>Thread</code>å®ä¾‹çš„<code>start()</code>æ–¹æ³•æ‰èƒ½å¯åŠ¨æ–°çº¿ç¨‹ï¼Œå¦‚æœæˆ‘ä»¬æŸ¥çœ‹<code>Thread</code>ç±»çš„æºä»£ç ï¼Œä¼šçœ‹åˆ°<code>start()</code>æ–¹æ³•å†…éƒ¨è°ƒç”¨äº†ä¸€ä¸ª<code>private native void start0()</code>æ–¹æ³•ï¼Œ<code>native</code>ä¿®é¥°ç¬¦è¡¨ç¤ºè¿™ä¸ªæ–¹æ³•æ˜¯ç”±JVMè™šæ‹Ÿæœºå†…éƒ¨çš„Cä»£ç å®ç°çš„ï¼Œä¸æ˜¯ç”±Javaä»£ç å®ç°çš„ã€‚</p>
<p><strong>è¿›ç¨‹ä¼˜å…ˆçº§</strong></p>
<p>å¯ä»¥å¯¹çº¿ç¨‹è®¾å®šä¼˜å…ˆçº§ï¼Œè®¾å®šä¼˜å…ˆçº§çš„æ–¹æ³•æ˜¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Thread.setPriority(<span class="keyword">int</span> n) <span class="comment">// 1~10, é»˜è®¤å€¼5</span></span><br></pre></td></tr></table></figure>

<h2 id="2-è¿›ç¨‹çŠ¶æ€"><a href="#2-è¿›ç¨‹çŠ¶æ€" class="headerlink" title="2. è¿›ç¨‹çŠ¶æ€"></a>2. è¿›ç¨‹çŠ¶æ€</h2><p><img src="https://raw.githubusercontent.com/ghj1998/image_repository/main/image-20210423092711785.png" alt="image-20210423092711785"></p>
<ul>
<li>Newï¼šæ–°åˆ›å»ºçš„çº¿ç¨‹ï¼Œå°šæœªæ‰§è¡Œï¼›</li>
<li>Runnableï¼šè¿è¡Œä¸­çš„çº¿ç¨‹ï¼Œæ­£åœ¨æ‰§è¡Œ<code>run()</code>æ–¹æ³•çš„Javaä»£ç ï¼›</li>
<li>Blockedï¼šè¿è¡Œä¸­çš„çº¿ç¨‹ï¼Œå› ä¸ºæŸäº›æ“ä½œè¢«é˜»å¡è€ŒæŒ‚èµ·ï¼›</li>
<li>Waitingï¼šè¿è¡Œä¸­çš„çº¿ç¨‹ï¼Œå› ä¸ºæŸäº›æ“ä½œåœ¨ç­‰å¾…ä¸­ï¼›</li>
<li>Timed Waitingï¼šè¿è¡Œä¸­çš„çº¿ç¨‹ï¼Œå› ä¸ºæ‰§è¡Œ<code>sleep()</code>æ–¹æ³•æ­£åœ¨è®¡æ—¶ç­‰å¾…ï¼›</li>
<li>Terminatedï¼šçº¿ç¨‹å·²ç»ˆæ­¢ï¼Œå› ä¸º<code>run()</code>æ–¹æ³•æ‰§è¡Œå®Œæ¯•ã€‚</li>
</ul>
<p>ä¸€ä¸ªçº¿ç¨‹è¿˜å¯ä»¥ç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹ç›´åˆ°å…¶è¿è¡Œç»“æŸã€‚ä¾‹å¦‚ï¼Œ<code>main</code>çº¿ç¨‹åœ¨å¯åŠ¨<code>t</code>çº¿ç¨‹åï¼Œå¯ä»¥é€šè¿‡<code>t.join()</code>ç­‰å¾…<code>t</code>çº¿ç¨‹ç»“æŸåå†ç»§ç»­è¿è¡Œï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        Thread t = <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">        System.out.println(<span class="string">&quot;start&quot;</span>);</span><br><span class="line">        t.start();</span><br><span class="line">        t.join();</span><br><span class="line">        System.out.println(<span class="string">&quot;end&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å½“<code>main</code>çº¿ç¨‹å¯¹çº¿ç¨‹å¯¹è±¡<code>t</code>è°ƒç”¨<code>join()</code>æ–¹æ³•æ—¶ï¼Œä¸»çº¿ç¨‹å°†ç­‰å¾…å˜é‡<code>t</code>è¡¨ç¤ºçš„çº¿ç¨‹è¿è¡Œç»“æŸï¼Œå³<code>join</code>å°±æ˜¯æŒ‡ç­‰å¾…è¯¥çº¿ç¨‹ç»“æŸï¼Œç„¶åæ‰ç»§ç»­å¾€ä¸‹æ‰§è¡Œè‡ªèº«çº¿ç¨‹ã€‚</p>
<p><code>join(long)</code>çš„é‡è½½æ–¹æ³•ä¹Ÿå¯ä»¥æŒ‡å®šä¸€ä¸ªç­‰å¾…æ—¶é—´ï¼Œè¶…è¿‡ç­‰å¾…æ—¶é—´åå°±ä¸å†ç»§ç»­ç­‰å¾…ã€‚</p>
<h2 id="3-ä¸­æ–­çº¿ç¨‹"><a href="#3-ä¸­æ–­çº¿ç¨‹" class="headerlink" title="3. ä¸­æ–­çº¿ç¨‹"></a>3. ä¸­æ–­çº¿ç¨‹</h2><p>ä¸­æ–­ä¸€ä¸ªçº¿ç¨‹éå¸¸ç®€å•ï¼Œåªéœ€è¦åœ¨å…¶ä»–çº¿ç¨‹ä¸­å¯¹ç›®æ ‡çº¿ç¨‹è°ƒç”¨<code>interrupt()</code>æ–¹æ³•ï¼Œç›®æ ‡çº¿ç¨‹éœ€è¦åå¤æ£€æµ‹è‡ªèº«çŠ¶æ€æ˜¯å¦æ˜¯interruptedçŠ¶æ€ï¼Œå¦‚æœæ˜¯ï¼Œå°±ç«‹åˆ»ç»“æŸè¿è¡Œã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        Thread t = <span class="keyword">new</span> MyThread();</span><br><span class="line">        t.start();</span><br><span class="line">        Thread.sleep(<span class="number">1</span>); <span class="comment">// æš‚åœ1æ¯«ç§’</span></span><br><span class="line">        t.interrupt(); <span class="comment">// ä¸­æ–­tçº¿ç¨‹</span></span><br><span class="line">        t.join(); <span class="comment">// ç­‰å¾…tçº¿ç¨‹ç»“æŸ</span></span><br><span class="line">        System.out.println(<span class="string">&quot;end&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyThread</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> n = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (! isInterrupted()) &#123;</span><br><span class="line">            n ++;</span><br><span class="line">            System.out.println(n + <span class="string">&quot; hello!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>main</code>çº¿ç¨‹é€šè¿‡è°ƒç”¨<code>t.interrupt()</code>æ–¹æ³•ä¸­æ–­<code>t</code>çº¿ç¨‹ï¼Œä½†æ˜¯è¦æ³¨æ„ï¼Œ<code>interrupt()</code>æ–¹æ³•ä»…ä»…å‘<code>t</code>çº¿ç¨‹å‘å‡ºäº†â€œä¸­æ–­è¯·æ±‚â€ï¼Œè‡³äº<code>t</code>çº¿ç¨‹æ˜¯å¦èƒ½ç«‹åˆ»å“åº”ï¼Œè¦çœ‹å…·ä½“ä»£ç ã€‚è€Œ<code>t</code>çº¿ç¨‹çš„<code>while</code>å¾ªç¯ä¼šæ£€æµ‹**<code>isInterrupted()</code>**ï¼Œæ‰€ä»¥ä¸Šè¿°ä»£ç èƒ½æ­£ç¡®å“åº”<code>interrupt()</code>è¯·æ±‚ï¼Œä½¿å¾—è‡ªèº«ç«‹åˆ»ç»“æŸè¿è¡Œ<code>run()</code>æ–¹æ³•ã€‚</p>
<p>å¦‚æœçº¿ç¨‹å¤„äºç­‰å¾…çŠ¶æ€ï¼Œä¾‹å¦‚ï¼Œ<code>t.join()</code>ä¼šè®©<code>main</code>çº¿ç¨‹è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œæ­¤æ—¶ï¼Œå¦‚æœå¯¹<code>main</code>çº¿ç¨‹è°ƒç”¨<code>interrupt()</code>ï¼Œ<code>join()</code>æ–¹æ³•ä¼šç«‹åˆ»æŠ›å‡º<code>InterruptedException</code>ã€‚</p>
<p>ç›®æ ‡çº¿ç¨‹åªè¦æ•è·åˆ°<code>join()</code>æ–¹æ³•æŠ›å‡ºçš„<code>InterruptedException</code>ï¼Œå°±è¯´æ˜æœ‰å…¶ä»–çº¿ç¨‹å¯¹å…¶è°ƒç”¨äº†<code>interrupt()</code>æ–¹æ³•ï¼Œé€šå¸¸æƒ…å†µä¸‹è¯¥çº¿ç¨‹åº”è¯¥ç«‹åˆ»ç»“æŸè¿è¡Œã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        Thread t = <span class="keyword">new</span> MyThread();</span><br><span class="line">        t.start();</span><br><span class="line">        Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">        t.interrupt(); <span class="comment">// ä¸­æ–­tçº¿ç¨‹</span></span><br><span class="line">        t.join(); <span class="comment">// ç­‰å¾…tçº¿ç¨‹ç»“æŸ</span></span><br><span class="line">        System.out.println(<span class="string">&quot;end&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyThread</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Thread hello = <span class="keyword">new</span> HelloThread();</span><br><span class="line">        hello.start(); <span class="comment">// å¯åŠ¨helloçº¿ç¨‹</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            hello.join(); <span class="comment">// ç­‰å¾…helloçº¿ç¨‹ç»“æŸ</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;interrupted!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        hello.interrupt();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HelloThread</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> n = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (!isInterrupted()) &#123;</span><br><span class="line">            n++;</span><br><span class="line">            System.out.println(n + <span class="string">&quot; hello!&quot;</span>);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">100</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>main</code>çº¿ç¨‹é€šè¿‡è°ƒç”¨<code>t.interrupt()</code>ä»è€Œé€šçŸ¥<code>t</code>çº¿ç¨‹ä¸­æ–­ï¼Œè€Œæ­¤æ—¶<code>t</code>çº¿ç¨‹æ­£ä½äº<code>hello.join()</code>çš„ç­‰å¾…ä¸­ï¼Œæ­¤æ–¹æ³•ä¼šç«‹åˆ»ç»“æŸç­‰å¾…å¹¶æŠ›å‡º<code>InterruptedException</code>ã€‚ç”±äºæˆ‘ä»¬åœ¨<code>t</code>çº¿ç¨‹ä¸­æ•è·äº†<code>InterruptedException</code>ï¼Œå› æ­¤ï¼Œå°±å¯ä»¥å‡†å¤‡ç»“æŸè¯¥çº¿ç¨‹ã€‚åœ¨<code>t</code>çº¿ç¨‹ç»“æŸå‰ï¼Œå¯¹<code>hello</code>çº¿ç¨‹ä¹Ÿè¿›è¡Œäº†<code>interrupt()</code>è°ƒç”¨é€šçŸ¥å…¶ä¸­æ–­ã€‚å¦‚æœå»æ‰è¿™ä¸€è¡Œä»£ç ï¼Œå¯ä»¥å‘ç°<code>hello</code>çº¿ç¨‹ä»ç„¶ä¼šç»§ç»­è¿è¡Œï¼Œä¸”JVMä¸ä¼šé€€å‡ºã€‚</p>
<p><strong>è®¾ç½®æ ‡å¿—ä½ä¸­æ–­çº¿ç¨‹</strong></p>
<p>å¦ä¸€ä¸ªå¸¸ç”¨çš„ä¸­æ–­çº¿ç¨‹çš„æ–¹æ³•æ˜¯è®¾ç½®æ ‡å¿—ä½ã€‚æˆ‘ä»¬é€šå¸¸ä¼šç”¨ä¸€ä¸ª<code>running</code>æ ‡å¿—ä½æ¥æ ‡è¯†çº¿ç¨‹æ˜¯å¦åº”è¯¥ç»§ç»­è¿è¡Œï¼Œåœ¨å¤–éƒ¨çº¿ç¨‹ä¸­ï¼Œé€šè¿‡æŠŠ<code>HelloThread.running</code>ç½®ä¸º<code>false</code>ï¼Œå°±å¯ä»¥è®©çº¿ç¨‹ç»“æŸï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span>  <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        HelloThread t = <span class="keyword">new</span> HelloThread();</span><br><span class="line">        t.start();</span><br><span class="line">        Thread.sleep(<span class="number">1</span>);</span><br><span class="line">        t.running = <span class="keyword">false</span>; <span class="comment">// æ ‡å¿—ä½ç½®ä¸ºfalse</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HelloThread</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">volatile</span> <span class="keyword">boolean</span> running = <span class="keyword">true</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> n = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (running) &#123;</span><br><span class="line">            n ++;</span><br><span class="line">            System.out.println(n + <span class="string">&quot; hello!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;end!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>HelloThread</code>çš„æ ‡å¿—ä½<code>boolean running</code>æ˜¯ä¸€ä¸ªçº¿ç¨‹é—´å…±äº«çš„å˜é‡ã€‚</p>
<p>çº¿ç¨‹é—´å…±äº«å˜é‡éœ€è¦ä½¿ç”¨<code>volatile</code>å…³é”®å­—æ ‡è®°ï¼Œç¡®ä¿æ¯ä¸ªçº¿ç¨‹éƒ½èƒ½è¯»å–åˆ°æ›´æ–°åçš„å˜é‡å€¼ã€‚</p>
<p><code>volatile</code>å…³é”®å­—è§£å†³çš„æ˜¯å¯è§æ€§é—®é¢˜ï¼šå½“ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹äº†æŸä¸ªå…±äº«å˜é‡çš„å€¼ï¼Œå…¶ä»–çº¿ç¨‹èƒ½å¤Ÿç«‹åˆ»çœ‹åˆ°ä¿®æ”¹åçš„å€¼ã€‚</p>
<h2 id="4-å®ˆæŠ¤çº¿ç¨‹"><a href="#4-å®ˆæŠ¤çº¿ç¨‹" class="headerlink" title="4. å®ˆæŠ¤çº¿ç¨‹"></a>4. å®ˆæŠ¤çº¿ç¨‹</h2><p>å®ˆæŠ¤çº¿ç¨‹æ˜¯æŒ‡ä¸ºå…¶ä»–çº¿ç¨‹æœåŠ¡çš„çº¿ç¨‹ã€‚åœ¨JVMä¸­ï¼Œæ‰€æœ‰éå®ˆæŠ¤çº¿ç¨‹éƒ½æ‰§è¡Œå®Œæ¯•åï¼Œæ— è®ºæœ‰æ²¡æœ‰å®ˆæŠ¤çº¿ç¨‹ï¼Œè™šæ‹Ÿæœºéƒ½ä¼šè‡ªåŠ¨é€€å‡ºã€‚</p>
<p>å› æ­¤ï¼ŒJVMé€€å‡ºæ—¶ï¼Œä¸å¿…å…³å¿ƒå®ˆæŠ¤çº¿ç¨‹æ˜¯å¦å·²ç»“æŸã€‚</p>
<p>å¦‚ä½•åˆ›å»ºå®ˆæŠ¤çº¿ç¨‹å‘¢ï¼Ÿæ–¹æ³•å’Œæ™®é€šçº¿ç¨‹ä¸€æ ·ï¼Œåªæ˜¯åœ¨è°ƒç”¨<code>start()</code>æ–¹æ³•å‰ï¼Œè°ƒç”¨<code>setDaemon(true)</code>æŠŠè¯¥çº¿ç¨‹æ ‡è®°ä¸ºå®ˆæŠ¤çº¿ç¨‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Thread t = <span class="keyword">new</span> MyThread();</span><br><span class="line">t.setDaemon(<span class="keyword">true</span>);</span><br><span class="line">t.start();</span><br></pre></td></tr></table></figure>

<p>å®ˆæŠ¤çº¿ç¨‹ä¸èƒ½æŒæœ‰ä»»ä½•éœ€è¦å…³é—­çš„èµ„æºï¼Œä¾‹å¦‚æ‰“å¼€æ–‡ä»¶ç­‰ï¼ï¼ï¼ï¼</p>
<h2 id="5-çº¿ç¨‹åŒæ­¥"><a href="#5-çº¿ç¨‹åŒæ­¥" class="headerlink" title="5. çº¿ç¨‹åŒæ­¥"></a>5. çº¿ç¨‹åŒæ­¥</h2><p>å¦‚æœå¤šä¸ªçº¿ç¨‹åŒæ—¶è¯»å†™å…±äº«å˜é‡ï¼Œä¼šå‡ºç°æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ã€‚</p>
<p>å¤šçº¿ç¨‹æ¨¡å‹ä¸‹ï¼Œè¦ä¿è¯é€»è¾‘æ­£ç¡®ï¼Œå¯¹å…±äº«å˜é‡è¿›è¡Œè¯»å†™æ—¶ï¼Œå¿…é¡»ä¿è¯ä¸€ç»„æŒ‡ä»¤ä»¥åŸå­æ–¹å¼æ‰§è¡Œï¼šå³æŸä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œæ—¶ï¼Œå…¶ä»–çº¿ç¨‹å¿…é¡»ç­‰å¾…ï¼š</p>
<p><img src="https://raw.githubusercontent.com/ghj1998/image_repository/main/image-20210423102653271.png" alt="image-20210423102653271"></p>
<p>Javaç¨‹åºä½¿ç”¨<code>synchronized</code>å…³é”®å­—å¯¹ä¸€ä¸ªå¯¹è±¡è¿›è¡ŒåŠ é”ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">synchronized</span>(lock) &#123;</span><br><span class="line">    n = n + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚ä½•ä½¿ç”¨<code>synchronized</code>ï¼š</p>
<ol>
<li>æ‰¾å‡ºä¿®æ”¹å…±äº«å˜é‡çš„çº¿ç¨‹ä»£ç å—ï¼›</li>
<li>é€‰æ‹©ä¸€ä¸ªå…±äº«å®ä¾‹ä½œä¸ºé”ï¼›</li>
<li>ä½¿ç”¨<code>synchronized(lockObject) &#123; ... &#125;</code>ã€‚<code>lockObject</code>å¯ä»¥æ˜¯ä»»ä½•ä¸€ä¸ªå¯¹è±¡ã€‚</li>
</ol>
<p>ä¾‹å¦‚ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> add = <span class="keyword">new</span> AddThread();</span><br><span class="line">        <span class="keyword">var</span> dec = <span class="keyword">new</span> DecThread();</span><br><span class="line">        add.start();</span><br><span class="line">        dec.start();</span><br><span class="line">        add.join();</span><br><span class="line">        dec.join();</span><br><span class="line">        System.out.println(Counter.count);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Counter</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Object lock = <span class="keyword">new</span> Object();</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AddThread</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">10000</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">synchronized</span>(Counter.lock) &#123;</span><br><span class="line">                Counter.count += <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DecThread</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">10000</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">synchronized</span>(Counter.lock) &#123;</span><br><span class="line">                Counter.count -= <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>ä¸éœ€è¦synchronizedçš„æ“ä½œ</strong></p>
<p>JVMè§„èŒƒå®šä¹‰äº†å‡ ç§åŸå­æ“ä½œï¼š</p>
<ul>
<li>åŸºæœ¬ç±»å‹ï¼ˆ<code>long</code>å’Œ<code>double</code>é™¤å¤–ï¼‰èµ‹å€¼ï¼Œä¾‹å¦‚ï¼š<code>int n = m</code>ï¼›</li>
<li>å¼•ç”¨ç±»å‹èµ‹å€¼ï¼Œä¾‹å¦‚ï¼š<code>List&lt;String&gt; list = anotherList</code>ã€‚</li>
</ul>
<p>å¯¹JVMå®šä¹‰çš„å•ä¸ªåŸå­æ“ä½œä¸éœ€è¦åŒæ­¥ã€‚</p>
<h2 id="6-åŒæ­¥æ–¹æ³•"><a href="#6-åŒæ­¥æ–¹æ³•" class="headerlink" title="6. åŒæ­¥æ–¹æ³•"></a>6. åŒæ­¥æ–¹æ³•</h2><p>è®©çº¿ç¨‹è‡ªå·±é€‰æ‹©é”å¯¹è±¡å¾€å¾€ä¼šä½¿å¾—ä»£ç é€»è¾‘æ··ä¹±ï¼Œä¹Ÿä¸åˆ©äºå°è£…ã€‚æ›´å¥½çš„æ–¹æ³•æ˜¯æŠŠ<code>synchronized</code>é€»è¾‘å°è£…èµ·æ¥ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Counter</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">synchronized</span>(<span class="keyword">this</span>) &#123;</span><br><span class="line">            count += n;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dec</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">synchronized</span>(<span class="keyword">this</span>) &#123;</span><br><span class="line">            count -= n;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">get</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>synchronized</code>é”ä½çš„å¯¹è±¡æ˜¯<code>this</code>ï¼Œå³å½“å‰å®ä¾‹ï¼Œè¿™åˆä½¿å¾—åˆ›å»ºå¤šä¸ª<code>Counter</code>å®ä¾‹çš„æ—¶å€™ï¼Œå®ƒä»¬ä¹‹é—´äº’ä¸å½±å“ï¼Œå¯ä»¥å¹¶å‘æ‰§è¡Œï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> c1 = Counter();</span><br><span class="line"><span class="keyword">var</span> c2 = Counter();</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯¹c1è¿›è¡Œæ“ä½œçš„çº¿ç¨‹:</span></span><br><span class="line"><span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">    c1.add();</span><br><span class="line">&#125;).start();</span><br><span class="line"><span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">    c1.dec();</span><br><span class="line">&#125;).start();</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯¹c2è¿›è¡Œæ“ä½œçš„çº¿ç¨‹:</span></span><br><span class="line"><span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">    c2.add();</span><br><span class="line">&#125;).start();</span><br><span class="line"><span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">    c2.dec();</span><br><span class="line">&#125;).start();</span><br></pre></td></tr></table></figure>

<p>å¦‚æœä¸€ä¸ªç±»è¢«è®¾è®¡ä¸ºå…è®¸å¤šçº¿ç¨‹æ­£ç¡®è®¿é—®ï¼Œæˆ‘ä»¬å°±è¯´è¿™ä¸ªç±»å°±æ˜¯â€œçº¿ç¨‹å®‰å…¨â€çš„ï¼ˆthread-safeï¼‰ï¼Œä¸Šé¢çš„<code>Counter</code>ç±»å°±æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚Javaæ ‡å‡†åº“çš„<code>java.lang.StringBuffer</code>ä¹Ÿæ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</p>
<p>è¿˜æœ‰ä¸€äº›ä¸å˜ç±»ï¼Œä¾‹å¦‚<code>String</code>ï¼Œ<code>Integer</code>ï¼Œ<code>LocalDate</code>ï¼Œå®ƒä»¬çš„æ‰€æœ‰æˆå‘˜å˜é‡éƒ½æ˜¯<code>final</code>ï¼Œå¤šçº¿ç¨‹åŒæ—¶è®¿é—®æ—¶åªèƒ½è¯»ä¸èƒ½å†™ï¼Œè¿™äº›ä¸å˜ç±»ä¹Ÿæ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</p>
<p>æœ€åï¼Œç±»ä¼¼<code>Math</code>è¿™äº›åªæä¾›é™æ€æ–¹æ³•ï¼Œæ²¡æœ‰æˆå‘˜å˜é‡çš„ç±»ï¼Œä¹Ÿæ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</p>
<p>é™¤äº†ä¸Šè¿°å‡ ç§å°‘æ•°æƒ…å†µï¼Œå¤§éƒ¨åˆ†ç±»ï¼Œä¾‹å¦‚<code>ArrayList</code>ï¼Œéƒ½æ˜¯éçº¿ç¨‹å®‰å…¨çš„ç±»ï¼Œæˆ‘ä»¬ä¸èƒ½åœ¨å¤šçº¿ç¨‹ä¸­ä¿®æ”¹å®ƒä»¬ã€‚ä½†æ˜¯ï¼Œå¦‚æœæ‰€æœ‰çº¿ç¨‹éƒ½åªè¯»å–ï¼Œä¸å†™å…¥ï¼Œé‚£ä¹ˆ<code>ArrayList</code>æ˜¯å¯ä»¥å®‰å…¨åœ°åœ¨çº¿ç¨‹é—´å…±äº«çš„ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">synchronized</span>(<span class="keyword">this</span>) &#123; <span class="comment">// é”ä½this</span></span><br><span class="line">        count += n;</span><br><span class="line">    &#125; <span class="comment">// è§£é”</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç­‰åŒäºï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123; <span class="comment">// é”ä½this</span></span><br><span class="line">    count += n;</span><br><span class="line">&#125; <span class="comment">// è§£é”</span></span><br></pre></td></tr></table></figure>

<p>å¯¹äº<code>static</code>æ–¹æ³•ï¼Œæ˜¯æ²¡æœ‰<code>this</code>å®ä¾‹çš„ï¼Œå¯¹<code>static</code>æ–¹æ³•æ·»åŠ <code>synchronized</code>ï¼Œé”ä½çš„æ˜¯è¯¥ç±»çš„<code>Class</code>å®ä¾‹ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">synchronized</span>(Counter.class) &#123;</span><br><span class="line">            ...</span><br><span class="line">        &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<h2 id="7-æ­»é”"><a href="#7-æ­»é”" class="headerlink" title="7. æ­»é”"></a>7. æ­»é”</h2><p>Javaçš„çº¿ç¨‹é”æ˜¯å¯é‡å…¥çš„é”ã€‚</p>
<p>èƒ½è¢«åŒä¸€ä¸ªçº¿ç¨‹åå¤è·å–çš„é”ï¼Œå°±å«åšå¯é‡å…¥é”ã€‚</p>
<p>ç”±äºJavaçš„çº¿ç¨‹é”æ˜¯å¯é‡å…¥é”ï¼Œæ‰€ä»¥ï¼Œè·å–é”çš„æ—¶å€™ï¼Œä¸ä½†è¦åˆ¤æ–­æ˜¯å¦æ˜¯ç¬¬ä¸€æ¬¡è·å–ï¼Œè¿˜è¦è®°å½•è¿™æ˜¯ç¬¬å‡ æ¬¡è·å–ã€‚æ¯è·å–ä¸€æ¬¡é”ï¼Œè®°å½•+1ï¼Œæ¯é€€å‡º<code>synchronized</code>å—ï¼Œè®°å½•-1ï¼Œå‡åˆ°0çš„æ—¶å€™ï¼Œæ‰ä¼šçœŸæ­£é‡Šæ”¾é”ã€‚</p>
<p><strong>æ­»é”</strong></p>
<p>ä¸€ä¸ªçº¿ç¨‹å¯ä»¥è·å–ä¸€ä¸ªé”åï¼Œå†ç»§ç»­è·å–å¦ä¸€ä¸ªé”ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> m)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">synchronized</span>(lockA) &#123; <span class="comment">// è·å¾—lockAçš„é”</span></span><br><span class="line">        <span class="keyword">this</span>.value += m;</span><br><span class="line">        <span class="keyword">synchronized</span>(lockB) &#123; <span class="comment">// è·å¾—lockBçš„é”</span></span><br><span class="line">            <span class="keyword">this</span>.another += m;</span><br><span class="line">        &#125; <span class="comment">// é‡Šæ”¾lockBçš„é”</span></span><br><span class="line">    &#125; <span class="comment">// é‡Šæ”¾lockAçš„é”</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dec</span><span class="params">(<span class="keyword">int</span> m)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">synchronized</span>(lockB) &#123; <span class="comment">// è·å¾—lockBçš„é”</span></span><br><span class="line">        <span class="keyword">this</span>.another -= m;</span><br><span class="line">        <span class="keyword">synchronized</span>(lockA) &#123; <span class="comment">// è·å¾—lockAçš„é”</span></span><br><span class="line">            <span class="keyword">this</span>.value -= m;</span><br><span class="line">        &#125; <span class="comment">// é‡Šæ”¾lockAçš„é”</span></span><br><span class="line">    &#125; <span class="comment">// é‡Šæ”¾lockBçš„é”</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ­»é”å‘ç”Ÿåï¼Œæ²¡æœ‰ä»»ä½•æœºåˆ¶èƒ½è§£é™¤æ­»é”ï¼Œåªèƒ½å¼ºåˆ¶ç»“æŸJVMè¿›ç¨‹ã€‚åœ¨ç¼–å†™å¤šçº¿ç¨‹åº”ç”¨æ—¶ï¼Œè¦ç‰¹åˆ«æ³¨æ„é˜²æ­¢æ­»é”ã€‚</p>
<p>å¦‚ä½•é¿å…æ­»é”å‘¢ï¼Ÿ</p>
<p>çº¿ç¨‹è·å–é”çš„é¡ºåºè¦ä¸€è‡´ã€‚å³ä¸¥æ ¼æŒ‰ç…§å…ˆè·å–<code>lockA</code>ï¼Œå†è·å–<code>lockB</code>çš„é¡ºåºï¼Œæ”¹å†™<code>dec()</code>æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dec</span><span class="params">(<span class="keyword">int</span> m)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">synchronized</span>(lockA) &#123; <span class="comment">// è·å¾—lockAçš„é”</span></span><br><span class="line">        <span class="keyword">this</span>.value -= m;</span><br><span class="line">        <span class="keyword">synchronized</span>(lockB) &#123; <span class="comment">// è·å¾—lockBçš„é”</span></span><br><span class="line">            <span class="keyword">this</span>.another -= m;</span><br><span class="line">        &#125; <span class="comment">// é‡Šæ”¾lockBçš„é”</span></span><br><span class="line">    &#125; <span class="comment">// é‡Šæ”¾lockAçš„é”</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="8-waitå’Œnotify"><a href="#8-waitå’Œnotify" class="headerlink" title="8. waitå’Œnotify"></a>8. waitå’Œnotify</h2><p>å¤šçº¿ç¨‹åè°ƒè¿è¡Œçš„åŸåˆ™å°±æ˜¯ï¼šå½“æ¡ä»¶ä¸æ»¡è¶³æ—¶ï¼Œçº¿ç¨‹è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼›å½“æ¡ä»¶æ»¡è¶³æ—¶ï¼Œçº¿ç¨‹è¢«å”¤é†’ï¼Œç»§ç»­æ‰§è¡Œä»»åŠ¡ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TaskQueue</span> </span>&#123;</span><br><span class="line">    Queue&lt;String&gt; queue = <span class="keyword">new</span> LinkedList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">addTask</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.queue.add(s);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> String <span class="title">getTask</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (queue.isEmpty()) &#123;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> queue.remove();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>while()</code>å¾ªç¯æ°¸è¿œä¸ä¼šé€€å‡ºã€‚å› ä¸ºçº¿ç¨‹åœ¨æ‰§è¡Œ<code>while()</code>å¾ªç¯æ—¶ï¼Œå·²ç»åœ¨<code>getTask()</code>å…¥å£è·å–äº†<code>this</code>é”ï¼Œå…¶ä»–çº¿ç¨‹æ ¹æœ¬æ— æ³•è°ƒç”¨<code>addTask()</code>ï¼Œå› ä¸º<code>addTask()</code>æ‰§è¡Œæ¡ä»¶ä¹Ÿæ˜¯è·å–<code>this</code>é”ã€‚</p>
<p>æ”¹é€ ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> String <span class="title">getTask</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (queue.isEmpty()) &#123;</span><br><span class="line">        <span class="keyword">this</span>.wait();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> queue.remove();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å½“ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œåˆ°<code>getTask()</code>æ–¹æ³•å†…éƒ¨çš„<code>while</code>å¾ªç¯æ—¶ï¼Œå®ƒå¿…å®šå·²ç»è·å–åˆ°äº†<code>this</code>é”ï¼Œæ­¤æ—¶ï¼Œçº¿ç¨‹æ‰§è¡Œ<code>while</code>æ¡ä»¶åˆ¤æ–­ï¼Œå¦‚æœæ¡ä»¶æˆç«‹ï¼ˆé˜Ÿåˆ—ä¸ºç©ºï¼‰ï¼Œçº¿ç¨‹å°†æ‰§è¡Œ<code>this.wait()</code>ï¼Œè¿›å…¥ç­‰å¾…çŠ¶æ€ã€‚</p>
<p>è¿™é‡Œçš„å…³é”®æ˜¯ï¼š<code>wait()</code>æ–¹æ³•å¿…é¡»åœ¨å½“å‰è·å–çš„é”å¯¹è±¡ä¸Šè°ƒç”¨ï¼Œè¿™é‡Œè·å–çš„æ˜¯<code>this</code>é”ï¼Œå› æ­¤è°ƒç”¨<code>this.wait()</code>ã€‚</p>
<p><code>wait()</code>æ–¹æ³•è°ƒç”¨æ—¶ï¼Œä¼š<em>é‡Šæ”¾</em>çº¿ç¨‹è·å¾—çš„é”ï¼Œ<code>wait()</code>æ–¹æ³•è¿”å›åï¼Œçº¿ç¨‹åˆä¼šé‡æ–°è¯•å›¾è·å¾—é”ã€‚</p>
<p>å¦‚ä½•è®©ç­‰å¾…çš„çº¿ç¨‹è¢«é‡æ–°å”¤é†’ï¼Œç„¶åä»<code>wait()</code>æ–¹æ³•è¿”å›ï¼Ÿ</p>
<p>åœ¨ç›¸åŒçš„é”å¯¹è±¡ä¸Šè°ƒç”¨<code>notify()</code>æ–¹æ³•ã€‚æˆ‘ä»¬ä¿®æ”¹<code>addTask()</code>å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">addTask</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.queue.add(s);</span><br><span class="line">    <span class="keyword">this</span>.notify(); <span class="comment">// å”¤é†’åœ¨thisé”ç­‰å¾…çš„çº¿ç¨‹</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨å¾€é˜Ÿåˆ—ä¸­æ·»åŠ äº†ä»»åŠ¡åï¼Œçº¿ç¨‹ç«‹åˆ»å¯¹<code>this</code>é”å¯¹è±¡è°ƒç”¨<code>notify()</code>æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šå”¤é†’ä¸€ä¸ªæ­£åœ¨<code>this</code>é”ç­‰å¾…çš„çº¿ç¨‹ï¼ˆå°±æ˜¯åœ¨<code>getTask()</code>ä¸­ä½äº<code>this.wait()</code>çš„çº¿ç¨‹ï¼‰ï¼Œä»è€Œä½¿å¾—ç­‰å¾…çº¿ç¨‹ä»<code>this.wait()</code>æ–¹æ³•è¿”å›ã€‚</p>
<p>å®Œæ•´ä¾‹å­ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> q = <span class="keyword">new</span> TaskQueue();</span><br><span class="line">        <span class="keyword">var</span> ts = <span class="keyword">new</span> ArrayList&lt;Thread&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">5</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">var</span> t = <span class="keyword">new</span> Thread() &#123;</span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                    <span class="comment">// æ‰§è¡Œtask:</span></span><br><span class="line">                    <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">                        <span class="keyword">try</span> &#123;</span><br><span class="line">                            String s = q.getTask();</span><br><span class="line">                            System.out.println(<span class="string">&quot;execute task: &quot;</span> + s);</span><br><span class="line">                        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                            <span class="keyword">return</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;;</span><br><span class="line">            t.start();</span><br><span class="line">            ts.add(t);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">var</span> add = <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">10</span>; i++) &#123;</span><br><span class="line">                <span class="comment">// æ”¾å…¥task:</span></span><br><span class="line">                String s = <span class="string">&quot;t-&quot;</span> + Math.random();</span><br><span class="line">                System.out.println(<span class="string">&quot;add task: &quot;</span> + s);</span><br><span class="line">                q.addTask(s);</span><br><span class="line">                <span class="keyword">try</span> &#123; Thread.sleep(<span class="number">100</span>); &#125; <span class="keyword">catch</span>(InterruptedException e) &#123;&#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        add.start();</span><br><span class="line">        add.join();</span><br><span class="line">        Thread.sleep(<span class="number">100</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> t : ts) &#123;</span><br><span class="line">            t.interrupt();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TaskQueue</span> </span>&#123;</span><br><span class="line">    Queue&lt;String&gt; queue = <span class="keyword">new</span> LinkedList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">addTask</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.queue.add(s);</span><br><span class="line">        <span class="keyword">this</span>.notifyAll();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> String <span class="title">getTask</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (queue.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">this</span>.wait();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> queue.remove();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>this.notifyAll()</code>è€Œä¸æ˜¯<code>this.notify()</code>ï¼Œä½¿ç”¨<code>notifyAll()</code>å°†å”¤é†’æ‰€æœ‰å½“å‰æ­£åœ¨<code>this</code>é”ç­‰å¾…çš„çº¿ç¨‹ï¼Œè€Œ<code>notify()</code>åªä¼šå”¤é†’å…¶ä¸­ä¸€ä¸ªï¼Œè¿™æ˜¯å› ä¸ºå¯èƒ½æœ‰å¤šä¸ªçº¿ç¨‹æ­£åœ¨<code>getTask()</code>æ–¹æ³•å†…éƒ¨çš„<code>wait()</code>ä¸­ç­‰å¾…ï¼Œä½¿ç”¨<code>notifyAll()</code>å°†ä¸€æ¬¡æ€§å…¨éƒ¨å”¤é†’ã€‚é€šå¸¸æ¥è¯´ï¼Œ<code>notifyAll()</code>æ›´å®‰å…¨ã€‚</p>
<p><strong><code>while()</code>å¾ªç¯ä¸­è°ƒç”¨`wait()</strong></p>
<h2 id="9-ReentrantLock"><a href="#9-ReentrantLock" class="headerlink" title="9. ReentrantLock"></a>9. ReentrantLock</h2><p><code>java.util.concurrent.locks</code>åŒ…æä¾›çš„<code>ReentrantLock</code>ç”¨äºæ›¿ä»£<code>synchronized</code>åŠ é”</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Counter</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> count;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">synchronized</span>(<span class="keyword">this</span>) &#123;</span><br><span class="line">            count += n;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç­‰åŒäºï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Counter</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Lock lock = <span class="keyword">new</span> ReentrantLock();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> count;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            count += n;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>ReentrantLock</code>æ˜¯Javaä»£ç å®ç°çš„é”ï¼Œæˆ‘ä»¬å°±å¿…é¡»å…ˆè·å–é”ï¼Œç„¶ååœ¨<code>finally</code>ä¸­æ­£ç¡®é‡Šæ”¾é”ã€‚</p>
<p><code>ReentrantLock</code>æ˜¯å¯é‡å…¥é”ï¼Œå®ƒå’Œ<code>synchronized</code>ä¸€æ ·ï¼Œä¸€ä¸ªçº¿ç¨‹å¯ä»¥å¤šæ¬¡è·å–åŒä¸€ä¸ªé”ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (lock.tryLock(<span class="number">1</span>, TimeUnit.SECONDS)) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        lock.unlock();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸Šè¿°ä»£ç åœ¨å°è¯•è·å–é”çš„æ—¶å€™ï¼Œæœ€å¤šç­‰å¾…1ç§’ã€‚å¦‚æœ1ç§’åä»æœªè·å–åˆ°é”ï¼Œ<code>tryLock()</code>è¿”å›<code>false</code>ï¼Œç¨‹åºå°±å¯ä»¥åšä¸€äº›é¢å¤–å¤„ç†ï¼Œè€Œä¸æ˜¯æ— é™ç­‰å¾…ä¸‹å»ã€‚</p>
<p>æ‰€ä»¥ï¼Œä½¿ç”¨<code>ReentrantLock</code>æ¯”ç›´æ¥ä½¿ç”¨<code>synchronized</code>æ›´å®‰å…¨ï¼Œçº¿ç¨‹åœ¨<code>tryLock()</code>å¤±è´¥çš„æ—¶å€™ä¸ä¼šå¯¼è‡´æ­»é”ã€‚</p>
<h2 id="10-Condition"><a href="#10-Condition" class="headerlink" title="10. Condition"></a>10. Condition</h2><p>ä½¿ç”¨<code>Condition</code>å¯¹è±¡æ¥å®ç°<code>wait</code>å’Œ<code>notify</code>çš„åŠŸèƒ½ã€‚</p>
<p>æŠŠå‰é¢ç”¨<code>synchronized</code>å®ç°çš„åŠŸèƒ½é€šè¿‡<code>ReentrantLock</code>å’Œ<code>Condition</code>æ¥å®ç°ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TaskQueue</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Lock lock = <span class="keyword">new</span> ReentrantLock();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Condition condition = lock.newCondition();</span><br><span class="line">    <span class="keyword">private</span> Queue&lt;String&gt; queue = <span class="keyword">new</span> LinkedList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addTask</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            queue.add(s);</span><br><span class="line">            condition.signalAll();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getTask</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">while</span> (queue.isEmpty()) &#123;</span><br><span class="line">                condition.await();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> queue.remove();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨<code>Condition</code>æ—¶ï¼Œå¼•ç”¨çš„<code>Condition</code>å¯¹è±¡å¿…é¡»ä»<code>Lock</code>å®ä¾‹çš„<code>newCondition()</code>è¿”å›ï¼Œè¿™æ ·æ‰èƒ½è·å¾—ä¸€ä¸ªç»‘å®šäº†<code>Lock</code>å®ä¾‹çš„<code>Condition</code>å®ä¾‹ã€‚</p>
<p><code>Condition</code>æä¾›çš„<code>await()</code>ã€<code>signal()</code>ã€<code>signalAll()</code>åŸç†å’Œ<code>synchronized</code>é”å¯¹è±¡çš„<code>wait()</code>ã€<code>notify()</code>ã€<code>notifyAll()</code>æ˜¯ä¸€è‡´çš„ï¼Œå¹¶ä¸”å…¶è¡Œä¸ºä¹Ÿæ˜¯ä¸€æ ·çš„ï¼š</p>
<ul>
<li><code>await()</code>ä¼šé‡Šæ”¾å½“å‰é”ï¼Œè¿›å…¥ç­‰å¾…çŠ¶æ€ï¼›</li>
<li><code>signal()</code>ä¼šå”¤é†’æŸä¸ªç­‰å¾…çº¿ç¨‹ï¼›</li>
<li><code>signalAll()</code>ä¼šå”¤é†’æ‰€æœ‰ç­‰å¾…çº¿ç¨‹ï¼›</li>
<li>å”¤é†’çº¿ç¨‹ä»<code>await()</code>è¿”å›åéœ€è¦é‡æ–°è·å¾—é”ã€‚</li>
</ul>
<p><code>await()</code>å¯ä»¥åœ¨ç­‰å¾…æŒ‡å®šæ—¶é—´åï¼Œå¦‚æœè¿˜æ²¡æœ‰è¢«å…¶ä»–çº¿ç¨‹é€šè¿‡<code>signal()</code>æˆ–<code>signalAll()</code>å”¤é†’ï¼Œå¯ä»¥è‡ªå·±é†’æ¥ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (condition.await(<span class="number">1</span>, TimeUnit.SECOND)) &#123;</span><br><span class="line">    <span class="comment">// è¢«å…¶ä»–çº¿ç¨‹å”¤é†’</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// æŒ‡å®šæ—¶é—´å†…æ²¡æœ‰è¢«å…¶ä»–çº¿ç¨‹å”¤é†’</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="11-ReadWriteLock"><a href="#11-ReadWriteLock" class="headerlink" title="11. ReadWriteLock"></a>11. ReadWriteLock</h2><p><code>ReadWriteLock</code>å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå®ƒä¿è¯ï¼š</p>
<ul>
<li>åªå…è®¸ä¸€ä¸ªçº¿ç¨‹å†™å…¥ï¼ˆå…¶ä»–çº¿ç¨‹æ—¢ä¸èƒ½å†™å…¥ä¹Ÿä¸èƒ½è¯»å–ï¼‰ï¼›</li>
<li>æ²¡æœ‰å†™å…¥æ—¶ï¼Œå¤šä¸ªçº¿ç¨‹å…è®¸åŒæ—¶è¯»ï¼ˆæé«˜æ€§èƒ½ï¼‰ã€‚</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Counter</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ReadWriteLock rwlock = <span class="keyword">new</span> ReentrantReadWriteLock();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Lock rlock = rwlock.readLock();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Lock wlock = rwlock.writeLock();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span>[] counts = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">10</span>];</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">inc</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">        wlock.lock(); <span class="comment">// åŠ å†™é”</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            counts[index] += <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            wlock.unlock(); <span class="comment">// é‡Šæ”¾å†™é”</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span>[] get() &#123;</span><br><span class="line">        rlock.lock(); <span class="comment">// åŠ è¯»é”</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> Arrays.copyOf(counts, counts.length);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            rlock.unlock(); <span class="comment">// é‡Šæ”¾è¯»é”</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;	</span><br></pre></td></tr></table></figure>

<h2 id="12-StampedLock"><a href="#12-StampedLock" class="headerlink" title="12. StampedLock"></a>12. StampedLock</h2><p>æ–°çš„è¯»å†™é”ï¼š<code>StampedLock</code>ã€‚<code>StampedLock</code>å’Œ<code>ReadWriteLock</code>ç›¸æ¯”ï¼Œæ”¹è¿›ä¹‹å¤„åœ¨äºï¼šè¯»çš„è¿‡ç¨‹ä¸­ä¹Ÿå…è®¸è·å–å†™é”åå†™å…¥ï¼</p>
<p>ä¹è§‚é”çš„æ„æ€å°±æ˜¯ä¹è§‚åœ°ä¼°è®¡è¯»çš„è¿‡ç¨‹ä¸­å¤§æ¦‚ç‡ä¸ä¼šæœ‰å†™å…¥ï¼Œå› æ­¤è¢«ç§°ä¸ºä¹è§‚é”ã€‚åè¿‡æ¥ï¼Œæ‚²è§‚é”åˆ™æ˜¯è¯»çš„è¿‡ç¨‹ä¸­æ‹’ç»æœ‰å†™å…¥ï¼Œä¹Ÿå°±æ˜¯å†™å…¥å¿…é¡»ç­‰å¾…ã€‚æ˜¾ç„¶ä¹è§‚é”çš„å¹¶å‘æ•ˆç‡æ›´é«˜ï¼Œä½†ä¸€æ—¦æœ‰å°æ¦‚ç‡çš„å†™å…¥å¯¼è‡´è¯»å–çš„æ•°æ®ä¸ä¸€è‡´ï¼Œéœ€è¦èƒ½æ£€æµ‹å‡ºæ¥ï¼Œå†è¯»ä¸€éå°±è¡Œã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Point</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> StampedLock stampedLock = <span class="keyword">new</span> StampedLock();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">double</span> x;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">double</span> y;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">move</span><span class="params">(<span class="keyword">double</span> deltaX, <span class="keyword">double</span> deltaY)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">long</span> stamp = stampedLock.writeLock(); <span class="comment">// è·å–å†™é”</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            x += deltaX;</span><br><span class="line">            y += deltaY;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            stampedLock.unlockWrite(stamp); <span class="comment">// é‡Šæ”¾å†™é”</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">distanceFromOrigin</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">long</span> stamp = stampedLock.tryOptimisticRead(); <span class="comment">// è·å¾—ä¸€ä¸ªä¹è§‚è¯»é”</span></span><br><span class="line">        <span class="comment">// æ³¨æ„ä¸‹é¢ä¸¤è¡Œä»£ç ä¸æ˜¯åŸå­æ“ä½œ</span></span><br><span class="line">        <span class="comment">// å‡è®¾x,y = (100,200)</span></span><br><span class="line">        <span class="keyword">double</span> currentX = x;</span><br><span class="line">        <span class="comment">// æ­¤å¤„å·²è¯»å–åˆ°x=100ï¼Œä½†x,yå¯èƒ½è¢«å†™çº¿ç¨‹ä¿®æ”¹ä¸º(300,400)</span></span><br><span class="line">        <span class="keyword">double</span> currentY = y;</span><br><span class="line">        <span class="comment">// æ­¤å¤„å·²è¯»å–åˆ°yï¼Œå¦‚æœæ²¡æœ‰å†™å…¥ï¼Œè¯»å–æ˜¯æ­£ç¡®çš„(100,200)</span></span><br><span class="line">        <span class="comment">// å¦‚æœæœ‰å†™å…¥ï¼Œè¯»å–æ˜¯é”™è¯¯çš„(100,400)</span></span><br><span class="line">        <span class="keyword">if</span> (!stampedLock.validate(stamp)) &#123; <span class="comment">// æ£€æŸ¥ä¹è§‚è¯»é”åæ˜¯å¦æœ‰å…¶ä»–å†™é”å‘ç”Ÿ</span></span><br><span class="line">            stamp = stampedLock.readLock(); <span class="comment">// è·å–ä¸€ä¸ªæ‚²è§‚è¯»é”</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                currentX = x;</span><br><span class="line">                currentY = y;</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                stampedLock.unlockRead(stamp); <span class="comment">// é‡Šæ”¾æ‚²è§‚è¯»é”</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> Math.sqrt(currentX * currentX + currentY * currentY);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="13-ä½¿ç”¨Concurrenté›†åˆ"><a href="#13-ä½¿ç”¨Concurrenté›†åˆ" class="headerlink" title="13. ä½¿ç”¨Concurrenté›†åˆ"></a>13. ä½¿ç”¨Concurrenté›†åˆ</h2><p><code>BlockingQueue</code>ï¼šå½“ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨è¿™ä¸ª<code>TaskQueue</code>çš„<code>getTask()</code>æ–¹æ³•æ—¶ï¼Œè¯¥æ–¹æ³•å†…éƒ¨å¯èƒ½ä¼šè®©çº¿ç¨‹å˜æˆç­‰å¾…çŠ¶æ€ï¼Œç›´åˆ°é˜Ÿåˆ—æ¡ä»¶æ»¡è¶³ä¸ä¸ºç©ºï¼Œçº¿ç¨‹è¢«å”¤é†’åï¼Œ<code>getTask()</code>æ–¹æ³•æ‰ä¼šè¿”å›ã€‚</p>
<p>Javaæ ‡å‡†åº“çš„<code>java.util.concurrent</code>åŒ…æä¾›çº¿ç¨‹å®‰å…¨çš„é›†åˆï¼š</p>
<table>
<thead>
<tr>
<th align="left">interface</th>
<th align="left">non-thread-safe</th>
<th align="left">thread-safe</th>
</tr>
</thead>
<tbody><tr>
<td align="left">List</td>
<td align="left"><code>ArrayList</code></td>
<td align="left"><code>CopyOnWriteArrayList</code></td>
</tr>
<tr>
<td align="left">Map</td>
<td align="left"><code>HashMap</code></td>
<td align="left"><code>ConcurrentHashMap</code></td>
</tr>
<tr>
<td align="left">Set</td>
<td align="left"><code>HashSet / TreeSet</code></td>
<td align="left"><code>CopyOnWriteArraySet</code></td>
</tr>
<tr>
<td align="left">Queue</td>
<td align="left"><code>ArrayDeque / LinkedList</code></td>
<td align="left"><code>ArrayBlockingQueue / LinkedBlockingQueue</code></td>
</tr>
<tr>
<td align="left">Deque</td>
<td align="left"><code>ArrayDeque / LinkedList</code></td>
<td align="left"><code>LinkedBlockingDeque</code></td>
</tr>
</tbody></table>
<p>ä½¿ç”¨æ–¹æ³•å®Œå…¨ç›¸åŒã€‚</p>
<p><code>java.util.Collections</code>å·¥å…·ç±»è¿˜æä¾›äº†ä¸€ä¸ªæ—§çš„çº¿ç¨‹å®‰å…¨é›†åˆè½¬æ¢å™¨ï¼Œå¯ä»¥è¿™ä¹ˆç”¨ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Map unsafeMap = <span class="keyword">new</span> HashMap();</span><br><span class="line">Map threadSafeMap = Collections.synchronizedMap(unsafeMap);</span><br></pre></td></tr></table></figure>

<p><strong>ä½†æ˜¯ä¸æ¨èï¼Œå› ä¸ºæ•ˆç‡ä½</strong></p>
<h2 id="14-Atomic"><a href="#14-Atomic" class="headerlink" title="14. Atomic"></a>14. Atomic</h2><p>Javaçš„<code>java.util.concurrent</code>åŒ…é™¤äº†æä¾›åº•å±‚é”ã€å¹¶å‘é›†åˆå¤–ï¼Œè¿˜æä¾›äº†ä¸€ç»„åŸå­æ“ä½œçš„å°è£…ç±»ï¼Œå®ƒä»¬ä½äº<code>java.util.concurrent.atomic</code>åŒ…ã€‚</p>
<p>æˆ‘ä»¬ä»¥<code>AtomicInteger</code>ä¸ºä¾‹ï¼Œå®ƒæä¾›çš„ä¸»è¦æ“ä½œæœ‰ï¼š</p>
<ul>
<li>å¢åŠ å€¼å¹¶è¿”å›æ–°å€¼ï¼š<code>int addAndGet(int delta)</code></li>
<li>åŠ 1åè¿”å›æ–°å€¼ï¼š<code>int incrementAndGet()</code></li>
<li>è·å–å½“å‰å€¼ï¼š<code>int get()</code></li>
<li>ç”¨CASæ–¹å¼è®¾ç½®ï¼š<code>int compareAndSet(int expect, int update)</code></li>
</ul>
<p>CAS ï¼šCompare and Setã€‚</p>
<p>å®ç°æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">incrementAndGet</span><span class="params">(AtomicInteger <span class="keyword">var</span>)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> prev, next;</span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">        prev = <span class="keyword">var</span>.get();</span><br><span class="line">        next = prev + <span class="number">1</span>;</span><br><span class="line">    &#125; <span class="keyword">while</span> ( ! <span class="keyword">var</span>.compareAndSet(prev, next));</span><br><span class="line">    <span class="keyword">return</span> next;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>CASæ˜¯æŒ‡ï¼Œåœ¨è¿™ä¸ªæ“ä½œä¸­ï¼Œå¦‚æœ<code>AtomicInteger</code>çš„å½“å‰å€¼æ˜¯<code>prev</code>ï¼Œé‚£ä¹ˆå°±æ›´æ–°ä¸º<code>next</code>ï¼Œè¿”å›<code>true</code>ã€‚å¦‚æœ<code>AtomicInteger</code>çš„å½“å‰å€¼ä¸æ˜¯<code>prev</code>ï¼Œå°±ä»€ä¹ˆä¹Ÿä¸å¹²ï¼Œè¿”å›<code>false</code>ã€‚é€šè¿‡CASæ“ä½œå¹¶é…åˆ<code>do ... while</code>å¾ªç¯ï¼Œå³ä½¿å…¶ä»–çº¿ç¨‹ä¿®æ”¹äº†<code>AtomicInteger</code>çš„å€¼ï¼Œæœ€ç»ˆçš„ç»“æœä¹Ÿæ˜¯æ­£ç¡®çš„ã€‚</p>
<p>æˆ‘ä»¬å¹¶ä¸éœ€è¦ç›´æ¥ç”¨<code>do ... while</code>å¾ªç¯è°ƒç”¨<code>compareAndSet</code>å®ç°å¤æ‚çš„å¹¶å‘æ“ä½œï¼Œè€Œæ˜¯ç”¨<code>incrementAndGet()</code>è¿™æ ·çš„å°è£…å¥½çš„æ–¹æ³•ï¼Œå› æ­¤ï¼Œä½¿ç”¨èµ·æ¥éå¸¸ç®€å•ã€‚</p>
<p>åœ¨é«˜åº¦ç«äº‰çš„æƒ…å†µä¸‹ï¼Œè¿˜å¯ä»¥ä½¿ç”¨Java 8æä¾›çš„<code>LongAdder</code>å’Œ<code>LongAccumulator</code>ã€‚</p>
<h2 id="15-çº¿ç¨‹æ± "><a href="#15-çº¿ç¨‹æ± " class="headerlink" title="15. çº¿ç¨‹æ± "></a>15. çº¿ç¨‹æ± </h2><h3 id="15-1-æ™®é€šçº¿ç¨‹æ± "><a href="#15-1-æ™®é€šçº¿ç¨‹æ± " class="headerlink" title="15.1 æ™®é€šçº¿ç¨‹æ± "></a>15.1 æ™®é€šçº¿ç¨‹æ± </h3><p>ç¨‹æ± å†…éƒ¨ç»´æŠ¤äº†è‹¥å¹²ä¸ªçº¿ç¨‹ï¼Œæ²¡æœ‰ä»»åŠ¡çš„æ—¶å€™ï¼Œè¿™äº›çº¿ç¨‹éƒ½å¤„äºç­‰å¾…çŠ¶æ€ã€‚å¦‚æœæœ‰æ–°ä»»åŠ¡ï¼Œå°±åˆ†é…ä¸€ä¸ªç©ºé—²çº¿ç¨‹æ‰§è¡Œã€‚å¦‚æœæ‰€æœ‰çº¿ç¨‹éƒ½å¤„äºå¿™ç¢ŒçŠ¶æ€ï¼Œæ–°ä»»åŠ¡è¦ä¹ˆæ”¾å…¥é˜Ÿåˆ—ç­‰å¾…ï¼Œè¦ä¹ˆå¢åŠ ä¸€ä¸ªæ–°çº¿ç¨‹è¿›è¡Œå¤„ç†ã€‚</p>
<p>Javaæ ‡å‡†åº“æä¾›äº†<code>ExecutorService</code>æ¥å£è¡¨ç¤ºçº¿ç¨‹æ± ï¼Œå®ƒçš„å…¸å‹ç”¨æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»ºå›ºå®šå¤§å°çš„çº¿ç¨‹æ± :</span></span><br><span class="line">ExecutorService executor = Executors.newFixedThreadPool(<span class="number">3</span>);</span><br><span class="line"><span class="comment">// æäº¤ä»»åŠ¡:</span></span><br><span class="line">executor.submit(task1);</span><br><span class="line">executor.submit(task2);</span><br><span class="line">executor.submit(task3);</span><br><span class="line">executor.submit(task4);</span><br><span class="line">executor.submit(task5);</span><br></pre></td></tr></table></figure>

<p>å› ä¸º<code>ExecutorService</code>åªæ˜¯æ¥å£ï¼ŒJavaæ ‡å‡†åº“æä¾›çš„å‡ ä¸ªå¸¸ç”¨å®ç°ç±»æœ‰ï¼š</p>
<ul>
<li><code>FixedThreadPool</code>ï¼šçº¿ç¨‹æ•°å›ºå®šçš„çº¿ç¨‹æ± ï¼›</li>
<li><code>CachedThreadPool</code>ï¼šçº¿ç¨‹æ•°æ ¹æ®ä»»åŠ¡åŠ¨æ€è°ƒæ•´çš„çº¿ç¨‹æ± ï¼›</li>
<li><code>SingleThreadExecutor</code>ï¼šä»…å•çº¿ç¨‹æ‰§è¡Œçš„çº¿ç¨‹æ± ã€‚</li>
</ul>
<p>æ‰§è¡Œé€»è¾‘ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// åˆ›å»ºä¸€ä¸ªå›ºå®šå¤§å°çš„çº¿ç¨‹æ± :</span></span><br><span class="line">        ExecutorService es = Executors.newFixedThreadPool(<span class="number">4</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">6</span>; i++) &#123;</span><br><span class="line">            es.submit(<span class="keyword">new</span> Task(<span class="string">&quot;&quot;</span> + i));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å…³é—­çº¿ç¨‹æ± :</span></span><br><span class="line">        es.shutdown();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Task</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Task</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;start task &quot;</span> + name);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;end task &quot;</span> + name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">start task 0</span></span><br><span class="line"><span class="comment">start task 1</span></span><br><span class="line"><span class="comment">start task 2</span></span><br><span class="line"><span class="comment">start task 3</span></span><br><span class="line"><span class="comment">end task 0</span></span><br><span class="line"><span class="comment">start task 4</span></span><br><span class="line"><span class="comment">end task 1</span></span><br><span class="line"><span class="comment">start task 5</span></span><br><span class="line"><span class="comment">end task 2</span></span><br><span class="line"><span class="comment">end task 3</span></span><br><span class="line"><span class="comment">end task 4</span></span><br><span class="line"><span class="comment">end task 5</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨<code>shutdown()</code>æ–¹æ³•å…³é—­çº¿ç¨‹æ± çš„æ—¶å€™ï¼Œå®ƒä¼šç­‰å¾…æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡å…ˆå®Œæˆï¼Œç„¶åå†å…³é—­ã€‚<code>shutdownNow()</code>ä¼šç«‹åˆ»åœæ­¢æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡ï¼Œ<code>awaitTermination()</code>åˆ™ä¼šç­‰å¾…æŒ‡å®šçš„æ—¶é—´è®©çº¿ç¨‹æ± å…³é—­ã€‚</p>
<p>åŠ¨æ€èŒƒå›´çš„çº¿ç¨‹æ± ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">int</span> min = <span class="number">4</span>;</span><br><span class="line"><span class="keyword">int</span> max = <span class="number">10</span>;</span><br><span class="line">ExecutorService es = <span class="keyword">new</span> ThreadPoolExecutor(min, max,</span><br><span class="line">        <span class="number">60L</span>, TimeUnit.SECONDS, <span class="keyword">new</span> SynchronousQueue&lt;Runnable&gt;());</span><br></pre></td></tr></table></figure>

<h3 id="15-2-åå¤æ‰§è¡Œçº¿ç¨‹æ± ScheduledThreadPool"><a href="#15-2-åå¤æ‰§è¡Œçº¿ç¨‹æ± ScheduledThreadPool" class="headerlink" title="15.2 åå¤æ‰§è¡Œçº¿ç¨‹æ± ScheduledThreadPool"></a>15.2 åå¤æ‰§è¡Œçº¿ç¨‹æ± ScheduledThreadPool</h3><p>åˆ›å»ºä¸€ä¸ª<code>ScheduledThreadPool</code>ä»ç„¶æ˜¯é€šè¿‡<code>Executors</code>ç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">ScheduledExecutorService ses = Executors.newScheduledThreadPool(<span class="number">4</span>);</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¯ä»¥æäº¤ä¸€æ¬¡æ€§ä»»åŠ¡ï¼Œå®ƒä¼šåœ¨æŒ‡å®šå»¶è¿Ÿååªæ‰§è¡Œä¸€æ¬¡ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 1ç§’åæ‰§è¡Œä¸€æ¬¡æ€§ä»»åŠ¡:</span></span><br><span class="line">ses.schedule(<span class="keyword">new</span> Task(<span class="string">&quot;one-time&quot;</span>), <span class="number">1</span>, TimeUnit.SECONDS);</span><br></pre></td></tr></table></figure>

<p>å¦‚æœä»»åŠ¡ä»¥å›ºå®šçš„æ¯3ç§’æ‰§è¡Œï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·å†™ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 2ç§’åå¼€å§‹æ‰§è¡Œå®šæ—¶ä»»åŠ¡ï¼Œæ¯3ç§’æ‰§è¡Œ:</span></span><br><span class="line">ses.scheduleAtFixedRate(<span class="keyword">new</span> Task(<span class="string">&quot;fixed-rate&quot;</span>), <span class="number">2</span>, <span class="number">3</span>, TimeUnit.SECONDS);</span><br></pre></td></tr></table></figure>

<p>å¦‚æœä»»åŠ¡ä»¥å›ºå®šçš„3ç§’ä¸ºé—´éš”æ‰§è¡Œï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·å†™ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 2ç§’åå¼€å§‹æ‰§è¡Œå®šæ—¶ä»»åŠ¡ï¼Œä»¥3ç§’ä¸ºé—´éš”æ‰§è¡Œ:</span></span><br><span class="line">ses.scheduleWithFixedDelay(<span class="keyword">new</span> Task(<span class="string">&quot;fixed-delay&quot;</span>), <span class="number">2</span>, <span class="number">3</span>, TimeUnit.SECONDS);</span><br></pre></td></tr></table></figure>

<p><code>FixedRate</code>æ˜¯æŒ‡ä»»åŠ¡æ€»æ˜¯ä»¥å›ºå®šæ—¶é—´é—´éš”è§¦å‘ï¼Œä¸ç®¡ä»»åŠ¡æ‰§è¡Œå¤šé•¿æ—¶é—´ï¼š</p>
<p><img src="https://raw.githubusercontent.com/ghj1998/image_repository/main/image-20210509224407824.png" alt="image-20210509224407824"></p>
<p><code>FixedDelay</code>æ˜¯æŒ‡ï¼Œä¸Šä¸€æ¬¡ä»»åŠ¡æ‰§è¡Œå®Œæ¯•åï¼Œç­‰å¾…å›ºå®šçš„æ—¶é—´é—´éš”ï¼Œå†æ‰§è¡Œä¸‹ä¸€æ¬¡ä»»åŠ¡ï¼š</p>
<p><img src="https://raw.githubusercontent.com/ghj1998/image_repository/main/image-20210509224432989.png" alt="image-20210509224432989"></p>
<h2 id="16-Future"><a href="#16-Future" class="headerlink" title="16. Future"></a>16. Future</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class Task implements Runnable &#123;</span><br><span class="line">    public String result;</span><br><span class="line"></span><br><span class="line">    public void run() &#123;</span><br><span class="line">        this.result &#x3D; longTimeCalculation(); </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>Runnable</code>æ¥å£æœ‰ä¸ªé—®é¢˜ï¼Œå®ƒçš„æ–¹æ³•æ²¡æœ‰è¿”å›å€¼ã€‚</p>
<p>Javaæ ‡å‡†åº“è¿˜æä¾›äº†ä¸€ä¸ª<code>Callable</code>æ¥å£ï¼Œå’Œ<code>Runnable</code>æ¥å£æ¯”ï¼Œå®ƒå¤šäº†ä¸€ä¸ªè¿”å›å€¼ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Task</span> <span class="keyword">implements</span> <span class="title">Callable</span>&lt;<span class="title">String</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> longTimeCalculation(); </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>Callable</code>æ¥å£æ˜¯ä¸€ä¸ªæ³›å‹æ¥å£ï¼Œå¯ä»¥è¿”å›æŒ‡å®šç±»å‹çš„ç»“æœã€‚</p>
<p><code>ExecutorService.submit()</code>æ–¹æ³•è¿”å›ä¸€ä¸ª<code>Future</code>ç±»å‹çš„å®ä¾‹ï¼Œä»£è¡¨ä¸€ä¸ªæœªæ¥èƒ½è·å–ç»“æœçš„å¯¹è±¡ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">ExecutorService executor = Executors.newFixedThreadPool(<span class="number">4</span>); </span><br><span class="line"><span class="comment">// å®šä¹‰ä»»åŠ¡:</span></span><br><span class="line">Callable&lt;String&gt; task = <span class="keyword">new</span> Task();</span><br><span class="line"><span class="comment">// æäº¤ä»»åŠ¡å¹¶è·å¾—Future:</span></span><br><span class="line">Future&lt;String&gt; future = executor.submit(task);</span><br><span class="line"><span class="comment">// ä»Futureè·å–å¼‚æ­¥æ‰§è¡Œè¿”å›çš„ç»“æœ:</span></span><br><span class="line">String result = future.get(); <span class="comment">// å¯èƒ½é˜»å¡</span></span><br></pre></td></tr></table></figure>

<p>ä¸€ä¸ª<code>Future&lt;V&gt;</code>æ¥å£è¡¨ç¤ºä¸€ä¸ªæœªæ¥å¯èƒ½ä¼šè¿”å›çš„ç»“æœï¼Œå®ƒå®šä¹‰çš„æ–¹æ³•æœ‰ï¼š</p>
<ul>
<li><code>get()</code>ï¼šè·å–ç»“æœï¼ˆå¯èƒ½ä¼šç­‰å¾…ï¼‰</li>
<li><code>get(long timeout, TimeUnit unit)</code>ï¼šè·å–ç»“æœï¼Œä½†åªç­‰å¾…æŒ‡å®šçš„æ—¶é—´ï¼›</li>
<li><code>cancel(boolean mayInterruptIfRunning)</code>ï¼šå–æ¶ˆå½“å‰ä»»åŠ¡ï¼›</li>
<li><code>isDone()</code>ï¼šåˆ¤æ–­ä»»åŠ¡æ˜¯å¦å·²å®Œæˆã€‚</li>
</ul>
<h2 id="17-CompletableFuture"><a href="#17-CompletableFuture" class="headerlink" title="17. CompletableFuture"></a>17. CompletableFuture</h2><p>Java 8å¼€å§‹å¼•å…¥äº†<code>CompletableFuture</code>ï¼Œå®ƒé’ˆå¯¹<code>Future</code>åšäº†æ”¹è¿›ï¼Œå¯ä»¥ä¼ å…¥å›è°ƒå¯¹è±¡ï¼Œå½“å¼‚æ­¥ä»»åŠ¡å®Œæˆæˆ–è€…å‘ç”Ÿå¼‚å¸¸æ—¶ï¼Œè‡ªåŠ¨è°ƒç”¨å›è°ƒå¯¹è±¡çš„å›è°ƒæ–¹æ³•ã€‚</p>
<p>ä¸¾ä¾‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// åˆ›å»ºå¼‚æ­¥æ‰§è¡Œä»»åŠ¡:</span></span><br><span class="line">        CompletableFuture&lt;Double&gt; cf = CompletableFuture.supplyAsync(Main::fetchPrice);</span><br><span class="line">        <span class="comment">// å¦‚æœæ‰§è¡ŒæˆåŠŸ:</span></span><br><span class="line">        cf.thenAccept((result) -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;price: &quot;</span> + result);</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// å¦‚æœæ‰§è¡Œå¼‚å¸¸:</span></span><br><span class="line">        cf.exceptionally((e) -&gt; &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// ä¸»çº¿ç¨‹ä¸è¦ç«‹åˆ»ç»“æŸï¼Œå¦åˆ™CompletableFutureé»˜è®¤ä½¿ç”¨çš„çº¿ç¨‹æ± ä¼šç«‹åˆ»å…³é—­:</span></span><br><span class="line">        Thread.sleep(<span class="number">200</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">static</span> Double <span class="title">fetchPrice</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">100</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (Math.random() &lt; <span class="number">0.3</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">&quot;fetch price failed!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">5</span> + Math.random() * <span class="number">20</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åˆ›å»ºä¸€ä¸ª<code>CompletableFuture</code>æ˜¯é€šè¿‡<code>CompletableFuture.supplyAsync()</code>å®ç°çš„ï¼Œå®ƒéœ€è¦ä¸€ä¸ªå®ç°äº†<code>Supplier</code>æ¥å£çš„å¯¹è±¡ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Supplier</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function">T <span class="title">get</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç”¨lambdaè¯­æ³•ç®€åŒ–äº†ä¸€ä¸‹ï¼Œç›´æ¥ä¼ å…¥<code>Main::fetchPrice</code>,<code>Main.fetchPrice()</code>é™æ€æ–¹æ³•çš„ç­¾åç¬¦åˆ<code>Supplier</code>æ¥å£çš„å®šä¹‰ã€‚</p>
<p>ç´§æ¥ç€ï¼Œ<code>CompletableFuture</code>å·²ç»è¢«æäº¤ç»™é»˜è®¤çš„çº¿ç¨‹æ± æ‰§è¡Œäº†ï¼Œæˆ‘ä»¬éœ€è¦å®šä¹‰çš„æ˜¯<code>CompletableFuture</code>å®Œæˆæ—¶å’Œå¼‚å¸¸æ—¶éœ€è¦å›è°ƒçš„å®ä¾‹ã€‚å®Œæˆæ—¶ï¼Œ<code>CompletableFuture</code>ä¼šè°ƒç”¨<code>Consumer</code>å¯¹è±¡ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Consumer</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">accept</span><span class="params">(T t)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¼‚å¸¸æ—¶ï¼Œ<code>CompletableFuture</code>ä¼šè°ƒç”¨<code>Function</code>å¯¹è±¡ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Function</span>&lt;<span class="title">T</span>, <span class="title">R</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function">R <span class="title">apply</span><span class="params">(T t)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>CompletableFuture</code>çš„ä¼˜ç‚¹æ˜¯ï¼š</p>
<ul>
<li>å¼‚æ­¥ä»»åŠ¡ç»“æŸæ—¶ï¼Œä¼šè‡ªåŠ¨å›è°ƒæŸä¸ªå¯¹è±¡çš„æ–¹æ³•ï¼›</li>
<li>å¼‚æ­¥ä»»åŠ¡å‡ºé”™æ—¶ï¼Œä¼šè‡ªåŠ¨å›è°ƒæŸä¸ªå¯¹è±¡çš„æ–¹æ³•ï¼›</li>
<li>ä¸»çº¿ç¨‹è®¾ç½®å¥½å›è°ƒåï¼Œä¸å†å…³å¿ƒå¼‚æ­¥ä»»åŠ¡çš„æ‰§è¡Œã€‚</li>
</ul>
<p>ç›´æ¥çœ‹ä¾‹å­ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// ç¬¬ä¸€ä¸ªä»»åŠ¡:</span></span><br><span class="line">        CompletableFuture&lt;String&gt; cfQuery = CompletableFuture.supplyAsync(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">return</span> queryCode(<span class="string">&quot;ä¸­å›½çŸ³æ²¹&quot;</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// cfQueryæˆåŠŸåç»§ç»­æ‰§è¡Œä¸‹ä¸€ä¸ªä»»åŠ¡:</span></span><br><span class="line">        CompletableFuture&lt;Double&gt; cfFetch = cfQuery.thenApplyAsync((code) -&gt; &#123;</span><br><span class="line">            <span class="keyword">return</span> fetchPrice(code);</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// cfFetchæˆåŠŸåæ‰“å°ç»“æœ:</span></span><br><span class="line">        cfFetch.thenAccept((result) -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;price: &quot;</span> + result);</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// ä¸»çº¿ç¨‹ä¸è¦ç«‹åˆ»ç»“æŸï¼Œå¦åˆ™CompletableFutureé»˜è®¤ä½¿ç”¨çš„çº¿ç¨‹æ± ä¼šç«‹åˆ»å…³é—­:</span></span><br><span class="line">        Thread.sleep(<span class="number">2000</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">static</span> String <span class="title">queryCode</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">100</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;601857&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">static</span> Double <span class="title">fetchPrice</span><span class="params">(String code)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">100</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">5</span> + Math.random() * <span class="number">20</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">price: 18.552424162240882</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p>é™¤äº†ä¸²è¡Œæ‰§è¡Œå¤–ï¼Œå¤šä¸ª<code>CompletableFuture</code>è¿˜å¯ä»¥å¹¶è¡Œæ‰§è¡Œã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬è€ƒè™‘è¿™æ ·çš„åœºæ™¯ï¼š</p>
<p>åŒæ—¶ä»æ–°æµªå’Œç½‘æ˜“æŸ¥è¯¢è¯åˆ¸ä»£ç ï¼Œåªè¦ä»»æ„ä¸€ä¸ªè¿”å›ç»“æœï¼Œå°±è¿›è¡Œä¸‹ä¸€æ­¥æŸ¥è¯¢ä»·æ ¼ï¼ŒæŸ¥è¯¢ä»·æ ¼ä¹ŸåŒæ—¶ä»æ–°æµªå’Œç½‘æ˜“æŸ¥è¯¢ï¼Œåªè¦ä»»æ„ä¸€ä¸ªè¿”å›ç»“æœï¼Œå°±å®Œæˆæ“ä½œï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// ä¸¤ä¸ªCompletableFutureæ‰§è¡Œå¼‚æ­¥æŸ¥è¯¢:</span></span><br><span class="line">        CompletableFuture&lt;String&gt; cfQueryFromSina = CompletableFuture.supplyAsync(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">return</span> queryCode(<span class="string">&quot;ä¸­å›½çŸ³æ²¹&quot;</span>, <span class="string">&quot;https://finance.sina.com.cn/code/&quot;</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">        CompletableFuture&lt;String&gt; cfQueryFrom163 = CompletableFuture.supplyAsync(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">return</span> queryCode(<span class="string">&quot;ä¸­å›½çŸ³æ²¹&quot;</span>, <span class="string">&quot;https://money.163.com/code/&quot;</span>);</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ç”¨anyOfåˆå¹¶ä¸ºä¸€ä¸ªæ–°çš„CompletableFuture:</span></span><br><span class="line">        CompletableFuture&lt;Object&gt; cfQuery = CompletableFuture.anyOf(cfQueryFromSina, cfQueryFrom163);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä¸¤ä¸ªCompletableFutureæ‰§è¡Œå¼‚æ­¥æŸ¥è¯¢:</span></span><br><span class="line">        CompletableFuture&lt;Double&gt; cfFetchFromSina = cfQuery.thenApplyAsync((code) -&gt; &#123;</span><br><span class="line">            <span class="keyword">return</span> fetchPrice((String) code, <span class="string">&quot;https://finance.sina.com.cn/price/&quot;</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">        CompletableFuture&lt;Double&gt; cfFetchFrom163 = cfQuery.thenApplyAsync((code) -&gt; &#123;</span><br><span class="line">            <span class="keyword">return</span> fetchPrice((String) code, <span class="string">&quot;https://money.163.com/price/&quot;</span>);</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ç”¨anyOfåˆå¹¶ä¸ºä¸€ä¸ªæ–°çš„CompletableFuture:</span></span><br><span class="line">        CompletableFuture&lt;Object&gt; cfFetch = CompletableFuture.anyOf(cfFetchFromSina, cfFetchFrom163);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æœ€ç»ˆç»“æœ:</span></span><br><span class="line">        cfFetch.thenAccept((result) -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;price: &quot;</span> + result);</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// ä¸»çº¿ç¨‹ä¸è¦ç«‹åˆ»ç»“æŸï¼Œå¦åˆ™CompletableFutureé»˜è®¤ä½¿ç”¨çš„çº¿ç¨‹æ± ä¼šç«‹åˆ»å…³é—­:</span></span><br><span class="line">        Thread.sleep(<span class="number">200</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">static</span> String <span class="title">queryCode</span><span class="params">(String name, String url)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;query code from &quot;</span> + url + <span class="string">&quot;...&quot;</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep((<span class="keyword">long</span>) (Math.random() * <span class="number">100</span>));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;601857&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">static</span> Double <span class="title">fetchPrice</span><span class="params">(String code, String url)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;query price from &quot;</span> + url + <span class="string">&quot;...&quot;</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep((<span class="keyword">long</span>) (Math.random() * <span class="number">100</span>));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">5</span> + Math.random() * <span class="number">20</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">query code from https://finance.sina.com.cn/code/...</span></span><br><span class="line"><span class="comment">query code from https://money.163.com/code/...</span></span><br><span class="line"><span class="comment">query price from https://finance.sina.com.cn/price/...</span></span><br><span class="line"><span class="comment">query price from https://money.163.com/price/...</span></span><br><span class="line"><span class="comment">price: 16.397253746873602</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/ghj1998/image_repository/main/image-20210509230825458.png" alt="image-20210509230825458"></p>
<p>é™¤äº†<code>anyOf()</code>å¯ä»¥å®ç°â€œä»»æ„ä¸ª<code>CompletableFuture</code>åªè¦ä¸€ä¸ªæˆåŠŸâ€ï¼Œ<code>allOf()</code>å¯ä»¥å®ç°â€œæ‰€æœ‰<code>CompletableFuture</code>éƒ½å¿…é¡»æˆåŠŸâ€ï¼Œè¿™äº›ç»„åˆæ“ä½œå¯ä»¥å®ç°éå¸¸å¤æ‚çš„å¼‚æ­¥æµç¨‹æ§åˆ¶ã€‚</p>
<p>æœ€åæˆ‘ä»¬æ³¨æ„<code>CompletableFuture</code>çš„å‘½åè§„åˆ™ï¼š</p>
<ul>
<li><code>xxx()</code>ï¼šè¡¨ç¤ºè¯¥æ–¹æ³•å°†ç»§ç»­åœ¨å·²æœ‰çš„çº¿ç¨‹ä¸­æ‰§è¡Œï¼›</li>
<li><code>xxxAsync()</code>ï¼šè¡¨ç¤ºå°†å¼‚æ­¥åœ¨çº¿ç¨‹æ± ä¸­æ‰§è¡Œã€‚</li>
</ul>
<h2 id="18-ForkJoin"><a href="#18-ForkJoin" class="headerlink" title="18. ForkJoin"></a>18. ForkJoin</h2><p>Fork/Joinä»»åŠ¡çš„åŸç†ï¼šåˆ¤æ–­ä¸€ä¸ªä»»åŠ¡æ˜¯å¦è¶³å¤Ÿå°ï¼Œå¦‚æœæ˜¯ï¼Œç›´æ¥è®¡ç®—ï¼Œå¦åˆ™ï¼Œå°±åˆ†æ‹†æˆå‡ ä¸ªå°ä»»åŠ¡åˆ†åˆ«è®¡ç®—ã€‚è¿™ä¸ªè¿‡ç¨‹å¯ä»¥åå¤â€œè£‚å˜â€æˆä¸€ç³»åˆ—å°ä»»åŠ¡ã€‚</p>
<p>ä½¿ç”¨Fork/Joinå¯¹å¤§æ•°æ®è¿›è¡Œå¹¶è¡Œæ±‚å’Œï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// åˆ›å»º2000ä¸ªéšæœºæ•°ç»„æˆçš„æ•°ç»„:</span></span><br><span class="line">        <span class="keyword">long</span>[] array = <span class="keyword">new</span> <span class="keyword">long</span>[<span class="number">2000</span>];</span><br><span class="line">        <span class="keyword">long</span> expectedSum = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; array.length; i++) &#123;</span><br><span class="line">            array[i] = random();</span><br><span class="line">            expectedSum += array[i];</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;Expected sum: &quot;</span> + expectedSum);</span><br><span class="line">        <span class="comment">// fork/join:</span></span><br><span class="line">        ForkJoinTask&lt;Long&gt; task = <span class="keyword">new</span> SumTask(array, <span class="number">0</span>, array.length);</span><br><span class="line">        <span class="keyword">long</span> startTime = System.currentTimeMillis();</span><br><span class="line">        Long result = ForkJoinPool.commonPool().invoke(task);</span><br><span class="line">        <span class="keyword">long</span> endTime = System.currentTimeMillis();</span><br><span class="line">        System.out.println(<span class="string">&quot;Fork/join sum: &quot;</span> + result + <span class="string">&quot; in &quot;</span> + (endTime - startTime) + <span class="string">&quot; ms.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> Random random = <span class="keyword">new</span> Random(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">long</span> <span class="title">random</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> random.nextInt(<span class="number">10000</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SumTask</span> <span class="keyword">extends</span> <span class="title">RecursiveTask</span>&lt;<span class="title">Long</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> THRESHOLD = <span class="number">500</span>;</span><br><span class="line">    <span class="keyword">long</span>[] array;</span><br><span class="line">    <span class="keyword">int</span> start;</span><br><span class="line">    <span class="keyword">int</span> end;</span><br><span class="line"></span><br><span class="line">    SumTask(<span class="keyword">long</span>[] array, <span class="keyword">int</span> start, <span class="keyword">int</span> end) &#123;</span><br><span class="line">        <span class="keyword">this</span>.array = array;</span><br><span class="line">        <span class="keyword">this</span>.start = start;</span><br><span class="line">        <span class="keyword">this</span>.end = end;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> Long <span class="title">compute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (end - start &lt;= THRESHOLD) &#123;</span><br><span class="line">            <span class="comment">// å¦‚æœä»»åŠ¡è¶³å¤Ÿå°,ç›´æ¥è®¡ç®—:</span></span><br><span class="line">            <span class="keyword">long</span> sum = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = start; i &lt; end; i++) &#123;</span><br><span class="line">                sum += <span class="keyword">this</span>.array[i];</span><br><span class="line">                <span class="comment">// æ•…æ„æ”¾æ…¢è®¡ç®—é€Ÿåº¦:</span></span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">1</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> sum;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// ä»»åŠ¡å¤ªå¤§,ä¸€åˆ†ä¸ºäºŒ:</span></span><br><span class="line">        <span class="keyword">int</span> middle = (end + start) / <span class="number">2</span>;</span><br><span class="line">        System.out.println(String.format(<span class="string">&quot;split %d~%d ==&gt; %d~%d, %d~%d&quot;</span>, start, end, start, middle, middle, end));</span><br><span class="line">        SumTask subtask1 = <span class="keyword">new</span> SumTask(<span class="keyword">this</span>.array, start, middle);</span><br><span class="line">        SumTask subtask2 = <span class="keyword">new</span> SumTask(<span class="keyword">this</span>.array, middle, end);</span><br><span class="line">        invokeAll(subtask1, subtask2);</span><br><span class="line">        Long subresult1 = subtask1.join();</span><br><span class="line">        Long subresult2 = subtask2.join();</span><br><span class="line">        Long result = subresult1 + subresult2;</span><br><span class="line">        System.out.println(<span class="string">&quot;result = &quot;</span> + subresult1 + <span class="string">&quot; + &quot;</span> + subresult2 + <span class="string">&quot; ==&gt; &quot;</span> + result);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Expected sum: 9788366</span></span><br><span class="line"><span class="comment">split 0~2000 ==&gt; 0~1000, 1000~2000</span></span><br><span class="line"><span class="comment">split 1000~2000 ==&gt; 1000~1500, 1500~2000</span></span><br><span class="line"><span class="comment">split 0~1000 ==&gt; 0~500, 500~1000</span></span><br><span class="line"><span class="comment">result = 2485485 + 2491717 ==&gt; 4977202</span></span><br><span class="line"><span class="comment">result = 2391591 + 2419573 ==&gt; 4811164</span></span><br><span class="line"><span class="comment">result = 4811164 + 4977202 ==&gt; 9788366</span></span><br><span class="line"><span class="comment">Fork/join sum: 9788366 in 1084 ms.</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p>å…³é”®å¼åˆ†è£‚ï¼Œä»£ç ç»“æ„å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SumTask</span> <span class="keyword">extends</span> <span class="title">RecursiveTask</span>&lt;<span class="title">Long</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">protected</span> Long <span class="title">compute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// â€œåˆ†è£‚â€å­ä»»åŠ¡:</span></span><br><span class="line">        SumTask subtask1 = <span class="keyword">new</span> SumTask(...);</span><br><span class="line">        SumTask subtask2 = <span class="keyword">new</span> SumTask(...);</span><br><span class="line">        <span class="comment">// invokeAllä¼šå¹¶è¡Œè¿è¡Œä¸¤ä¸ªå­ä»»åŠ¡:</span></span><br><span class="line">        invokeAll(subtask1, subtask2);</span><br><span class="line">        <span class="comment">// è·å¾—å­ä»»åŠ¡çš„ç»“æœ:</span></span><br><span class="line">        Long subresult1 = subtask1.join();</span><br><span class="line">        Long subresult2 = subtask2.join();</span><br><span class="line">        <span class="comment">// æ±‡æ€»ç»“æœ:</span></span><br><span class="line">        <span class="keyword">return</span> subresult1 + subresult2;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Javaæ ‡å‡†åº“æä¾›çš„<code>java.util.Arrays.parallelSort(array)</code>å¯ä»¥è¿›è¡Œå¹¶è¡Œæ’åºï¼Œå®ƒçš„åŸç†å°±æ˜¯å†…éƒ¨é€šè¿‡Fork/Joinå¯¹å¤§æ•°ç»„åˆ†æ‹†è¿›è¡Œå¹¶è¡Œæ’åºï¼Œåœ¨å¤šæ ¸CPUä¸Šå°±å¯ä»¥å¤§å¤§æé«˜æ’åºçš„é€Ÿåº¦ã€‚</p>
<h2 id="19-ThreadLocal"><a href="#19-ThreadLocal" class="headerlink" title="19. ThreadLocal"></a>19. ThreadLocal</h2><p><code>Thread</code>å¯¹è±¡ä»£è¡¨ä¸€ä¸ªçº¿ç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä»£ç ä¸­è°ƒç”¨<code>Thread.currentThread()</code>è·å–å½“å‰çº¿ç¨‹ã€‚ä¾‹å¦‚ï¼Œæ‰“å°æ—¥å¿—æ—¶ï¼Œå¯ä»¥åŒæ—¶æ‰“å°å‡ºå½“å‰çº¿ç¨‹çš„åå­—ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        log(<span class="string">&quot;start main...&quot;</span>);</span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            log(<span class="string">&quot;run task...&quot;</span>);</span><br><span class="line">        &#125;).start();</span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            log(<span class="string">&quot;print...&quot;</span>);</span><br><span class="line">        &#125;).start();</span><br><span class="line">        log(<span class="string">&quot;end main.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">log</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot;: &quot;</span> + s);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">main: start main...</span></span><br><span class="line"><span class="comment">Thread-0: run task...</span></span><br><span class="line"><span class="comment">main: end main.</span></span><br><span class="line"><span class="comment">Thread-1: print...</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p>å¯¹äºå¤šä»»åŠ¡ï¼ŒJavaæ ‡å‡†åº“æä¾›çš„çº¿ç¨‹æ± å¯ä»¥æ–¹ä¾¿åœ°æ‰§è¡Œè¿™äº›ä»»åŠ¡ï¼ŒåŒæ—¶å¤ç”¨çº¿ç¨‹ã€‚Webåº”ç”¨ç¨‹åºå°±æ˜¯å…¸å‹çš„å¤šä»»åŠ¡åº”ç”¨ï¼Œæ¯ä¸ªç”¨æˆ·è¯·æ±‚é¡µé¢æ—¶ï¼Œæˆ‘ä»¬éƒ½ä¼šåˆ›å»ºä¸€ä¸ªä»»åŠ¡ï¼Œç±»ä¼¼ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">process</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">    checkPermission();</span><br><span class="line">    doWork();</span><br><span class="line">    saveStatus();</span><br><span class="line">    sendResponse();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç„¶åï¼Œé€šè¿‡çº¿ç¨‹æ± å»æ‰§è¡Œè¿™äº›ä»»åŠ¡ã€‚</p>
<p>Javaæ ‡å‡†åº“æä¾›äº†ä¸€ä¸ªç‰¹æ®Šçš„<code>ThreadLocal</code>ï¼Œå®ƒå¯ä»¥åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­ä¼ é€’åŒä¸€ä¸ªå¯¹è±¡ã€‚</p>
<p><code>ThreadLocal</code>å®ä¾‹é€šå¸¸æ€»æ˜¯ä»¥é™æ€å­—æ®µåˆå§‹åŒ–å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> ThreadLocal&lt;User&gt; threadLocalUser = <span class="keyword">new</span> ThreadLocal&lt;&gt;();</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">processUser</span><span class="params">(user)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        threadLocalUser.set(user);</span><br><span class="line">        step1();</span><br><span class="line">        step2();</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        threadLocalUser.remove();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡è®¾ç½®ä¸€ä¸ª<code>User</code>å®ä¾‹å…³è”åˆ°<code>ThreadLocal</code>ä¸­ï¼Œåœ¨ç§»é™¤ä¹‹å‰ï¼Œæ‰€æœ‰æ–¹æ³•éƒ½å¯ä»¥éšæ—¶è·å–åˆ°è¯¥<code>User</code>å®ä¾‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">step1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    User u = threadLocalUser.get();</span><br><span class="line">    log();</span><br><span class="line">    printUser();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">log</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    User u = threadLocalUser.get();</span><br><span class="line">    println(u.name);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">step2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    User u = threadLocalUser.get();</span><br><span class="line">    checkUser(u.id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥æŠŠ<code>ThreadLocal</code>çœ‹æˆä¸€ä¸ªå…¨å±€<code>Map&lt;Thread, Object&gt;</code>ï¼šæ¯ä¸ªçº¿ç¨‹è·å–<code>ThreadLocal</code>å˜é‡æ—¶ï¼Œæ€»æ˜¯ä½¿ç”¨<code>Thread</code>è‡ªèº«ä½œä¸ºkeyï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Object threadLocalValue = threadLocalMap.get(Thread.currentThread());</span><br></pre></td></tr></table></figure>

<p>å› æ­¤ï¼Œ<code>ThreadLocal</code>ç›¸å½“äºç»™æ¯ä¸ªçº¿ç¨‹éƒ½å¼€è¾Ÿäº†ä¸€ä¸ªç‹¬ç«‹çš„å­˜å‚¨ç©ºé—´ï¼Œå„ä¸ªçº¿ç¨‹çš„<code>ThreadLocal</code>å…³è”çš„å®ä¾‹äº’ä¸å¹²æ‰°ã€‚</p>
<p>æœ€åï¼Œç‰¹åˆ«æ³¨æ„<code>ThreadLocal</code>ä¸€å®šè¦åœ¨<code>finally</code>ä¸­æ¸…é™¤ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    threadLocalUser.set(user);</span><br><span class="line">    ...</span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    threadLocalUser.remove();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸ºäº†ä¿è¯èƒ½é‡Šæ”¾<code>ThreadLocal</code>å…³è”çš„å®ä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡<code>AutoCloseable</code>æ¥å£é…åˆ<code>try (resource) &#123;...&#125;</code>ç»“æ„ï¼Œè®©ç¼–è¯‘å™¨è‡ªåŠ¨ä¸ºæˆ‘ä»¬å…³é—­ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªä¿å­˜äº†å½“å‰ç”¨æˆ·åçš„<code>ThreadLocal</code>å¯ä»¥å°è£…ä¸ºä¸€ä¸ª<code>UserContext</code>å¯¹è±¡ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserContext</span> <span class="keyword">implements</span> <span class="title">AutoCloseable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> ThreadLocal&lt;String&gt; ctx = <span class="keyword">new</span> ThreadLocal&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">UserContext</span><span class="params">(String user)</span> </span>&#123;</span><br><span class="line">        ctx.set(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">currentUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ctx.get();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ctx.remove();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨çš„æ—¶å€™ï¼Œæˆ‘ä»¬å€ŸåŠ©<code>try (resource) &#123;...&#125;</code>ç»“æ„ï¼Œå¯ä»¥è¿™ä¹ˆå†™ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span> (<span class="keyword">var</span> ctx = <span class="keyword">new</span> UserContext(<span class="string">&quot;Bob&quot;</span>)) &#123;</span><br><span class="line">    <span class="comment">// å¯ä»»æ„è°ƒç”¨UserContext.currentUser():</span></span><br><span class="line">    String currentUser = UserContext.currentUser();</span><br><span class="line">&#125; <span class="comment">// åœ¨æ­¤è‡ªåŠ¨è°ƒç”¨UserContext.close()æ–¹æ³•é‡Šæ”¾ThreadLocalå…³è”å¯¹è±¡</span></span><br></pre></td></tr></table></figure>

<p>è¿™æ ·å°±åœ¨<code>UserContext</code>ä¸­å®Œå…¨å°è£…äº†<code>ThreadLocal</code>ï¼Œå¤–éƒ¨ä»£ç åœ¨<code>try (resource) &#123;...&#125;</code>å†…éƒ¨å¯ä»¥éšæ—¶è°ƒç”¨<code>UserContext.currentUser()</code>è·å–å½“å‰çº¿ç¨‹ç»‘å®šçš„ç”¨æˆ·åã€‚</p>
]]></content>
      <tags>
        <tag>JAVA</tag>
        <tag>å¤šçº¿ç¨‹</tag>
      </tags>
  </entry>
  <entry>
    <title>ç½‘ç»œç¼–ç¨‹</title>
    <url>/2021/05/08/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/</url>
    <content><![CDATA[<h1 id="ç½‘ç»œç¼–ç¨‹"><a href="#ç½‘ç»œç¼–ç¨‹" class="headerlink" title="ç½‘ç»œç¼–ç¨‹"></a>ç½‘ç»œç¼–ç¨‹</h1><h2 id="1-ç½‘ç»œåŸºç¡€"><a href="#1-ç½‘ç»œåŸºç¡€" class="headerlink" title="1. ç½‘ç»œåŸºç¡€"></a>1. ç½‘ç»œåŸºç¡€</h2><p>TCP/IPåè®®æ³›æŒ‡äº’è”ç½‘åè®®ï¼Œåªæœ‰ä½¿ç”¨TCP/IPåè®®çš„è®¡ç®—æœºæ‰èƒ½å¤Ÿè”å…¥äº’è”ç½‘ã€‚</p>
<h3 id="1-1-IPåœ°å€"><a href="#1-1-IPåœ°å€" class="headerlink" title="1.1 IPåœ°å€"></a>1.1 IPåœ°å€</h3><p>åœ¨äº’è”ç½‘ä¸­ï¼Œä¸€ä¸ªIPåœ°å€ç”¨äºå”¯ä¸€æ ‡è¯†ä¸€ä¸ªç½‘ç»œæ¥å£ï¼ˆNetwork Interfaceï¼‰ã€‚ä¸€å°è”å…¥äº’è”ç½‘çš„è®¡ç®—æœºè‚¯å®šæœ‰ä¸€ä¸ªIPåœ°å€ï¼Œä½†ä¹Ÿå¯èƒ½æœ‰å¤šä¸ªIPåœ°å€ã€‚</p>
<p>IPåœ°å€åˆ†ä¸ºIPv4å’ŒIPv6ä¸¤ç§ã€‚IPv4é‡‡ç”¨32ä½åœ°å€ï¼Œç±»ä¼¼<code>101.202.99.12</code>ï¼Œè€ŒIPv6é‡‡ç”¨128ä½åœ°å€ï¼Œç±»ä¼¼<code>2001:0DA8:100A:0000:0000:1020:F2F3:1428</code></p>
<p>IPåœ°å€åˆåˆ†ä¸ºå…¬ç½‘IPåœ°å€å’Œå†…ç½‘IPåœ°å€ã€‚å…¬ç½‘IPåœ°å€å¯ä»¥ç›´æ¥è¢«è®¿é—®ï¼Œå†…ç½‘IPåœ°å€åªèƒ½åœ¨å†…ç½‘è®¿é—®ã€‚å†…ç½‘IPåœ°å€ç±»ä¼¼äºï¼š</p>
<ul>
<li>192.168.x.x</li>
<li>10.x.x.x</li>
</ul>
<p>æœ‰ä¸€ä¸ªç‰¹æ®Šçš„IPåœ°å€ï¼Œç§°ä¹‹ä¸ºæœ¬æœºåœ°å€ï¼Œå®ƒæ€»æ˜¯<code>127.0.0.1</code>ã€‚</p>
<p>å¦‚æœä¸€å°è®¡ç®—æœºåªæœ‰ä¸€ä¸ªç½‘å¡ï¼Œå¹¶ä¸”æ¥å…¥äº†ç½‘ç»œï¼Œé‚£ä¹ˆï¼Œå®ƒæœ‰ä¸€ä¸ªæœ¬æœºåœ°å€<code>127.0.0.1</code>ï¼Œè¿˜æœ‰ä¸€ä¸ªIPåœ°å€ï¼Œä¾‹å¦‚<code>101.202.99.12</code>ï¼Œå¯ä»¥é€šè¿‡è¿™ä¸ªIPåœ°å€æ¥å…¥ç½‘ç»œã€‚</p>
<p>å¦‚æœä¸€å°è®¡ç®—æœºæœ‰ä¸¤å—ç½‘å¡ï¼Œé‚£ä¹ˆé™¤äº†æœ¬æœºåœ°å€ï¼Œå®ƒå¯ä»¥æœ‰ä¸¤ä¸ªIPåœ°å€ï¼Œå¯ä»¥åˆ†åˆ«æ¥å…¥ä¸¤ä¸ªç½‘ç»œã€‚é€šå¸¸è¿æ¥ä¸¤ä¸ªç½‘ç»œçš„è®¾å¤‡æ˜¯è·¯ç”±å™¨æˆ–è€…äº¤æ¢æœºï¼Œå®ƒè‡³å°‘æœ‰ä¸¤ä¸ªIPåœ°å€ï¼Œåˆ†åˆ«æ¥å…¥ä¸åŒçš„ç½‘ç»œï¼Œè®©ç½‘ç»œä¹‹é—´è¿æ¥èµ·æ¥ã€‚</p>
<p>å¦‚æœä¸¤å°è®¡ç®—æœºä½äºåŒä¸€ä¸ªç½‘ç»œï¼Œé‚£ä¹ˆä»–ä»¬ä¹‹é—´å¯ä»¥ç›´æ¥é€šä¿¡ï¼Œå› ä¸ºä»–ä»¬çš„IPåœ°å€å‰æ®µæ˜¯ç›¸åŒçš„ï¼Œä¹Ÿå°±æ˜¯ç½‘ç»œå·æ˜¯ç›¸åŒçš„ã€‚ç½‘ç»œå·æ˜¯IPåœ°å€é€šè¿‡å­ç½‘æ©ç è¿‡æ»¤åå¾—åˆ°çš„ã€‚ä¾‹å¦‚ï¼š</p>
<p>æŸå°è®¡ç®—æœºçš„IPæ˜¯<code>101.202.99.2</code>ï¼Œå­ç½‘æ©ç æ˜¯<code>255.255.255.0</code>ï¼Œé‚£ä¹ˆè®¡ç®—è¯¥è®¡ç®—æœºçš„ç½‘ç»œå·æ˜¯ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">IP &#x3D; 101.202.99.2</span><br><span class="line">Mask &#x3D; 255.255.255.0</span><br><span class="line">Network &#x3D; IP &amp; Mask &#x3D; 101.202.99.0</span><br></pre></td></tr></table></figure>

<p>æ¯å°è®¡ç®—æœºéƒ½éœ€è¦æ­£ç¡®é…ç½®IPåœ°å€å’Œå­ç½‘æ©ç ï¼Œæ ¹æ®è¿™ä¸¤ä¸ªå°±å¯ä»¥è®¡ç®—ç½‘ç»œå·ï¼Œå¦‚æœä¸¤å°è®¡ç®—æœºè®¡ç®—å‡ºçš„ç½‘ç»œå·ç›¸åŒï¼Œè¯´æ˜ä¸¤å°è®¡ç®—æœºåœ¨åŒä¸€ä¸ªç½‘ç»œï¼Œå¯ä»¥ç›´æ¥é€šä¿¡ã€‚</p>
<p>å¦‚æœä¸¤å°è®¡ç®—æœºè®¡ç®—å‡ºçš„ç½‘ç»œå·ä¸åŒï¼Œé‚£ä¹ˆä¸¤å°è®¡ç®—æœºä¸åœ¨åŒä¸€ä¸ªç½‘ç»œï¼Œä¸èƒ½ç›´æ¥é€šä¿¡ï¼Œå®ƒä»¬ä¹‹é—´å¿…é¡»é€šè¿‡è·¯ç”±å™¨æˆ–è€…äº¤æ¢æœºè¿™æ ·çš„ç½‘ç»œè®¾å¤‡é—´æ¥é€šä¿¡ï¼Œæˆ‘ä»¬æŠŠè¿™ç§è®¾å¤‡ç§°ä¸ºç½‘å…³ã€‚</p>
<p>ç½‘å…³çš„ä½œç”¨å°±æ˜¯è¿æ¥å¤šä¸ªç½‘ç»œï¼Œè´Ÿè´£æŠŠæ¥è‡ªä¸€ä¸ªç½‘ç»œçš„æ•°æ®åŒ…å‘åˆ°å¦ä¸€ä¸ªç½‘ç»œï¼Œè¿™ä¸ªè¿‡ç¨‹å«è·¯ç”±ã€‚</p>
<p>ä¸€å°è®¡ç®—æœºçš„ä¸€ä¸ªç½‘å¡ä¼šæœ‰3ä¸ªå…³é”®é…ç½®ï¼š</p>
<p><img src="https://www.liaoxuefeng.com/files/attachments/1318110181195841/l" alt="network"></p>
<h3 id="1-2-åŸŸå"><a href="#1-2-åŸŸå" class="headerlink" title="1.2. åŸŸå"></a>1.2. åŸŸå</h3><p>ç›´æ¥è®°å¿†IPåœ°å€éå¸¸å›°éš¾ï¼Œæ‰€ä»¥æˆ‘ä»¬é€šå¸¸ä½¿ç”¨åŸŸåè®¿é—®æŸä¸ªç‰¹å®šçš„æœåŠ¡ã€‚åŸŸåè§£ææœåŠ¡å™¨DNSè´Ÿè´£æŠŠåŸŸåç¿»è¯‘æˆå¯¹åº”çš„IPï¼Œå®¢æˆ·ç«¯å†æ ¹æ®IPåœ°å€è®¿é—®æœåŠ¡å™¨ã€‚</p>
<p>ç”¨<code>nslookup</code>å¯ä»¥æŸ¥çœ‹åŸŸåå¯¹åº”çš„IPåœ°å€ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ nslookup www.liaoxuefeng.com</span><br><span class="line">Server:  xxx.xxx.xxx.xxx</span><br><span class="line">Address: xxx.xxx.xxx.xxx#53</span><br><span class="line"></span><br><span class="line">Non-authoritative answer:</span><br><span class="line">Name:    www.liaoxuefeng.com</span><br><span class="line">Address: 47.98.33.223</span><br></pre></td></tr></table></figure>

<p>æœ‰ä¸€ä¸ªç‰¹æ®Šçš„æœ¬æœºåŸŸå<code>localhost</code>ï¼Œå®ƒå¯¹åº”çš„IPåœ°å€æ€»æ˜¯æœ¬æœºåœ°å€<code>127.0.0.1</code>ã€‚</p>
<h3 id="1-3-ç½‘ç»œæ¨¡å‹"><a href="#1-3-ç½‘ç»œæ¨¡å‹" class="headerlink" title="1.3 ç½‘ç»œæ¨¡å‹"></a>1.3 ç½‘ç»œæ¨¡å‹</h3><p><strong>OSIå‚è€ƒæ¨¡å‹</strong></p>
<ul>
<li>åº”ç”¨å±‚ï¼Œæä¾›åº”ç”¨ç¨‹åºä¹‹é—´çš„é€šä¿¡ï¼›</li>
<li>è¡¨ç¤ºå±‚ï¼šå¤„ç†æ•°æ®æ ¼å¼ï¼ŒåŠ è§£å¯†ç­‰ç­‰ï¼›</li>
<li>ä¼šè¯å±‚ï¼šè´Ÿè´£å»ºç«‹å’Œç»´æŠ¤ä¼šè¯ï¼›</li>
<li>ä¼ è¾“å±‚ï¼šè´Ÿè´£æä¾›ç«¯åˆ°ç«¯çš„å¯é ä¼ è¾“ï¼›</li>
<li>ç½‘ç»œå±‚ï¼šè´Ÿè´£æ ¹æ®ç›®æ ‡åœ°å€é€‰æ‹©è·¯ç”±æ¥ä¼ è¾“æ•°æ®ï¼›</li>
<li>é“¾è·¯å±‚å’Œç‰©ç†å±‚è´Ÿè´£æŠŠæ•°æ®è¿›è¡Œåˆ†ç‰‡å¹¶ä¸”çœŸæ­£é€šè¿‡ç‰©ç†ç½‘ç»œä¼ è¾“ï¼Œä¾‹å¦‚ï¼Œæ— çº¿ç½‘ã€å…‰çº¤ç­‰ã€‚</li>
</ul>
<p>äº’è”ç½‘å®é™…ä½¿ç”¨çš„TCP/IPæ¨¡å‹å¹¶ä¸æ˜¯å¯¹åº”åˆ°OSIçš„7å±‚æ¨¡å‹ï¼Œè€Œæ˜¯å¤§è‡´å¯¹åº”OSIçš„5å±‚æ¨¡å‹ï¼š</p>
<table>
<thead>
<tr>
<th align="left">OSI</th>
<th align="left">TCP/IP</th>
</tr>
</thead>
<tbody><tr>
<td align="left">åº”ç”¨å±‚</td>
<td align="left">åº”ç”¨å±‚</td>
</tr>
<tr>
<td align="left">è¡¨ç¤ºå±‚</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">ä¼šè¯å±‚</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">ä¼ è¾“å±‚</td>
<td align="left">ä¼ è¾“å±‚</td>
</tr>
<tr>
<td align="left">ç½‘ç»œå±‚</td>
<td align="left">IPå±‚</td>
</tr>
<tr>
<td align="left">é“¾è·¯å±‚</td>
<td align="left">ç½‘ç»œæ¥å£å±‚</td>
</tr>
<tr>
<td align="left">ç‰©ç†å±‚</td>
<td align="left"></td>
</tr>
</tbody></table>
<h3 id="1-4-å¸¸ç”¨åè®®"><a href="#1-4-å¸¸ç”¨åè®®" class="headerlink" title="1.4 å¸¸ç”¨åè®®"></a>1.4 å¸¸ç”¨åè®®</h3><p>IPåè®®æ˜¯ä¸€ä¸ªåˆ†ç»„äº¤æ¢ï¼Œå®ƒä¸ä¿è¯å¯é ä¼ è¾“ã€‚è€ŒTCPåè®®æ˜¯ä¼ è¾“æ§åˆ¶åè®®ï¼Œå®ƒæ˜¯é¢å‘è¿æ¥çš„åè®®ï¼Œæ”¯æŒå¯é ä¼ è¾“å’ŒåŒå‘é€šä¿¡ã€‚TCPåè®®æ˜¯å»ºç«‹åœ¨IPåè®®ä¹‹ä¸Šçš„ï¼Œç®€å•åœ°è¯´ï¼ŒIPåè®®åªè´Ÿè´£å‘æ•°æ®åŒ…ï¼Œä¸ä¿è¯é¡ºåºå’Œæ­£ç¡®æ€§ï¼Œè€ŒTCPåè®®è´Ÿè´£æ§åˆ¶æ•°æ®åŒ…ä¼ è¾“ï¼Œå®ƒåœ¨ä¼ è¾“æ•°æ®ä¹‹å‰éœ€è¦å…ˆå»ºç«‹<strong>è¿æ¥</strong>ï¼Œå»ºç«‹è¿æ¥åæ‰èƒ½ä¼ è¾“æ•°æ®ï¼Œä¼ è¾“å®Œåè¿˜éœ€è¦æ–­å¼€è¿æ¥ã€‚TCPåè®®ä¹‹æ‰€ä»¥èƒ½ä¿è¯æ•°æ®çš„<strong>å¯é ä¼ è¾“</strong>ï¼Œæ˜¯é€šè¿‡æ¥æ”¶ç¡®è®¤ã€è¶…æ—¶é‡ä¼ è¿™äº›æœºåˆ¶å®ç°çš„ã€‚å¹¶ä¸”ï¼ŒTCPåè®®å…è®¸<strong>åŒå‘é€šä¿¡</strong>ï¼Œå³é€šä¿¡åŒæ–¹å¯ä»¥åŒæ—¶å‘é€å’Œæ¥æ”¶æ•°æ®ã€‚</p>
<p>TCPåè®®ä¹Ÿæ˜¯åº”ç”¨æœ€å¹¿æ³›çš„åè®®ï¼Œè®¸å¤šé«˜çº§åè®®éƒ½æ˜¯å»ºç«‹åœ¨TCPåè®®ä¹‹ä¸Šçš„ï¼Œä¾‹å¦‚HTTPã€SMTPç­‰ã€‚</p>
<p>UDPåè®®ï¼ˆUser Datagram Protocolï¼‰æ˜¯ä¸€ç§æ•°æ®æŠ¥æ–‡åè®®ï¼Œå®ƒæ˜¯æ— è¿æ¥åè®®ï¼Œ<strong>ä¸å¯é ä¼ è¾“</strong>ã€‚å› ä¸ºUDPåè®®åœ¨é€šä¿¡å‰<strong>ä¸éœ€è¦å»ºç«‹è¿æ¥</strong>ï¼Œå› æ­¤å®ƒçš„ä¼ è¾“æ•ˆç‡æ¯”TCPé«˜ï¼Œè€Œä¸”UDPåè®®æ¯”TCPåè®®è¦ç®€å•å¾—å¤šã€‚</p>
<p>é€‰æ‹©UDPåè®®æ—¶ï¼Œä¼ è¾“çš„æ•°æ®é€šå¸¸æ˜¯èƒ½å®¹å¿ä¸¢å¤±çš„ï¼Œä¾‹å¦‚ï¼Œä¸€äº›è¯­éŸ³è§†é¢‘é€šä¿¡çš„åº”ç”¨ä¼šé€‰æ‹©UDPåè®®ã€‚</p>
<h2 id="2-TCPç¼–ç¨‹"><a href="#2-TCPç¼–ç¨‹" class="headerlink" title="2. TCPç¼–ç¨‹"></a>2. TCPç¼–ç¨‹</h2><h3 id="2-1-Socket"><a href="#2-1-Socket" class="headerlink" title="2.1 Socket"></a>2.1 Socket</h3><p>åœ¨å¼€å‘ç½‘ç»œåº”ç”¨ç¨‹åºçš„æ—¶å€™ï¼Œæˆ‘ä»¬åˆä¼šé‡åˆ°Socketè¿™ä¸ªæ¦‚å¿µã€‚Socketæ˜¯ä¸€ä¸ªæŠ½è±¡æ¦‚å¿µï¼Œä¸€ä¸ªåº”ç”¨ç¨‹åºé€šè¿‡ä¸€ä¸ªSocketæ¥å»ºç«‹ä¸€ä¸ªè¿œç¨‹è¿æ¥ï¼Œè€ŒSocketå†…éƒ¨é€šè¿‡TCP/IPåè®®æŠŠæ•°æ®ä¼ è¾“åˆ°ç½‘ç»œï¼š</p>
<p><img src="https://raw.githubusercontent.com/ghj1998/image_repository/main/image-20210507111650298.png" alt="image-20210507111650298"></p>
<p>å½“æ“ä½œç³»ç»Ÿæ¥æ”¶åˆ°ä¸€ä¸ªæ•°æ®åŒ…çš„æ—¶å€™ï¼Œå¦‚æœåªæœ‰IPåœ°å€ï¼Œå®ƒæ²¡æ³•åˆ¤æ–­åº”è¯¥å‘ç»™å“ªä¸ªåº”ç”¨ç¨‹åºï¼Œæ‰€ä»¥ï¼Œæ“ä½œç³»ç»ŸæŠ½è±¡å‡ºSocketæ¥å£ï¼Œæ¯ä¸ªåº”ç”¨ç¨‹åºéœ€è¦å„è‡ªå¯¹åº”åˆ°ä¸åŒçš„Socketï¼Œæ•°æ®åŒ…æ‰èƒ½æ ¹æ®Socketæ­£ç¡®åœ°å‘åˆ°å¯¹åº”çš„åº”ç”¨ç¨‹åºã€‚</p>
<p>Socketç­‰äºIPåœ°å€åŠ ç«¯å£å·ã€‚</p>
<p>ç«¯å£å·æ€»æ˜¯ç”±æ“ä½œç³»ç»Ÿåˆ†é…ï¼Œå®ƒæ˜¯ä¸€ä¸ª0ï½65535ä¹‹é—´çš„æ•°å­—ï¼Œå…¶ä¸­ï¼Œå°äº1024çš„ç«¯å£å±äº<em>ç‰¹æƒç«¯å£</em>ï¼Œéœ€è¦ç®¡ç†å‘˜æƒé™ï¼Œå¤§äº1024çš„ç«¯å£å¯ä»¥ç”±ä»»æ„ç”¨æˆ·çš„åº”ç”¨ç¨‹åºæ‰“å¼€ã€‚</p>
<p>å› æ­¤ï¼Œå½“Socketè¿æ¥æˆåŠŸåœ°åœ¨æœåŠ¡å™¨ç«¯å’Œå®¢æˆ·ç«¯ä¹‹é—´å»ºç«‹åï¼š</p>
<ul>
<li>å¯¹æœåŠ¡å™¨ç«¯æ¥è¯´ï¼Œå®ƒçš„Socketæ˜¯æŒ‡å®šçš„IPåœ°å€å’ŒæŒ‡å®šçš„ç«¯å£å·ï¼›</li>
<li>å¯¹å®¢æˆ·ç«¯æ¥è¯´ï¼Œå®ƒçš„Socketæ˜¯å®ƒæ‰€åœ¨è®¡ç®—æœºçš„IPåœ°å€å’Œä¸€ä¸ªç”±æ“ä½œç³»ç»Ÿåˆ†é…çš„éšæœºç«¯å£å·ã€‚</li>
</ul>
<h3 id="2-2-æœåŠ¡å™¨ç«¯"><a href="#2-2-æœåŠ¡å™¨ç«¯" class="headerlink" title="2.2 æœåŠ¡å™¨ç«¯"></a>2.2 æœåŠ¡å™¨ç«¯</h3><p>Javaæ ‡å‡†åº“æä¾›äº†<code>ServerSocket</code>æ¥å®ç°å¯¹æŒ‡å®šIPå’ŒæŒ‡å®šç«¯å£çš„ç›‘å¬ã€‚<code>ServerSocket</code>çš„å…¸å‹å®ç°ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Server</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        ServerSocket ss = <span class="keyword">new</span> ServerSocket(<span class="number">6666</span>); <span class="comment">// ç›‘å¬æŒ‡å®šç«¯å£</span></span><br><span class="line">        System.out.println(<span class="string">&quot;server is running...&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">            Socket sock = ss.accept();</span><br><span class="line">            System.out.println(<span class="string">&quot;connected from &quot;</span> + sock.getRemoteSocketAddress());</span><br><span class="line">            Thread t = <span class="keyword">new</span> Handler(sock);</span><br><span class="line">            t.start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Handler</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line">    Socket sock;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Handler</span><span class="params">(Socket sock)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.sock = sock;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> (InputStream input = <span class="keyword">this</span>.sock.getInputStream()) &#123;</span><br><span class="line">            <span class="keyword">try</span> (OutputStream output = <span class="keyword">this</span>.sock.getOutputStream()) &#123;</span><br><span class="line">                handle(input, output);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">this</span>.sock.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException ioe) &#123;</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">&quot;client disconnected.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">handle</span><span class="params">(InputStream input, OutputStream output)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> writer = <span class="keyword">new</span> BufferedWriter(<span class="keyword">new</span> OutputStreamWriter(output, StandardCharsets.UTF_8));</span><br><span class="line">        <span class="keyword">var</span> reader = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(input, StandardCharsets.UTF_8));</span><br><span class="line">        writer.write(<span class="string">&quot;hello\n&quot;</span>);</span><br><span class="line">        writer.flush();</span><br><span class="line">        <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">            String s = reader.readLine();</span><br><span class="line">            <span class="keyword">if</span> (s.equals(<span class="string">&quot;bye&quot;</span>)) &#123;</span><br><span class="line">                writer.write(<span class="string">&quot;bye\n&quot;</span>);</span><br><span class="line">                writer.flush();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            writer.write(<span class="string">&quot;ok: &quot;</span> + s + <span class="string">&quot;\n&quot;</span>);</span><br><span class="line">            writer.flush();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æœåŠ¡å™¨ç«¯é€šè¿‡ä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">ServerSocket ss = <span class="keyword">new</span> ServerSocket(<span class="number">6666</span>);</span><br></pre></td></tr></table></figure>

<p>åœ¨æŒ‡å®šç«¯å£<code>6666</code>ç›‘å¬ã€‚è¿™é‡Œæˆ‘ä»¬æ²¡æœ‰æŒ‡å®šIPåœ°å€ï¼Œè¡¨ç¤ºåœ¨è®¡ç®—æœºçš„æ‰€æœ‰ç½‘ç»œæ¥å£ä¸Šè¿›è¡Œç›‘å¬ã€‚</p>
<p>å¦‚æœ<code>ServerSocket</code>ç›‘å¬æˆåŠŸï¼Œæˆ‘ä»¬å°±ä½¿ç”¨ä¸€ä¸ªæ— é™å¾ªç¯æ¥å¤„ç†å®¢æˆ·ç«¯çš„è¿æ¥ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> (;;) &#123;</span><br><span class="line">    Socket sock = ss.accept();</span><br><span class="line">    Thread t = <span class="keyword">new</span> Handler(sock);</span><br><span class="line">    t.start();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>ss.accept()</code>è¡¨ç¤ºæ¯å½“æœ‰æ–°çš„å®¢æˆ·ç«¯è¿æ¥è¿›æ¥åï¼Œå°±è¿”å›ä¸€ä¸ª<code>Socket</code>å®ä¾‹ï¼Œè¿™ä¸ª<code>Socket</code>å®ä¾‹å°±æ˜¯ç”¨æ¥å’Œåˆšè¿æ¥çš„å®¢æˆ·ç«¯è¿›è¡Œé€šä¿¡çš„ã€‚ç”±äºå®¢æˆ·ç«¯å¾ˆå¤šï¼Œè¦å®ç°å¹¶å‘å¤„ç†ï¼Œæˆ‘ä»¬å°±å¿…é¡»ä¸ºæ¯ä¸ªæ–°çš„<code>Socket</code>åˆ›å»ºä¸€ä¸ªæ–°çº¿ç¨‹æ¥å¤„ç†ï¼Œè¿™æ ·ï¼Œä¸»çº¿ç¨‹çš„ä½œç”¨å°±æ˜¯æ¥æ”¶æ–°çš„è¿æ¥ï¼Œæ¯å½“æ”¶åˆ°æ–°è¿æ¥åï¼Œå°±åˆ›å»ºä¸€ä¸ªæ–°çº¿ç¨‹è¿›è¡Œå¤„ç†ã€‚</p>
<p>ä¹Ÿå¯ä»¥ä½¿ç”¨çº¿ç¨‹æ± è¿›è¡Œå¤„ç†ã€‚</p>
<p>å¦‚æœæ²¡æœ‰å®¢æˆ·ç«¯è¿æ¥è¿›æ¥ï¼Œ<code>accept()</code>æ–¹æ³•ä¼šé˜»å¡å¹¶ä¸€ç›´ç­‰å¾…ã€‚å¦‚æœæœ‰å¤šä¸ªå®¢æˆ·ç«¯åŒæ—¶è¿æ¥è¿›æ¥ï¼Œ<code>ServerSocket</code>ä¼šæŠŠè¿æ¥æ‰”åˆ°é˜Ÿåˆ—é‡Œï¼Œç„¶åä¸€ä¸ªä¸€ä¸ªå¤„ç†ã€‚å¯¹äºJavaç¨‹åºè€Œè¨€ï¼Œåªéœ€è¦é€šè¿‡å¾ªç¯ä¸æ–­è°ƒç”¨<code>accept()</code>å°±å¯ä»¥è·å–æ–°çš„è¿æ¥ã€‚</p>
<h3 id="2-3-å®¢æˆ·ç«¯"><a href="#2-3-å®¢æˆ·ç«¯" class="headerlink" title="2.3 å®¢æˆ·ç«¯"></a>2.3 å®¢æˆ·ç«¯</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        Socket sock = <span class="keyword">new</span> Socket(<span class="string">&quot;localhost&quot;</span>, <span class="number">6666</span>); <span class="comment">// è¿æ¥æŒ‡å®šæœåŠ¡å™¨å’Œç«¯å£</span></span><br><span class="line">        <span class="keyword">try</span> (InputStream input = sock.getInputStream()) &#123;</span><br><span class="line">            <span class="keyword">try</span> (OutputStream output = sock.getOutputStream()) &#123;</span><br><span class="line">                handle(input, output);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        sock.close();</span><br><span class="line">        System.out.println(<span class="string">&quot;disconnected.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">handle</span><span class="params">(InputStream input, OutputStream output)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> writer = <span class="keyword">new</span> BufferedWriter(<span class="keyword">new</span> OutputStreamWriter(output, StandardCharsets.UTF_8));</span><br><span class="line">        <span class="keyword">var</span> reader = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(input, StandardCharsets.UTF_8));</span><br><span class="line">        Scanner scanner = <span class="keyword">new</span> Scanner(System.in);</span><br><span class="line">        System.out.println(<span class="string">&quot;[server] &quot;</span> + reader.readLine());</span><br><span class="line">        <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">            System.out.print(<span class="string">&quot;&gt;&gt;&gt; &quot;</span>); <span class="comment">// æ‰“å°æç¤º</span></span><br><span class="line">            String s = scanner.nextLine(); <span class="comment">// è¯»å–ä¸€è¡Œè¾“å…¥</span></span><br><span class="line">            writer.write(s);</span><br><span class="line">            writer.newLine();</span><br><span class="line">            writer.flush();</span><br><span class="line">            String resp = reader.readLine();</span><br><span class="line">            System.out.println(<span class="string">&quot;&lt;&lt;&lt; &quot;</span> + resp);</span><br><span class="line">            <span class="keyword">if</span> (resp.equals(<span class="string">&quot;bye&quot;</span>)) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å®¢æˆ·ç«¯ç¨‹åºé€šè¿‡ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Socket sock &#x3D; new Socket(&quot;localhost&quot;, 6666);</span><br></pre></td></tr></table></figure>

<p>è¿æ¥åˆ°æœåŠ¡å™¨ç«¯ï¼Œæ³¨æ„ä¸Šè¿°ä»£ç çš„æœåŠ¡å™¨åœ°å€æ˜¯<code>&quot;localhost&quot;</code>ï¼Œè¡¨ç¤ºæœ¬æœºåœ°å€ï¼Œç«¯å£å·æ˜¯<code>6666</code>ã€‚å¦‚æœè¿æ¥æˆåŠŸï¼Œå°†è¿”å›ä¸€ä¸ª<code>Socket</code>å®ä¾‹ï¼Œç”¨äºåç»­é€šä¿¡ã€‚</p>
<h3 id="2-4-Socketæµ"><a href="#2-4-Socketæµ" class="headerlink" title="2.4 Socketæµ"></a>2.4 Socketæµ</h3><p>å½“Socketè¿æ¥åˆ›å»ºæˆåŠŸåï¼Œæ— è®ºæ˜¯æœåŠ¡å™¨ç«¯ï¼Œè¿˜æ˜¯å®¢æˆ·ç«¯ï¼Œæˆ‘ä»¬éƒ½ä½¿ç”¨<code>Socket</code>å®ä¾‹è¿›è¡Œç½‘ç»œé€šä¿¡ã€‚å› ä¸ºTCPæ˜¯ä¸€ç§åŸºäºæµçš„åè®®ï¼Œå› æ­¤ï¼ŒJavaæ ‡å‡†åº“ä½¿ç”¨<code>InputStream</code>å’Œ<code>OutputStream</code>æ¥å°è£…Socketçš„æ•°æ®æµï¼Œè¿™æ ·æˆ‘ä»¬ä½¿ç”¨Socketçš„æµï¼Œå’Œæ™®é€šIOæµç±»ä¼¼ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ç”¨äºè¯»å–ç½‘ç»œæ•°æ®:</span></span><br><span class="line">InputStream in = sock.getInputStream();</span><br><span class="line"><span class="comment">// ç”¨äºå†™å…¥ç½‘ç»œæ•°æ®:</span></span><br><span class="line">OutputStream out = sock.getOutputStream();</span><br></pre></td></tr></table></figure>

<p>å¦‚æœä¸è°ƒç”¨<code>flush()</code>ï¼Œæˆ‘ä»¬å¾ˆå¯èƒ½ä¼šå‘ç°ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨éƒ½æ”¶ä¸åˆ°æ•°æ®ï¼Œè¿™å¹¶ä¸æ˜¯Javaæ ‡å‡†åº“çš„è®¾è®¡é—®é¢˜ï¼Œè€Œæ˜¯æˆ‘ä»¬ä»¥æµçš„å½¢å¼å†™å…¥æ•°æ®çš„æ—¶å€™ï¼Œå¹¶ä¸æ˜¯ä¸€å†™å…¥å°±ç«‹åˆ»å‘é€åˆ°ç½‘ç»œï¼Œè€Œæ˜¯å…ˆå†™å…¥å†…å­˜ç¼“å†²åŒºï¼Œç›´åˆ°ç¼“å†²åŒºæ»¡äº†ä»¥åï¼Œæ‰ä¼šä¸€æ¬¡æ€§çœŸæ­£å‘é€åˆ°ç½‘ç»œï¼Œè¿™æ ·è®¾è®¡çš„ç›®çš„æ˜¯ä¸ºäº†æé«˜ä¼ è¾“æ•ˆç‡ã€‚å¦‚æœç¼“å†²åŒºçš„æ•°æ®å¾ˆå°‘ï¼Œè€Œæˆ‘ä»¬åˆæƒ³å¼ºåˆ¶æŠŠè¿™äº›æ•°æ®å‘é€åˆ°ç½‘ç»œï¼Œå°±å¿…é¡»è°ƒç”¨<code>flush()</code>å¼ºåˆ¶æŠŠç¼“å†²åŒºæ•°æ®å‘é€å‡ºå»ã€‚</p>
<h2 id="3-UDPç¼–ç¨‹"><a href="#3-UDPç¼–ç¨‹" class="headerlink" title="3. UDPç¼–ç¨‹"></a>3. UDPç¼–ç¨‹</h2><p>å’ŒTCPç¼–ç¨‹ç›¸æ¯”ï¼ŒUDPç¼–ç¨‹å°±ç®€å•å¾—å¤šï¼Œå› ä¸ºUDPæ²¡æœ‰åˆ›å»ºè¿æ¥ï¼Œæ•°æ®åŒ…ä¹Ÿæ˜¯ä¸€æ¬¡æ”¶å‘ä¸€ä¸ªï¼Œæ‰€ä»¥æ²¡æœ‰æµçš„æ¦‚å¿µã€‚</p>
<p>åœ¨Javaä¸­ä½¿ç”¨UDPç¼–ç¨‹ï¼Œä»ç„¶éœ€è¦ä½¿ç”¨Socketï¼Œå› ä¸ºåº”ç”¨ç¨‹åºåœ¨ä½¿ç”¨UDPæ—¶å¿…é¡»æŒ‡å®šç½‘ç»œæ¥å£ï¼ˆIPï¼‰å’Œç«¯å£å·ã€‚æ³¨æ„ï¼šUDPç«¯å£å’ŒTCPç«¯å£è™½ç„¶éƒ½ä½¿ç”¨0~65535ï¼Œä½†ä»–ä»¬æ˜¯ä¸¤å¥—ç‹¬ç«‹çš„ç«¯å£ï¼Œå³ä¸€ä¸ªåº”ç”¨ç¨‹åºç”¨TCPå ç”¨äº†ç«¯å£1234ï¼Œä¸å½±å“å¦ä¸€ä¸ªåº”ç”¨ç¨‹åºç”¨UDPå ç”¨ç«¯å£1234ã€‚</p>
<h3 id="3-1-æœåŠ¡å™¨ç«¯"><a href="#3-1-æœåŠ¡å™¨ç«¯" class="headerlink" title="3.1 æœåŠ¡å™¨ç«¯"></a>3.1 æœåŠ¡å™¨ç«¯</h3><p>Javaæä¾›äº†<code>DatagramSocket</code>æ¥å®ç°è¿™ä¸ªåŠŸèƒ½ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">DatagramSocket ds = <span class="keyword">new</span> DatagramSocket(<span class="number">6666</span>); <span class="comment">// ç›‘å¬æŒ‡å®šç«¯å£</span></span><br><span class="line"><span class="keyword">for</span> (;;) &#123; <span class="comment">// æ— é™å¾ªç¯</span></span><br><span class="line">    <span class="comment">// æ•°æ®ç¼“å†²åŒº:</span></span><br><span class="line">    <span class="keyword">byte</span>[] buffer = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];</span><br><span class="line">    DatagramPacket packet = <span class="keyword">new</span> DatagramPacket(buffer, buffer.length);</span><br><span class="line">    ds.receive(packet); <span class="comment">// æ”¶å–ä¸€ä¸ªUDPæ•°æ®åŒ…</span></span><br><span class="line">    <span class="comment">// æ”¶å–åˆ°çš„æ•°æ®å­˜å‚¨åœ¨bufferä¸­ï¼Œç”±packet.getOffset(), packet.getLength()æŒ‡å®šèµ·å§‹ä½ç½®å’Œé•¿åº¦</span></span><br><span class="line">    <span class="comment">// å°†å…¶æŒ‰UTF-8ç¼–ç è½¬æ¢ä¸ºString:</span></span><br><span class="line">    String s = <span class="keyword">new</span> String(packet.getData(), packet.getOffset(), packet.getLength(), StandardCharsets.UTF_8);</span><br><span class="line">    <span class="comment">// å‘é€æ•°æ®:</span></span><br><span class="line">    <span class="keyword">byte</span>[] data = <span class="string">&quot;ACK&quot;</span>.getBytes(StandardCharsets.UTF_8);</span><br><span class="line">    packet.setData(data);</span><br><span class="line">    ds.send(packet);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æœåŠ¡å™¨ç«¯é¦–å…ˆä½¿ç”¨å¦‚ä¸‹è¯­å¥åœ¨æŒ‡å®šçš„ç«¯å£ç›‘å¬UDPæ•°æ®åŒ…ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">DatagramSocket ds = <span class="keyword">new</span> DatagramSocket(<span class="number">6666</span>);</span><br></pre></td></tr></table></figure>

<p>å½“æœåŠ¡å™¨æ”¶åˆ°ä¸€ä¸ª<code>DatagramPacket</code>åï¼Œé€šå¸¸å¿…é¡»ç«‹åˆ»å›å¤ä¸€ä¸ªæˆ–å¤šä¸ªUDPåŒ…ï¼Œå› ä¸ºå®¢æˆ·ç«¯åœ°å€åœ¨<code>DatagramPacket</code>ä¸­ï¼Œæ¯æ¬¡æ”¶åˆ°çš„<code>DatagramPacket</code>å¯èƒ½æ˜¯ä¸åŒçš„å®¢æˆ·ç«¯ï¼Œå¦‚æœä¸å›å¤ï¼Œå®¢æˆ·ç«¯å°±æ”¶ä¸åˆ°ä»»ä½•UDPåŒ…ã€‚</p>
<h3 id="3-2-å®¢æˆ·ç«¯"><a href="#3-2-å®¢æˆ·ç«¯" class="headerlink" title="3.2 å®¢æˆ·ç«¯"></a>3.2 å®¢æˆ·ç«¯</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">DatagramSocket ds = <span class="keyword">new</span> DatagramSocket();</span><br><span class="line">ds.setSoTimeout(<span class="number">1000</span>);</span><br><span class="line">ds.connect(InetAddress.getByName(<span class="string">&quot;localhost&quot;</span>), <span class="number">6666</span>); <span class="comment">// è¿æ¥æŒ‡å®šæœåŠ¡å™¨å’Œç«¯å£</span></span><br><span class="line"><span class="comment">// å‘é€:</span></span><br><span class="line"><span class="keyword">byte</span>[] data = <span class="string">&quot;Hello&quot;</span>.getBytes();</span><br><span class="line">DatagramPacket packet = <span class="keyword">new</span> DatagramPacket(data, data.length);</span><br><span class="line">ds.send(packet);</span><br><span class="line"><span class="comment">// æ¥æ”¶:</span></span><br><span class="line"><span class="keyword">byte</span>[] buffer = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];</span><br><span class="line">packet = <span class="keyword">new</span> DatagramPacket(buffer, buffer.length);</span><br><span class="line">ds.receive(packet);</span><br><span class="line">String resp = <span class="keyword">new</span> String(packet.getData(), packet.getOffset(), packet.getLength());</span><br><span class="line">ds.disconnect();</span><br></pre></td></tr></table></figure>

<p><code>DatagramSocket ds = new DatagramSocket();</code><br><code>ds.setSoTimeout(1000);</code></p>
<p>å®¢æˆ·ç«¯åˆ›å»º<code>DatagramSocket</code>å®ä¾‹æ—¶å¹¶ä¸éœ€è¦æŒ‡å®šç«¯å£ï¼Œè€Œæ˜¯ç”±æ“ä½œç³»ç»Ÿè‡ªåŠ¨æŒ‡å®šä¸€ä¸ªå½“å‰æœªä½¿ç”¨çš„ç«¯å£ã€‚ç´§æ¥ç€ï¼Œè°ƒç”¨<code>setSoTimeout(1000)</code>è®¾å®šè¶…æ—¶1ç§’ï¼Œæ„æ€æ˜¯åç»­æ¥æ”¶UDPåŒ…æ—¶ï¼Œç­‰å¾…æ—¶é—´æœ€å¤šä¸ä¼šè¶…è¿‡1ç§’ï¼Œå¦åˆ™åœ¨æ²¡æœ‰æ”¶åˆ°UDPåŒ…æ—¶ï¼Œå®¢æˆ·ç«¯ä¼šæ— é™ç­‰å¾…ä¸‹å»ã€‚è¿™</p>
<p><code>ds.connect(InetAddress.getByName(&quot;localhost&quot;), 6666);</code></p>
<p>è¿™ä¸ª<code>connect()</code>æ–¹æ³•ä¸æ˜¯çœŸè¿æ¥ï¼Œå®ƒæ˜¯ä¸ºäº†åœ¨å®¢æˆ·ç«¯çš„<code>DatagramSocket</code>å®ä¾‹ä¸­ä¿å­˜æœåŠ¡å™¨ç«¯çš„IPå’Œç«¯å£å·ï¼Œç¡®ä¿è¿™ä¸ª<code>DatagramSocket</code>å®ä¾‹åªèƒ½å¾€æŒ‡å®šçš„åœ°å€å’Œç«¯å£å‘é€UDPåŒ…ï¼Œä¸èƒ½å¾€å…¶ä»–åœ°å€å’Œç«¯å£å‘é€ã€‚</p>
<p>å¦‚æœå®¢æˆ·ç«¯å¸Œæœ›å‘ä¸¤ä¸ªä¸åŒçš„æœåŠ¡å™¨å‘é€UDPåŒ…ï¼Œé‚£ä¹ˆå®ƒå¿…é¡»åˆ›å»ºä¸¤ä¸ª<code>DatagramSocket</code>å®ä¾‹ã€‚</p>
<p><code>ds.disconnect();</code></p>
<p>æ³¨æ„åˆ°<code>disconnect()</code>ä¹Ÿä¸æ˜¯çœŸæ­£åœ°æ–­å¼€è¿æ¥ï¼Œå®ƒåªæ˜¯æ¸…é™¤äº†å®¢æˆ·ç«¯<code>DatagramSocket</code>å®ä¾‹è®°å½•çš„è¿œç¨‹æœåŠ¡å™¨åœ°å€å’Œç«¯å£å·ï¼Œè¿™æ ·ï¼Œ<code>DatagramSocket</code>å®ä¾‹å°±å¯ä»¥è¿æ¥å¦ä¸€ä¸ªæœåŠ¡å™¨ç«¯ã€‚</p>
<h2 id="4-å‘é€Email"><a href="#4-å‘é€Email" class="headerlink" title="4. å‘é€Email"></a>4. å‘é€Email</h2><h3 id="4-1-åŸºç¡€å®šä¹‰"><a href="#4-1-åŸºç¡€å®šä¹‰" class="headerlink" title="4.1 åŸºç¡€å®šä¹‰"></a>4.1 åŸºç¡€å®šä¹‰</h3><p>é‚®ä»¶è½¯ä»¶ç§°ä¸ºMUA ï¼šMail User Agentï¼Œæ„æ€æ˜¯ç»™ç”¨æˆ·æœåŠ¡çš„é‚®ä»¶ä»£ç†ï¼›</p>
<p>é‚®ä»¶æœåŠ¡å™¨åˆ™ç§°ä¸ºMTA ï¼šMail Transfer Agentï¼Œæ„æ€æ˜¯é‚®ä»¶ä¸­è½¬çš„ä»£ç†ï¼›</p>
<p>æœ€ç»ˆåˆ°è¾¾çš„é‚®ä»¶æœåŠ¡å™¨ç§°ä¸ºMDA ï¼šMail Delivery Agentï¼Œæ„æ€æ˜¯é‚®ä»¶åˆ°è¾¾çš„ä»£ç†ã€‚</p>
<p><img src="https://raw.githubusercontent.com/ghj1998/image_repository/main/image-20210507152805907.png" alt="image-20210507152805907"></p>
<p>ç”µå­é‚®ä»¶é€šå¸¸å°±å­˜å‚¨åœ¨MDAæœåŠ¡å™¨çš„ç¡¬ç›˜ä¸Šï¼Œç„¶åç­‰æ”¶ä»¶äººé€šè¿‡è½¯ä»¶æˆ–è€…ç™»é™†æµè§ˆå™¨æŸ¥çœ‹é‚®ä»¶ã€‚</p>
<p>è¦å‘é€é‚®ä»¶ï¼Œæˆ‘ä»¬å…³å¿ƒçš„æ˜¯å¦‚ä½•ç¼–å†™ä¸€ä¸ªMUAçš„è½¯ä»¶ï¼ŒæŠŠé‚®ä»¶å‘é€åˆ°MTAä¸Šã€‚</p>
<p>MUAåˆ°MTAå‘é€é‚®ä»¶çš„åè®®å°±æ˜¯SMTPåè®®ï¼Œå®ƒæ˜¯Simple Mail Transport Protocolçš„ç¼©å†™ï¼Œä½¿ç”¨æ ‡å‡†ç«¯å£25ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨åŠ å¯†ç«¯å£465æˆ–587ã€‚</p>
<p>SMTPåè®®æ˜¯ä¸€ä¸ªå»ºç«‹åœ¨TCPä¹‹ä¸Šçš„åè®®ï¼Œä»»ä½•ç¨‹åºå‘é€é‚®ä»¶éƒ½å¿…é¡»éµå®ˆSMTPåè®®ã€‚ä½¿ç”¨Javaç¨‹åºå‘é€é‚®ä»¶æ—¶ï¼Œæˆ‘ä»¬æ— éœ€å…³å¿ƒSMTPåè®®çš„åº•å±‚åŸç†ï¼Œåªéœ€è¦ä½¿ç”¨JavaMailè¿™ä¸ªæ ‡å‡†APIå°±å¯ä»¥ç›´æ¥å‘é€é‚®ä»¶ã€‚</p>
<h3 id="4-2-SMTPç™»å½•ä¿¡æ¯"><a href="#4-2-SMTPç™»å½•ä¿¡æ¯" class="headerlink" title="4.2 SMTPç™»å½•ä¿¡æ¯"></a>4.2 SMTPç™»å½•ä¿¡æ¯</h3><p>å‘é€é‚®ä»¶å‰ï¼Œæˆ‘ä»¬é¦–å…ˆè¦ç¡®å®šä½œä¸ºMTAçš„é‚®ä»¶æœåŠ¡å™¨åœ°å€å’Œç«¯å£å·ã€‚é‚®ä»¶æœåŠ¡å™¨åœ°å€é€šå¸¸æ˜¯<code>smtp.example.com</code>ï¼Œç«¯å£å·ç”±é‚®ä»¶æœåŠ¡å•†ç¡®å®šä½¿ç”¨25ã€465è¿˜æ˜¯587ã€‚</p>
<p>ä¾‹å¦‚ï¼š</p>
<ul>
<li>QQé‚®ç®±ï¼šSMTPæœåŠ¡å™¨æ˜¯smtp.qq.comï¼Œç«¯å£æ˜¯465/587ï¼›</li>
<li>163é‚®ç®±ï¼šSMTPæœåŠ¡å™¨æ˜¯smtp.163.comï¼Œç«¯å£æ˜¯465ï¼›</li>
<li>Gmailé‚®ç®±ï¼šSMTPæœåŠ¡å™¨æ˜¯smtp.gmail.comï¼Œç«¯å£æ˜¯465/587ã€‚</li>
</ul>
<p>æœ‰äº†SMTPæœåŠ¡å™¨çš„åŸŸåå’Œç«¯å£å·ï¼Œæˆ‘ä»¬è¿˜éœ€è¦SMTPæœåŠ¡å™¨çš„ç™»å½•ä¿¡æ¯ï¼Œé€šå¸¸æ˜¯ä½¿ç”¨è‡ªå·±çš„é‚®ä»¶åœ°å€ä½œä¸ºç”¨æˆ·åï¼Œç™»å½•å£ä»¤æ˜¯ç”¨æˆ·å£ä»¤æˆ–è€…ä¸€ä¸ªç‹¬ç«‹è®¾ç½®çš„SMTPå£ä»¤ã€‚</p>
<h3 id="4-4-å¦‚ä½•å‘é€é‚®ä»¶"><a href="#4-4-å¦‚ä½•å‘é€é‚®ä»¶" class="headerlink" title="4.4 å¦‚ä½•å‘é€é‚®ä»¶"></a>4.4 å¦‚ä½•å‘é€é‚®ä»¶</h3><ol>
<li><p>éœ€è¦å¯¼å…¥ä¾èµ–</p>
<p>åœ¨Mavenå·¥ç¨‹ä¸­ï¼Œåœ¨pomé…ç½®ä¸­åŠ å…¥ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.mail<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.mail-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.6.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.sun.mail<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.mail<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.6.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>é€šè¿‡JAVAMail APIè¿æ¥åˆ°SMTPæœåŠ¡å™¨</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æœåŠ¡å™¨åœ°å€:</span></span><br><span class="line">String smtp = <span class="string">&quot;smtp.office365.com&quot;</span>;</span><br><span class="line"><span class="comment">// ç™»å½•ç”¨æˆ·å:</span></span><br><span class="line">String username = <span class="string">&quot;jxsmtp101@outlook.com&quot;</span>;</span><br><span class="line"><span class="comment">// ç™»å½•å£ä»¤:</span></span><br><span class="line">String password = <span class="string">&quot;********&quot;</span>;</span><br><span class="line"><span class="comment">// è¿æ¥åˆ°SMTPæœåŠ¡å™¨587ç«¯å£:</span></span><br><span class="line">Properties props = <span class="keyword">new</span> Properties();</span><br><span class="line">props.put(<span class="string">&quot;mail.smtp.host&quot;</span>, smtp); <span class="comment">// SMTPä¸»æœºå</span></span><br><span class="line">props.put(<span class="string">&quot;mail.smtp.port&quot;</span>, <span class="string">&quot;587&quot;</span>); <span class="comment">// ä¸»æœºç«¯å£å·</span></span><br><span class="line">props.put(<span class="string">&quot;mail.smtp.auth&quot;</span>, <span class="string">&quot;true&quot;</span>); <span class="comment">// æ˜¯å¦éœ€è¦ç”¨æˆ·è®¤è¯</span></span><br><span class="line">props.put(<span class="string">&quot;mail.smtp.starttls.enable&quot;</span>, <span class="string">&quot;true&quot;</span>); <span class="comment">// å¯ç”¨TLSåŠ å¯†</span></span><br><span class="line"><span class="comment">// è·å–Sessionå®ä¾‹:</span></span><br><span class="line">Session session = Session.getInstance(props, <span class="keyword">new</span> Authenticator() &#123;</span><br><span class="line">    <span class="function"><span class="keyword">protected</span> PasswordAuthentication <span class="title">getPasswordAuthentication</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> PasswordAuthentication(username, password);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// è®¾ç½®debugæ¨¡å¼ä¾¿äºè°ƒè¯•:</span></span><br><span class="line">session.setDebug(<span class="keyword">true</span>);</span><br></pre></td></tr></table></figure>

<p>ä»¥587ç«¯å£ä¸ºä¾‹ï¼Œè¿æ¥SMTPæœåŠ¡å™¨æ—¶ï¼Œéœ€è¦å‡†å¤‡ä¸€ä¸ªPropertieså¯¹è±¡ï¼Œå¡«å…¥ç›¸å…³ä¿¡æ¯ã€‚æœ€åè·å–Sessionå®ä¾‹æ—¶ï¼Œå¦‚æœæœåŠ¡å™¨éœ€è¦è®¤è¯ï¼Œè¿˜éœ€è¦ä¼ å…¥ä¸€ä¸ªAuthenticatorå¯¹è±¡ï¼Œå¹¶è¿”å›æŒ‡å®šçš„ç”¨æˆ·åå’Œå£ä»¤ã€‚</p>
</li>
<li><p>å‘é€é‚®ä»¶</p>
<p>æ„é€ ä¸€ä¸ª<code>Message</code>å¯¹è±¡ï¼Œç„¶åè°ƒç”¨<code>Transport.send(Message)</code>å³å¯å®Œæˆå‘é€ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">MimeMessage message = <span class="keyword">new</span> MimeMessage(session);</span><br><span class="line"><span class="comment">// è®¾ç½®å‘é€æ–¹åœ°å€:</span></span><br><span class="line">message.setFrom(<span class="keyword">new</span> InternetAddress(<span class="string">&quot;me@example.com&quot;</span>));</span><br><span class="line"><span class="comment">// è®¾ç½®æ¥æ”¶æ–¹åœ°å€:</span></span><br><span class="line">message.setRecipient(Message.RecipientType.TO, <span class="keyword">new</span> InternetAddress(<span class="string">&quot;xiaoming@somewhere.com&quot;</span>));</span><br><span class="line"><span class="comment">// è®¾ç½®é‚®ä»¶ä¸»é¢˜:</span></span><br><span class="line">message.setSubject(<span class="string">&quot;Hello&quot;</span>, <span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line"><span class="comment">// è®¾ç½®é‚®ä»¶æ­£æ–‡:</span></span><br><span class="line">message.setText(<span class="string">&quot;Hi Xiaoming...&quot;</span>, <span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line"><span class="comment">// å‘é€:</span></span><br><span class="line">Transport.send(message);</span><br></pre></td></tr></table></figure>

<p>ç»å¤§å¤šæ•°é‚®ä»¶æœåŠ¡å™¨è¦æ±‚å‘é€æ–¹åœ°å€å’Œç™»å½•ç”¨æˆ·åå¿…é¡»ä¸€è‡´</p>
</li>
</ol>
<h3 id="4-5-HTMLé‚®ä»¶"><a href="#4-5-HTMLé‚®ä»¶" class="headerlink" title="4.5 HTMLé‚®ä»¶"></a>4.5 HTMLé‚®ä»¶</h3><p>å‘é€HTMLé‚®ä»¶</p>
<p>å‘é€HTMLé‚®ä»¶å’Œæ–‡æœ¬é‚®ä»¶æ˜¯ç±»ä¼¼çš„ï¼Œåªéœ€è¦æŠŠï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">message.setText(body, <span class="string">&quot;UTF-8&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>æ”¹ä¸ºï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">message.setText(body, <span class="string">&quot;UTF-8&quot;</span>, <span class="string">&quot;html&quot;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="4-6-å‘é€é™„ä»¶"><a href="#4-6-å‘é€é™„ä»¶" class="headerlink" title="4.6 å‘é€é™„ä»¶"></a>4.6 å‘é€é™„ä»¶</h3><p>è¦åœ¨ç”µå­é‚®ä»¶ä¸­æºå¸¦é™„ä»¶ï¼Œæˆ‘ä»¬å°±ä¸èƒ½ç›´æ¥è°ƒç”¨<code>message.setText()</code>æ–¹æ³•ï¼Œè€Œæ˜¯è¦æ„é€ ä¸€ä¸ª<code>Multipart</code>å¯¹è±¡ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Multipart multipart = <span class="keyword">new</span> MimeMultipart();</span><br><span class="line"><span class="comment">// æ·»åŠ text:</span></span><br><span class="line">BodyPart textpart = <span class="keyword">new</span> MimeBodyPart();</span><br><span class="line">textpart.setContent(body, <span class="string">&quot;text/html;charset=utf-8&quot;</span>);</span><br><span class="line">multipart.addBodyPart(textpart);</span><br><span class="line"><span class="comment">// æ·»åŠ image:</span></span><br><span class="line">BodyPart imagepart = <span class="keyword">new</span> MimeBodyPart();</span><br><span class="line">imagepart.setFileName(fileName);</span><br><span class="line">imagepart.setDataHandler(<span class="keyword">new</span> DataHandler(<span class="keyword">new</span> ByteArrayDataSource(input, <span class="string">&quot;application/octet-stream&quot;</span>)));</span><br><span class="line">multipart.addBodyPart(imagepart);</span><br><span class="line"><span class="comment">// è®¾ç½®é‚®ä»¶å†…å®¹ä¸ºmultipart:</span></span><br><span class="line">message.setContent(multipart);</span><br></pre></td></tr></table></figure>

<p>ä¸€ä¸ª<code>Multipart</code>å¯¹è±¡å¯ä»¥æ·»åŠ è‹¥å¹²ä¸ª<code>BodyPart</code>ï¼Œå…¶ä¸­ç¬¬ä¸€ä¸ª<code>BodyPart</code>æ˜¯æ–‡æœ¬ï¼Œå³é‚®ä»¶æ­£æ–‡ï¼Œåé¢çš„BodyPartæ˜¯é™„ä»¶ã€‚</p>
<p><code>BodyPart</code>ä¾é <code>setContent()</code>å†³å®šæ·»åŠ çš„å†…å®¹ï¼Œå¦‚æœæ·»åŠ æ–‡æœ¬ï¼Œç”¨<code>setContent(&quot;...&quot;, &quot;text/plain;charset=utf-8&quot;)</code>æ·»åŠ çº¯æ–‡æœ¬ï¼Œæˆ–è€…ç”¨<code>setContent(&quot;...&quot;, &quot;text/html;charset=utf-8&quot;)</code>æ·»åŠ HTMLæ–‡æœ¬ã€‚</p>
<p>æœæ·»åŠ é™„ä»¶ï¼Œéœ€è¦è®¾ç½®æ–‡ä»¶åï¼ˆä¸ä¸€å®šå’ŒçœŸå®æ–‡ä»¶åä¸€è‡´ï¼‰ï¼Œå¹¶ä¸”æ·»åŠ ä¸€ä¸ª<code>DataHandler()</code>ï¼Œä¼ å…¥æ–‡ä»¶çš„MIMEç±»å‹ã€‚äºŒè¿›åˆ¶æ–‡ä»¶å¯ä»¥ç”¨<code>application/octet-stream</code>ï¼ŒWordæ–‡æ¡£åˆ™æ˜¯<code>application/msword</code>ã€‚</p>
<p><strong>å¦‚ä½•å†…åµŒå›¾ç‰‡ï¼Ÿ</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Multipart multipart = <span class="keyword">new</span> MimeMultipart();</span><br><span class="line"><span class="comment">// æ·»åŠ text:</span></span><br><span class="line">BodyPart textpart = <span class="keyword">new</span> MimeBodyPart();</span><br><span class="line">textpart.setContent(<span class="string">&quot;&lt;h1&gt;Hello&lt;/h1&gt;&lt;p&gt;&lt;img src=\&quot;cid:img01\&quot;&gt;&lt;/p&gt;&quot;</span>, <span class="string">&quot;text/html;charset=utf-8&quot;</span>);</span><br><span class="line">multipart.addBodyPart(textpart);</span><br><span class="line"><span class="comment">// æ·»åŠ image:</span></span><br><span class="line">BodyPart imagepart = <span class="keyword">new</span> MimeBodyPart();</span><br><span class="line">imagepart.setFileName(fileName);</span><br><span class="line">imagepart.setDataHandler(<span class="keyword">new</span> DataHandler(<span class="keyword">new</span> ByteArrayDataSource(input, <span class="string">&quot;image/jpeg&quot;</span>)));</span><br><span class="line"><span class="comment">// ä¸HTMLçš„&lt;img src=&quot;cid:img01&quot;&gt;å…³è”:</span></span><br><span class="line">imagepart.setHeader(<span class="string">&quot;Content-ID&quot;</span>, <span class="string">&quot;&lt;img01&gt;&quot;</span>);</span><br><span class="line">multipart.addBodyPart(imagepart);</span><br></pre></td></tr></table></figure>

<h3 id="4-7-å¸¸è§é—®é¢˜"><a href="#4-7-å¸¸è§é—®é¢˜" class="headerlink" title="4.7 å¸¸è§é—®é¢˜"></a>4.7 å¸¸è§é—®é¢˜</h3><p>å¦‚æœç”¨æˆ·åæˆ–å£ä»¤é”™è¯¯ï¼Œä¼šå¯¼è‡´<code>535</code>ç™»å½•å¤±è´¥ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">DEBUG SMTP: AUTH LOGIN failed</span><br><span class="line">Exception in thread &quot;main&quot; javax.mail.AuthenticationFailedException: 535 5.7.3 Authentication unsuccessful [HK0PR03CA0105.apcprd03.prod.outlook.com]</span><br></pre></td></tr></table></figure>

<p>å¦‚æœç™»å½•ç”¨æˆ·å’Œå‘ä»¶äººä¸ä¸€è‡´ï¼Œä¼šå¯¼è‡´<code>554</code>æ‹’ç»å‘é€é”™è¯¯ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">DEBUG SMTP: MessagingException while sending, THROW: </span><br><span class="line">com.sun.mail.smtp.SMTPSendFailedException: 554 5.2.0 STOREDRV.Submission.Exception:SendAsDeniedException.MapiExceptionSendAsDenied;</span><br></pre></td></tr></table></figure>

<p>æœ‰äº›æ—¶å€™ï¼Œå¦‚æœé‚®ä»¶ä¸»é¢˜å’Œæ­£æ–‡è¿‡äºç®€å•ï¼Œä¼šå¯¼è‡´<code>554</code>è¢«è¯†åˆ«ä¸ºåƒåœ¾é‚®ä»¶çš„é”™è¯¯ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">DEBUG SMTP: MessagingException while sending, THROW: </span><br><span class="line">com.sun.mail.smtp.SMTPSendFailedException: 554 DT:SPM</span><br></pre></td></tr></table></figure>

<h2 id="5-æ¥æ”¶Email"><a href="#5-æ¥æ”¶Email" class="headerlink" title="5. æ¥æ”¶Email"></a>5. æ¥æ”¶Email</h2><p>æ¥æ”¶é‚®ä»¶æ˜¯æ”¶ä»¶äººç”¨è‡ªå·±çš„å®¢æˆ·ç«¯æŠŠé‚®ä»¶ä»MDAæœåŠ¡å™¨ä¸ŠæŠ“å–åˆ°æœ¬åœ°çš„è¿‡ç¨‹ã€‚</p>
<p>æ¥æ”¶é‚®ä»¶ä½¿ç”¨æœ€å¹¿æ³›çš„åè®®æ˜¯<strong>POP3</strong>ï¼šPost Office Protocol version 3ï¼Œå®ƒä¹Ÿæ˜¯ä¸€ä¸ªå»ºç«‹åœ¨TCPè¿æ¥ä¹‹ä¸Šçš„åè®®ã€‚POP3æœåŠ¡å™¨çš„æ ‡å‡†ç«¯å£æ˜¯110ï¼Œå¦‚æœæ•´ä¸ªä¼šè¯éœ€è¦åŠ å¯†ï¼Œé‚£ä¹ˆä½¿ç”¨åŠ å¯†ç«¯å£995ã€‚</p>
<p>å¦ä¸€ç§æ¥æ”¶é‚®ä»¶çš„åè®®æ˜¯<strong>IMAP</strong>ï¼šInternet Mail Access Protocolï¼Œå®ƒä½¿ç”¨æ ‡å‡†ç«¯å£143å’ŒåŠ å¯†ç«¯å£993ã€‚</p>
<p><strong>IMAPå’ŒPOP3çš„ä¸»è¦åŒºåˆ«</strong>æ˜¯ï¼ŒIMAPåè®®åœ¨æœ¬åœ°çš„æ‰€æœ‰æ“ä½œéƒ½ä¼šè‡ªåŠ¨åŒæ­¥åˆ°æœåŠ¡å™¨ä¸Šï¼Œå¹¶ä¸”ï¼ŒIMAPå¯ä»¥å…è®¸ç”¨æˆ·åœ¨é‚®ä»¶æœåŠ¡å™¨çš„æ”¶ä»¶ç®±ä¸­åˆ›å»ºæ–‡ä»¶å¤¹ã€‚</p>
<p>JavaMailä¹Ÿæä¾›äº†IMAPåè®®çš„æ”¯æŒã€‚å› ä¸ºPOP3å’ŒIMAPçš„ä½¿ç”¨æ–¹å¼éå¸¸ç±»ä¼¼ï¼Œå› æ­¤æˆ‘ä»¬åªä»‹ç»POP3çš„ç”¨æ³•ã€‚</p>
<p>ä½¿ç”¨POP3æ”¶å–Emailæ—¶ï¼Œæˆ‘ä»¬æ— éœ€å…³å¿ƒPOP3åè®®åº•å±‚ï¼Œå› ä¸ºJavaMailæä¾›äº†é«˜å±‚æ¥å£ã€‚é¦–å…ˆéœ€è¦è¿æ¥åˆ°Storeå¯¹è±¡ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å‡†å¤‡ç™»å½•ä¿¡æ¯:</span></span><br><span class="line">String host = <span class="string">&quot;pop3.example.com&quot;</span>;</span><br><span class="line"><span class="keyword">int</span> port = <span class="number">995</span>;</span><br><span class="line">String username = <span class="string">&quot;bob@example.com&quot;</span>;</span><br><span class="line">String password = <span class="string">&quot;password&quot;</span>;</span><br><span class="line"></span><br><span class="line">Properties props = <span class="keyword">new</span> Properties();</span><br><span class="line">props.setProperty(<span class="string">&quot;mail.store.protocol&quot;</span>, <span class="string">&quot;pop3&quot;</span>); <span class="comment">// åè®®åç§°</span></span><br><span class="line">props.setProperty(<span class="string">&quot;mail.pop3.host&quot;</span>, host);<span class="comment">// POP3ä¸»æœºå</span></span><br><span class="line">props.setProperty(<span class="string">&quot;mail.pop3.port&quot;</span>, String.valueOf(port)); <span class="comment">// ç«¯å£å·</span></span><br><span class="line"><span class="comment">// å¯åŠ¨SSL:</span></span><br><span class="line">props.put(<span class="string">&quot;mail.smtp.socketFactory.class&quot;</span>, <span class="string">&quot;javax.net.ssl.SSLSocketFactory&quot;</span>);</span><br><span class="line">props.put(<span class="string">&quot;mail.smtp.socketFactory.port&quot;</span>, String.valueOf(port));</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿æ¥åˆ°Store:</span></span><br><span class="line">URLName url = <span class="keyword">new</span> URLName(<span class="string">&quot;pop3&quot;</span>, host, post, <span class="string">&quot;&quot;</span>, username, password);</span><br><span class="line">Session session = Session.getInstance(props, <span class="keyword">null</span>);</span><br><span class="line">session.setDebug(<span class="keyword">true</span>); <span class="comment">// æ˜¾ç¤ºè°ƒè¯•ä¿¡æ¯</span></span><br><span class="line">Store store = <span class="keyword">new</span> POP3SSLStore(session, url);</span><br><span class="line">store.connect();</span><br></pre></td></tr></table></figure>

<p>ä¸€ä¸ª<code>Store</code>å¯¹è±¡è¡¨ç¤ºæ•´ä¸ªé‚®ç®±çš„å­˜å‚¨ï¼Œè¦æ”¶å–é‚®ä»¶ï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡<code>Store</code>è®¿é—®æŒ‡å®šçš„<code>Folder</code>ï¼ˆæ–‡ä»¶å¤¹ï¼‰ï¼Œé€šå¸¸æ˜¯<code>INBOX</code>è¡¨ç¤ºæ”¶ä»¶ç®±ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è·å–æ”¶ä»¶ç®±:</span></span><br><span class="line">Folder folder = store.getFolder(<span class="string">&quot;INBOX&quot;</span>);</span><br><span class="line"><span class="comment">// ä»¥è¯»å†™æ–¹å¼æ‰“å¼€:</span></span><br><span class="line">folder.open(Folder.READ_WRITE);</span><br><span class="line"><span class="comment">// æ‰“å°é‚®ä»¶æ€»æ•°/æ–°é‚®ä»¶æ•°é‡/æœªè¯»æ•°é‡/å·²åˆ é™¤æ•°é‡:</span></span><br><span class="line">System.out.println(<span class="string">&quot;Total messages: &quot;</span> + folder.getMessageCount());</span><br><span class="line">System.out.println(<span class="string">&quot;New messages: &quot;</span> + folder.getNewMessageCount());</span><br><span class="line">System.out.println(<span class="string">&quot;Unread messages: &quot;</span> + folder.getUnreadMessageCount());</span><br><span class="line">System.out.println(<span class="string">&quot;Deleted messages: &quot;</span> + folder.getDeletedMessageCount());</span><br><span class="line"><span class="comment">// è·å–æ¯ä¸€å°é‚®ä»¶:</span></span><br><span class="line">Message[] messages = folder.getMessages();</span><br><span class="line"><span class="keyword">for</span> (Message message : messages) &#123;</span><br><span class="line">    <span class="comment">// æ‰“å°æ¯ä¸€å°é‚®ä»¶:</span></span><br><span class="line">    printMessage((MimeMessage) message);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å½“æˆ‘ä»¬è·å–åˆ°ä¸€ä¸ª<code>Message</code>å¯¹è±¡æ—¶ï¼Œå¯ä»¥å¼ºåˆ¶è½¬å‹ä¸ºMimeMessageï¼Œç„¶åæ‰“å°å‡ºé‚®ä»¶ä¸»é¢˜ã€å‘ä»¶äººã€æ”¶ä»¶äººç­‰ä¿¡æ¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">printMessage</span><span class="params">(MimeMessage msg)</span> <span class="keyword">throws</span> IOException, MessagingException </span>&#123;</span><br><span class="line">    <span class="comment">// é‚®ä»¶ä¸»é¢˜:</span></span><br><span class="line">    System.out.println(<span class="string">&quot;Subject: &quot;</span> + MimeUtility.decodeText(msg.getSubject()));</span><br><span class="line">    <span class="comment">// å‘ä»¶äºº:</span></span><br><span class="line">    Address[] froms = msg.getFrom();</span><br><span class="line">    InternetAddress address = (InternetAddress) froms[<span class="number">0</span>];</span><br><span class="line">    String personal = address.getPersonal();</span><br><span class="line">    String from = personal == <span class="keyword">null</span> ? address.getAddress() : (MimeUtility.decodeText(personal) + <span class="string">&quot; &lt;&quot;</span> + address.getAddress() + <span class="string">&quot;&gt;&quot;</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;From: &quot;</span> + from);</span><br><span class="line">    <span class="comment">// ç»§ç»­æ‰“å°æ”¶ä»¶äºº:</span></span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¯”è¾ƒéº»çƒ¦çš„æ˜¯è·å–é‚®ä»¶çš„æ­£æ–‡ã€‚ä¸€ä¸ª<code>MimeMessage</code>å¯¹è±¡ä¹Ÿæ˜¯ä¸€ä¸ª<code>Part</code>å¯¹è±¡ï¼Œå®ƒå¯èƒ½åªåŒ…å«ä¸€ä¸ªæ–‡æœ¬ï¼Œä¹Ÿå¯èƒ½æ˜¯ä¸€ä¸ª<code>Multipart</code>å¯¹è±¡ï¼Œå³ç”±å‡ ä¸ª<code>Part</code>æ„æˆï¼Œå› æ­¤ï¼Œéœ€è¦é€’å½’åœ°è§£æå‡ºå®Œæ•´çš„æ­£æ–‡ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function">String <span class="title">getBody</span><span class="params">(Part part)</span> <span class="keyword">throws</span> MessagingException, IOException </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (part.isMimeType(<span class="string">&quot;text/*&quot;</span>)) &#123;</span><br><span class="line">        <span class="comment">// Partæ˜¯æ–‡æœ¬:</span></span><br><span class="line">        <span class="keyword">return</span> part.getContent().toString();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (part.isMimeType(<span class="string">&quot;multipart/*&quot;</span>)) &#123;</span><br><span class="line">        <span class="comment">// Partæ˜¯ä¸€ä¸ªMultipartå¯¹è±¡:</span></span><br><span class="line">        Multipart multipart = (Multipart) part.getContent();</span><br><span class="line">        <span class="comment">// å¾ªç¯è§£ææ¯ä¸ªå­Part:</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; multipart.getCount(); i++) &#123;</span><br><span class="line">            BodyPart bodyPart = multipart.getBodyPart(i);</span><br><span class="line">            String body = getBody(bodyPart);</span><br><span class="line">            <span class="keyword">if</span> (!body.isEmpty()) &#123;</span><br><span class="line">                <span class="keyword">return</span> body;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æœ€åè®°å¾—å…³é—­<code>Folder</code>å’Œ<code>Store</code>ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">folder.close(<span class="keyword">true</span>); <span class="comment">// ä¼ å…¥trueè¡¨ç¤ºåˆ é™¤æ“ä½œä¼šåŒæ­¥åˆ°æœåŠ¡å™¨ä¸Šï¼ˆå³åˆ é™¤æœåŠ¡å™¨æ”¶ä»¶ç®±çš„é‚®ä»¶ï¼‰</span></span><br><span class="line">store.close();</span><br></pre></td></tr></table></figure>

<h2 id="6-HTTPç¼–ç¨‹"><a href="#6-HTTPç¼–ç¨‹" class="headerlink" title="6. HTTPç¼–ç¨‹"></a>6. HTTPç¼–ç¨‹</h2><p>HTTPæ˜¯HyperText Transfer Protocolçš„ç¼©å†™ï¼Œç¿»è¯‘ä¸ºè¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼Œå®ƒæ˜¯åŸºäºTCPåè®®ä¹‹ä¸Šçš„ä¸€ç§è¯·æ±‚-å“åº”åè®®ã€‚</p>
<p>å½“æµè§ˆå™¨å¸Œæœ›è®¿é—®æŸä¸ªç½‘ç«™æ—¶ï¼Œæµè§ˆå™¨å’Œç½‘ç«™æœåŠ¡å™¨ä¹‹é—´é¦–å…ˆå»ºç«‹TCPè¿æ¥ï¼Œä¸”æœåŠ¡å™¨æ€»æ˜¯ä½¿ç”¨<code>80</code>ç«¯å£å’ŒåŠ å¯†ç«¯å£<code>443</code>ï¼Œç„¶åï¼Œæµè§ˆå™¨å‘æœåŠ¡å™¨å‘é€ä¸€ä¸ªHTTPè¯·æ±‚ï¼ŒæœåŠ¡å™¨æ”¶åˆ°åï¼Œè¿”å›ä¸€ä¸ªHTTPå“åº”ï¼Œå¹¶ä¸”åœ¨å“åº”ä¸­åŒ…å«äº†HTMLçš„ç½‘é¡µå†…å®¹ï¼Œè¿™æ ·ï¼Œæµè§ˆå™¨è§£æHTMLåå°±å¯ä»¥ç»™ç”¨æˆ·æ˜¾ç¤ºç½‘é¡µäº†ã€‚</p>
<p><img src="https://raw.githubusercontent.com/ghj1998/image_repository/main/image-20210508210525080.png" alt="image-20210508210525080"></p>
<p>HTTPè¯·æ±‚çš„æ ¼å¼æ˜¯å›ºå®šçš„ï¼Œå®ƒç”±HTTP Headerå’ŒHTTP Bodyä¸¤éƒ¨åˆ†æ„æˆã€‚ç¬¬ä¸€è¡Œæ€»æ˜¯<code>è¯·æ±‚æ–¹æ³• è·¯å¾„ HTTPç‰ˆæœ¬</code>ï¼Œä¾‹å¦‚ï¼Œ<code>GET / HTTP/1.1</code>è¡¨ç¤ºä½¿ç”¨<code>GET</code>è¯·æ±‚ï¼Œè·¯å¾„æ˜¯<code>/</code>ï¼Œç‰ˆæœ¬æ˜¯<code>HTTP/1.1</code>ã€‚</p>
<p>åç»­çš„æ¯ä¸€è¡Œéƒ½æ˜¯å›ºå®šçš„<code>Header: Value</code>æ ¼å¼ï¼Œæˆ‘ä»¬ç§°ä¸ºHTTP Headerï¼ŒæœåŠ¡å™¨ä¾é æŸäº›ç‰¹å®šçš„Headeræ¥è¯†åˆ«å®¢æˆ·ç«¯è¯·æ±‚ï¼Œä¾‹å¦‚ï¼š</p>
<ul>
<li><p>Hostï¼šè¯·æ±‚çš„åŸŸå</p>
</li>
<li><p>User-Agentï¼šå®¢æˆ·ç«¯æ ‡è¯†ï¼ˆåˆ¤æ–­æ¥è‡ªä»€ä¹ˆæµè§ˆå™¨æˆ–è€…æ˜¯å¦æ¥è‡ªçˆ¬è™«ï¼‰</p>
<p><em>çˆ¬è™«å¯ä»¥éšä¾¿ä¿®æ”¹è¿™ä¸ªä¿¡æ¯ï¼Œä¼ªè£…è‡ªå·±ã€‚ä¸çŸ¥é“è¿˜æœ‰å•¥ç”¨ã€‚</em></p>
</li>
<li><p>Acceptï¼šå®¢æˆ·ç«¯èƒ½å¤„ç†çš„HTTPå“åº”æ ¼å¼ï¼Œ*/*è¡¨ç¤ºä»»æ„æ ¼å¼ï¼Œtext/*è¡¨ç¤ºä»»æ„æ–‡æœ¬ï¼Œimage/pngè¡¨ç¤ºpngæ ¼å¼çš„å›¾ç‰‡ã€‚</p>
</li>
<li><p>Accept-Languageï¼šè¡¨ç¤ºå®¢æˆ·ç«¯èƒ½æ¥å—çš„è¯­è¨€ã€‚</p>
</li>
</ul>
<p>å¦‚æœæ˜¯<code>GET</code>è¯·æ±‚ï¼Œé‚£ä¹ˆè¯¥HTTPè¯·æ±‚åªæœ‰HTTP Headerï¼Œæ²¡æœ‰HTTP Bodyã€‚å¦‚æœæ˜¯<code>POST</code>è¯·æ±‚ï¼Œé‚£ä¹ˆè¯¥HTTPè¯·æ±‚å¸¦æœ‰Bodyï¼Œä»¥ä¸€ä¸ªç©ºè¡Œåˆ†éš”ã€‚ä¸€ä¸ªå…¸å‹çš„å¸¦Bodyçš„HTTPè¯·æ±‚å¦‚ä¸‹ï¼š</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="string">POST</span> <span class="string">/login</span> <span class="string">HTTP/1.1</span></span><br><span class="line"><span class="attr">Host:</span> <span class="string">www.example.com</span></span><br><span class="line"><span class="attr">Content-Type:</span> <span class="string">application/x-www-form-urlencoded</span></span><br><span class="line"><span class="attr">Content-Length:</span> <span class="number">30</span></span><br><span class="line"></span><br><span class="line"><span class="string">username=hello&amp;password=123456</span></span><br></pre></td></tr></table></figure>

<p><code>POST</code>è¯·æ±‚é€šå¸¸è¦è®¾ç½®<code>Content-Type</code>è¡¨ç¤ºBodyçš„ç±»å‹ï¼Œ<code>Content-Length</code>è¡¨ç¤ºBodyçš„é•¿åº¦ï¼Œè¿™æ ·æœåŠ¡å™¨å°±å¯ä»¥æ ¹æ®è¯·æ±‚çš„Headerå’ŒBodyåšå‡ºæ­£ç¡®çš„å“åº”ã€‚</p>
<p><code>GET</code>è¯·æ±‚çš„å‚æ•°å¿…é¡»é™„åŠ åœ¨URLä¸Šï¼Œå¹¶ä»¥URLEncodeæ–¹å¼ç¼–ç ï¼Œä¾‹å¦‚ï¼š<code>http://www.example.com/?a=1&amp;b=K%26R</code>ï¼Œå‚æ•°åˆ†åˆ«æ˜¯<code>a=1</code>å’Œ<code>b=K&amp;R</code>ã€‚</p>
<p><code>POST</code>è¯·æ±‚çš„å‚æ•°ä¸ä¸€å®šæ˜¯URLç¼–ç ï¼Œå¯ä»¥æŒ‰ä»»æ„æ ¼å¼ç¼–ç ï¼Œåªéœ€è¦åœ¨<code>Content-Type</code>ä¸­æ­£ç¡®è®¾ç½®å³å¯ã€‚å¸¸è§çš„å‘é€JSONçš„<code>POST</code>è¯·æ±‚å¦‚ä¸‹ï¼š</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="string">POST</span> <span class="string">/login</span> <span class="string">HTTP/1.1</span></span><br><span class="line"><span class="attr">Content-Type:</span> <span class="string">application/json</span></span><br><span class="line"><span class="attr">Content-Length:</span> <span class="number">38</span></span><br><span class="line"></span><br><span class="line">&#123;<span class="string">&quot;username&quot;</span><span class="string">:&quot;bob&quot;</span>,<span class="string">&quot;password&quot;</span><span class="string">:&quot;123456&quot;</span>&#125;</span><br></pre></td></tr></table></figure>

<p>å…¸å‹çš„HTTPå“åº”å¦‚ä¸‹ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Content-Type: text/html</span><br><span class="line">Content-Length: 133251</span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>å“åº”çš„ç¬¬ä¸€è¡Œæ€»æ˜¯<code>HTTPç‰ˆæœ¬ å“åº”ä»£ç  å“åº”è¯´æ˜</code>ï¼Œä¾‹å¦‚ï¼Œ<code>HTTP/1.1 200 OK</code>è¡¨ç¤ºç‰ˆæœ¬æ˜¯<code>HTTP/1.1</code>ï¼Œå“åº”ä»£ç æ˜¯<code>200</code>ï¼Œå“åº”è¯´æ˜æ˜¯<code>OK</code>ã€‚</p>
<p>å“åº”ä»£ç ï¼š</p>
<ul>
<li>1xxï¼šè¡¨ç¤ºä¸€ä¸ªæç¤ºæ€§å“åº”ï¼Œä¾‹å¦‚101è¡¨ç¤ºå°†åˆ‡æ¢åè®®ï¼Œå¸¸è§äºWebSocketè¿æ¥ï¼›</li>
<li>2xxï¼šè¡¨ç¤ºä¸€ä¸ªæˆåŠŸçš„å“åº”ï¼Œä¾‹å¦‚200è¡¨ç¤ºæˆåŠŸï¼Œ206è¡¨ç¤ºåªå‘é€äº†éƒ¨åˆ†å†…å®¹ï¼›</li>
<li>3xxï¼šè¡¨ç¤ºä¸€ä¸ªé‡å®šå‘çš„å“åº”ï¼Œä¾‹å¦‚301è¡¨ç¤ºæ°¸ä¹…é‡å®šå‘ï¼Œ303è¡¨ç¤ºå®¢æˆ·ç«¯åº”è¯¥æŒ‰æŒ‡å®šè·¯å¾„é‡æ–°å‘é€è¯·æ±‚ï¼›</li>
<li>4xxï¼šè¡¨ç¤ºä¸€ä¸ªå› ä¸ºå®¢æˆ·ç«¯é—®é¢˜å¯¼è‡´çš„é”™è¯¯å“åº”ï¼Œä¾‹å¦‚400è¡¨ç¤ºå› ä¸ºContent-Typeç­‰å„ç§åŸå› å¯¼è‡´çš„æ— æ•ˆè¯·æ±‚ï¼Œ404è¡¨ç¤ºæŒ‡å®šçš„è·¯å¾„ä¸å­˜åœ¨ï¼›</li>
<li>5xxï¼šè¡¨ç¤ºä¸€ä¸ªå› ä¸ºæœåŠ¡å™¨é—®é¢˜å¯¼è‡´çš„é”™è¯¯å“åº”ï¼Œä¾‹å¦‚500è¡¨ç¤ºæœåŠ¡å™¨å†…éƒ¨æ•…éšœï¼Œ503è¡¨ç¤ºæœåŠ¡å™¨æš‚æ—¶æ— æ³•å“åº”ã€‚</li>
</ul>
<p>å½“æµè§ˆå™¨æ”¶åˆ°ç¬¬ä¸€ä¸ªHTTPå“åº”åï¼Œå®ƒè§£æHTMLåï¼Œåˆä¼šå‘é€ä¸€ç³»åˆ—HTTPè¯·æ±‚ï¼Œä¾‹å¦‚ï¼Œ<code>GET /logo.jpg HTTP/1.1</code>è¯·æ±‚ä¸€ä¸ªå›¾ç‰‡ï¼ŒæœåŠ¡å™¨å“åº”å›¾ç‰‡è¯·æ±‚åï¼Œä¼šç›´æ¥æŠŠäºŒè¿›åˆ¶å†…å®¹çš„å›¾ç‰‡å‘é€ç»™æµè§ˆå™¨ï¼š</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="string">HTTP/1.1</span> <span class="number">200</span> <span class="string">OK</span></span><br><span class="line"><span class="attr">Content-Type:</span> <span class="string">image/jpeg</span></span><br><span class="line"><span class="attr">Content-Length:</span> <span class="number">18391</span></span><br><span class="line"></span><br><span class="line"><span class="string">????JFIFHH??XExifMM?i&amp;??X?...(äºŒè¿›åˆ¶çš„JPEGå›¾ç‰‡)</span></span><br></pre></td></tr></table></figure>

<p>HTTP/1.0åè®®ï¼Œæ¯æ¬¡å‘é€ä¸€ä¸ªHTTPè¯·æ±‚ï¼Œå®¢æˆ·ç«¯éƒ½éœ€è¦å…ˆåˆ›å»ºä¸€ä¸ªæ–°çš„TCPè¿æ¥ã€‚</p>
<p>HTTP/1.1åè®®å…è®¸åœ¨ä¸€ä¸ªTCPè¿æ¥ä¸­åå¤å‘é€-å“åº”ã€‚</p>
<p>HTTP/2.0å…è®¸å®¢æˆ·ç«¯åœ¨æ²¡æœ‰æ”¶åˆ°å“åº”çš„æ—¶å€™ï¼Œå‘é€å¤šä¸ªHTTPè¯·æ±‚ï¼ŒæœåŠ¡å™¨è¿”å›å“åº”çš„æ—¶å€™ï¼Œä¸ä¸€å®šæŒ‰é¡ºåºè¿”å›ï¼Œåªè¦åŒæ–¹èƒ½è¯†åˆ«å‡ºå“ªä¸ªå“åº”å¯¹åº”å“ªä¸ªè¯·æ±‚ï¼Œå°±å¯ä»¥åšåˆ°å¹¶è¡Œå‘é€å’Œæ¥æ”¶ï¼š</p>
<p>Java 11å¼€å§‹ï¼Œå¼•å…¥äº†æ–°çš„<code>HttpClient</code>ï¼Œå®ƒä½¿ç”¨é“¾å¼è°ƒç”¨çš„APIï¼Œèƒ½å¤§å¤§ç®€åŒ–HTTPçš„å¤„ç†ã€‚</p>
<p>é¦–å…ˆéœ€è¦åˆ›å»ºä¸€ä¸ªå…¨å±€<code>HttpClient</code>å®ä¾‹ï¼Œå› ä¸º<code>HttpClient</code>å†…éƒ¨ä½¿ç”¨çº¿ç¨‹æ± ä¼˜åŒ–å¤šä¸ªHTTPè¿æ¥ï¼Œå¯ä»¥å¤ç”¨ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> HttpClient httpClient = HttpClient.newBuilder().build();</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨<code>GET</code>è¯·æ±‚è·å–æ–‡æœ¬å†…å®¹ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.net.URI;</span><br><span class="line"><span class="keyword">import</span> java.net.http.*;</span><br><span class="line"><span class="keyword">import</span> java.net.http.HttpClient.Version;</span><br><span class="line"><span class="keyword">import</span> java.time.Duration;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="comment">// å…¨å±€HttpClient:</span></span><br><span class="line">    <span class="keyword">static</span> HttpClient httpClient = HttpClient.newBuilder().build();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        String url = <span class="string">&quot;https://www.sina.com.cn/&quot;</span>;</span><br><span class="line">        HttpRequest request = HttpRequest.newBuilder(<span class="keyword">new</span> URI(url))</span><br><span class="line">            <span class="comment">// è®¾ç½®Header:</span></span><br><span class="line">            .header(<span class="string">&quot;User-Agent&quot;</span>, <span class="string">&quot;Java HttpClient&quot;</span>).header(<span class="string">&quot;Accept&quot;</span>, <span class="string">&quot;*/*&quot;</span>)</span><br><span class="line">            <span class="comment">// è®¾ç½®è¶…æ—¶:</span></span><br><span class="line">            .timeout(Duration.ofSeconds(<span class="number">5</span>))</span><br><span class="line">            <span class="comment">// è®¾ç½®ç‰ˆæœ¬:</span></span><br><span class="line">            .version(Version.HTTP_2).build();</span><br><span class="line">        HttpResponse&lt;String&gt; response = httpClient.send(request, HttpResponse.BodyHandlers.ofString());</span><br><span class="line">        <span class="comment">// HTTPå…è®¸é‡å¤çš„Headerï¼Œå› æ­¤ä¸€ä¸ªHeaderå¯å¯¹åº”å¤šä¸ªValue:</span></span><br><span class="line">        Map&lt;String, List&lt;String&gt;&gt; headers = response.headers().map();</span><br><span class="line">        <span class="keyword">for</span> (String header : headers.keySet()) &#123;</span><br><span class="line">            System.out.println(header + <span class="string">&quot;: &quot;</span> + headers.get(header).get(<span class="number">0</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(response.body().substring(<span class="number">0</span>, <span class="number">1024</span>) + <span class="string">&quot;...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœæˆ‘ä»¬è¦è·å–å›¾ç‰‡è¿™æ ·çš„äºŒè¿›åˆ¶å†…å®¹ï¼Œåªéœ€è¦æŠŠ<code>HttpResponse.BodyHandlers.ofString()</code>æ¢æˆ<code>HttpResponse.BodyHandlers.ofByteArray()</code>ï¼Œå°±å¯ä»¥è·å¾—ä¸€ä¸ª<code>HttpResponse&lt;byte[]&gt;</code>å¯¹è±¡ã€‚å¦‚æœå“åº”çš„å†…å®¹å¾ˆå¤§ï¼Œä¸å¸Œæœ›ä¸€æ¬¡æ€§å…¨éƒ¨åŠ è½½åˆ°å†…å­˜ï¼Œå¯ä»¥ä½¿ç”¨<code>HttpResponse.BodyHandlers.ofInputStream()</code>è·å–ä¸€ä¸ª<code>InputStream</code>æµã€‚</p>
<p>è¦ä½¿ç”¨<code>POST</code>è¯·æ±‚ï¼Œæˆ‘ä»¬è¦å‡†å¤‡å¥½å‘é€çš„Bodyæ•°æ®å¹¶æ­£ç¡®è®¾ç½®<code>Content-Type</code>ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">String url = <span class="string">&quot;http://www.example.com/login&quot;</span>;</span><br><span class="line">String body = <span class="string">&quot;username=bob&amp;password=123456&quot;</span>;</span><br><span class="line">HttpRequest request = HttpRequest.newBuilder(<span class="keyword">new</span> URI(url))</span><br><span class="line">    <span class="comment">// è®¾ç½®Header:</span></span><br><span class="line">    .header(<span class="string">&quot;Accept&quot;</span>, <span class="string">&quot;*/*&quot;</span>)</span><br><span class="line">    .header(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;application/x-www-form-urlencoded&quot;</span>)</span><br><span class="line">    <span class="comment">// è®¾ç½®è¶…æ—¶:</span></span><br><span class="line">    .timeout(Duration.ofSeconds(<span class="number">5</span>))</span><br><span class="line">    <span class="comment">// è®¾ç½®ç‰ˆæœ¬:</span></span><br><span class="line">    .version(Version.HTTP_2)</span><br><span class="line">    <span class="comment">// ä½¿ç”¨POSTå¹¶è®¾ç½®Body:</span></span><br><span class="line">    .POST(BodyPublishers.ofString(body, StandardCharsets.UTF_8)).build();</span><br><span class="line">HttpResponse&lt;String&gt; response = httpClient.send(request, HttpResponse.BodyHandlers.ofString());</span><br><span class="line">String s = response.body();</span><br></pre></td></tr></table></figure>

<h2 id="7-RMIè¿œç¨‹è°ƒç”¨"><a href="#7-RMIè¿œç¨‹è°ƒç”¨" class="headerlink" title="7. RMIè¿œç¨‹è°ƒç”¨"></a>7. RMIè¿œç¨‹è°ƒç”¨</h2><p>Javaçš„RMIè¿œç¨‹è°ƒç”¨æ˜¯æŒ‡ï¼Œä¸€ä¸ªJVMä¸­çš„ä»£ç å¯ä»¥é€šè¿‡ç½‘ç»œå®ç°è¿œç¨‹è°ƒç”¨å¦ä¸€ä¸ªJVMçš„æŸä¸ªæ–¹æ³•ã€‚RMIæ˜¯Remote Method Invocationçš„ç¼©å†™ã€‚</p>
<p>æä¾›æœåŠ¡çš„ä¸€æ–¹æˆ‘ä»¬ç§°ä¹‹ä¸ºæœåŠ¡å™¨ï¼Œè€Œå®ç°è¿œç¨‹è°ƒç”¨çš„ä¸€æ–¹æˆ‘ä»¬ç§°ä¹‹ä¸ºå®¢æˆ·ç«¯ã€‚</p>
<p>æˆ‘ä»¬å…ˆæ¥å®ç°ä¸€ä¸ªæœ€ç®€å•çš„RMIï¼šæœåŠ¡å™¨ä¼šæä¾›ä¸€ä¸ª<code>WorldClock</code>æœåŠ¡ï¼Œå…è®¸å®¢æˆ·ç«¯è·å–æŒ‡å®šæ—¶åŒºçš„æ—¶é—´ï¼Œå³å…è®¸å®¢æˆ·ç«¯è°ƒç”¨ä¸‹é¢çš„æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function">LocalDateTime <span class="title">getLocalDateTime</span><span class="params">(String zoneId)</span></span>;</span><br></pre></td></tr></table></figure>

<p>è¦å®ç°RMIï¼ŒæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯å¿…é¡»å…±äº«åŒä¸€ä¸ªæ¥å£ã€‚æˆ‘ä»¬å®šä¹‰ä¸€ä¸ª<code>WorldClock</code>æ¥å£ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">WorldClock</span> <span class="keyword">extends</span> <span class="title">Remote</span> </span>&#123;</span><br><span class="line">    <span class="function">LocalDateTime <span class="title">getLocalDateTime</span><span class="params">(String zoneId)</span> <span class="keyword">throws</span> RemoteException</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Javaçš„RMIè§„å®šæ­¤æ¥å£å¿…é¡»æ´¾ç”Ÿè‡ª<code>java.rmi.Remote</code>ï¼Œå¹¶åœ¨æ¯ä¸ªæ–¹æ³•å£°æ˜æŠ›å‡º<code>RemoteException</code>ã€‚</p>
<p>ä¸‹ä¸€æ­¥æ˜¯ç¼–å†™æœåŠ¡å™¨çš„å®ç°ç±»ï¼Œå› ä¸ºå®¢æˆ·ç«¯è¯·æ±‚çš„è°ƒç”¨æ–¹æ³•<code>getLocalDateTime()</code>æœ€ç»ˆä¼šé€šè¿‡è¿™ä¸ªå®ç°ç±»è¿”å›ç»“æœã€‚å®ç°ç±»<code>WorldClockService</code>ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WorldClockService</span> <span class="keyword">implements</span> <span class="title">WorldClock</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> LocalDateTime <span class="title">getLocalDateTime</span><span class="params">(String zoneId)</span> <span class="keyword">throws</span> RemoteException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> LocalDateTime.now(ZoneId.of(zoneId)).withNano(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬éœ€è¦é€šè¿‡Java RMIæä¾›çš„ä¸€ç³»åˆ—åº•å±‚æ”¯æŒæ¥å£ï¼ŒæŠŠä¸Šé¢ç¼–å†™çš„æœåŠ¡ä»¥RMIçš„å½¢å¼æš´éœ²åœ¨ç½‘ç»œä¸Šï¼Œå®¢æˆ·ç«¯æ‰èƒ½è°ƒç”¨ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Server</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> RemoteException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;create World clock remote service...&quot;</span>);</span><br><span class="line">        <span class="comment">// å®ä¾‹åŒ–ä¸€ä¸ªWorldClock:</span></span><br><span class="line">        WorldClock worldClock = <span class="keyword">new</span> WorldClockService();</span><br><span class="line">        <span class="comment">// å°†æ­¤æœåŠ¡è½¬æ¢ä¸ºè¿œç¨‹æœåŠ¡æ¥å£:</span></span><br><span class="line">        WorldClock skeleton = (WorldClock) UnicastRemoteObject.exportObject(worldClock, <span class="number">0</span>);</span><br><span class="line">        <span class="comment">// å°†RMIæœåŠ¡æ³¨å†Œåˆ°1099ç«¯å£:</span></span><br><span class="line">        Registry registry = LocateRegistry.createRegistry(<span class="number">1099</span>);</span><br><span class="line">        <span class="comment">// æ³¨å†Œæ­¤æœåŠ¡ï¼ŒæœåŠ¡åä¸º&quot;WorldClock&quot;:</span></span><br><span class="line">        registry.rebind(<span class="string">&quot;WorldClock&quot;</span>, skeleton);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸Šè¿°ä»£ç ä¸»è¦ç›®çš„æ˜¯é€šè¿‡RMIæä¾›çš„ç›¸å…³ç±»ï¼Œå°†æˆ‘ä»¬è‡ªå·±çš„<code>WorldClock</code>å®ä¾‹æ³¨å†Œåˆ°RMIæœåŠ¡ä¸Šã€‚RMIçš„é»˜è®¤ç«¯å£æ˜¯<code>1099</code>ï¼Œæœ€åä¸€æ­¥æ³¨å†ŒæœåŠ¡æ—¶é€šè¿‡<code>rebind()</code>æŒ‡å®šæœåŠ¡åç§°ä¸º<code>&quot;WorldClock&quot;</code>ã€‚</p>
<p>å®¢æˆ·ç«¯ä»£ç ï¼š</p>
<p>RMIè¦æ±‚æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯å…±äº«åŒä¸€ä¸ªæ¥å£ï¼Œå› æ­¤æˆ‘ä»¬è¦æŠŠ<code>WorldClock.java</code>è¿™ä¸ªæ¥å£æ–‡ä»¶å¤åˆ¶åˆ°å®¢æˆ·ç«¯ï¼Œç„¶ååœ¨å®¢æˆ·ç«¯å®ç°RMIè°ƒç”¨ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> RemoteException, NotBoundException </span>&#123;</span><br><span class="line">        <span class="comment">// è¿æ¥åˆ°æœåŠ¡å™¨localhostï¼Œç«¯å£1099:</span></span><br><span class="line">        Registry registry = LocateRegistry.getRegistry(<span class="string">&quot;localhost&quot;</span>, <span class="number">1099</span>);</span><br><span class="line">        <span class="comment">// æŸ¥æ‰¾åç§°ä¸º&quot;WorldClock&quot;çš„æœåŠ¡å¹¶å¼ºåˆ¶è½¬å‹ä¸ºWorldClockæ¥å£:</span></span><br><span class="line">        WorldClock worldClock = (WorldClock) registry.lookup(<span class="string">&quot;WorldClock&quot;</span>);</span><br><span class="line">        <span class="comment">// æ­£å¸¸è°ƒç”¨æ¥å£æ–¹æ³•:</span></span><br><span class="line">        LocalDateTime now = worldClock.getLocalDateTime(<span class="string">&quot;Asia/Shanghai&quot;</span>);</span><br><span class="line">        <span class="comment">// æ‰“å°è°ƒç”¨ç»“æœ:</span></span><br><span class="line">        System.out.println(now);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å®¢æˆ·ç«¯æŒæœ‰çš„<code>WorldClock</code>æ¥å£å®é™…ä¸Šå¯¹åº”äº†ä¸€ä¸ªâ€œå®ç°ç±»â€ï¼Œå®ƒæ˜¯ç”±<code>Registry</code>å†…éƒ¨åŠ¨æ€ç”Ÿæˆçš„ï¼Œå¹¶è´Ÿè´£æŠŠæ–¹æ³•è°ƒç”¨é€šè¿‡ç½‘ç»œä¼ é€’åˆ°æœåŠ¡å™¨ç«¯ã€‚è€ŒæœåŠ¡å™¨ç«¯æ¥æ”¶ç½‘ç»œè°ƒç”¨çš„æœåŠ¡å¹¶ä¸æ˜¯æˆ‘ä»¬è‡ªå·±ç¼–å†™çš„<code>WorldClockService</code>ï¼Œè€Œæ˜¯<code>Registry</code>è‡ªåŠ¨ç”Ÿæˆçš„ä»£ç ã€‚æˆ‘ä»¬æŠŠå®¢æˆ·ç«¯çš„â€œå®ç°ç±»â€ç§°ä¸º<code>stub</code>ï¼Œè€ŒæœåŠ¡å™¨ç«¯çš„ç½‘ç»œæœåŠ¡ç±»ç§°ä¸º<code>skeleton</code>ï¼Œå®ƒä¼šçœŸæ­£è°ƒç”¨æœåŠ¡å™¨ç«¯çš„<code>WorldClockService</code>ï¼Œè·å–ç»“æœï¼Œç„¶åæŠŠç»“æœé€šè¿‡ç½‘ç»œä¼ é€’ç»™å®¢æˆ·ç«¯ã€‚</p>
<p><img src="https://raw.githubusercontent.com/ghj1998/image_repository/main/image-20210508214717808.png" alt="image-20210508214717808"></p>
<p>ä½¿ç”¨RMIæ—¶ï¼ŒåŒæ–¹å¿…é¡»æ˜¯å†…ç½‘äº’ç›¸ä¿¡ä»»çš„æœºå™¨ï¼Œä¸è¦æŠŠ1099ç«¯å£æš´éœ²åœ¨å…¬ç½‘ä¸Šä½œä¸ºå¯¹å¤–æœåŠ¡ã€‚</p>
]]></content>
      <tags>
        <tag>JAVA</tag>
        <tag>ç½‘ç»œç¼–ç¨‹</tag>
        <tag>TCP/IP</tag>
      </tags>
  </entry>
</search>
